var zS=Object.defineProperty;var VS=(t,e,n)=>e in t?zS(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n;var m=(t,e,n)=>(VS(t,typeof e!="symbol"?e+"":e,n),n);function jS(t,e){for(var n=0;n<e.length;n++){const i=e[n];if(typeof i!="string"&&!Array.isArray(i)){for(const r in i)if(r!=="default"&&!(r in t)){const s=Object.getOwnPropertyDescriptor(i,r);s&&Object.defineProperty(t,r,s.get?s:{enumerable:!0,get:()=>i[r]})}}}return Object.freeze(Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}))}(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))i(r);new MutationObserver(r=>{for(const s of r)if(s.type==="childList")for(const o of s.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&i(o)}).observe(document,{childList:!0,subtree:!0});function n(r){const s={};return r.integrity&&(s.integrity=r.integrity),r.referrerPolicy&&(s.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?s.credentials="include":r.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function i(r){if(r.ep)return;r.ep=!0;const s=n(r);fetch(r.href,s)}})();var R6=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function hu(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var wv={exports:{}},J={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Jo=Symbol.for("react.element"),WS=Symbol.for("react.portal"),HS=Symbol.for("react.fragment"),$S=Symbol.for("react.strict_mode"),XS=Symbol.for("react.profiler"),YS=Symbol.for("react.provider"),KS=Symbol.for("react.context"),qS=Symbol.for("react.forward_ref"),ZS=Symbol.for("react.suspense"),QS=Symbol.for("react.memo"),JS=Symbol.for("react.lazy"),f_=Symbol.iterator;function GS(t){return t===null||typeof t!="object"?null:(t=f_&&t[f_]||t["@@iterator"],typeof t=="function"?t:null)}var Ev={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},Sv=Object.assign,Av={};function hs(t,e,n){this.props=t,this.context=e,this.refs=Av,this.updater=n||Ev}hs.prototype.isReactComponent={};hs.prototype.setState=function(t,e){if(typeof t!="object"&&typeof t!="function"&&t!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,t,e,"setState")};hs.prototype.forceUpdate=function(t){this.updater.enqueueForceUpdate(this,t,"forceUpdate")};function xv(){}xv.prototype=hs.prototype;function _p(t,e,n){this.props=t,this.context=e,this.refs=Av,this.updater=n||Ev}var mp=_p.prototype=new xv;mp.constructor=_p;Sv(mp,hs.prototype);mp.isPureReactComponent=!0;var d_=Array.isArray,Rv=Object.prototype.hasOwnProperty,yp={current:null},bv={key:!0,ref:!0,__self:!0,__source:!0};function Cv(t,e,n){var i,r={},s=null,o=null;if(e!=null)for(i in e.ref!==void 0&&(o=e.ref),e.key!==void 0&&(s=""+e.key),e)Rv.call(e,i)&&!bv.hasOwnProperty(i)&&(r[i]=e[i]);var a=arguments.length-2;if(a===1)r.children=n;else if(1<a){for(var l=Array(a),c=0;c<a;c++)l[c]=arguments[c+2];r.children=l}if(t&&t.defaultProps)for(i in a=t.defaultProps,a)r[i]===void 0&&(r[i]=a[i]);return{$$typeof:Jo,type:t,key:s,ref:o,props:r,_owner:yp.current}}function eA(t,e){return{$$typeof:Jo,type:t.type,key:e,ref:t.ref,props:t.props,_owner:t._owner}}function vp(t){return typeof t=="object"&&t!==null&&t.$$typeof===Jo}function tA(t){var e={"=":"=0",":":"=2"};return"$"+t.replace(/[=:]/g,function(n){return e[n]})}var p_=/\/+/g;function Gu(t,e){return typeof t=="object"&&t!==null&&t.key!=null?tA(""+t.key):e.toString(36)}function yl(t,e,n,i,r){var s=typeof t;(s==="undefined"||s==="boolean")&&(t=null);var o=!1;if(t===null)o=!0;else switch(s){case"string":case"number":o=!0;break;case"object":switch(t.$$typeof){case Jo:case WS:o=!0}}if(o)return o=t,r=r(o),t=i===""?"."+Gu(o,0):i,d_(r)?(n="",t!=null&&(n=t.replace(p_,"$&/")+"/"),yl(r,e,n,"",function(c){return c})):r!=null&&(vp(r)&&(r=eA(r,n+(!r.key||o&&o.key===r.key?"":(""+r.key).replace(p_,"$&/")+"/")+t)),e.push(r)),1;if(o=0,i=i===""?".":i+":",d_(t))for(var a=0;a<t.length;a++){s=t[a];var l=i+Gu(s,a);o+=yl(s,e,n,l,r)}else if(l=GS(t),typeof l=="function")for(t=l.call(t),a=0;!(s=t.next()).done;)s=s.value,l=i+Gu(s,a++),o+=yl(s,e,n,l,r);else if(s==="object")throw e=String(t),Error("Objects are not valid as a React child (found: "+(e==="[object Object]"?"object with keys {"+Object.keys(t).join(", ")+"}":e)+"). If you meant to render a collection of children, use an array instead.");return o}function Ea(t,e,n){if(t==null)return t;var i=[],r=0;return yl(t,i,"","",function(s){return e.call(n,s,r++)}),i}function nA(t){if(t._status===-1){var e=t._result;e=e(),e.then(function(n){(t._status===0||t._status===-1)&&(t._status=1,t._result=n)},function(n){(t._status===0||t._status===-1)&&(t._status=2,t._result=n)}),t._status===-1&&(t._status=0,t._result=e)}if(t._status===1)return t._result.default;throw t._result}var et={current:null},vl={transition:null},iA={ReactCurrentDispatcher:et,ReactCurrentBatchConfig:vl,ReactCurrentOwner:yp};J.Children={map:Ea,forEach:function(t,e,n){Ea(t,function(){e.apply(this,arguments)},n)},count:function(t){var e=0;return Ea(t,function(){e++}),e},toArray:function(t){return Ea(t,function(e){return e})||[]},only:function(t){if(!vp(t))throw Error("React.Children.only expected to receive a single React element child.");return t}};J.Component=hs;J.Fragment=HS;J.Profiler=XS;J.PureComponent=_p;J.StrictMode=$S;J.Suspense=ZS;J.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=iA;J.cloneElement=function(t,e,n){if(t==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+t+".");var i=Sv({},t.props),r=t.key,s=t.ref,o=t._owner;if(e!=null){if(e.ref!==void 0&&(s=e.ref,o=yp.current),e.key!==void 0&&(r=""+e.key),t.type&&t.type.defaultProps)var a=t.type.defaultProps;for(l in e)Rv.call(e,l)&&!bv.hasOwnProperty(l)&&(i[l]=e[l]===void 0&&a!==void 0?a[l]:e[l])}var l=arguments.length-2;if(l===1)i.children=n;else if(1<l){a=Array(l);for(var c=0;c<l;c++)a[c]=arguments[c+2];i.children=a}return{$$typeof:Jo,type:t.type,key:r,ref:s,props:i,_owner:o}};J.createContext=function(t){return t={$$typeof:KS,_currentValue:t,_currentValue2:t,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},t.Provider={$$typeof:YS,_context:t},t.Consumer=t};J.createElement=Cv;J.createFactory=function(t){var e=Cv.bind(null,t);return e.type=t,e};J.createRef=function(){return{current:null}};J.forwardRef=function(t){return{$$typeof:qS,render:t}};J.isValidElement=vp;J.lazy=function(t){return{$$typeof:JS,_payload:{_status:-1,_result:t},_init:nA}};J.memo=function(t,e){return{$$typeof:QS,type:t,compare:e===void 0?null:e}};J.startTransition=function(t){var e=vl.transition;vl.transition={};try{t()}finally{vl.transition=e}};J.unstable_act=function(){throw Error("act(...) is not supported in production builds of React.")};J.useCallback=function(t,e){return et.current.useCallback(t,e)};J.useContext=function(t){return et.current.useContext(t)};J.useDebugValue=function(){};J.useDeferredValue=function(t){return et.current.useDeferredValue(t)};J.useEffect=function(t,e){return et.current.useEffect(t,e)};J.useId=function(){return et.current.useId()};J.useImperativeHandle=function(t,e,n){return et.current.useImperativeHandle(t,e,n)};J.useInsertionEffect=function(t,e){return et.current.useInsertionEffect(t,e)};J.useLayoutEffect=function(t,e){return et.current.useLayoutEffect(t,e)};J.useMemo=function(t,e){return et.current.useMemo(t,e)};J.useReducer=function(t,e,n){return et.current.useReducer(t,e,n)};J.useRef=function(t){return et.current.useRef(t)};J.useState=function(t){return et.current.useState(t)};J.useSyncExternalStore=function(t,e,n){return et.current.useSyncExternalStore(t,e,n)};J.useTransition=function(){return et.current.useTransition()};J.version="18.2.0";wv.exports=J;var L=wv.exports;const qe=hu(L);var Pv={exports:{}},pt={},Mv={exports:{}},Iv={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */(function(t){function e(j,Y){var K=j.length;j.push(Y);e:for(;0<K;){var pe=K-1>>>1,he=j[pe];if(0<r(he,Y))j[pe]=Y,j[K]=he,K=pe;else break e}}function n(j){return j.length===0?null:j[0]}function i(j){if(j.length===0)return null;var Y=j[0],K=j.pop();if(K!==Y){j[0]=K;e:for(var pe=0,he=j.length,nr=he>>>1;pe<nr;){var bt=2*(pe+1)-1,ms=j[bt],on=bt+1,Ae=j[on];if(0>r(ms,K))on<he&&0>r(Ae,ms)?(j[pe]=Ae,j[on]=K,pe=on):(j[pe]=ms,j[bt]=K,pe=bt);else if(on<he&&0>r(Ae,K))j[pe]=Ae,j[on]=K,pe=on;else break e}}return Y}function r(j,Y){var K=j.sortIndex-Y.sortIndex;return K!==0?K:j.id-Y.id}if(typeof performance=="object"&&typeof performance.now=="function"){var s=performance;t.unstable_now=function(){return s.now()}}else{var o=Date,a=o.now();t.unstable_now=function(){return o.now()-a}}var l=[],c=[],u=1,h=null,f=3,d=!1,p=!1,v=!1,A=typeof setTimeout=="function"?setTimeout:null,y=typeof clearTimeout=="function"?clearTimeout:null,g=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function _(j){for(var Y=n(c);Y!==null;){if(Y.callback===null)i(c);else if(Y.startTime<=j)i(c),Y.sortIndex=Y.expirationTime,e(l,Y);else break;Y=n(c)}}function E(j){if(v=!1,_(j),!p)if(n(l)!==null)p=!0,_s(R);else{var Y=n(c);Y!==null&&tr(E,Y.startTime-j)}}function R(j,Y){p=!1,v&&(v=!1,y(O),O=-1),d=!0;var K=f;try{for(_(Y),h=n(l);h!==null&&(!(h.expirationTime>Y)||j&&!H());){var pe=h.callback;if(typeof pe=="function"){h.callback=null,f=h.priorityLevel;var he=pe(h.expirationTime<=Y);Y=t.unstable_now(),typeof he=="function"?h.callback=he:h===n(l)&&i(l),_(Y)}else i(l);h=n(l)}if(h!==null)var nr=!0;else{var bt=n(c);bt!==null&&tr(E,bt.startTime-Y),nr=!1}return nr}finally{h=null,f=K,d=!1}}var P=!1,I=null,O=-1,k=5,D=-1;function H(){return!(t.unstable_now()-D<k)}function X(){if(I!==null){var j=t.unstable_now();D=j;var Y=!0;try{Y=I(!0,j)}finally{Y?$():(P=!1,I=null)}}else P=!1}var $;if(typeof g=="function")$=function(){g(X)};else if(typeof MessageChannel<"u"){var q=new MessageChannel,nt=q.port2;q.port1.onmessage=X,$=function(){nt.postMessage(null)}}else $=function(){A(X,0)};function _s(j){I=j,P||(P=!0,$())}function tr(j,Y){O=A(function(){j(t.unstable_now())},Y)}t.unstable_IdlePriority=5,t.unstable_ImmediatePriority=1,t.unstable_LowPriority=4,t.unstable_NormalPriority=3,t.unstable_Profiling=null,t.unstable_UserBlockingPriority=2,t.unstable_cancelCallback=function(j){j.callback=null},t.unstable_continueExecution=function(){p||d||(p=!0,_s(R))},t.unstable_forceFrameRate=function(j){0>j||125<j?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):k=0<j?Math.floor(1e3/j):5},t.unstable_getCurrentPriorityLevel=function(){return f},t.unstable_getFirstCallbackNode=function(){return n(l)},t.unstable_next=function(j){switch(f){case 1:case 2:case 3:var Y=3;break;default:Y=f}var K=f;f=Y;try{return j()}finally{f=K}},t.unstable_pauseExecution=function(){},t.unstable_requestPaint=function(){},t.unstable_runWithPriority=function(j,Y){switch(j){case 1:case 2:case 3:case 4:case 5:break;default:j=3}var K=f;f=j;try{return Y()}finally{f=K}},t.unstable_scheduleCallback=function(j,Y,K){var pe=t.unstable_now();switch(typeof K=="object"&&K!==null?(K=K.delay,K=typeof K=="number"&&0<K?pe+K:pe):K=pe,j){case 1:var he=-1;break;case 2:he=250;break;case 5:he=1073741823;break;case 4:he=1e4;break;default:he=5e3}return he=K+he,j={id:u++,callback:Y,priorityLevel:j,startTime:K,expirationTime:he,sortIndex:-1},K>pe?(j.sortIndex=K,e(c,j),n(l)===null&&j===n(c)&&(v?(y(O),O=-1):v=!0,tr(E,K-pe))):(j.sortIndex=he,e(l,j),p||d||(p=!0,_s(R))),j},t.unstable_shouldYield=H,t.unstable_wrapCallback=function(j){var Y=f;return function(){var K=f;f=Y;try{return j.apply(this,arguments)}finally{f=K}}}})(Iv);Mv.exports=Iv;var rA=Mv.exports;/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Ov=L,dt=rA;function B(t){for(var e="https://reactjs.org/docs/error-decoder.html?invariant="+t,n=1;n<arguments.length;n++)e+="&args[]="+encodeURIComponent(arguments[n]);return"Minified React error #"+t+"; visit "+e+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var Nv=new Set,To={};function Yi(t,e){Kr(t,e),Kr(t+"Capture",e)}function Kr(t,e){for(To[t]=e,t=0;t<e.length;t++)Nv.add(e[t])}var En=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),yf=Object.prototype.hasOwnProperty,sA=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,g_={},__={};function oA(t){return yf.call(__,t)?!0:yf.call(g_,t)?!1:sA.test(t)?__[t]=!0:(g_[t]=!0,!1)}function aA(t,e,n,i){if(n!==null&&n.type===0)return!1;switch(typeof e){case"function":case"symbol":return!0;case"boolean":return i?!1:n!==null?!n.acceptsBooleans:(t=t.toLowerCase().slice(0,5),t!=="data-"&&t!=="aria-");default:return!1}}function lA(t,e,n,i){if(e===null||typeof e>"u"||aA(t,e,n,i))return!0;if(i)return!1;if(n!==null)switch(n.type){case 3:return!e;case 4:return e===!1;case 5:return isNaN(e);case 6:return isNaN(e)||1>e}return!1}function tt(t,e,n,i,r,s,o){this.acceptsBooleans=e===2||e===3||e===4,this.attributeName=i,this.attributeNamespace=r,this.mustUseProperty=n,this.propertyName=t,this.type=e,this.sanitizeURL=s,this.removeEmptyString=o}var ze={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(t){ze[t]=new tt(t,0,!1,t,null,!1,!1)});[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(t){var e=t[0];ze[e]=new tt(e,1,!1,t[1],null,!1,!1)});["contentEditable","draggable","spellCheck","value"].forEach(function(t){ze[t]=new tt(t,2,!1,t.toLowerCase(),null,!1,!1)});["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(t){ze[t]=new tt(t,2,!1,t,null,!1,!1)});"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(t){ze[t]=new tt(t,3,!1,t.toLowerCase(),null,!1,!1)});["checked","multiple","muted","selected"].forEach(function(t){ze[t]=new tt(t,3,!0,t,null,!1,!1)});["capture","download"].forEach(function(t){ze[t]=new tt(t,4,!1,t,null,!1,!1)});["cols","rows","size","span"].forEach(function(t){ze[t]=new tt(t,6,!1,t,null,!1,!1)});["rowSpan","start"].forEach(function(t){ze[t]=new tt(t,5,!1,t.toLowerCase(),null,!1,!1)});var Tp=/[\-:]([a-z])/g;function wp(t){return t[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(t){var e=t.replace(Tp,wp);ze[e]=new tt(e,1,!1,t,null,!1,!1)});"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(t){var e=t.replace(Tp,wp);ze[e]=new tt(e,1,!1,t,"http://www.w3.org/1999/xlink",!1,!1)});["xml:base","xml:lang","xml:space"].forEach(function(t){var e=t.replace(Tp,wp);ze[e]=new tt(e,1,!1,t,"http://www.w3.org/XML/1998/namespace",!1,!1)});["tabIndex","crossOrigin"].forEach(function(t){ze[t]=new tt(t,1,!1,t.toLowerCase(),null,!1,!1)});ze.xlinkHref=new tt("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1);["src","href","action","formAction"].forEach(function(t){ze[t]=new tt(t,1,!1,t.toLowerCase(),null,!0,!0)});function Ep(t,e,n,i){var r=ze.hasOwnProperty(e)?ze[e]:null;(r!==null?r.type!==0:i||!(2<e.length)||e[0]!=="o"&&e[0]!=="O"||e[1]!=="n"&&e[1]!=="N")&&(lA(e,n,r,i)&&(n=null),i||r===null?oA(e)&&(n===null?t.removeAttribute(e):t.setAttribute(e,""+n)):r.mustUseProperty?t[r.propertyName]=n===null?r.type===3?!1:"":n:(e=r.attributeName,i=r.attributeNamespace,n===null?t.removeAttribute(e):(r=r.type,n=r===3||r===4&&n===!0?"":""+n,i?t.setAttributeNS(i,e,n):t.setAttribute(e,n))))}var Pn=Ov.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,Sa=Symbol.for("react.element"),gr=Symbol.for("react.portal"),_r=Symbol.for("react.fragment"),Sp=Symbol.for("react.strict_mode"),vf=Symbol.for("react.profiler"),kv=Symbol.for("react.provider"),Fv=Symbol.for("react.context"),Ap=Symbol.for("react.forward_ref"),Tf=Symbol.for("react.suspense"),wf=Symbol.for("react.suspense_list"),xp=Symbol.for("react.memo"),Bn=Symbol.for("react.lazy"),Dv=Symbol.for("react.offscreen"),m_=Symbol.iterator;function xs(t){return t===null||typeof t!="object"?null:(t=m_&&t[m_]||t["@@iterator"],typeof t=="function"?t:null)}var ve=Object.assign,eh;function Ws(t){if(eh===void 0)try{throw Error()}catch(n){var e=n.stack.trim().match(/\n( *(at )?)/);eh=e&&e[1]||""}return`
`+eh+t}var th=!1;function nh(t,e){if(!t||th)return"";th=!0;var n=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(e)if(e=function(){throw Error()},Object.defineProperty(e.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(e,[])}catch(c){var i=c}Reflect.construct(t,[],e)}else{try{e.call()}catch(c){i=c}t.call(e.prototype)}else{try{throw Error()}catch(c){i=c}t()}}catch(c){if(c&&i&&typeof c.stack=="string"){for(var r=c.stack.split(`
`),s=i.stack.split(`
`),o=r.length-1,a=s.length-1;1<=o&&0<=a&&r[o]!==s[a];)a--;for(;1<=o&&0<=a;o--,a--)if(r[o]!==s[a]){if(o!==1||a!==1)do if(o--,a--,0>a||r[o]!==s[a]){var l=`
`+r[o].replace(" at new "," at ");return t.displayName&&l.includes("<anonymous>")&&(l=l.replace("<anonymous>",t.displayName)),l}while(1<=o&&0<=a);break}}}finally{th=!1,Error.prepareStackTrace=n}return(t=t?t.displayName||t.name:"")?Ws(t):""}function cA(t){switch(t.tag){case 5:return Ws(t.type);case 16:return Ws("Lazy");case 13:return Ws("Suspense");case 19:return Ws("SuspenseList");case 0:case 2:case 15:return t=nh(t.type,!1),t;case 11:return t=nh(t.type.render,!1),t;case 1:return t=nh(t.type,!0),t;default:return""}}function Ef(t){if(t==null)return null;if(typeof t=="function")return t.displayName||t.name||null;if(typeof t=="string")return t;switch(t){case _r:return"Fragment";case gr:return"Portal";case vf:return"Profiler";case Sp:return"StrictMode";case Tf:return"Suspense";case wf:return"SuspenseList"}if(typeof t=="object")switch(t.$$typeof){case Fv:return(t.displayName||"Context")+".Consumer";case kv:return(t._context.displayName||"Context")+".Provider";case Ap:var e=t.render;return t=t.displayName,t||(t=e.displayName||e.name||"",t=t!==""?"ForwardRef("+t+")":"ForwardRef"),t;case xp:return e=t.displayName||null,e!==null?e:Ef(t.type)||"Memo";case Bn:e=t._payload,t=t._init;try{return Ef(t(e))}catch{}}return null}function uA(t){var e=t.type;switch(t.tag){case 24:return"Cache";case 9:return(e.displayName||"Context")+".Consumer";case 10:return(e._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return t=e.render,t=t.displayName||t.name||"",e.displayName||(t!==""?"ForwardRef("+t+")":"ForwardRef");case 7:return"Fragment";case 5:return e;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return Ef(e);case 8:return e===Sp?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof e=="function")return e.displayName||e.name||null;if(typeof e=="string")return e}return null}function si(t){switch(typeof t){case"boolean":case"number":case"string":case"undefined":return t;case"object":return t;default:return""}}function Bv(t){var e=t.type;return(t=t.nodeName)&&t.toLowerCase()==="input"&&(e==="checkbox"||e==="radio")}function hA(t){var e=Bv(t)?"checked":"value",n=Object.getOwnPropertyDescriptor(t.constructor.prototype,e),i=""+t[e];if(!t.hasOwnProperty(e)&&typeof n<"u"&&typeof n.get=="function"&&typeof n.set=="function"){var r=n.get,s=n.set;return Object.defineProperty(t,e,{configurable:!0,get:function(){return r.call(this)},set:function(o){i=""+o,s.call(this,o)}}),Object.defineProperty(t,e,{enumerable:n.enumerable}),{getValue:function(){return i},setValue:function(o){i=""+o},stopTracking:function(){t._valueTracker=null,delete t[e]}}}}function Aa(t){t._valueTracker||(t._valueTracker=hA(t))}function Uv(t){if(!t)return!1;var e=t._valueTracker;if(!e)return!0;var n=e.getValue(),i="";return t&&(i=Bv(t)?t.checked?"true":"false":t.value),t=i,t!==n?(e.setValue(t),!0):!1}function Ll(t){if(t=t||(typeof document<"u"?document:void 0),typeof t>"u")return null;try{return t.activeElement||t.body}catch{return t.body}}function Sf(t,e){var n=e.checked;return ve({},e,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:n??t._wrapperState.initialChecked})}function y_(t,e){var n=e.defaultValue==null?"":e.defaultValue,i=e.checked!=null?e.checked:e.defaultChecked;n=si(e.value!=null?e.value:n),t._wrapperState={initialChecked:i,initialValue:n,controlled:e.type==="checkbox"||e.type==="radio"?e.checked!=null:e.value!=null}}function Lv(t,e){e=e.checked,e!=null&&Ep(t,"checked",e,!1)}function Af(t,e){Lv(t,e);var n=si(e.value),i=e.type;if(n!=null)i==="number"?(n===0&&t.value===""||t.value!=n)&&(t.value=""+n):t.value!==""+n&&(t.value=""+n);else if(i==="submit"||i==="reset"){t.removeAttribute("value");return}e.hasOwnProperty("value")?xf(t,e.type,n):e.hasOwnProperty("defaultValue")&&xf(t,e.type,si(e.defaultValue)),e.checked==null&&e.defaultChecked!=null&&(t.defaultChecked=!!e.defaultChecked)}function v_(t,e,n){if(e.hasOwnProperty("value")||e.hasOwnProperty("defaultValue")){var i=e.type;if(!(i!=="submit"&&i!=="reset"||e.value!==void 0&&e.value!==null))return;e=""+t._wrapperState.initialValue,n||e===t.value||(t.value=e),t.defaultValue=e}n=t.name,n!==""&&(t.name=""),t.defaultChecked=!!t._wrapperState.initialChecked,n!==""&&(t.name=n)}function xf(t,e,n){(e!=="number"||Ll(t.ownerDocument)!==t)&&(n==null?t.defaultValue=""+t._wrapperState.initialValue:t.defaultValue!==""+n&&(t.defaultValue=""+n))}var Hs=Array.isArray;function Ur(t,e,n,i){if(t=t.options,e){e={};for(var r=0;r<n.length;r++)e["$"+n[r]]=!0;for(n=0;n<t.length;n++)r=e.hasOwnProperty("$"+t[n].value),t[n].selected!==r&&(t[n].selected=r),r&&i&&(t[n].defaultSelected=!0)}else{for(n=""+si(n),e=null,r=0;r<t.length;r++){if(t[r].value===n){t[r].selected=!0,i&&(t[r].defaultSelected=!0);return}e!==null||t[r].disabled||(e=t[r])}e!==null&&(e.selected=!0)}}function Rf(t,e){if(e.dangerouslySetInnerHTML!=null)throw Error(B(91));return ve({},e,{value:void 0,defaultValue:void 0,children:""+t._wrapperState.initialValue})}function T_(t,e){var n=e.value;if(n==null){if(n=e.children,e=e.defaultValue,n!=null){if(e!=null)throw Error(B(92));if(Hs(n)){if(1<n.length)throw Error(B(93));n=n[0]}e=n}e==null&&(e=""),n=e}t._wrapperState={initialValue:si(n)}}function zv(t,e){var n=si(e.value),i=si(e.defaultValue);n!=null&&(n=""+n,n!==t.value&&(t.value=n),e.defaultValue==null&&t.defaultValue!==n&&(t.defaultValue=n)),i!=null&&(t.defaultValue=""+i)}function w_(t){var e=t.textContent;e===t._wrapperState.initialValue&&e!==""&&e!==null&&(t.value=e)}function Vv(t){switch(t){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function bf(t,e){return t==null||t==="http://www.w3.org/1999/xhtml"?Vv(e):t==="http://www.w3.org/2000/svg"&&e==="foreignObject"?"http://www.w3.org/1999/xhtml":t}var xa,jv=function(t){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(e,n,i,r){MSApp.execUnsafeLocalFunction(function(){return t(e,n,i,r)})}:t}(function(t,e){if(t.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in t)t.innerHTML=e;else{for(xa=xa||document.createElement("div"),xa.innerHTML="<svg>"+e.valueOf().toString()+"</svg>",e=xa.firstChild;t.firstChild;)t.removeChild(t.firstChild);for(;e.firstChild;)t.appendChild(e.firstChild)}});function wo(t,e){if(e){var n=t.firstChild;if(n&&n===t.lastChild&&n.nodeType===3){n.nodeValue=e;return}}t.textContent=e}var Gs={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},fA=["Webkit","ms","Moz","O"];Object.keys(Gs).forEach(function(t){fA.forEach(function(e){e=e+t.charAt(0).toUpperCase()+t.substring(1),Gs[e]=Gs[t]})});function Wv(t,e,n){return e==null||typeof e=="boolean"||e===""?"":n||typeof e!="number"||e===0||Gs.hasOwnProperty(t)&&Gs[t]?(""+e).trim():e+"px"}function Hv(t,e){t=t.style;for(var n in e)if(e.hasOwnProperty(n)){var i=n.indexOf("--")===0,r=Wv(n,e[n],i);n==="float"&&(n="cssFloat"),i?t.setProperty(n,r):t[n]=r}}var dA=ve({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function Cf(t,e){if(e){if(dA[t]&&(e.children!=null||e.dangerouslySetInnerHTML!=null))throw Error(B(137,t));if(e.dangerouslySetInnerHTML!=null){if(e.children!=null)throw Error(B(60));if(typeof e.dangerouslySetInnerHTML!="object"||!("__html"in e.dangerouslySetInnerHTML))throw Error(B(61))}if(e.style!=null&&typeof e.style!="object")throw Error(B(62))}}function Pf(t,e){if(t.indexOf("-")===-1)return typeof e.is=="string";switch(t){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var Mf=null;function Rp(t){return t=t.target||t.srcElement||window,t.correspondingUseElement&&(t=t.correspondingUseElement),t.nodeType===3?t.parentNode:t}var If=null,Lr=null,zr=null;function E_(t){if(t=ta(t)){if(typeof If!="function")throw Error(B(280));var e=t.stateNode;e&&(e=_u(e),If(t.stateNode,t.type,e))}}function $v(t){Lr?zr?zr.push(t):zr=[t]:Lr=t}function Xv(){if(Lr){var t=Lr,e=zr;if(zr=Lr=null,E_(t),e)for(t=0;t<e.length;t++)E_(e[t])}}function Yv(t,e){return t(e)}function Kv(){}var ih=!1;function qv(t,e,n){if(ih)return t(e,n);ih=!0;try{return Yv(t,e,n)}finally{ih=!1,(Lr!==null||zr!==null)&&(Kv(),Xv())}}function Eo(t,e){var n=t.stateNode;if(n===null)return null;var i=_u(n);if(i===null)return null;n=i[e];e:switch(e){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(i=!i.disabled)||(t=t.type,i=!(t==="button"||t==="input"||t==="select"||t==="textarea")),t=!i;break e;default:t=!1}if(t)return null;if(n&&typeof n!="function")throw Error(B(231,e,typeof n));return n}var Of=!1;if(En)try{var Rs={};Object.defineProperty(Rs,"passive",{get:function(){Of=!0}}),window.addEventListener("test",Rs,Rs),window.removeEventListener("test",Rs,Rs)}catch{Of=!1}function pA(t,e,n,i,r,s,o,a,l){var c=Array.prototype.slice.call(arguments,3);try{e.apply(n,c)}catch(u){this.onError(u)}}var eo=!1,zl=null,Vl=!1,Nf=null,gA={onError:function(t){eo=!0,zl=t}};function _A(t,e,n,i,r,s,o,a,l){eo=!1,zl=null,pA.apply(gA,arguments)}function mA(t,e,n,i,r,s,o,a,l){if(_A.apply(this,arguments),eo){if(eo){var c=zl;eo=!1,zl=null}else throw Error(B(198));Vl||(Vl=!0,Nf=c)}}function Ki(t){var e=t,n=t;if(t.alternate)for(;e.return;)e=e.return;else{t=e;do e=t,e.flags&4098&&(n=e.return),t=e.return;while(t)}return e.tag===3?n:null}function Zv(t){if(t.tag===13){var e=t.memoizedState;if(e===null&&(t=t.alternate,t!==null&&(e=t.memoizedState)),e!==null)return e.dehydrated}return null}function S_(t){if(Ki(t)!==t)throw Error(B(188))}function yA(t){var e=t.alternate;if(!e){if(e=Ki(t),e===null)throw Error(B(188));return e!==t?null:t}for(var n=t,i=e;;){var r=n.return;if(r===null)break;var s=r.alternate;if(s===null){if(i=r.return,i!==null){n=i;continue}break}if(r.child===s.child){for(s=r.child;s;){if(s===n)return S_(r),t;if(s===i)return S_(r),e;s=s.sibling}throw Error(B(188))}if(n.return!==i.return)n=r,i=s;else{for(var o=!1,a=r.child;a;){if(a===n){o=!0,n=r,i=s;break}if(a===i){o=!0,i=r,n=s;break}a=a.sibling}if(!o){for(a=s.child;a;){if(a===n){o=!0,n=s,i=r;break}if(a===i){o=!0,i=s,n=r;break}a=a.sibling}if(!o)throw Error(B(189))}}if(n.alternate!==i)throw Error(B(190))}if(n.tag!==3)throw Error(B(188));return n.stateNode.current===n?t:e}function Qv(t){return t=yA(t),t!==null?Jv(t):null}function Jv(t){if(t.tag===5||t.tag===6)return t;for(t=t.child;t!==null;){var e=Jv(t);if(e!==null)return e;t=t.sibling}return null}var Gv=dt.unstable_scheduleCallback,A_=dt.unstable_cancelCallback,vA=dt.unstable_shouldYield,TA=dt.unstable_requestPaint,Se=dt.unstable_now,wA=dt.unstable_getCurrentPriorityLevel,bp=dt.unstable_ImmediatePriority,eT=dt.unstable_UserBlockingPriority,jl=dt.unstable_NormalPriority,EA=dt.unstable_LowPriority,tT=dt.unstable_IdlePriority,fu=null,nn=null;function SA(t){if(nn&&typeof nn.onCommitFiberRoot=="function")try{nn.onCommitFiberRoot(fu,t,void 0,(t.current.flags&128)===128)}catch{}}var Bt=Math.clz32?Math.clz32:RA,AA=Math.log,xA=Math.LN2;function RA(t){return t>>>=0,t===0?32:31-(AA(t)/xA|0)|0}var Ra=64,ba=4194304;function $s(t){switch(t&-t){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return t&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return t&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return t}}function Wl(t,e){var n=t.pendingLanes;if(n===0)return 0;var i=0,r=t.suspendedLanes,s=t.pingedLanes,o=n&268435455;if(o!==0){var a=o&~r;a!==0?i=$s(a):(s&=o,s!==0&&(i=$s(s)))}else o=n&~r,o!==0?i=$s(o):s!==0&&(i=$s(s));if(i===0)return 0;if(e!==0&&e!==i&&!(e&r)&&(r=i&-i,s=e&-e,r>=s||r===16&&(s&4194240)!==0))return e;if(i&4&&(i|=n&16),e=t.entangledLanes,e!==0)for(t=t.entanglements,e&=i;0<e;)n=31-Bt(e),r=1<<n,i|=t[n],e&=~r;return i}function bA(t,e){switch(t){case 1:case 2:case 4:return e+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return e+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function CA(t,e){for(var n=t.suspendedLanes,i=t.pingedLanes,r=t.expirationTimes,s=t.pendingLanes;0<s;){var o=31-Bt(s),a=1<<o,l=r[o];l===-1?(!(a&n)||a&i)&&(r[o]=bA(a,e)):l<=e&&(t.expiredLanes|=a),s&=~a}}function kf(t){return t=t.pendingLanes&-1073741825,t!==0?t:t&1073741824?1073741824:0}function nT(){var t=Ra;return Ra<<=1,!(Ra&4194240)&&(Ra=64),t}function rh(t){for(var e=[],n=0;31>n;n++)e.push(t);return e}function Go(t,e,n){t.pendingLanes|=e,e!==536870912&&(t.suspendedLanes=0,t.pingedLanes=0),t=t.eventTimes,e=31-Bt(e),t[e]=n}function PA(t,e){var n=t.pendingLanes&~e;t.pendingLanes=e,t.suspendedLanes=0,t.pingedLanes=0,t.expiredLanes&=e,t.mutableReadLanes&=e,t.entangledLanes&=e,e=t.entanglements;var i=t.eventTimes;for(t=t.expirationTimes;0<n;){var r=31-Bt(n),s=1<<r;e[r]=0,i[r]=-1,t[r]=-1,n&=~s}}function Cp(t,e){var n=t.entangledLanes|=e;for(t=t.entanglements;n;){var i=31-Bt(n),r=1<<i;r&e|t[i]&e&&(t[i]|=e),n&=~r}}var ne=0;function iT(t){return t&=-t,1<t?4<t?t&268435455?16:536870912:4:1}var rT,Pp,sT,oT,aT,Ff=!1,Ca=[],qn=null,Zn=null,Qn=null,So=new Map,Ao=new Map,Vn=[],MA="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function x_(t,e){switch(t){case"focusin":case"focusout":qn=null;break;case"dragenter":case"dragleave":Zn=null;break;case"mouseover":case"mouseout":Qn=null;break;case"pointerover":case"pointerout":So.delete(e.pointerId);break;case"gotpointercapture":case"lostpointercapture":Ao.delete(e.pointerId)}}function bs(t,e,n,i,r,s){return t===null||t.nativeEvent!==s?(t={blockedOn:e,domEventName:n,eventSystemFlags:i,nativeEvent:s,targetContainers:[r]},e!==null&&(e=ta(e),e!==null&&Pp(e)),t):(t.eventSystemFlags|=i,e=t.targetContainers,r!==null&&e.indexOf(r)===-1&&e.push(r),t)}function IA(t,e,n,i,r){switch(e){case"focusin":return qn=bs(qn,t,e,n,i,r),!0;case"dragenter":return Zn=bs(Zn,t,e,n,i,r),!0;case"mouseover":return Qn=bs(Qn,t,e,n,i,r),!0;case"pointerover":var s=r.pointerId;return So.set(s,bs(So.get(s)||null,t,e,n,i,r)),!0;case"gotpointercapture":return s=r.pointerId,Ao.set(s,bs(Ao.get(s)||null,t,e,n,i,r)),!0}return!1}function lT(t){var e=Si(t.target);if(e!==null){var n=Ki(e);if(n!==null){if(e=n.tag,e===13){if(e=Zv(n),e!==null){t.blockedOn=e,aT(t.priority,function(){sT(n)});return}}else if(e===3&&n.stateNode.current.memoizedState.isDehydrated){t.blockedOn=n.tag===3?n.stateNode.containerInfo:null;return}}}t.blockedOn=null}function Tl(t){if(t.blockedOn!==null)return!1;for(var e=t.targetContainers;0<e.length;){var n=Df(t.domEventName,t.eventSystemFlags,e[0],t.nativeEvent);if(n===null){n=t.nativeEvent;var i=new n.constructor(n.type,n);Mf=i,n.target.dispatchEvent(i),Mf=null}else return e=ta(n),e!==null&&Pp(e),t.blockedOn=n,!1;e.shift()}return!0}function R_(t,e,n){Tl(t)&&n.delete(e)}function OA(){Ff=!1,qn!==null&&Tl(qn)&&(qn=null),Zn!==null&&Tl(Zn)&&(Zn=null),Qn!==null&&Tl(Qn)&&(Qn=null),So.forEach(R_),Ao.forEach(R_)}function Cs(t,e){t.blockedOn===e&&(t.blockedOn=null,Ff||(Ff=!0,dt.unstable_scheduleCallback(dt.unstable_NormalPriority,OA)))}function xo(t){function e(r){return Cs(r,t)}if(0<Ca.length){Cs(Ca[0],t);for(var n=1;n<Ca.length;n++){var i=Ca[n];i.blockedOn===t&&(i.blockedOn=null)}}for(qn!==null&&Cs(qn,t),Zn!==null&&Cs(Zn,t),Qn!==null&&Cs(Qn,t),So.forEach(e),Ao.forEach(e),n=0;n<Vn.length;n++)i=Vn[n],i.blockedOn===t&&(i.blockedOn=null);for(;0<Vn.length&&(n=Vn[0],n.blockedOn===null);)lT(n),n.blockedOn===null&&Vn.shift()}var Vr=Pn.ReactCurrentBatchConfig,Hl=!0;function NA(t,e,n,i){var r=ne,s=Vr.transition;Vr.transition=null;try{ne=1,Mp(t,e,n,i)}finally{ne=r,Vr.transition=s}}function kA(t,e,n,i){var r=ne,s=Vr.transition;Vr.transition=null;try{ne=4,Mp(t,e,n,i)}finally{ne=r,Vr.transition=s}}function Mp(t,e,n,i){if(Hl){var r=Df(t,e,n,i);if(r===null)ph(t,e,i,$l,n),x_(t,i);else if(IA(r,t,e,n,i))i.stopPropagation();else if(x_(t,i),e&4&&-1<MA.indexOf(t)){for(;r!==null;){var s=ta(r);if(s!==null&&rT(s),s=Df(t,e,n,i),s===null&&ph(t,e,i,$l,n),s===r)break;r=s}r!==null&&i.stopPropagation()}else ph(t,e,i,null,n)}}var $l=null;function Df(t,e,n,i){if($l=null,t=Rp(i),t=Si(t),t!==null)if(e=Ki(t),e===null)t=null;else if(n=e.tag,n===13){if(t=Zv(e),t!==null)return t;t=null}else if(n===3){if(e.stateNode.current.memoizedState.isDehydrated)return e.tag===3?e.stateNode.containerInfo:null;t=null}else e!==t&&(t=null);return $l=t,null}function cT(t){switch(t){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(wA()){case bp:return 1;case eT:return 4;case jl:case EA:return 16;case tT:return 536870912;default:return 16}default:return 16}}var Wn=null,Ip=null,wl=null;function uT(){if(wl)return wl;var t,e=Ip,n=e.length,i,r="value"in Wn?Wn.value:Wn.textContent,s=r.length;for(t=0;t<n&&e[t]===r[t];t++);var o=n-t;for(i=1;i<=o&&e[n-i]===r[s-i];i++);return wl=r.slice(t,1<i?1-i:void 0)}function El(t){var e=t.keyCode;return"charCode"in t?(t=t.charCode,t===0&&e===13&&(t=13)):t=e,t===10&&(t=13),32<=t||t===13?t:0}function Pa(){return!0}function b_(){return!1}function gt(t){function e(n,i,r,s,o){this._reactName=n,this._targetInst=r,this.type=i,this.nativeEvent=s,this.target=o,this.currentTarget=null;for(var a in t)t.hasOwnProperty(a)&&(n=t[a],this[a]=n?n(s):s[a]);return this.isDefaultPrevented=(s.defaultPrevented!=null?s.defaultPrevented:s.returnValue===!1)?Pa:b_,this.isPropagationStopped=b_,this}return ve(e.prototype,{preventDefault:function(){this.defaultPrevented=!0;var n=this.nativeEvent;n&&(n.preventDefault?n.preventDefault():typeof n.returnValue!="unknown"&&(n.returnValue=!1),this.isDefaultPrevented=Pa)},stopPropagation:function(){var n=this.nativeEvent;n&&(n.stopPropagation?n.stopPropagation():typeof n.cancelBubble!="unknown"&&(n.cancelBubble=!0),this.isPropagationStopped=Pa)},persist:function(){},isPersistent:Pa}),e}var fs={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(t){return t.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},Op=gt(fs),ea=ve({},fs,{view:0,detail:0}),FA=gt(ea),sh,oh,Ps,du=ve({},ea,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:Np,button:0,buttons:0,relatedTarget:function(t){return t.relatedTarget===void 0?t.fromElement===t.srcElement?t.toElement:t.fromElement:t.relatedTarget},movementX:function(t){return"movementX"in t?t.movementX:(t!==Ps&&(Ps&&t.type==="mousemove"?(sh=t.screenX-Ps.screenX,oh=t.screenY-Ps.screenY):oh=sh=0,Ps=t),sh)},movementY:function(t){return"movementY"in t?t.movementY:oh}}),C_=gt(du),DA=ve({},du,{dataTransfer:0}),BA=gt(DA),UA=ve({},ea,{relatedTarget:0}),ah=gt(UA),LA=ve({},fs,{animationName:0,elapsedTime:0,pseudoElement:0}),zA=gt(LA),VA=ve({},fs,{clipboardData:function(t){return"clipboardData"in t?t.clipboardData:window.clipboardData}}),jA=gt(VA),WA=ve({},fs,{data:0}),P_=gt(WA),HA={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},$A={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},XA={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function YA(t){var e=this.nativeEvent;return e.getModifierState?e.getModifierState(t):(t=XA[t])?!!e[t]:!1}function Np(){return YA}var KA=ve({},ea,{key:function(t){if(t.key){var e=HA[t.key]||t.key;if(e!=="Unidentified")return e}return t.type==="keypress"?(t=El(t),t===13?"Enter":String.fromCharCode(t)):t.type==="keydown"||t.type==="keyup"?$A[t.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:Np,charCode:function(t){return t.type==="keypress"?El(t):0},keyCode:function(t){return t.type==="keydown"||t.type==="keyup"?t.keyCode:0},which:function(t){return t.type==="keypress"?El(t):t.type==="keydown"||t.type==="keyup"?t.keyCode:0}}),qA=gt(KA),ZA=ve({},du,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),M_=gt(ZA),QA=ve({},ea,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:Np}),JA=gt(QA),GA=ve({},fs,{propertyName:0,elapsedTime:0,pseudoElement:0}),ex=gt(GA),tx=ve({},du,{deltaX:function(t){return"deltaX"in t?t.deltaX:"wheelDeltaX"in t?-t.wheelDeltaX:0},deltaY:function(t){return"deltaY"in t?t.deltaY:"wheelDeltaY"in t?-t.wheelDeltaY:"wheelDelta"in t?-t.wheelDelta:0},deltaZ:0,deltaMode:0}),nx=gt(tx),ix=[9,13,27,32],kp=En&&"CompositionEvent"in window,to=null;En&&"documentMode"in document&&(to=document.documentMode);var rx=En&&"TextEvent"in window&&!to,hT=En&&(!kp||to&&8<to&&11>=to),I_=String.fromCharCode(32),O_=!1;function fT(t,e){switch(t){case"keyup":return ix.indexOf(e.keyCode)!==-1;case"keydown":return e.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function dT(t){return t=t.detail,typeof t=="object"&&"data"in t?t.data:null}var mr=!1;function sx(t,e){switch(t){case"compositionend":return dT(e);case"keypress":return e.which!==32?null:(O_=!0,I_);case"textInput":return t=e.data,t===I_&&O_?null:t;default:return null}}function ox(t,e){if(mr)return t==="compositionend"||!kp&&fT(t,e)?(t=uT(),wl=Ip=Wn=null,mr=!1,t):null;switch(t){case"paste":return null;case"keypress":if(!(e.ctrlKey||e.altKey||e.metaKey)||e.ctrlKey&&e.altKey){if(e.char&&1<e.char.length)return e.char;if(e.which)return String.fromCharCode(e.which)}return null;case"compositionend":return hT&&e.locale!=="ko"?null:e.data;default:return null}}var ax={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function N_(t){var e=t&&t.nodeName&&t.nodeName.toLowerCase();return e==="input"?!!ax[t.type]:e==="textarea"}function pT(t,e,n,i){$v(i),e=Xl(e,"onChange"),0<e.length&&(n=new Op("onChange","change",null,n,i),t.push({event:n,listeners:e}))}var no=null,Ro=null;function lx(t){xT(t,0)}function pu(t){var e=Tr(t);if(Uv(e))return t}function cx(t,e){if(t==="change")return e}var gT=!1;if(En){var lh;if(En){var ch="oninput"in document;if(!ch){var k_=document.createElement("div");k_.setAttribute("oninput","return;"),ch=typeof k_.oninput=="function"}lh=ch}else lh=!1;gT=lh&&(!document.documentMode||9<document.documentMode)}function F_(){no&&(no.detachEvent("onpropertychange",_T),Ro=no=null)}function _T(t){if(t.propertyName==="value"&&pu(Ro)){var e=[];pT(e,Ro,t,Rp(t)),qv(lx,e)}}function ux(t,e,n){t==="focusin"?(F_(),no=e,Ro=n,no.attachEvent("onpropertychange",_T)):t==="focusout"&&F_()}function hx(t){if(t==="selectionchange"||t==="keyup"||t==="keydown")return pu(Ro)}function fx(t,e){if(t==="click")return pu(e)}function dx(t,e){if(t==="input"||t==="change")return pu(e)}function px(t,e){return t===e&&(t!==0||1/t===1/e)||t!==t&&e!==e}var zt=typeof Object.is=="function"?Object.is:px;function bo(t,e){if(zt(t,e))return!0;if(typeof t!="object"||t===null||typeof e!="object"||e===null)return!1;var n=Object.keys(t),i=Object.keys(e);if(n.length!==i.length)return!1;for(i=0;i<n.length;i++){var r=n[i];if(!yf.call(e,r)||!zt(t[r],e[r]))return!1}return!0}function D_(t){for(;t&&t.firstChild;)t=t.firstChild;return t}function B_(t,e){var n=D_(t);t=0;for(var i;n;){if(n.nodeType===3){if(i=t+n.textContent.length,t<=e&&i>=e)return{node:n,offset:e-t};t=i}e:{for(;n;){if(n.nextSibling){n=n.nextSibling;break e}n=n.parentNode}n=void 0}n=D_(n)}}function mT(t,e){return t&&e?t===e?!0:t&&t.nodeType===3?!1:e&&e.nodeType===3?mT(t,e.parentNode):"contains"in t?t.contains(e):t.compareDocumentPosition?!!(t.compareDocumentPosition(e)&16):!1:!1}function yT(){for(var t=window,e=Ll();e instanceof t.HTMLIFrameElement;){try{var n=typeof e.contentWindow.location.href=="string"}catch{n=!1}if(n)t=e.contentWindow;else break;e=Ll(t.document)}return e}function Fp(t){var e=t&&t.nodeName&&t.nodeName.toLowerCase();return e&&(e==="input"&&(t.type==="text"||t.type==="search"||t.type==="tel"||t.type==="url"||t.type==="password")||e==="textarea"||t.contentEditable==="true")}function gx(t){var e=yT(),n=t.focusedElem,i=t.selectionRange;if(e!==n&&n&&n.ownerDocument&&mT(n.ownerDocument.documentElement,n)){if(i!==null&&Fp(n)){if(e=i.start,t=i.end,t===void 0&&(t=e),"selectionStart"in n)n.selectionStart=e,n.selectionEnd=Math.min(t,n.value.length);else if(t=(e=n.ownerDocument||document)&&e.defaultView||window,t.getSelection){t=t.getSelection();var r=n.textContent.length,s=Math.min(i.start,r);i=i.end===void 0?s:Math.min(i.end,r),!t.extend&&s>i&&(r=i,i=s,s=r),r=B_(n,s);var o=B_(n,i);r&&o&&(t.rangeCount!==1||t.anchorNode!==r.node||t.anchorOffset!==r.offset||t.focusNode!==o.node||t.focusOffset!==o.offset)&&(e=e.createRange(),e.setStart(r.node,r.offset),t.removeAllRanges(),s>i?(t.addRange(e),t.extend(o.node,o.offset)):(e.setEnd(o.node,o.offset),t.addRange(e)))}}for(e=[],t=n;t=t.parentNode;)t.nodeType===1&&e.push({element:t,left:t.scrollLeft,top:t.scrollTop});for(typeof n.focus=="function"&&n.focus(),n=0;n<e.length;n++)t=e[n],t.element.scrollLeft=t.left,t.element.scrollTop=t.top}}var _x=En&&"documentMode"in document&&11>=document.documentMode,yr=null,Bf=null,io=null,Uf=!1;function U_(t,e,n){var i=n.window===n?n.document:n.nodeType===9?n:n.ownerDocument;Uf||yr==null||yr!==Ll(i)||(i=yr,"selectionStart"in i&&Fp(i)?i={start:i.selectionStart,end:i.selectionEnd}:(i=(i.ownerDocument&&i.ownerDocument.defaultView||window).getSelection(),i={anchorNode:i.anchorNode,anchorOffset:i.anchorOffset,focusNode:i.focusNode,focusOffset:i.focusOffset}),io&&bo(io,i)||(io=i,i=Xl(Bf,"onSelect"),0<i.length&&(e=new Op("onSelect","select",null,e,n),t.push({event:e,listeners:i}),e.target=yr)))}function Ma(t,e){var n={};return n[t.toLowerCase()]=e.toLowerCase(),n["Webkit"+t]="webkit"+e,n["Moz"+t]="moz"+e,n}var vr={animationend:Ma("Animation","AnimationEnd"),animationiteration:Ma("Animation","AnimationIteration"),animationstart:Ma("Animation","AnimationStart"),transitionend:Ma("Transition","TransitionEnd")},uh={},vT={};En&&(vT=document.createElement("div").style,"AnimationEvent"in window||(delete vr.animationend.animation,delete vr.animationiteration.animation,delete vr.animationstart.animation),"TransitionEvent"in window||delete vr.transitionend.transition);function gu(t){if(uh[t])return uh[t];if(!vr[t])return t;var e=vr[t],n;for(n in e)if(e.hasOwnProperty(n)&&n in vT)return uh[t]=e[n];return t}var TT=gu("animationend"),wT=gu("animationiteration"),ET=gu("animationstart"),ST=gu("transitionend"),AT=new Map,L_="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function ci(t,e){AT.set(t,e),Yi(e,[t])}for(var hh=0;hh<L_.length;hh++){var fh=L_[hh],mx=fh.toLowerCase(),yx=fh[0].toUpperCase()+fh.slice(1);ci(mx,"on"+yx)}ci(TT,"onAnimationEnd");ci(wT,"onAnimationIteration");ci(ET,"onAnimationStart");ci("dblclick","onDoubleClick");ci("focusin","onFocus");ci("focusout","onBlur");ci(ST,"onTransitionEnd");Kr("onMouseEnter",["mouseout","mouseover"]);Kr("onMouseLeave",["mouseout","mouseover"]);Kr("onPointerEnter",["pointerout","pointerover"]);Kr("onPointerLeave",["pointerout","pointerover"]);Yi("onChange","change click focusin focusout input keydown keyup selectionchange".split(" "));Yi("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" "));Yi("onBeforeInput",["compositionend","keypress","textInput","paste"]);Yi("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" "));Yi("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" "));Yi("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var Xs="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),vx=new Set("cancel close invalid load scroll toggle".split(" ").concat(Xs));function z_(t,e,n){var i=t.type||"unknown-event";t.currentTarget=n,mA(i,e,void 0,t),t.currentTarget=null}function xT(t,e){e=(e&4)!==0;for(var n=0;n<t.length;n++){var i=t[n],r=i.event;i=i.listeners;e:{var s=void 0;if(e)for(var o=i.length-1;0<=o;o--){var a=i[o],l=a.instance,c=a.currentTarget;if(a=a.listener,l!==s&&r.isPropagationStopped())break e;z_(r,a,c),s=l}else for(o=0;o<i.length;o++){if(a=i[o],l=a.instance,c=a.currentTarget,a=a.listener,l!==s&&r.isPropagationStopped())break e;z_(r,a,c),s=l}}}if(Vl)throw t=Nf,Vl=!1,Nf=null,t}function ce(t,e){var n=e[Wf];n===void 0&&(n=e[Wf]=new Set);var i=t+"__bubble";n.has(i)||(RT(e,t,2,!1),n.add(i))}function dh(t,e,n){var i=0;e&&(i|=4),RT(n,t,i,e)}var Ia="_reactListening"+Math.random().toString(36).slice(2);function Co(t){if(!t[Ia]){t[Ia]=!0,Nv.forEach(function(n){n!=="selectionchange"&&(vx.has(n)||dh(n,!1,t),dh(n,!0,t))});var e=t.nodeType===9?t:t.ownerDocument;e===null||e[Ia]||(e[Ia]=!0,dh("selectionchange",!1,e))}}function RT(t,e,n,i){switch(cT(e)){case 1:var r=NA;break;case 4:r=kA;break;default:r=Mp}n=r.bind(null,e,n,t),r=void 0,!Of||e!=="touchstart"&&e!=="touchmove"&&e!=="wheel"||(r=!0),i?r!==void 0?t.addEventListener(e,n,{capture:!0,passive:r}):t.addEventListener(e,n,!0):r!==void 0?t.addEventListener(e,n,{passive:r}):t.addEventListener(e,n,!1)}function ph(t,e,n,i,r){var s=i;if(!(e&1)&&!(e&2)&&i!==null)e:for(;;){if(i===null)return;var o=i.tag;if(o===3||o===4){var a=i.stateNode.containerInfo;if(a===r||a.nodeType===8&&a.parentNode===r)break;if(o===4)for(o=i.return;o!==null;){var l=o.tag;if((l===3||l===4)&&(l=o.stateNode.containerInfo,l===r||l.nodeType===8&&l.parentNode===r))return;o=o.return}for(;a!==null;){if(o=Si(a),o===null)return;if(l=o.tag,l===5||l===6){i=s=o;continue e}a=a.parentNode}}i=i.return}qv(function(){var c=s,u=Rp(n),h=[];e:{var f=AT.get(t);if(f!==void 0){var d=Op,p=t;switch(t){case"keypress":if(El(n)===0)break e;case"keydown":case"keyup":d=qA;break;case"focusin":p="focus",d=ah;break;case"focusout":p="blur",d=ah;break;case"beforeblur":case"afterblur":d=ah;break;case"click":if(n.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":d=C_;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":d=BA;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":d=JA;break;case TT:case wT:case ET:d=zA;break;case ST:d=ex;break;case"scroll":d=FA;break;case"wheel":d=nx;break;case"copy":case"cut":case"paste":d=jA;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":d=M_}var v=(e&4)!==0,A=!v&&t==="scroll",y=v?f!==null?f+"Capture":null:f;v=[];for(var g=c,_;g!==null;){_=g;var E=_.stateNode;if(_.tag===5&&E!==null&&(_=E,y!==null&&(E=Eo(g,y),E!=null&&v.push(Po(g,E,_)))),A)break;g=g.return}0<v.length&&(f=new d(f,p,null,n,u),h.push({event:f,listeners:v}))}}if(!(e&7)){e:{if(f=t==="mouseover"||t==="pointerover",d=t==="mouseout"||t==="pointerout",f&&n!==Mf&&(p=n.relatedTarget||n.fromElement)&&(Si(p)||p[Sn]))break e;if((d||f)&&(f=u.window===u?u:(f=u.ownerDocument)?f.defaultView||f.parentWindow:window,d?(p=n.relatedTarget||n.toElement,d=c,p=p?Si(p):null,p!==null&&(A=Ki(p),p!==A||p.tag!==5&&p.tag!==6)&&(p=null)):(d=null,p=c),d!==p)){if(v=C_,E="onMouseLeave",y="onMouseEnter",g="mouse",(t==="pointerout"||t==="pointerover")&&(v=M_,E="onPointerLeave",y="onPointerEnter",g="pointer"),A=d==null?f:Tr(d),_=p==null?f:Tr(p),f=new v(E,g+"leave",d,n,u),f.target=A,f.relatedTarget=_,E=null,Si(u)===c&&(v=new v(y,g+"enter",p,n,u),v.target=_,v.relatedTarget=A,E=v),A=E,d&&p)t:{for(v=d,y=p,g=0,_=v;_;_=rr(_))g++;for(_=0,E=y;E;E=rr(E))_++;for(;0<g-_;)v=rr(v),g--;for(;0<_-g;)y=rr(y),_--;for(;g--;){if(v===y||y!==null&&v===y.alternate)break t;v=rr(v),y=rr(y)}v=null}else v=null;d!==null&&V_(h,f,d,v,!1),p!==null&&A!==null&&V_(h,A,p,v,!0)}}e:{if(f=c?Tr(c):window,d=f.nodeName&&f.nodeName.toLowerCase(),d==="select"||d==="input"&&f.type==="file")var R=cx;else if(N_(f))if(gT)R=dx;else{R=hx;var P=ux}else(d=f.nodeName)&&d.toLowerCase()==="input"&&(f.type==="checkbox"||f.type==="radio")&&(R=fx);if(R&&(R=R(t,c))){pT(h,R,n,u);break e}P&&P(t,f,c),t==="focusout"&&(P=f._wrapperState)&&P.controlled&&f.type==="number"&&xf(f,"number",f.value)}switch(P=c?Tr(c):window,t){case"focusin":(N_(P)||P.contentEditable==="true")&&(yr=P,Bf=c,io=null);break;case"focusout":io=Bf=yr=null;break;case"mousedown":Uf=!0;break;case"contextmenu":case"mouseup":case"dragend":Uf=!1,U_(h,n,u);break;case"selectionchange":if(_x)break;case"keydown":case"keyup":U_(h,n,u)}var I;if(kp)e:{switch(t){case"compositionstart":var O="onCompositionStart";break e;case"compositionend":O="onCompositionEnd";break e;case"compositionupdate":O="onCompositionUpdate";break e}O=void 0}else mr?fT(t,n)&&(O="onCompositionEnd"):t==="keydown"&&n.keyCode===229&&(O="onCompositionStart");O&&(hT&&n.locale!=="ko"&&(mr||O!=="onCompositionStart"?O==="onCompositionEnd"&&mr&&(I=uT()):(Wn=u,Ip="value"in Wn?Wn.value:Wn.textContent,mr=!0)),P=Xl(c,O),0<P.length&&(O=new P_(O,t,null,n,u),h.push({event:O,listeners:P}),I?O.data=I:(I=dT(n),I!==null&&(O.data=I)))),(I=rx?sx(t,n):ox(t,n))&&(c=Xl(c,"onBeforeInput"),0<c.length&&(u=new P_("onBeforeInput","beforeinput",null,n,u),h.push({event:u,listeners:c}),u.data=I))}xT(h,e)})}function Po(t,e,n){return{instance:t,listener:e,currentTarget:n}}function Xl(t,e){for(var n=e+"Capture",i=[];t!==null;){var r=t,s=r.stateNode;r.tag===5&&s!==null&&(r=s,s=Eo(t,n),s!=null&&i.unshift(Po(t,s,r)),s=Eo(t,e),s!=null&&i.push(Po(t,s,r))),t=t.return}return i}function rr(t){if(t===null)return null;do t=t.return;while(t&&t.tag!==5);return t||null}function V_(t,e,n,i,r){for(var s=e._reactName,o=[];n!==null&&n!==i;){var a=n,l=a.alternate,c=a.stateNode;if(l!==null&&l===i)break;a.tag===5&&c!==null&&(a=c,r?(l=Eo(n,s),l!=null&&o.unshift(Po(n,l,a))):r||(l=Eo(n,s),l!=null&&o.push(Po(n,l,a)))),n=n.return}o.length!==0&&t.push({event:e,listeners:o})}var Tx=/\r\n?/g,wx=/\u0000|\uFFFD/g;function j_(t){return(typeof t=="string"?t:""+t).replace(Tx,`
`).replace(wx,"")}function Oa(t,e,n){if(e=j_(e),j_(t)!==e&&n)throw Error(B(425))}function Yl(){}var Lf=null,zf=null;function Vf(t,e){return t==="textarea"||t==="noscript"||typeof e.children=="string"||typeof e.children=="number"||typeof e.dangerouslySetInnerHTML=="object"&&e.dangerouslySetInnerHTML!==null&&e.dangerouslySetInnerHTML.__html!=null}var jf=typeof setTimeout=="function"?setTimeout:void 0,Ex=typeof clearTimeout=="function"?clearTimeout:void 0,W_=typeof Promise=="function"?Promise:void 0,Sx=typeof queueMicrotask=="function"?queueMicrotask:typeof W_<"u"?function(t){return W_.resolve(null).then(t).catch(Ax)}:jf;function Ax(t){setTimeout(function(){throw t})}function gh(t,e){var n=e,i=0;do{var r=n.nextSibling;if(t.removeChild(n),r&&r.nodeType===8)if(n=r.data,n==="/$"){if(i===0){t.removeChild(r),xo(e);return}i--}else n!=="$"&&n!=="$?"&&n!=="$!"||i++;n=r}while(n);xo(e)}function Jn(t){for(;t!=null;t=t.nextSibling){var e=t.nodeType;if(e===1||e===3)break;if(e===8){if(e=t.data,e==="$"||e==="$!"||e==="$?")break;if(e==="/$")return null}}return t}function H_(t){t=t.previousSibling;for(var e=0;t;){if(t.nodeType===8){var n=t.data;if(n==="$"||n==="$!"||n==="$?"){if(e===0)return t;e--}else n==="/$"&&e++}t=t.previousSibling}return null}var ds=Math.random().toString(36).slice(2),Gt="__reactFiber$"+ds,Mo="__reactProps$"+ds,Sn="__reactContainer$"+ds,Wf="__reactEvents$"+ds,xx="__reactListeners$"+ds,Rx="__reactHandles$"+ds;function Si(t){var e=t[Gt];if(e)return e;for(var n=t.parentNode;n;){if(e=n[Sn]||n[Gt]){if(n=e.alternate,e.child!==null||n!==null&&n.child!==null)for(t=H_(t);t!==null;){if(n=t[Gt])return n;t=H_(t)}return e}t=n,n=t.parentNode}return null}function ta(t){return t=t[Gt]||t[Sn],!t||t.tag!==5&&t.tag!==6&&t.tag!==13&&t.tag!==3?null:t}function Tr(t){if(t.tag===5||t.tag===6)return t.stateNode;throw Error(B(33))}function _u(t){return t[Mo]||null}var Hf=[],wr=-1;function ui(t){return{current:t}}function ue(t){0>wr||(t.current=Hf[wr],Hf[wr]=null,wr--)}function ae(t,e){wr++,Hf[wr]=t.current,t.current=e}var oi={},Ye=ui(oi),ot=ui(!1),Di=oi;function qr(t,e){var n=t.type.contextTypes;if(!n)return oi;var i=t.stateNode;if(i&&i.__reactInternalMemoizedUnmaskedChildContext===e)return i.__reactInternalMemoizedMaskedChildContext;var r={},s;for(s in n)r[s]=e[s];return i&&(t=t.stateNode,t.__reactInternalMemoizedUnmaskedChildContext=e,t.__reactInternalMemoizedMaskedChildContext=r),r}function at(t){return t=t.childContextTypes,t!=null}function Kl(){ue(ot),ue(Ye)}function $_(t,e,n){if(Ye.current!==oi)throw Error(B(168));ae(Ye,e),ae(ot,n)}function bT(t,e,n){var i=t.stateNode;if(e=e.childContextTypes,typeof i.getChildContext!="function")return n;i=i.getChildContext();for(var r in i)if(!(r in e))throw Error(B(108,uA(t)||"Unknown",r));return ve({},n,i)}function ql(t){return t=(t=t.stateNode)&&t.__reactInternalMemoizedMergedChildContext||oi,Di=Ye.current,ae(Ye,t),ae(ot,ot.current),!0}function X_(t,e,n){var i=t.stateNode;if(!i)throw Error(B(169));n?(t=bT(t,e,Di),i.__reactInternalMemoizedMergedChildContext=t,ue(ot),ue(Ye),ae(Ye,t)):ue(ot),ae(ot,n)}var pn=null,mu=!1,_h=!1;function CT(t){pn===null?pn=[t]:pn.push(t)}function bx(t){mu=!0,CT(t)}function hi(){if(!_h&&pn!==null){_h=!0;var t=0,e=ne;try{var n=pn;for(ne=1;t<n.length;t++){var i=n[t];do i=i(!0);while(i!==null)}pn=null,mu=!1}catch(r){throw pn!==null&&(pn=pn.slice(t+1)),Gv(bp,hi),r}finally{ne=e,_h=!1}}return null}var Er=[],Sr=0,Zl=null,Ql=0,vt=[],Tt=0,Bi=null,_n=1,mn="";function yi(t,e){Er[Sr++]=Ql,Er[Sr++]=Zl,Zl=t,Ql=e}function PT(t,e,n){vt[Tt++]=_n,vt[Tt++]=mn,vt[Tt++]=Bi,Bi=t;var i=_n;t=mn;var r=32-Bt(i)-1;i&=~(1<<r),n+=1;var s=32-Bt(e)+r;if(30<s){var o=r-r%5;s=(i&(1<<o)-1).toString(32),i>>=o,r-=o,_n=1<<32-Bt(e)+r|n<<r|i,mn=s+t}else _n=1<<s|n<<r|i,mn=t}function Dp(t){t.return!==null&&(yi(t,1),PT(t,1,0))}function Bp(t){for(;t===Zl;)Zl=Er[--Sr],Er[Sr]=null,Ql=Er[--Sr],Er[Sr]=null;for(;t===Bi;)Bi=vt[--Tt],vt[Tt]=null,mn=vt[--Tt],vt[Tt]=null,_n=vt[--Tt],vt[Tt]=null}var ft=null,ht=null,fe=!1,Ot=null;function MT(t,e){var n=wt(5,null,null,0);n.elementType="DELETED",n.stateNode=e,n.return=t,e=t.deletions,e===null?(t.deletions=[n],t.flags|=16):e.push(n)}function Y_(t,e){switch(t.tag){case 5:var n=t.type;return e=e.nodeType!==1||n.toLowerCase()!==e.nodeName.toLowerCase()?null:e,e!==null?(t.stateNode=e,ft=t,ht=Jn(e.firstChild),!0):!1;case 6:return e=t.pendingProps===""||e.nodeType!==3?null:e,e!==null?(t.stateNode=e,ft=t,ht=null,!0):!1;case 13:return e=e.nodeType!==8?null:e,e!==null?(n=Bi!==null?{id:_n,overflow:mn}:null,t.memoizedState={dehydrated:e,treeContext:n,retryLane:1073741824},n=wt(18,null,null,0),n.stateNode=e,n.return=t,t.child=n,ft=t,ht=null,!0):!1;default:return!1}}function $f(t){return(t.mode&1)!==0&&(t.flags&128)===0}function Xf(t){if(fe){var e=ht;if(e){var n=e;if(!Y_(t,e)){if($f(t))throw Error(B(418));e=Jn(n.nextSibling);var i=ft;e&&Y_(t,e)?MT(i,n):(t.flags=t.flags&-4097|2,fe=!1,ft=t)}}else{if($f(t))throw Error(B(418));t.flags=t.flags&-4097|2,fe=!1,ft=t}}}function K_(t){for(t=t.return;t!==null&&t.tag!==5&&t.tag!==3&&t.tag!==13;)t=t.return;ft=t}function Na(t){if(t!==ft)return!1;if(!fe)return K_(t),fe=!0,!1;var e;if((e=t.tag!==3)&&!(e=t.tag!==5)&&(e=t.type,e=e!=="head"&&e!=="body"&&!Vf(t.type,t.memoizedProps)),e&&(e=ht)){if($f(t))throw IT(),Error(B(418));for(;e;)MT(t,e),e=Jn(e.nextSibling)}if(K_(t),t.tag===13){if(t=t.memoizedState,t=t!==null?t.dehydrated:null,!t)throw Error(B(317));e:{for(t=t.nextSibling,e=0;t;){if(t.nodeType===8){var n=t.data;if(n==="/$"){if(e===0){ht=Jn(t.nextSibling);break e}e--}else n!=="$"&&n!=="$!"&&n!=="$?"||e++}t=t.nextSibling}ht=null}}else ht=ft?Jn(t.stateNode.nextSibling):null;return!0}function IT(){for(var t=ht;t;)t=Jn(t.nextSibling)}function Zr(){ht=ft=null,fe=!1}function Up(t){Ot===null?Ot=[t]:Ot.push(t)}var Cx=Pn.ReactCurrentBatchConfig;function Mt(t,e){if(t&&t.defaultProps){e=ve({},e),t=t.defaultProps;for(var n in t)e[n]===void 0&&(e[n]=t[n]);return e}return e}var Jl=ui(null),Gl=null,Ar=null,Lp=null;function zp(){Lp=Ar=Gl=null}function Vp(t){var e=Jl.current;ue(Jl),t._currentValue=e}function Yf(t,e,n){for(;t!==null;){var i=t.alternate;if((t.childLanes&e)!==e?(t.childLanes|=e,i!==null&&(i.childLanes|=e)):i!==null&&(i.childLanes&e)!==e&&(i.childLanes|=e),t===n)break;t=t.return}}function jr(t,e){Gl=t,Lp=Ar=null,t=t.dependencies,t!==null&&t.firstContext!==null&&(t.lanes&e&&(st=!0),t.firstContext=null)}function xt(t){var e=t._currentValue;if(Lp!==t)if(t={context:t,memoizedValue:e,next:null},Ar===null){if(Gl===null)throw Error(B(308));Ar=t,Gl.dependencies={lanes:0,firstContext:t}}else Ar=Ar.next=t;return e}var Ai=null;function jp(t){Ai===null?Ai=[t]:Ai.push(t)}function OT(t,e,n,i){var r=e.interleaved;return r===null?(n.next=n,jp(e)):(n.next=r.next,r.next=n),e.interleaved=n,An(t,i)}function An(t,e){t.lanes|=e;var n=t.alternate;for(n!==null&&(n.lanes|=e),n=t,t=t.return;t!==null;)t.childLanes|=e,n=t.alternate,n!==null&&(n.childLanes|=e),n=t,t=t.return;return n.tag===3?n.stateNode:null}var Un=!1;function Wp(t){t.updateQueue={baseState:t.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function NT(t,e){t=t.updateQueue,e.updateQueue===t&&(e.updateQueue={baseState:t.baseState,firstBaseUpdate:t.firstBaseUpdate,lastBaseUpdate:t.lastBaseUpdate,shared:t.shared,effects:t.effects})}function Tn(t,e){return{eventTime:t,lane:e,tag:0,payload:null,callback:null,next:null}}function Gn(t,e,n){var i=t.updateQueue;if(i===null)return null;if(i=i.shared,G&2){var r=i.pending;return r===null?e.next=e:(e.next=r.next,r.next=e),i.pending=e,An(t,n)}return r=i.interleaved,r===null?(e.next=e,jp(i)):(e.next=r.next,r.next=e),i.interleaved=e,An(t,n)}function Sl(t,e,n){if(e=e.updateQueue,e!==null&&(e=e.shared,(n&4194240)!==0)){var i=e.lanes;i&=t.pendingLanes,n|=i,e.lanes=n,Cp(t,n)}}function q_(t,e){var n=t.updateQueue,i=t.alternate;if(i!==null&&(i=i.updateQueue,n===i)){var r=null,s=null;if(n=n.firstBaseUpdate,n!==null){do{var o={eventTime:n.eventTime,lane:n.lane,tag:n.tag,payload:n.payload,callback:n.callback,next:null};s===null?r=s=o:s=s.next=o,n=n.next}while(n!==null);s===null?r=s=e:s=s.next=e}else r=s=e;n={baseState:i.baseState,firstBaseUpdate:r,lastBaseUpdate:s,shared:i.shared,effects:i.effects},t.updateQueue=n;return}t=n.lastBaseUpdate,t===null?n.firstBaseUpdate=e:t.next=e,n.lastBaseUpdate=e}function ec(t,e,n,i){var r=t.updateQueue;Un=!1;var s=r.firstBaseUpdate,o=r.lastBaseUpdate,a=r.shared.pending;if(a!==null){r.shared.pending=null;var l=a,c=l.next;l.next=null,o===null?s=c:o.next=c,o=l;var u=t.alternate;u!==null&&(u=u.updateQueue,a=u.lastBaseUpdate,a!==o&&(a===null?u.firstBaseUpdate=c:a.next=c,u.lastBaseUpdate=l))}if(s!==null){var h=r.baseState;o=0,u=c=l=null,a=s;do{var f=a.lane,d=a.eventTime;if((i&f)===f){u!==null&&(u=u.next={eventTime:d,lane:0,tag:a.tag,payload:a.payload,callback:a.callback,next:null});e:{var p=t,v=a;switch(f=e,d=n,v.tag){case 1:if(p=v.payload,typeof p=="function"){h=p.call(d,h,f);break e}h=p;break e;case 3:p.flags=p.flags&-65537|128;case 0:if(p=v.payload,f=typeof p=="function"?p.call(d,h,f):p,f==null)break e;h=ve({},h,f);break e;case 2:Un=!0}}a.callback!==null&&a.lane!==0&&(t.flags|=64,f=r.effects,f===null?r.effects=[a]:f.push(a))}else d={eventTime:d,lane:f,tag:a.tag,payload:a.payload,callback:a.callback,next:null},u===null?(c=u=d,l=h):u=u.next=d,o|=f;if(a=a.next,a===null){if(a=r.shared.pending,a===null)break;f=a,a=f.next,f.next=null,r.lastBaseUpdate=f,r.shared.pending=null}}while(1);if(u===null&&(l=h),r.baseState=l,r.firstBaseUpdate=c,r.lastBaseUpdate=u,e=r.shared.interleaved,e!==null){r=e;do o|=r.lane,r=r.next;while(r!==e)}else s===null&&(r.shared.lanes=0);Li|=o,t.lanes=o,t.memoizedState=h}}function Z_(t,e,n){if(t=e.effects,e.effects=null,t!==null)for(e=0;e<t.length;e++){var i=t[e],r=i.callback;if(r!==null){if(i.callback=null,i=n,typeof r!="function")throw Error(B(191,r));r.call(i)}}}var kT=new Ov.Component().refs;function Kf(t,e,n,i){e=t.memoizedState,n=n(i,e),n=n==null?e:ve({},e,n),t.memoizedState=n,t.lanes===0&&(t.updateQueue.baseState=n)}var yu={isMounted:function(t){return(t=t._reactInternals)?Ki(t)===t:!1},enqueueSetState:function(t,e,n){t=t._reactInternals;var i=Ge(),r=ti(t),s=Tn(i,r);s.payload=e,n!=null&&(s.callback=n),e=Gn(t,s,r),e!==null&&(Ut(e,t,r,i),Sl(e,t,r))},enqueueReplaceState:function(t,e,n){t=t._reactInternals;var i=Ge(),r=ti(t),s=Tn(i,r);s.tag=1,s.payload=e,n!=null&&(s.callback=n),e=Gn(t,s,r),e!==null&&(Ut(e,t,r,i),Sl(e,t,r))},enqueueForceUpdate:function(t,e){t=t._reactInternals;var n=Ge(),i=ti(t),r=Tn(n,i);r.tag=2,e!=null&&(r.callback=e),e=Gn(t,r,i),e!==null&&(Ut(e,t,i,n),Sl(e,t,i))}};function Q_(t,e,n,i,r,s,o){return t=t.stateNode,typeof t.shouldComponentUpdate=="function"?t.shouldComponentUpdate(i,s,o):e.prototype&&e.prototype.isPureReactComponent?!bo(n,i)||!bo(r,s):!0}function FT(t,e,n){var i=!1,r=oi,s=e.contextType;return typeof s=="object"&&s!==null?s=xt(s):(r=at(e)?Di:Ye.current,i=e.contextTypes,s=(i=i!=null)?qr(t,r):oi),e=new e(n,s),t.memoizedState=e.state!==null&&e.state!==void 0?e.state:null,e.updater=yu,t.stateNode=e,e._reactInternals=t,i&&(t=t.stateNode,t.__reactInternalMemoizedUnmaskedChildContext=r,t.__reactInternalMemoizedMaskedChildContext=s),e}function J_(t,e,n,i){t=e.state,typeof e.componentWillReceiveProps=="function"&&e.componentWillReceiveProps(n,i),typeof e.UNSAFE_componentWillReceiveProps=="function"&&e.UNSAFE_componentWillReceiveProps(n,i),e.state!==t&&yu.enqueueReplaceState(e,e.state,null)}function qf(t,e,n,i){var r=t.stateNode;r.props=n,r.state=t.memoizedState,r.refs=kT,Wp(t);var s=e.contextType;typeof s=="object"&&s!==null?r.context=xt(s):(s=at(e)?Di:Ye.current,r.context=qr(t,s)),r.state=t.memoizedState,s=e.getDerivedStateFromProps,typeof s=="function"&&(Kf(t,e,s,n),r.state=t.memoizedState),typeof e.getDerivedStateFromProps=="function"||typeof r.getSnapshotBeforeUpdate=="function"||typeof r.UNSAFE_componentWillMount!="function"&&typeof r.componentWillMount!="function"||(e=r.state,typeof r.componentWillMount=="function"&&r.componentWillMount(),typeof r.UNSAFE_componentWillMount=="function"&&r.UNSAFE_componentWillMount(),e!==r.state&&yu.enqueueReplaceState(r,r.state,null),ec(t,n,r,i),r.state=t.memoizedState),typeof r.componentDidMount=="function"&&(t.flags|=4194308)}function Ms(t,e,n){if(t=n.ref,t!==null&&typeof t!="function"&&typeof t!="object"){if(n._owner){if(n=n._owner,n){if(n.tag!==1)throw Error(B(309));var i=n.stateNode}if(!i)throw Error(B(147,t));var r=i,s=""+t;return e!==null&&e.ref!==null&&typeof e.ref=="function"&&e.ref._stringRef===s?e.ref:(e=function(o){var a=r.refs;a===kT&&(a=r.refs={}),o===null?delete a[s]:a[s]=o},e._stringRef=s,e)}if(typeof t!="string")throw Error(B(284));if(!n._owner)throw Error(B(290,t))}return t}function ka(t,e){throw t=Object.prototype.toString.call(e),Error(B(31,t==="[object Object]"?"object with keys {"+Object.keys(e).join(", ")+"}":t))}function G_(t){var e=t._init;return e(t._payload)}function DT(t){function e(y,g){if(t){var _=y.deletions;_===null?(y.deletions=[g],y.flags|=16):_.push(g)}}function n(y,g){if(!t)return null;for(;g!==null;)e(y,g),g=g.sibling;return null}function i(y,g){for(y=new Map;g!==null;)g.key!==null?y.set(g.key,g):y.set(g.index,g),g=g.sibling;return y}function r(y,g){return y=ni(y,g),y.index=0,y.sibling=null,y}function s(y,g,_){return y.index=_,t?(_=y.alternate,_!==null?(_=_.index,_<g?(y.flags|=2,g):_):(y.flags|=2,g)):(y.flags|=1048576,g)}function o(y){return t&&y.alternate===null&&(y.flags|=2),y}function a(y,g,_,E){return g===null||g.tag!==6?(g=Sh(_,y.mode,E),g.return=y,g):(g=r(g,_),g.return=y,g)}function l(y,g,_,E){var R=_.type;return R===_r?u(y,g,_.props.children,E,_.key):g!==null&&(g.elementType===R||typeof R=="object"&&R!==null&&R.$$typeof===Bn&&G_(R)===g.type)?(E=r(g,_.props),E.ref=Ms(y,g,_),E.return=y,E):(E=Pl(_.type,_.key,_.props,null,y.mode,E),E.ref=Ms(y,g,_),E.return=y,E)}function c(y,g,_,E){return g===null||g.tag!==4||g.stateNode.containerInfo!==_.containerInfo||g.stateNode.implementation!==_.implementation?(g=Ah(_,y.mode,E),g.return=y,g):(g=r(g,_.children||[]),g.return=y,g)}function u(y,g,_,E,R){return g===null||g.tag!==7?(g=Mi(_,y.mode,E,R),g.return=y,g):(g=r(g,_),g.return=y,g)}function h(y,g,_){if(typeof g=="string"&&g!==""||typeof g=="number")return g=Sh(""+g,y.mode,_),g.return=y,g;if(typeof g=="object"&&g!==null){switch(g.$$typeof){case Sa:return _=Pl(g.type,g.key,g.props,null,y.mode,_),_.ref=Ms(y,null,g),_.return=y,_;case gr:return g=Ah(g,y.mode,_),g.return=y,g;case Bn:var E=g._init;return h(y,E(g._payload),_)}if(Hs(g)||xs(g))return g=Mi(g,y.mode,_,null),g.return=y,g;ka(y,g)}return null}function f(y,g,_,E){var R=g!==null?g.key:null;if(typeof _=="string"&&_!==""||typeof _=="number")return R!==null?null:a(y,g,""+_,E);if(typeof _=="object"&&_!==null){switch(_.$$typeof){case Sa:return _.key===R?l(y,g,_,E):null;case gr:return _.key===R?c(y,g,_,E):null;case Bn:return R=_._init,f(y,g,R(_._payload),E)}if(Hs(_)||xs(_))return R!==null?null:u(y,g,_,E,null);ka(y,_)}return null}function d(y,g,_,E,R){if(typeof E=="string"&&E!==""||typeof E=="number")return y=y.get(_)||null,a(g,y,""+E,R);if(typeof E=="object"&&E!==null){switch(E.$$typeof){case Sa:return y=y.get(E.key===null?_:E.key)||null,l(g,y,E,R);case gr:return y=y.get(E.key===null?_:E.key)||null,c(g,y,E,R);case Bn:var P=E._init;return d(y,g,_,P(E._payload),R)}if(Hs(E)||xs(E))return y=y.get(_)||null,u(g,y,E,R,null);ka(g,E)}return null}function p(y,g,_,E){for(var R=null,P=null,I=g,O=g=0,k=null;I!==null&&O<_.length;O++){I.index>O?(k=I,I=null):k=I.sibling;var D=f(y,I,_[O],E);if(D===null){I===null&&(I=k);break}t&&I&&D.alternate===null&&e(y,I),g=s(D,g,O),P===null?R=D:P.sibling=D,P=D,I=k}if(O===_.length)return n(y,I),fe&&yi(y,O),R;if(I===null){for(;O<_.length;O++)I=h(y,_[O],E),I!==null&&(g=s(I,g,O),P===null?R=I:P.sibling=I,P=I);return fe&&yi(y,O),R}for(I=i(y,I);O<_.length;O++)k=d(I,y,O,_[O],E),k!==null&&(t&&k.alternate!==null&&I.delete(k.key===null?O:k.key),g=s(k,g,O),P===null?R=k:P.sibling=k,P=k);return t&&I.forEach(function(H){return e(y,H)}),fe&&yi(y,O),R}function v(y,g,_,E){var R=xs(_);if(typeof R!="function")throw Error(B(150));if(_=R.call(_),_==null)throw Error(B(151));for(var P=R=null,I=g,O=g=0,k=null,D=_.next();I!==null&&!D.done;O++,D=_.next()){I.index>O?(k=I,I=null):k=I.sibling;var H=f(y,I,D.value,E);if(H===null){I===null&&(I=k);break}t&&I&&H.alternate===null&&e(y,I),g=s(H,g,O),P===null?R=H:P.sibling=H,P=H,I=k}if(D.done)return n(y,I),fe&&yi(y,O),R;if(I===null){for(;!D.done;O++,D=_.next())D=h(y,D.value,E),D!==null&&(g=s(D,g,O),P===null?R=D:P.sibling=D,P=D);return fe&&yi(y,O),R}for(I=i(y,I);!D.done;O++,D=_.next())D=d(I,y,O,D.value,E),D!==null&&(t&&D.alternate!==null&&I.delete(D.key===null?O:D.key),g=s(D,g,O),P===null?R=D:P.sibling=D,P=D);return t&&I.forEach(function(X){return e(y,X)}),fe&&yi(y,O),R}function A(y,g,_,E){if(typeof _=="object"&&_!==null&&_.type===_r&&_.key===null&&(_=_.props.children),typeof _=="object"&&_!==null){switch(_.$$typeof){case Sa:e:{for(var R=_.key,P=g;P!==null;){if(P.key===R){if(R=_.type,R===_r){if(P.tag===7){n(y,P.sibling),g=r(P,_.props.children),g.return=y,y=g;break e}}else if(P.elementType===R||typeof R=="object"&&R!==null&&R.$$typeof===Bn&&G_(R)===P.type){n(y,P.sibling),g=r(P,_.props),g.ref=Ms(y,P,_),g.return=y,y=g;break e}n(y,P);break}else e(y,P);P=P.sibling}_.type===_r?(g=Mi(_.props.children,y.mode,E,_.key),g.return=y,y=g):(E=Pl(_.type,_.key,_.props,null,y.mode,E),E.ref=Ms(y,g,_),E.return=y,y=E)}return o(y);case gr:e:{for(P=_.key;g!==null;){if(g.key===P)if(g.tag===4&&g.stateNode.containerInfo===_.containerInfo&&g.stateNode.implementation===_.implementation){n(y,g.sibling),g=r(g,_.children||[]),g.return=y,y=g;break e}else{n(y,g);break}else e(y,g);g=g.sibling}g=Ah(_,y.mode,E),g.return=y,y=g}return o(y);case Bn:return P=_._init,A(y,g,P(_._payload),E)}if(Hs(_))return p(y,g,_,E);if(xs(_))return v(y,g,_,E);ka(y,_)}return typeof _=="string"&&_!==""||typeof _=="number"?(_=""+_,g!==null&&g.tag===6?(n(y,g.sibling),g=r(g,_),g.return=y,y=g):(n(y,g),g=Sh(_,y.mode,E),g.return=y,y=g),o(y)):n(y,g)}return A}var Qr=DT(!0),BT=DT(!1),na={},rn=ui(na),Io=ui(na),Oo=ui(na);function xi(t){if(t===na)throw Error(B(174));return t}function Hp(t,e){switch(ae(Oo,e),ae(Io,t),ae(rn,na),t=e.nodeType,t){case 9:case 11:e=(e=e.documentElement)?e.namespaceURI:bf(null,"");break;default:t=t===8?e.parentNode:e,e=t.namespaceURI||null,t=t.tagName,e=bf(e,t)}ue(rn),ae(rn,e)}function Jr(){ue(rn),ue(Io),ue(Oo)}function UT(t){xi(Oo.current);var e=xi(rn.current),n=bf(e,t.type);e!==n&&(ae(Io,t),ae(rn,n))}function $p(t){Io.current===t&&(ue(rn),ue(Io))}var ge=ui(0);function tc(t){for(var e=t;e!==null;){if(e.tag===13){var n=e.memoizedState;if(n!==null&&(n=n.dehydrated,n===null||n.data==="$?"||n.data==="$!"))return e}else if(e.tag===19&&e.memoizedProps.revealOrder!==void 0){if(e.flags&128)return e}else if(e.child!==null){e.child.return=e,e=e.child;continue}if(e===t)break;for(;e.sibling===null;){if(e.return===null||e.return===t)return null;e=e.return}e.sibling.return=e.return,e=e.sibling}return null}var mh=[];function Xp(){for(var t=0;t<mh.length;t++)mh[t]._workInProgressVersionPrimary=null;mh.length=0}var Al=Pn.ReactCurrentDispatcher,yh=Pn.ReactCurrentBatchConfig,Ui=0,ye=null,Ce=null,Oe=null,nc=!1,ro=!1,No=0,Px=0;function Ve(){throw Error(B(321))}function Yp(t,e){if(e===null)return!1;for(var n=0;n<e.length&&n<t.length;n++)if(!zt(t[n],e[n]))return!1;return!0}function Kp(t,e,n,i,r,s){if(Ui=s,ye=e,e.memoizedState=null,e.updateQueue=null,e.lanes=0,Al.current=t===null||t.memoizedState===null?Nx:kx,t=n(i,r),ro){s=0;do{if(ro=!1,No=0,25<=s)throw Error(B(301));s+=1,Oe=Ce=null,e.updateQueue=null,Al.current=Fx,t=n(i,r)}while(ro)}if(Al.current=ic,e=Ce!==null&&Ce.next!==null,Ui=0,Oe=Ce=ye=null,nc=!1,e)throw Error(B(300));return t}function qp(){var t=No!==0;return No=0,t}function Jt(){var t={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return Oe===null?ye.memoizedState=Oe=t:Oe=Oe.next=t,Oe}function Rt(){if(Ce===null){var t=ye.alternate;t=t!==null?t.memoizedState:null}else t=Ce.next;var e=Oe===null?ye.memoizedState:Oe.next;if(e!==null)Oe=e,Ce=t;else{if(t===null)throw Error(B(310));Ce=t,t={memoizedState:Ce.memoizedState,baseState:Ce.baseState,baseQueue:Ce.baseQueue,queue:Ce.queue,next:null},Oe===null?ye.memoizedState=Oe=t:Oe=Oe.next=t}return Oe}function ko(t,e){return typeof e=="function"?e(t):e}function vh(t){var e=Rt(),n=e.queue;if(n===null)throw Error(B(311));n.lastRenderedReducer=t;var i=Ce,r=i.baseQueue,s=n.pending;if(s!==null){if(r!==null){var o=r.next;r.next=s.next,s.next=o}i.baseQueue=r=s,n.pending=null}if(r!==null){s=r.next,i=i.baseState;var a=o=null,l=null,c=s;do{var u=c.lane;if((Ui&u)===u)l!==null&&(l=l.next={lane:0,action:c.action,hasEagerState:c.hasEagerState,eagerState:c.eagerState,next:null}),i=c.hasEagerState?c.eagerState:t(i,c.action);else{var h={lane:u,action:c.action,hasEagerState:c.hasEagerState,eagerState:c.eagerState,next:null};l===null?(a=l=h,o=i):l=l.next=h,ye.lanes|=u,Li|=u}c=c.next}while(c!==null&&c!==s);l===null?o=i:l.next=a,zt(i,e.memoizedState)||(st=!0),e.memoizedState=i,e.baseState=o,e.baseQueue=l,n.lastRenderedState=i}if(t=n.interleaved,t!==null){r=t;do s=r.lane,ye.lanes|=s,Li|=s,r=r.next;while(r!==t)}else r===null&&(n.lanes=0);return[e.memoizedState,n.dispatch]}function Th(t){var e=Rt(),n=e.queue;if(n===null)throw Error(B(311));n.lastRenderedReducer=t;var i=n.dispatch,r=n.pending,s=e.memoizedState;if(r!==null){n.pending=null;var o=r=r.next;do s=t(s,o.action),o=o.next;while(o!==r);zt(s,e.memoizedState)||(st=!0),e.memoizedState=s,e.baseQueue===null&&(e.baseState=s),n.lastRenderedState=s}return[s,i]}function LT(){}function zT(t,e){var n=ye,i=Rt(),r=e(),s=!zt(i.memoizedState,r);if(s&&(i.memoizedState=r,st=!0),i=i.queue,Zp(WT.bind(null,n,i,t),[t]),i.getSnapshot!==e||s||Oe!==null&&Oe.memoizedState.tag&1){if(n.flags|=2048,Fo(9,jT.bind(null,n,i,r,e),void 0,null),Ne===null)throw Error(B(349));Ui&30||VT(n,e,r)}return r}function VT(t,e,n){t.flags|=16384,t={getSnapshot:e,value:n},e=ye.updateQueue,e===null?(e={lastEffect:null,stores:null},ye.updateQueue=e,e.stores=[t]):(n=e.stores,n===null?e.stores=[t]:n.push(t))}function jT(t,e,n,i){e.value=n,e.getSnapshot=i,HT(e)&&$T(t)}function WT(t,e,n){return n(function(){HT(e)&&$T(t)})}function HT(t){var e=t.getSnapshot;t=t.value;try{var n=e();return!zt(t,n)}catch{return!0}}function $T(t){var e=An(t,1);e!==null&&Ut(e,t,1,-1)}function em(t){var e=Jt();return typeof t=="function"&&(t=t()),e.memoizedState=e.baseState=t,t={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:ko,lastRenderedState:t},e.queue=t,t=t.dispatch=Ox.bind(null,ye,t),[e.memoizedState,t]}function Fo(t,e,n,i){return t={tag:t,create:e,destroy:n,deps:i,next:null},e=ye.updateQueue,e===null?(e={lastEffect:null,stores:null},ye.updateQueue=e,e.lastEffect=t.next=t):(n=e.lastEffect,n===null?e.lastEffect=t.next=t:(i=n.next,n.next=t,t.next=i,e.lastEffect=t)),t}function XT(){return Rt().memoizedState}function xl(t,e,n,i){var r=Jt();ye.flags|=t,r.memoizedState=Fo(1|e,n,void 0,i===void 0?null:i)}function vu(t,e,n,i){var r=Rt();i=i===void 0?null:i;var s=void 0;if(Ce!==null){var o=Ce.memoizedState;if(s=o.destroy,i!==null&&Yp(i,o.deps)){r.memoizedState=Fo(e,n,s,i);return}}ye.flags|=t,r.memoizedState=Fo(1|e,n,s,i)}function tm(t,e){return xl(8390656,8,t,e)}function Zp(t,e){return vu(2048,8,t,e)}function YT(t,e){return vu(4,2,t,e)}function KT(t,e){return vu(4,4,t,e)}function qT(t,e){if(typeof e=="function")return t=t(),e(t),function(){e(null)};if(e!=null)return t=t(),e.current=t,function(){e.current=null}}function ZT(t,e,n){return n=n!=null?n.concat([t]):null,vu(4,4,qT.bind(null,e,t),n)}function Qp(){}function QT(t,e){var n=Rt();e=e===void 0?null:e;var i=n.memoizedState;return i!==null&&e!==null&&Yp(e,i[1])?i[0]:(n.memoizedState=[t,e],t)}function JT(t,e){var n=Rt();e=e===void 0?null:e;var i=n.memoizedState;return i!==null&&e!==null&&Yp(e,i[1])?i[0]:(t=t(),n.memoizedState=[t,e],t)}function GT(t,e,n){return Ui&21?(zt(n,e)||(n=nT(),ye.lanes|=n,Li|=n,t.baseState=!0),e):(t.baseState&&(t.baseState=!1,st=!0),t.memoizedState=n)}function Mx(t,e){var n=ne;ne=n!==0&&4>n?n:4,t(!0);var i=yh.transition;yh.transition={};try{t(!1),e()}finally{ne=n,yh.transition=i}}function e1(){return Rt().memoizedState}function Ix(t,e,n){var i=ti(t);if(n={lane:i,action:n,hasEagerState:!1,eagerState:null,next:null},t1(t))n1(e,n);else if(n=OT(t,e,n,i),n!==null){var r=Ge();Ut(n,t,i,r),i1(n,e,i)}}function Ox(t,e,n){var i=ti(t),r={lane:i,action:n,hasEagerState:!1,eagerState:null,next:null};if(t1(t))n1(e,r);else{var s=t.alternate;if(t.lanes===0&&(s===null||s.lanes===0)&&(s=e.lastRenderedReducer,s!==null))try{var o=e.lastRenderedState,a=s(o,n);if(r.hasEagerState=!0,r.eagerState=a,zt(a,o)){var l=e.interleaved;l===null?(r.next=r,jp(e)):(r.next=l.next,l.next=r),e.interleaved=r;return}}catch{}finally{}n=OT(t,e,r,i),n!==null&&(r=Ge(),Ut(n,t,i,r),i1(n,e,i))}}function t1(t){var e=t.alternate;return t===ye||e!==null&&e===ye}function n1(t,e){ro=nc=!0;var n=t.pending;n===null?e.next=e:(e.next=n.next,n.next=e),t.pending=e}function i1(t,e,n){if(n&4194240){var i=e.lanes;i&=t.pendingLanes,n|=i,e.lanes=n,Cp(t,n)}}var ic={readContext:xt,useCallback:Ve,useContext:Ve,useEffect:Ve,useImperativeHandle:Ve,useInsertionEffect:Ve,useLayoutEffect:Ve,useMemo:Ve,useReducer:Ve,useRef:Ve,useState:Ve,useDebugValue:Ve,useDeferredValue:Ve,useTransition:Ve,useMutableSource:Ve,useSyncExternalStore:Ve,useId:Ve,unstable_isNewReconciler:!1},Nx={readContext:xt,useCallback:function(t,e){return Jt().memoizedState=[t,e===void 0?null:e],t},useContext:xt,useEffect:tm,useImperativeHandle:function(t,e,n){return n=n!=null?n.concat([t]):null,xl(4194308,4,qT.bind(null,e,t),n)},useLayoutEffect:function(t,e){return xl(4194308,4,t,e)},useInsertionEffect:function(t,e){return xl(4,2,t,e)},useMemo:function(t,e){var n=Jt();return e=e===void 0?null:e,t=t(),n.memoizedState=[t,e],t},useReducer:function(t,e,n){var i=Jt();return e=n!==void 0?n(e):e,i.memoizedState=i.baseState=e,t={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:t,lastRenderedState:e},i.queue=t,t=t.dispatch=Ix.bind(null,ye,t),[i.memoizedState,t]},useRef:function(t){var e=Jt();return t={current:t},e.memoizedState=t},useState:em,useDebugValue:Qp,useDeferredValue:function(t){return Jt().memoizedState=t},useTransition:function(){var t=em(!1),e=t[0];return t=Mx.bind(null,t[1]),Jt().memoizedState=t,[e,t]},useMutableSource:function(){},useSyncExternalStore:function(t,e,n){var i=ye,r=Jt();if(fe){if(n===void 0)throw Error(B(407));n=n()}else{if(n=e(),Ne===null)throw Error(B(349));Ui&30||VT(i,e,n)}r.memoizedState=n;var s={value:n,getSnapshot:e};return r.queue=s,tm(WT.bind(null,i,s,t),[t]),i.flags|=2048,Fo(9,jT.bind(null,i,s,n,e),void 0,null),n},useId:function(){var t=Jt(),e=Ne.identifierPrefix;if(fe){var n=mn,i=_n;n=(i&~(1<<32-Bt(i)-1)).toString(32)+n,e=":"+e+"R"+n,n=No++,0<n&&(e+="H"+n.toString(32)),e+=":"}else n=Px++,e=":"+e+"r"+n.toString(32)+":";return t.memoizedState=e},unstable_isNewReconciler:!1},kx={readContext:xt,useCallback:QT,useContext:xt,useEffect:Zp,useImperativeHandle:ZT,useInsertionEffect:YT,useLayoutEffect:KT,useMemo:JT,useReducer:vh,useRef:XT,useState:function(){return vh(ko)},useDebugValue:Qp,useDeferredValue:function(t){var e=Rt();return GT(e,Ce.memoizedState,t)},useTransition:function(){var t=vh(ko)[0],e=Rt().memoizedState;return[t,e]},useMutableSource:LT,useSyncExternalStore:zT,useId:e1,unstable_isNewReconciler:!1},Fx={readContext:xt,useCallback:QT,useContext:xt,useEffect:Zp,useImperativeHandle:ZT,useInsertionEffect:YT,useLayoutEffect:KT,useMemo:JT,useReducer:Th,useRef:XT,useState:function(){return Th(ko)},useDebugValue:Qp,useDeferredValue:function(t){var e=Rt();return Ce===null?e.memoizedState=t:GT(e,Ce.memoizedState,t)},useTransition:function(){var t=Th(ko)[0],e=Rt().memoizedState;return[t,e]},useMutableSource:LT,useSyncExternalStore:zT,useId:e1,unstable_isNewReconciler:!1};function Gr(t,e){try{var n="",i=e;do n+=cA(i),i=i.return;while(i);var r=n}catch(s){r=`
Error generating stack: `+s.message+`
`+s.stack}return{value:t,source:e,stack:r,digest:null}}function wh(t,e,n){return{value:t,source:null,stack:n??null,digest:e??null}}function Zf(t,e){try{console.error(e.value)}catch(n){setTimeout(function(){throw n})}}var Dx=typeof WeakMap=="function"?WeakMap:Map;function r1(t,e,n){n=Tn(-1,n),n.tag=3,n.payload={element:null};var i=e.value;return n.callback=function(){sc||(sc=!0,od=i),Zf(t,e)},n}function s1(t,e,n){n=Tn(-1,n),n.tag=3;var i=t.type.getDerivedStateFromError;if(typeof i=="function"){var r=e.value;n.payload=function(){return i(r)},n.callback=function(){Zf(t,e)}}var s=t.stateNode;return s!==null&&typeof s.componentDidCatch=="function"&&(n.callback=function(){Zf(t,e),typeof i!="function"&&(ei===null?ei=new Set([this]):ei.add(this));var o=e.stack;this.componentDidCatch(e.value,{componentStack:o!==null?o:""})}),n}function nm(t,e,n){var i=t.pingCache;if(i===null){i=t.pingCache=new Dx;var r=new Set;i.set(e,r)}else r=i.get(e),r===void 0&&(r=new Set,i.set(e,r));r.has(n)||(r.add(n),t=Zx.bind(null,t,e,n),e.then(t,t))}function im(t){do{var e;if((e=t.tag===13)&&(e=t.memoizedState,e=e!==null?e.dehydrated!==null:!0),e)return t;t=t.return}while(t!==null);return null}function rm(t,e,n,i,r){return t.mode&1?(t.flags|=65536,t.lanes=r,t):(t===e?t.flags|=65536:(t.flags|=128,n.flags|=131072,n.flags&=-52805,n.tag===1&&(n.alternate===null?n.tag=17:(e=Tn(-1,1),e.tag=2,Gn(n,e,1))),n.lanes|=1),t)}var Bx=Pn.ReactCurrentOwner,st=!1;function Ze(t,e,n,i){e.child=t===null?BT(e,null,n,i):Qr(e,t.child,n,i)}function sm(t,e,n,i,r){n=n.render;var s=e.ref;return jr(e,r),i=Kp(t,e,n,i,s,r),n=qp(),t!==null&&!st?(e.updateQueue=t.updateQueue,e.flags&=-2053,t.lanes&=~r,xn(t,e,r)):(fe&&n&&Dp(e),e.flags|=1,Ze(t,e,i,r),e.child)}function om(t,e,n,i,r){if(t===null){var s=n.type;return typeof s=="function"&&!sg(s)&&s.defaultProps===void 0&&n.compare===null&&n.defaultProps===void 0?(e.tag=15,e.type=s,o1(t,e,s,i,r)):(t=Pl(n.type,null,i,e,e.mode,r),t.ref=e.ref,t.return=e,e.child=t)}if(s=t.child,!(t.lanes&r)){var o=s.memoizedProps;if(n=n.compare,n=n!==null?n:bo,n(o,i)&&t.ref===e.ref)return xn(t,e,r)}return e.flags|=1,t=ni(s,i),t.ref=e.ref,t.return=e,e.child=t}function o1(t,e,n,i,r){if(t!==null){var s=t.memoizedProps;if(bo(s,i)&&t.ref===e.ref)if(st=!1,e.pendingProps=i=s,(t.lanes&r)!==0)t.flags&131072&&(st=!0);else return e.lanes=t.lanes,xn(t,e,r)}return Qf(t,e,n,i,r)}function a1(t,e,n){var i=e.pendingProps,r=i.children,s=t!==null?t.memoizedState:null;if(i.mode==="hidden")if(!(e.mode&1))e.memoizedState={baseLanes:0,cachePool:null,transitions:null},ae(Rr,ut),ut|=n;else{if(!(n&1073741824))return t=s!==null?s.baseLanes|n:n,e.lanes=e.childLanes=1073741824,e.memoizedState={baseLanes:t,cachePool:null,transitions:null},e.updateQueue=null,ae(Rr,ut),ut|=t,null;e.memoizedState={baseLanes:0,cachePool:null,transitions:null},i=s!==null?s.baseLanes:n,ae(Rr,ut),ut|=i}else s!==null?(i=s.baseLanes|n,e.memoizedState=null):i=n,ae(Rr,ut),ut|=i;return Ze(t,e,r,n),e.child}function l1(t,e){var n=e.ref;(t===null&&n!==null||t!==null&&t.ref!==n)&&(e.flags|=512,e.flags|=2097152)}function Qf(t,e,n,i,r){var s=at(n)?Di:Ye.current;return s=qr(e,s),jr(e,r),n=Kp(t,e,n,i,s,r),i=qp(),t!==null&&!st?(e.updateQueue=t.updateQueue,e.flags&=-2053,t.lanes&=~r,xn(t,e,r)):(fe&&i&&Dp(e),e.flags|=1,Ze(t,e,n,r),e.child)}function am(t,e,n,i,r){if(at(n)){var s=!0;ql(e)}else s=!1;if(jr(e,r),e.stateNode===null)Rl(t,e),FT(e,n,i),qf(e,n,i,r),i=!0;else if(t===null){var o=e.stateNode,a=e.memoizedProps;o.props=a;var l=o.context,c=n.contextType;typeof c=="object"&&c!==null?c=xt(c):(c=at(n)?Di:Ye.current,c=qr(e,c));var u=n.getDerivedStateFromProps,h=typeof u=="function"||typeof o.getSnapshotBeforeUpdate=="function";h||typeof o.UNSAFE_componentWillReceiveProps!="function"&&typeof o.componentWillReceiveProps!="function"||(a!==i||l!==c)&&J_(e,o,i,c),Un=!1;var f=e.memoizedState;o.state=f,ec(e,i,o,r),l=e.memoizedState,a!==i||f!==l||ot.current||Un?(typeof u=="function"&&(Kf(e,n,u,i),l=e.memoizedState),(a=Un||Q_(e,n,a,i,f,l,c))?(h||typeof o.UNSAFE_componentWillMount!="function"&&typeof o.componentWillMount!="function"||(typeof o.componentWillMount=="function"&&o.componentWillMount(),typeof o.UNSAFE_componentWillMount=="function"&&o.UNSAFE_componentWillMount()),typeof o.componentDidMount=="function"&&(e.flags|=4194308)):(typeof o.componentDidMount=="function"&&(e.flags|=4194308),e.memoizedProps=i,e.memoizedState=l),o.props=i,o.state=l,o.context=c,i=a):(typeof o.componentDidMount=="function"&&(e.flags|=4194308),i=!1)}else{o=e.stateNode,NT(t,e),a=e.memoizedProps,c=e.type===e.elementType?a:Mt(e.type,a),o.props=c,h=e.pendingProps,f=o.context,l=n.contextType,typeof l=="object"&&l!==null?l=xt(l):(l=at(n)?Di:Ye.current,l=qr(e,l));var d=n.getDerivedStateFromProps;(u=typeof d=="function"||typeof o.getSnapshotBeforeUpdate=="function")||typeof o.UNSAFE_componentWillReceiveProps!="function"&&typeof o.componentWillReceiveProps!="function"||(a!==h||f!==l)&&J_(e,o,i,l),Un=!1,f=e.memoizedState,o.state=f,ec(e,i,o,r);var p=e.memoizedState;a!==h||f!==p||ot.current||Un?(typeof d=="function"&&(Kf(e,n,d,i),p=e.memoizedState),(c=Un||Q_(e,n,c,i,f,p,l)||!1)?(u||typeof o.UNSAFE_componentWillUpdate!="function"&&typeof o.componentWillUpdate!="function"||(typeof o.componentWillUpdate=="function"&&o.componentWillUpdate(i,p,l),typeof o.UNSAFE_componentWillUpdate=="function"&&o.UNSAFE_componentWillUpdate(i,p,l)),typeof o.componentDidUpdate=="function"&&(e.flags|=4),typeof o.getSnapshotBeforeUpdate=="function"&&(e.flags|=1024)):(typeof o.componentDidUpdate!="function"||a===t.memoizedProps&&f===t.memoizedState||(e.flags|=4),typeof o.getSnapshotBeforeUpdate!="function"||a===t.memoizedProps&&f===t.memoizedState||(e.flags|=1024),e.memoizedProps=i,e.memoizedState=p),o.props=i,o.state=p,o.context=l,i=c):(typeof o.componentDidUpdate!="function"||a===t.memoizedProps&&f===t.memoizedState||(e.flags|=4),typeof o.getSnapshotBeforeUpdate!="function"||a===t.memoizedProps&&f===t.memoizedState||(e.flags|=1024),i=!1)}return Jf(t,e,n,i,s,r)}function Jf(t,e,n,i,r,s){l1(t,e);var o=(e.flags&128)!==0;if(!i&&!o)return r&&X_(e,n,!1),xn(t,e,s);i=e.stateNode,Bx.current=e;var a=o&&typeof n.getDerivedStateFromError!="function"?null:i.render();return e.flags|=1,t!==null&&o?(e.child=Qr(e,t.child,null,s),e.child=Qr(e,null,a,s)):Ze(t,e,a,s),e.memoizedState=i.state,r&&X_(e,n,!0),e.child}function c1(t){var e=t.stateNode;e.pendingContext?$_(t,e.pendingContext,e.pendingContext!==e.context):e.context&&$_(t,e.context,!1),Hp(t,e.containerInfo)}function lm(t,e,n,i,r){return Zr(),Up(r),e.flags|=256,Ze(t,e,n,i),e.child}var Gf={dehydrated:null,treeContext:null,retryLane:0};function ed(t){return{baseLanes:t,cachePool:null,transitions:null}}function u1(t,e,n){var i=e.pendingProps,r=ge.current,s=!1,o=(e.flags&128)!==0,a;if((a=o)||(a=t!==null&&t.memoizedState===null?!1:(r&2)!==0),a?(s=!0,e.flags&=-129):(t===null||t.memoizedState!==null)&&(r|=1),ae(ge,r&1),t===null)return Xf(e),t=e.memoizedState,t!==null&&(t=t.dehydrated,t!==null)?(e.mode&1?t.data==="$!"?e.lanes=8:e.lanes=1073741824:e.lanes=1,null):(o=i.children,t=i.fallback,s?(i=e.mode,s=e.child,o={mode:"hidden",children:o},!(i&1)&&s!==null?(s.childLanes=0,s.pendingProps=o):s=Eu(o,i,0,null),t=Mi(t,i,n,null),s.return=e,t.return=e,s.sibling=t,e.child=s,e.child.memoizedState=ed(n),e.memoizedState=Gf,t):Jp(e,o));if(r=t.memoizedState,r!==null&&(a=r.dehydrated,a!==null))return Ux(t,e,o,i,a,r,n);if(s){s=i.fallback,o=e.mode,r=t.child,a=r.sibling;var l={mode:"hidden",children:i.children};return!(o&1)&&e.child!==r?(i=e.child,i.childLanes=0,i.pendingProps=l,e.deletions=null):(i=ni(r,l),i.subtreeFlags=r.subtreeFlags&14680064),a!==null?s=ni(a,s):(s=Mi(s,o,n,null),s.flags|=2),s.return=e,i.return=e,i.sibling=s,e.child=i,i=s,s=e.child,o=t.child.memoizedState,o=o===null?ed(n):{baseLanes:o.baseLanes|n,cachePool:null,transitions:o.transitions},s.memoizedState=o,s.childLanes=t.childLanes&~n,e.memoizedState=Gf,i}return s=t.child,t=s.sibling,i=ni(s,{mode:"visible",children:i.children}),!(e.mode&1)&&(i.lanes=n),i.return=e,i.sibling=null,t!==null&&(n=e.deletions,n===null?(e.deletions=[t],e.flags|=16):n.push(t)),e.child=i,e.memoizedState=null,i}function Jp(t,e){return e=Eu({mode:"visible",children:e},t.mode,0,null),e.return=t,t.child=e}function Fa(t,e,n,i){return i!==null&&Up(i),Qr(e,t.child,null,n),t=Jp(e,e.pendingProps.children),t.flags|=2,e.memoizedState=null,t}function Ux(t,e,n,i,r,s,o){if(n)return e.flags&256?(e.flags&=-257,i=wh(Error(B(422))),Fa(t,e,o,i)):e.memoizedState!==null?(e.child=t.child,e.flags|=128,null):(s=i.fallback,r=e.mode,i=Eu({mode:"visible",children:i.children},r,0,null),s=Mi(s,r,o,null),s.flags|=2,i.return=e,s.return=e,i.sibling=s,e.child=i,e.mode&1&&Qr(e,t.child,null,o),e.child.memoizedState=ed(o),e.memoizedState=Gf,s);if(!(e.mode&1))return Fa(t,e,o,null);if(r.data==="$!"){if(i=r.nextSibling&&r.nextSibling.dataset,i)var a=i.dgst;return i=a,s=Error(B(419)),i=wh(s,i,void 0),Fa(t,e,o,i)}if(a=(o&t.childLanes)!==0,st||a){if(i=Ne,i!==null){switch(o&-o){case 4:r=2;break;case 16:r=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:r=32;break;case 536870912:r=268435456;break;default:r=0}r=r&(i.suspendedLanes|o)?0:r,r!==0&&r!==s.retryLane&&(s.retryLane=r,An(t,r),Ut(i,t,r,-1))}return rg(),i=wh(Error(B(421))),Fa(t,e,o,i)}return r.data==="$?"?(e.flags|=128,e.child=t.child,e=Qx.bind(null,t),r._reactRetry=e,null):(t=s.treeContext,ht=Jn(r.nextSibling),ft=e,fe=!0,Ot=null,t!==null&&(vt[Tt++]=_n,vt[Tt++]=mn,vt[Tt++]=Bi,_n=t.id,mn=t.overflow,Bi=e),e=Jp(e,i.children),e.flags|=4096,e)}function cm(t,e,n){t.lanes|=e;var i=t.alternate;i!==null&&(i.lanes|=e),Yf(t.return,e,n)}function Eh(t,e,n,i,r){var s=t.memoizedState;s===null?t.memoizedState={isBackwards:e,rendering:null,renderingStartTime:0,last:i,tail:n,tailMode:r}:(s.isBackwards=e,s.rendering=null,s.renderingStartTime=0,s.last=i,s.tail=n,s.tailMode=r)}function h1(t,e,n){var i=e.pendingProps,r=i.revealOrder,s=i.tail;if(Ze(t,e,i.children,n),i=ge.current,i&2)i=i&1|2,e.flags|=128;else{if(t!==null&&t.flags&128)e:for(t=e.child;t!==null;){if(t.tag===13)t.memoizedState!==null&&cm(t,n,e);else if(t.tag===19)cm(t,n,e);else if(t.child!==null){t.child.return=t,t=t.child;continue}if(t===e)break e;for(;t.sibling===null;){if(t.return===null||t.return===e)break e;t=t.return}t.sibling.return=t.return,t=t.sibling}i&=1}if(ae(ge,i),!(e.mode&1))e.memoizedState=null;else switch(r){case"forwards":for(n=e.child,r=null;n!==null;)t=n.alternate,t!==null&&tc(t)===null&&(r=n),n=n.sibling;n=r,n===null?(r=e.child,e.child=null):(r=n.sibling,n.sibling=null),Eh(e,!1,r,n,s);break;case"backwards":for(n=null,r=e.child,e.child=null;r!==null;){if(t=r.alternate,t!==null&&tc(t)===null){e.child=r;break}t=r.sibling,r.sibling=n,n=r,r=t}Eh(e,!0,n,null,s);break;case"together":Eh(e,!1,null,null,void 0);break;default:e.memoizedState=null}return e.child}function Rl(t,e){!(e.mode&1)&&t!==null&&(t.alternate=null,e.alternate=null,e.flags|=2)}function xn(t,e,n){if(t!==null&&(e.dependencies=t.dependencies),Li|=e.lanes,!(n&e.childLanes))return null;if(t!==null&&e.child!==t.child)throw Error(B(153));if(e.child!==null){for(t=e.child,n=ni(t,t.pendingProps),e.child=n,n.return=e;t.sibling!==null;)t=t.sibling,n=n.sibling=ni(t,t.pendingProps),n.return=e;n.sibling=null}return e.child}function Lx(t,e,n){switch(e.tag){case 3:c1(e),Zr();break;case 5:UT(e);break;case 1:at(e.type)&&ql(e);break;case 4:Hp(e,e.stateNode.containerInfo);break;case 10:var i=e.type._context,r=e.memoizedProps.value;ae(Jl,i._currentValue),i._currentValue=r;break;case 13:if(i=e.memoizedState,i!==null)return i.dehydrated!==null?(ae(ge,ge.current&1),e.flags|=128,null):n&e.child.childLanes?u1(t,e,n):(ae(ge,ge.current&1),t=xn(t,e,n),t!==null?t.sibling:null);ae(ge,ge.current&1);break;case 19:if(i=(n&e.childLanes)!==0,t.flags&128){if(i)return h1(t,e,n);e.flags|=128}if(r=e.memoizedState,r!==null&&(r.rendering=null,r.tail=null,r.lastEffect=null),ae(ge,ge.current),i)break;return null;case 22:case 23:return e.lanes=0,a1(t,e,n)}return xn(t,e,n)}var f1,td,d1,p1;f1=function(t,e){for(var n=e.child;n!==null;){if(n.tag===5||n.tag===6)t.appendChild(n.stateNode);else if(n.tag!==4&&n.child!==null){n.child.return=n,n=n.child;continue}if(n===e)break;for(;n.sibling===null;){if(n.return===null||n.return===e)return;n=n.return}n.sibling.return=n.return,n=n.sibling}};td=function(){};d1=function(t,e,n,i){var r=t.memoizedProps;if(r!==i){t=e.stateNode,xi(rn.current);var s=null;switch(n){case"input":r=Sf(t,r),i=Sf(t,i),s=[];break;case"select":r=ve({},r,{value:void 0}),i=ve({},i,{value:void 0}),s=[];break;case"textarea":r=Rf(t,r),i=Rf(t,i),s=[];break;default:typeof r.onClick!="function"&&typeof i.onClick=="function"&&(t.onclick=Yl)}Cf(n,i);var o;n=null;for(c in r)if(!i.hasOwnProperty(c)&&r.hasOwnProperty(c)&&r[c]!=null)if(c==="style"){var a=r[c];for(o in a)a.hasOwnProperty(o)&&(n||(n={}),n[o]="")}else c!=="dangerouslySetInnerHTML"&&c!=="children"&&c!=="suppressContentEditableWarning"&&c!=="suppressHydrationWarning"&&c!=="autoFocus"&&(To.hasOwnProperty(c)?s||(s=[]):(s=s||[]).push(c,null));for(c in i){var l=i[c];if(a=r!=null?r[c]:void 0,i.hasOwnProperty(c)&&l!==a&&(l!=null||a!=null))if(c==="style")if(a){for(o in a)!a.hasOwnProperty(o)||l&&l.hasOwnProperty(o)||(n||(n={}),n[o]="");for(o in l)l.hasOwnProperty(o)&&a[o]!==l[o]&&(n||(n={}),n[o]=l[o])}else n||(s||(s=[]),s.push(c,n)),n=l;else c==="dangerouslySetInnerHTML"?(l=l?l.__html:void 0,a=a?a.__html:void 0,l!=null&&a!==l&&(s=s||[]).push(c,l)):c==="children"?typeof l!="string"&&typeof l!="number"||(s=s||[]).push(c,""+l):c!=="suppressContentEditableWarning"&&c!=="suppressHydrationWarning"&&(To.hasOwnProperty(c)?(l!=null&&c==="onScroll"&&ce("scroll",t),s||a===l||(s=[])):(s=s||[]).push(c,l))}n&&(s=s||[]).push("style",n);var c=s;(e.updateQueue=c)&&(e.flags|=4)}};p1=function(t,e,n,i){n!==i&&(e.flags|=4)};function Is(t,e){if(!fe)switch(t.tailMode){case"hidden":e=t.tail;for(var n=null;e!==null;)e.alternate!==null&&(n=e),e=e.sibling;n===null?t.tail=null:n.sibling=null;break;case"collapsed":n=t.tail;for(var i=null;n!==null;)n.alternate!==null&&(i=n),n=n.sibling;i===null?e||t.tail===null?t.tail=null:t.tail.sibling=null:i.sibling=null}}function je(t){var e=t.alternate!==null&&t.alternate.child===t.child,n=0,i=0;if(e)for(var r=t.child;r!==null;)n|=r.lanes|r.childLanes,i|=r.subtreeFlags&14680064,i|=r.flags&14680064,r.return=t,r=r.sibling;else for(r=t.child;r!==null;)n|=r.lanes|r.childLanes,i|=r.subtreeFlags,i|=r.flags,r.return=t,r=r.sibling;return t.subtreeFlags|=i,t.childLanes=n,e}function zx(t,e,n){var i=e.pendingProps;switch(Bp(e),e.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return je(e),null;case 1:return at(e.type)&&Kl(),je(e),null;case 3:return i=e.stateNode,Jr(),ue(ot),ue(Ye),Xp(),i.pendingContext&&(i.context=i.pendingContext,i.pendingContext=null),(t===null||t.child===null)&&(Na(e)?e.flags|=4:t===null||t.memoizedState.isDehydrated&&!(e.flags&256)||(e.flags|=1024,Ot!==null&&(cd(Ot),Ot=null))),td(t,e),je(e),null;case 5:$p(e);var r=xi(Oo.current);if(n=e.type,t!==null&&e.stateNode!=null)d1(t,e,n,i,r),t.ref!==e.ref&&(e.flags|=512,e.flags|=2097152);else{if(!i){if(e.stateNode===null)throw Error(B(166));return je(e),null}if(t=xi(rn.current),Na(e)){i=e.stateNode,n=e.type;var s=e.memoizedProps;switch(i[Gt]=e,i[Mo]=s,t=(e.mode&1)!==0,n){case"dialog":ce("cancel",i),ce("close",i);break;case"iframe":case"object":case"embed":ce("load",i);break;case"video":case"audio":for(r=0;r<Xs.length;r++)ce(Xs[r],i);break;case"source":ce("error",i);break;case"img":case"image":case"link":ce("error",i),ce("load",i);break;case"details":ce("toggle",i);break;case"input":y_(i,s),ce("invalid",i);break;case"select":i._wrapperState={wasMultiple:!!s.multiple},ce("invalid",i);break;case"textarea":T_(i,s),ce("invalid",i)}Cf(n,s),r=null;for(var o in s)if(s.hasOwnProperty(o)){var a=s[o];o==="children"?typeof a=="string"?i.textContent!==a&&(s.suppressHydrationWarning!==!0&&Oa(i.textContent,a,t),r=["children",a]):typeof a=="number"&&i.textContent!==""+a&&(s.suppressHydrationWarning!==!0&&Oa(i.textContent,a,t),r=["children",""+a]):To.hasOwnProperty(o)&&a!=null&&o==="onScroll"&&ce("scroll",i)}switch(n){case"input":Aa(i),v_(i,s,!0);break;case"textarea":Aa(i),w_(i);break;case"select":case"option":break;default:typeof s.onClick=="function"&&(i.onclick=Yl)}i=r,e.updateQueue=i,i!==null&&(e.flags|=4)}else{o=r.nodeType===9?r:r.ownerDocument,t==="http://www.w3.org/1999/xhtml"&&(t=Vv(n)),t==="http://www.w3.org/1999/xhtml"?n==="script"?(t=o.createElement("div"),t.innerHTML="<script><\/script>",t=t.removeChild(t.firstChild)):typeof i.is=="string"?t=o.createElement(n,{is:i.is}):(t=o.createElement(n),n==="select"&&(o=t,i.multiple?o.multiple=!0:i.size&&(o.size=i.size))):t=o.createElementNS(t,n),t[Gt]=e,t[Mo]=i,f1(t,e,!1,!1),e.stateNode=t;e:{switch(o=Pf(n,i),n){case"dialog":ce("cancel",t),ce("close",t),r=i;break;case"iframe":case"object":case"embed":ce("load",t),r=i;break;case"video":case"audio":for(r=0;r<Xs.length;r++)ce(Xs[r],t);r=i;break;case"source":ce("error",t),r=i;break;case"img":case"image":case"link":ce("error",t),ce("load",t),r=i;break;case"details":ce("toggle",t),r=i;break;case"input":y_(t,i),r=Sf(t,i),ce("invalid",t);break;case"option":r=i;break;case"select":t._wrapperState={wasMultiple:!!i.multiple},r=ve({},i,{value:void 0}),ce("invalid",t);break;case"textarea":T_(t,i),r=Rf(t,i),ce("invalid",t);break;default:r=i}Cf(n,r),a=r;for(s in a)if(a.hasOwnProperty(s)){var l=a[s];s==="style"?Hv(t,l):s==="dangerouslySetInnerHTML"?(l=l?l.__html:void 0,l!=null&&jv(t,l)):s==="children"?typeof l=="string"?(n!=="textarea"||l!=="")&&wo(t,l):typeof l=="number"&&wo(t,""+l):s!=="suppressContentEditableWarning"&&s!=="suppressHydrationWarning"&&s!=="autoFocus"&&(To.hasOwnProperty(s)?l!=null&&s==="onScroll"&&ce("scroll",t):l!=null&&Ep(t,s,l,o))}switch(n){case"input":Aa(t),v_(t,i,!1);break;case"textarea":Aa(t),w_(t);break;case"option":i.value!=null&&t.setAttribute("value",""+si(i.value));break;case"select":t.multiple=!!i.multiple,s=i.value,s!=null?Ur(t,!!i.multiple,s,!1):i.defaultValue!=null&&Ur(t,!!i.multiple,i.defaultValue,!0);break;default:typeof r.onClick=="function"&&(t.onclick=Yl)}switch(n){case"button":case"input":case"select":case"textarea":i=!!i.autoFocus;break e;case"img":i=!0;break e;default:i=!1}}i&&(e.flags|=4)}e.ref!==null&&(e.flags|=512,e.flags|=2097152)}return je(e),null;case 6:if(t&&e.stateNode!=null)p1(t,e,t.memoizedProps,i);else{if(typeof i!="string"&&e.stateNode===null)throw Error(B(166));if(n=xi(Oo.current),xi(rn.current),Na(e)){if(i=e.stateNode,n=e.memoizedProps,i[Gt]=e,(s=i.nodeValue!==n)&&(t=ft,t!==null))switch(t.tag){case 3:Oa(i.nodeValue,n,(t.mode&1)!==0);break;case 5:t.memoizedProps.suppressHydrationWarning!==!0&&Oa(i.nodeValue,n,(t.mode&1)!==0)}s&&(e.flags|=4)}else i=(n.nodeType===9?n:n.ownerDocument).createTextNode(i),i[Gt]=e,e.stateNode=i}return je(e),null;case 13:if(ue(ge),i=e.memoizedState,t===null||t.memoizedState!==null&&t.memoizedState.dehydrated!==null){if(fe&&ht!==null&&e.mode&1&&!(e.flags&128))IT(),Zr(),e.flags|=98560,s=!1;else if(s=Na(e),i!==null&&i.dehydrated!==null){if(t===null){if(!s)throw Error(B(318));if(s=e.memoizedState,s=s!==null?s.dehydrated:null,!s)throw Error(B(317));s[Gt]=e}else Zr(),!(e.flags&128)&&(e.memoizedState=null),e.flags|=4;je(e),s=!1}else Ot!==null&&(cd(Ot),Ot=null),s=!0;if(!s)return e.flags&65536?e:null}return e.flags&128?(e.lanes=n,e):(i=i!==null,i!==(t!==null&&t.memoizedState!==null)&&i&&(e.child.flags|=8192,e.mode&1&&(t===null||ge.current&1?Pe===0&&(Pe=3):rg())),e.updateQueue!==null&&(e.flags|=4),je(e),null);case 4:return Jr(),td(t,e),t===null&&Co(e.stateNode.containerInfo),je(e),null;case 10:return Vp(e.type._context),je(e),null;case 17:return at(e.type)&&Kl(),je(e),null;case 19:if(ue(ge),s=e.memoizedState,s===null)return je(e),null;if(i=(e.flags&128)!==0,o=s.rendering,o===null)if(i)Is(s,!1);else{if(Pe!==0||t!==null&&t.flags&128)for(t=e.child;t!==null;){if(o=tc(t),o!==null){for(e.flags|=128,Is(s,!1),i=o.updateQueue,i!==null&&(e.updateQueue=i,e.flags|=4),e.subtreeFlags=0,i=n,n=e.child;n!==null;)s=n,t=i,s.flags&=14680066,o=s.alternate,o===null?(s.childLanes=0,s.lanes=t,s.child=null,s.subtreeFlags=0,s.memoizedProps=null,s.memoizedState=null,s.updateQueue=null,s.dependencies=null,s.stateNode=null):(s.childLanes=o.childLanes,s.lanes=o.lanes,s.child=o.child,s.subtreeFlags=0,s.deletions=null,s.memoizedProps=o.memoizedProps,s.memoizedState=o.memoizedState,s.updateQueue=o.updateQueue,s.type=o.type,t=o.dependencies,s.dependencies=t===null?null:{lanes:t.lanes,firstContext:t.firstContext}),n=n.sibling;return ae(ge,ge.current&1|2),e.child}t=t.sibling}s.tail!==null&&Se()>es&&(e.flags|=128,i=!0,Is(s,!1),e.lanes=4194304)}else{if(!i)if(t=tc(o),t!==null){if(e.flags|=128,i=!0,n=t.updateQueue,n!==null&&(e.updateQueue=n,e.flags|=4),Is(s,!0),s.tail===null&&s.tailMode==="hidden"&&!o.alternate&&!fe)return je(e),null}else 2*Se()-s.renderingStartTime>es&&n!==1073741824&&(e.flags|=128,i=!0,Is(s,!1),e.lanes=4194304);s.isBackwards?(o.sibling=e.child,e.child=o):(n=s.last,n!==null?n.sibling=o:e.child=o,s.last=o)}return s.tail!==null?(e=s.tail,s.rendering=e,s.tail=e.sibling,s.renderingStartTime=Se(),e.sibling=null,n=ge.current,ae(ge,i?n&1|2:n&1),e):(je(e),null);case 22:case 23:return ig(),i=e.memoizedState!==null,t!==null&&t.memoizedState!==null!==i&&(e.flags|=8192),i&&e.mode&1?ut&1073741824&&(je(e),e.subtreeFlags&6&&(e.flags|=8192)):je(e),null;case 24:return null;case 25:return null}throw Error(B(156,e.tag))}function Vx(t,e){switch(Bp(e),e.tag){case 1:return at(e.type)&&Kl(),t=e.flags,t&65536?(e.flags=t&-65537|128,e):null;case 3:return Jr(),ue(ot),ue(Ye),Xp(),t=e.flags,t&65536&&!(t&128)?(e.flags=t&-65537|128,e):null;case 5:return $p(e),null;case 13:if(ue(ge),t=e.memoizedState,t!==null&&t.dehydrated!==null){if(e.alternate===null)throw Error(B(340));Zr()}return t=e.flags,t&65536?(e.flags=t&-65537|128,e):null;case 19:return ue(ge),null;case 4:return Jr(),null;case 10:return Vp(e.type._context),null;case 22:case 23:return ig(),null;case 24:return null;default:return null}}var Da=!1,Xe=!1,jx=typeof WeakSet=="function"?WeakSet:Set,W=null;function xr(t,e){var n=t.ref;if(n!==null)if(typeof n=="function")try{n(null)}catch(i){we(t,e,i)}else n.current=null}function nd(t,e,n){try{n()}catch(i){we(t,e,i)}}var um=!1;function Wx(t,e){if(Lf=Hl,t=yT(),Fp(t)){if("selectionStart"in t)var n={start:t.selectionStart,end:t.selectionEnd};else e:{n=(n=t.ownerDocument)&&n.defaultView||window;var i=n.getSelection&&n.getSelection();if(i&&i.rangeCount!==0){n=i.anchorNode;var r=i.anchorOffset,s=i.focusNode;i=i.focusOffset;try{n.nodeType,s.nodeType}catch{n=null;break e}var o=0,a=-1,l=-1,c=0,u=0,h=t,f=null;t:for(;;){for(var d;h!==n||r!==0&&h.nodeType!==3||(a=o+r),h!==s||i!==0&&h.nodeType!==3||(l=o+i),h.nodeType===3&&(o+=h.nodeValue.length),(d=h.firstChild)!==null;)f=h,h=d;for(;;){if(h===t)break t;if(f===n&&++c===r&&(a=o),f===s&&++u===i&&(l=o),(d=h.nextSibling)!==null)break;h=f,f=h.parentNode}h=d}n=a===-1||l===-1?null:{start:a,end:l}}else n=null}n=n||{start:0,end:0}}else n=null;for(zf={focusedElem:t,selectionRange:n},Hl=!1,W=e;W!==null;)if(e=W,t=e.child,(e.subtreeFlags&1028)!==0&&t!==null)t.return=e,W=t;else for(;W!==null;){e=W;try{var p=e.alternate;if(e.flags&1024)switch(e.tag){case 0:case 11:case 15:break;case 1:if(p!==null){var v=p.memoizedProps,A=p.memoizedState,y=e.stateNode,g=y.getSnapshotBeforeUpdate(e.elementType===e.type?v:Mt(e.type,v),A);y.__reactInternalSnapshotBeforeUpdate=g}break;case 3:var _=e.stateNode.containerInfo;_.nodeType===1?_.textContent="":_.nodeType===9&&_.documentElement&&_.removeChild(_.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(B(163))}}catch(E){we(e,e.return,E)}if(t=e.sibling,t!==null){t.return=e.return,W=t;break}W=e.return}return p=um,um=!1,p}function so(t,e,n){var i=e.updateQueue;if(i=i!==null?i.lastEffect:null,i!==null){var r=i=i.next;do{if((r.tag&t)===t){var s=r.destroy;r.destroy=void 0,s!==void 0&&nd(e,n,s)}r=r.next}while(r!==i)}}function Tu(t,e){if(e=e.updateQueue,e=e!==null?e.lastEffect:null,e!==null){var n=e=e.next;do{if((n.tag&t)===t){var i=n.create;n.destroy=i()}n=n.next}while(n!==e)}}function id(t){var e=t.ref;if(e!==null){var n=t.stateNode;switch(t.tag){case 5:t=n;break;default:t=n}typeof e=="function"?e(t):e.current=t}}function g1(t){var e=t.alternate;e!==null&&(t.alternate=null,g1(e)),t.child=null,t.deletions=null,t.sibling=null,t.tag===5&&(e=t.stateNode,e!==null&&(delete e[Gt],delete e[Mo],delete e[Wf],delete e[xx],delete e[Rx])),t.stateNode=null,t.return=null,t.dependencies=null,t.memoizedProps=null,t.memoizedState=null,t.pendingProps=null,t.stateNode=null,t.updateQueue=null}function _1(t){return t.tag===5||t.tag===3||t.tag===4}function hm(t){e:for(;;){for(;t.sibling===null;){if(t.return===null||_1(t.return))return null;t=t.return}for(t.sibling.return=t.return,t=t.sibling;t.tag!==5&&t.tag!==6&&t.tag!==18;){if(t.flags&2||t.child===null||t.tag===4)continue e;t.child.return=t,t=t.child}if(!(t.flags&2))return t.stateNode}}function rd(t,e,n){var i=t.tag;if(i===5||i===6)t=t.stateNode,e?n.nodeType===8?n.parentNode.insertBefore(t,e):n.insertBefore(t,e):(n.nodeType===8?(e=n.parentNode,e.insertBefore(t,n)):(e=n,e.appendChild(t)),n=n._reactRootContainer,n!=null||e.onclick!==null||(e.onclick=Yl));else if(i!==4&&(t=t.child,t!==null))for(rd(t,e,n),t=t.sibling;t!==null;)rd(t,e,n),t=t.sibling}function sd(t,e,n){var i=t.tag;if(i===5||i===6)t=t.stateNode,e?n.insertBefore(t,e):n.appendChild(t);else if(i!==4&&(t=t.child,t!==null))for(sd(t,e,n),t=t.sibling;t!==null;)sd(t,e,n),t=t.sibling}var De=null,It=!1;function In(t,e,n){for(n=n.child;n!==null;)m1(t,e,n),n=n.sibling}function m1(t,e,n){if(nn&&typeof nn.onCommitFiberUnmount=="function")try{nn.onCommitFiberUnmount(fu,n)}catch{}switch(n.tag){case 5:Xe||xr(n,e);case 6:var i=De,r=It;De=null,In(t,e,n),De=i,It=r,De!==null&&(It?(t=De,n=n.stateNode,t.nodeType===8?t.parentNode.removeChild(n):t.removeChild(n)):De.removeChild(n.stateNode));break;case 18:De!==null&&(It?(t=De,n=n.stateNode,t.nodeType===8?gh(t.parentNode,n):t.nodeType===1&&gh(t,n),xo(t)):gh(De,n.stateNode));break;case 4:i=De,r=It,De=n.stateNode.containerInfo,It=!0,In(t,e,n),De=i,It=r;break;case 0:case 11:case 14:case 15:if(!Xe&&(i=n.updateQueue,i!==null&&(i=i.lastEffect,i!==null))){r=i=i.next;do{var s=r,o=s.destroy;s=s.tag,o!==void 0&&(s&2||s&4)&&nd(n,e,o),r=r.next}while(r!==i)}In(t,e,n);break;case 1:if(!Xe&&(xr(n,e),i=n.stateNode,typeof i.componentWillUnmount=="function"))try{i.props=n.memoizedProps,i.state=n.memoizedState,i.componentWillUnmount()}catch(a){we(n,e,a)}In(t,e,n);break;case 21:In(t,e,n);break;case 22:n.mode&1?(Xe=(i=Xe)||n.memoizedState!==null,In(t,e,n),Xe=i):In(t,e,n);break;default:In(t,e,n)}}function fm(t){var e=t.updateQueue;if(e!==null){t.updateQueue=null;var n=t.stateNode;n===null&&(n=t.stateNode=new jx),e.forEach(function(i){var r=Jx.bind(null,t,i);n.has(i)||(n.add(i),i.then(r,r))})}}function Pt(t,e){var n=e.deletions;if(n!==null)for(var i=0;i<n.length;i++){var r=n[i];try{var s=t,o=e,a=o;e:for(;a!==null;){switch(a.tag){case 5:De=a.stateNode,It=!1;break e;case 3:De=a.stateNode.containerInfo,It=!0;break e;case 4:De=a.stateNode.containerInfo,It=!0;break e}a=a.return}if(De===null)throw Error(B(160));m1(s,o,r),De=null,It=!1;var l=r.alternate;l!==null&&(l.return=null),r.return=null}catch(c){we(r,e,c)}}if(e.subtreeFlags&12854)for(e=e.child;e!==null;)y1(e,t),e=e.sibling}function y1(t,e){var n=t.alternate,i=t.flags;switch(t.tag){case 0:case 11:case 14:case 15:if(Pt(e,t),$t(t),i&4){try{so(3,t,t.return),Tu(3,t)}catch(v){we(t,t.return,v)}try{so(5,t,t.return)}catch(v){we(t,t.return,v)}}break;case 1:Pt(e,t),$t(t),i&512&&n!==null&&xr(n,n.return);break;case 5:if(Pt(e,t),$t(t),i&512&&n!==null&&xr(n,n.return),t.flags&32){var r=t.stateNode;try{wo(r,"")}catch(v){we(t,t.return,v)}}if(i&4&&(r=t.stateNode,r!=null)){var s=t.memoizedProps,o=n!==null?n.memoizedProps:s,a=t.type,l=t.updateQueue;if(t.updateQueue=null,l!==null)try{a==="input"&&s.type==="radio"&&s.name!=null&&Lv(r,s),Pf(a,o);var c=Pf(a,s);for(o=0;o<l.length;o+=2){var u=l[o],h=l[o+1];u==="style"?Hv(r,h):u==="dangerouslySetInnerHTML"?jv(r,h):u==="children"?wo(r,h):Ep(r,u,h,c)}switch(a){case"input":Af(r,s);break;case"textarea":zv(r,s);break;case"select":var f=r._wrapperState.wasMultiple;r._wrapperState.wasMultiple=!!s.multiple;var d=s.value;d!=null?Ur(r,!!s.multiple,d,!1):f!==!!s.multiple&&(s.defaultValue!=null?Ur(r,!!s.multiple,s.defaultValue,!0):Ur(r,!!s.multiple,s.multiple?[]:"",!1))}r[Mo]=s}catch(v){we(t,t.return,v)}}break;case 6:if(Pt(e,t),$t(t),i&4){if(t.stateNode===null)throw Error(B(162));r=t.stateNode,s=t.memoizedProps;try{r.nodeValue=s}catch(v){we(t,t.return,v)}}break;case 3:if(Pt(e,t),$t(t),i&4&&n!==null&&n.memoizedState.isDehydrated)try{xo(e.containerInfo)}catch(v){we(t,t.return,v)}break;case 4:Pt(e,t),$t(t);break;case 13:Pt(e,t),$t(t),r=t.child,r.flags&8192&&(s=r.memoizedState!==null,r.stateNode.isHidden=s,!s||r.alternate!==null&&r.alternate.memoizedState!==null||(tg=Se())),i&4&&fm(t);break;case 22:if(u=n!==null&&n.memoizedState!==null,t.mode&1?(Xe=(c=Xe)||u,Pt(e,t),Xe=c):Pt(e,t),$t(t),i&8192){if(c=t.memoizedState!==null,(t.stateNode.isHidden=c)&&!u&&t.mode&1)for(W=t,u=t.child;u!==null;){for(h=W=u;W!==null;){switch(f=W,d=f.child,f.tag){case 0:case 11:case 14:case 15:so(4,f,f.return);break;case 1:xr(f,f.return);var p=f.stateNode;if(typeof p.componentWillUnmount=="function"){i=f,n=f.return;try{e=i,p.props=e.memoizedProps,p.state=e.memoizedState,p.componentWillUnmount()}catch(v){we(i,n,v)}}break;case 5:xr(f,f.return);break;case 22:if(f.memoizedState!==null){pm(h);continue}}d!==null?(d.return=f,W=d):pm(h)}u=u.sibling}e:for(u=null,h=t;;){if(h.tag===5){if(u===null){u=h;try{r=h.stateNode,c?(s=r.style,typeof s.setProperty=="function"?s.setProperty("display","none","important"):s.display="none"):(a=h.stateNode,l=h.memoizedProps.style,o=l!=null&&l.hasOwnProperty("display")?l.display:null,a.style.display=Wv("display",o))}catch(v){we(t,t.return,v)}}}else if(h.tag===6){if(u===null)try{h.stateNode.nodeValue=c?"":h.memoizedProps}catch(v){we(t,t.return,v)}}else if((h.tag!==22&&h.tag!==23||h.memoizedState===null||h===t)&&h.child!==null){h.child.return=h,h=h.child;continue}if(h===t)break e;for(;h.sibling===null;){if(h.return===null||h.return===t)break e;u===h&&(u=null),h=h.return}u===h&&(u=null),h.sibling.return=h.return,h=h.sibling}}break;case 19:Pt(e,t),$t(t),i&4&&fm(t);break;case 21:break;default:Pt(e,t),$t(t)}}function $t(t){var e=t.flags;if(e&2){try{e:{for(var n=t.return;n!==null;){if(_1(n)){var i=n;break e}n=n.return}throw Error(B(160))}switch(i.tag){case 5:var r=i.stateNode;i.flags&32&&(wo(r,""),i.flags&=-33);var s=hm(t);sd(t,s,r);break;case 3:case 4:var o=i.stateNode.containerInfo,a=hm(t);rd(t,a,o);break;default:throw Error(B(161))}}catch(l){we(t,t.return,l)}t.flags&=-3}e&4096&&(t.flags&=-4097)}function Hx(t,e,n){W=t,v1(t)}function v1(t,e,n){for(var i=(t.mode&1)!==0;W!==null;){var r=W,s=r.child;if(r.tag===22&&i){var o=r.memoizedState!==null||Da;if(!o){var a=r.alternate,l=a!==null&&a.memoizedState!==null||Xe;a=Da;var c=Xe;if(Da=o,(Xe=l)&&!c)for(W=r;W!==null;)o=W,l=o.child,o.tag===22&&o.memoizedState!==null?gm(r):l!==null?(l.return=o,W=l):gm(r);for(;s!==null;)W=s,v1(s),s=s.sibling;W=r,Da=a,Xe=c}dm(t)}else r.subtreeFlags&8772&&s!==null?(s.return=r,W=s):dm(t)}}function dm(t){for(;W!==null;){var e=W;if(e.flags&8772){var n=e.alternate;try{if(e.flags&8772)switch(e.tag){case 0:case 11:case 15:Xe||Tu(5,e);break;case 1:var i=e.stateNode;if(e.flags&4&&!Xe)if(n===null)i.componentDidMount();else{var r=e.elementType===e.type?n.memoizedProps:Mt(e.type,n.memoizedProps);i.componentDidUpdate(r,n.memoizedState,i.__reactInternalSnapshotBeforeUpdate)}var s=e.updateQueue;s!==null&&Z_(e,s,i);break;case 3:var o=e.updateQueue;if(o!==null){if(n=null,e.child!==null)switch(e.child.tag){case 5:n=e.child.stateNode;break;case 1:n=e.child.stateNode}Z_(e,o,n)}break;case 5:var a=e.stateNode;if(n===null&&e.flags&4){n=a;var l=e.memoizedProps;switch(e.type){case"button":case"input":case"select":case"textarea":l.autoFocus&&n.focus();break;case"img":l.src&&(n.src=l.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(e.memoizedState===null){var c=e.alternate;if(c!==null){var u=c.memoizedState;if(u!==null){var h=u.dehydrated;h!==null&&xo(h)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(B(163))}Xe||e.flags&512&&id(e)}catch(f){we(e,e.return,f)}}if(e===t){W=null;break}if(n=e.sibling,n!==null){n.return=e.return,W=n;break}W=e.return}}function pm(t){for(;W!==null;){var e=W;if(e===t){W=null;break}var n=e.sibling;if(n!==null){n.return=e.return,W=n;break}W=e.return}}function gm(t){for(;W!==null;){var e=W;try{switch(e.tag){case 0:case 11:case 15:var n=e.return;try{Tu(4,e)}catch(l){we(e,n,l)}break;case 1:var i=e.stateNode;if(typeof i.componentDidMount=="function"){var r=e.return;try{i.componentDidMount()}catch(l){we(e,r,l)}}var s=e.return;try{id(e)}catch(l){we(e,s,l)}break;case 5:var o=e.return;try{id(e)}catch(l){we(e,o,l)}}}catch(l){we(e,e.return,l)}if(e===t){W=null;break}var a=e.sibling;if(a!==null){a.return=e.return,W=a;break}W=e.return}}var $x=Math.ceil,rc=Pn.ReactCurrentDispatcher,Gp=Pn.ReactCurrentOwner,St=Pn.ReactCurrentBatchConfig,G=0,Ne=null,be=null,Le=0,ut=0,Rr=ui(0),Pe=0,Do=null,Li=0,wu=0,eg=0,oo=null,rt=null,tg=0,es=1/0,fn=null,sc=!1,od=null,ei=null,Ba=!1,Hn=null,oc=0,ao=0,ad=null,bl=-1,Cl=0;function Ge(){return G&6?Se():bl!==-1?bl:bl=Se()}function ti(t){return t.mode&1?G&2&&Le!==0?Le&-Le:Cx.transition!==null?(Cl===0&&(Cl=nT()),Cl):(t=ne,t!==0||(t=window.event,t=t===void 0?16:cT(t.type)),t):1}function Ut(t,e,n,i){if(50<ao)throw ao=0,ad=null,Error(B(185));Go(t,n,i),(!(G&2)||t!==Ne)&&(t===Ne&&(!(G&2)&&(wu|=n),Pe===4&&jn(t,Le)),lt(t,i),n===1&&G===0&&!(e.mode&1)&&(es=Se()+500,mu&&hi()))}function lt(t,e){var n=t.callbackNode;CA(t,e);var i=Wl(t,t===Ne?Le:0);if(i===0)n!==null&&A_(n),t.callbackNode=null,t.callbackPriority=0;else if(e=i&-i,t.callbackPriority!==e){if(n!=null&&A_(n),e===1)t.tag===0?bx(_m.bind(null,t)):CT(_m.bind(null,t)),Sx(function(){!(G&6)&&hi()}),n=null;else{switch(iT(i)){case 1:n=bp;break;case 4:n=eT;break;case 16:n=jl;break;case 536870912:n=tT;break;default:n=jl}n=b1(n,T1.bind(null,t))}t.callbackPriority=e,t.callbackNode=n}}function T1(t,e){if(bl=-1,Cl=0,G&6)throw Error(B(327));var n=t.callbackNode;if(Wr()&&t.callbackNode!==n)return null;var i=Wl(t,t===Ne?Le:0);if(i===0)return null;if(i&30||i&t.expiredLanes||e)e=ac(t,i);else{e=i;var r=G;G|=2;var s=E1();(Ne!==t||Le!==e)&&(fn=null,es=Se()+500,Pi(t,e));do try{Kx();break}catch(a){w1(t,a)}while(1);zp(),rc.current=s,G=r,be!==null?e=0:(Ne=null,Le=0,e=Pe)}if(e!==0){if(e===2&&(r=kf(t),r!==0&&(i=r,e=ld(t,r))),e===1)throw n=Do,Pi(t,0),jn(t,i),lt(t,Se()),n;if(e===6)jn(t,i);else{if(r=t.current.alternate,!(i&30)&&!Xx(r)&&(e=ac(t,i),e===2&&(s=kf(t),s!==0&&(i=s,e=ld(t,s))),e===1))throw n=Do,Pi(t,0),jn(t,i),lt(t,Se()),n;switch(t.finishedWork=r,t.finishedLanes=i,e){case 0:case 1:throw Error(B(345));case 2:vi(t,rt,fn);break;case 3:if(jn(t,i),(i&130023424)===i&&(e=tg+500-Se(),10<e)){if(Wl(t,0)!==0)break;if(r=t.suspendedLanes,(r&i)!==i){Ge(),t.pingedLanes|=t.suspendedLanes&r;break}t.timeoutHandle=jf(vi.bind(null,t,rt,fn),e);break}vi(t,rt,fn);break;case 4:if(jn(t,i),(i&4194240)===i)break;for(e=t.eventTimes,r=-1;0<i;){var o=31-Bt(i);s=1<<o,o=e[o],o>r&&(r=o),i&=~s}if(i=r,i=Se()-i,i=(120>i?120:480>i?480:1080>i?1080:1920>i?1920:3e3>i?3e3:4320>i?4320:1960*$x(i/1960))-i,10<i){t.timeoutHandle=jf(vi.bind(null,t,rt,fn),i);break}vi(t,rt,fn);break;case 5:vi(t,rt,fn);break;default:throw Error(B(329))}}}return lt(t,Se()),t.callbackNode===n?T1.bind(null,t):null}function ld(t,e){var n=oo;return t.current.memoizedState.isDehydrated&&(Pi(t,e).flags|=256),t=ac(t,e),t!==2&&(e=rt,rt=n,e!==null&&cd(e)),t}function cd(t){rt===null?rt=t:rt.push.apply(rt,t)}function Xx(t){for(var e=t;;){if(e.flags&16384){var n=e.updateQueue;if(n!==null&&(n=n.stores,n!==null))for(var i=0;i<n.length;i++){var r=n[i],s=r.getSnapshot;r=r.value;try{if(!zt(s(),r))return!1}catch{return!1}}}if(n=e.child,e.subtreeFlags&16384&&n!==null)n.return=e,e=n;else{if(e===t)break;for(;e.sibling===null;){if(e.return===null||e.return===t)return!0;e=e.return}e.sibling.return=e.return,e=e.sibling}}return!0}function jn(t,e){for(e&=~eg,e&=~wu,t.suspendedLanes|=e,t.pingedLanes&=~e,t=t.expirationTimes;0<e;){var n=31-Bt(e),i=1<<n;t[n]=-1,e&=~i}}function _m(t){if(G&6)throw Error(B(327));Wr();var e=Wl(t,0);if(!(e&1))return lt(t,Se()),null;var n=ac(t,e);if(t.tag!==0&&n===2){var i=kf(t);i!==0&&(e=i,n=ld(t,i))}if(n===1)throw n=Do,Pi(t,0),jn(t,e),lt(t,Se()),n;if(n===6)throw Error(B(345));return t.finishedWork=t.current.alternate,t.finishedLanes=e,vi(t,rt,fn),lt(t,Se()),null}function ng(t,e){var n=G;G|=1;try{return t(e)}finally{G=n,G===0&&(es=Se()+500,mu&&hi())}}function zi(t){Hn!==null&&Hn.tag===0&&!(G&6)&&Wr();var e=G;G|=1;var n=St.transition,i=ne;try{if(St.transition=null,ne=1,t)return t()}finally{ne=i,St.transition=n,G=e,!(G&6)&&hi()}}function ig(){ut=Rr.current,ue(Rr)}function Pi(t,e){t.finishedWork=null,t.finishedLanes=0;var n=t.timeoutHandle;if(n!==-1&&(t.timeoutHandle=-1,Ex(n)),be!==null)for(n=be.return;n!==null;){var i=n;switch(Bp(i),i.tag){case 1:i=i.type.childContextTypes,i!=null&&Kl();break;case 3:Jr(),ue(ot),ue(Ye),Xp();break;case 5:$p(i);break;case 4:Jr();break;case 13:ue(ge);break;case 19:ue(ge);break;case 10:Vp(i.type._context);break;case 22:case 23:ig()}n=n.return}if(Ne=t,be=t=ni(t.current,null),Le=ut=e,Pe=0,Do=null,eg=wu=Li=0,rt=oo=null,Ai!==null){for(e=0;e<Ai.length;e++)if(n=Ai[e],i=n.interleaved,i!==null){n.interleaved=null;var r=i.next,s=n.pending;if(s!==null){var o=s.next;s.next=r,i.next=o}n.pending=i}Ai=null}return t}function w1(t,e){do{var n=be;try{if(zp(),Al.current=ic,nc){for(var i=ye.memoizedState;i!==null;){var r=i.queue;r!==null&&(r.pending=null),i=i.next}nc=!1}if(Ui=0,Oe=Ce=ye=null,ro=!1,No=0,Gp.current=null,n===null||n.return===null){Pe=1,Do=e,be=null;break}e:{var s=t,o=n.return,a=n,l=e;if(e=Le,a.flags|=32768,l!==null&&typeof l=="object"&&typeof l.then=="function"){var c=l,u=a,h=u.tag;if(!(u.mode&1)&&(h===0||h===11||h===15)){var f=u.alternate;f?(u.updateQueue=f.updateQueue,u.memoizedState=f.memoizedState,u.lanes=f.lanes):(u.updateQueue=null,u.memoizedState=null)}var d=im(o);if(d!==null){d.flags&=-257,rm(d,o,a,s,e),d.mode&1&&nm(s,c,e),e=d,l=c;var p=e.updateQueue;if(p===null){var v=new Set;v.add(l),e.updateQueue=v}else p.add(l);break e}else{if(!(e&1)){nm(s,c,e),rg();break e}l=Error(B(426))}}else if(fe&&a.mode&1){var A=im(o);if(A!==null){!(A.flags&65536)&&(A.flags|=256),rm(A,o,a,s,e),Up(Gr(l,a));break e}}s=l=Gr(l,a),Pe!==4&&(Pe=2),oo===null?oo=[s]:oo.push(s),s=o;do{switch(s.tag){case 3:s.flags|=65536,e&=-e,s.lanes|=e;var y=r1(s,l,e);q_(s,y);break e;case 1:a=l;var g=s.type,_=s.stateNode;if(!(s.flags&128)&&(typeof g.getDerivedStateFromError=="function"||_!==null&&typeof _.componentDidCatch=="function"&&(ei===null||!ei.has(_)))){s.flags|=65536,e&=-e,s.lanes|=e;var E=s1(s,a,e);q_(s,E);break e}}s=s.return}while(s!==null)}A1(n)}catch(R){e=R,be===n&&n!==null&&(be=n=n.return);continue}break}while(1)}function E1(){var t=rc.current;return rc.current=ic,t===null?ic:t}function rg(){(Pe===0||Pe===3||Pe===2)&&(Pe=4),Ne===null||!(Li&268435455)&&!(wu&268435455)||jn(Ne,Le)}function ac(t,e){var n=G;G|=2;var i=E1();(Ne!==t||Le!==e)&&(fn=null,Pi(t,e));do try{Yx();break}catch(r){w1(t,r)}while(1);if(zp(),G=n,rc.current=i,be!==null)throw Error(B(261));return Ne=null,Le=0,Pe}function Yx(){for(;be!==null;)S1(be)}function Kx(){for(;be!==null&&!vA();)S1(be)}function S1(t){var e=R1(t.alternate,t,ut);t.memoizedProps=t.pendingProps,e===null?A1(t):be=e,Gp.current=null}function A1(t){var e=t;do{var n=e.alternate;if(t=e.return,e.flags&32768){if(n=Vx(n,e),n!==null){n.flags&=32767,be=n;return}if(t!==null)t.flags|=32768,t.subtreeFlags=0,t.deletions=null;else{Pe=6,be=null;return}}else if(n=zx(n,e,ut),n!==null){be=n;return}if(e=e.sibling,e!==null){be=e;return}be=e=t}while(e!==null);Pe===0&&(Pe=5)}function vi(t,e,n){var i=ne,r=St.transition;try{St.transition=null,ne=1,qx(t,e,n,i)}finally{St.transition=r,ne=i}return null}function qx(t,e,n,i){do Wr();while(Hn!==null);if(G&6)throw Error(B(327));n=t.finishedWork;var r=t.finishedLanes;if(n===null)return null;if(t.finishedWork=null,t.finishedLanes=0,n===t.current)throw Error(B(177));t.callbackNode=null,t.callbackPriority=0;var s=n.lanes|n.childLanes;if(PA(t,s),t===Ne&&(be=Ne=null,Le=0),!(n.subtreeFlags&2064)&&!(n.flags&2064)||Ba||(Ba=!0,b1(jl,function(){return Wr(),null})),s=(n.flags&15990)!==0,n.subtreeFlags&15990||s){s=St.transition,St.transition=null;var o=ne;ne=1;var a=G;G|=4,Gp.current=null,Wx(t,n),y1(n,t),gx(zf),Hl=!!Lf,zf=Lf=null,t.current=n,Hx(n),TA(),G=a,ne=o,St.transition=s}else t.current=n;if(Ba&&(Ba=!1,Hn=t,oc=r),s=t.pendingLanes,s===0&&(ei=null),SA(n.stateNode),lt(t,Se()),e!==null)for(i=t.onRecoverableError,n=0;n<e.length;n++)r=e[n],i(r.value,{componentStack:r.stack,digest:r.digest});if(sc)throw sc=!1,t=od,od=null,t;return oc&1&&t.tag!==0&&Wr(),s=t.pendingLanes,s&1?t===ad?ao++:(ao=0,ad=t):ao=0,hi(),null}function Wr(){if(Hn!==null){var t=iT(oc),e=St.transition,n=ne;try{if(St.transition=null,ne=16>t?16:t,Hn===null)var i=!1;else{if(t=Hn,Hn=null,oc=0,G&6)throw Error(B(331));var r=G;for(G|=4,W=t.current;W!==null;){var s=W,o=s.child;if(W.flags&16){var a=s.deletions;if(a!==null){for(var l=0;l<a.length;l++){var c=a[l];for(W=c;W!==null;){var u=W;switch(u.tag){case 0:case 11:case 15:so(8,u,s)}var h=u.child;if(h!==null)h.return=u,W=h;else for(;W!==null;){u=W;var f=u.sibling,d=u.return;if(g1(u),u===c){W=null;break}if(f!==null){f.return=d,W=f;break}W=d}}}var p=s.alternate;if(p!==null){var v=p.child;if(v!==null){p.child=null;do{var A=v.sibling;v.sibling=null,v=A}while(v!==null)}}W=s}}if(s.subtreeFlags&2064&&o!==null)o.return=s,W=o;else e:for(;W!==null;){if(s=W,s.flags&2048)switch(s.tag){case 0:case 11:case 15:so(9,s,s.return)}var y=s.sibling;if(y!==null){y.return=s.return,W=y;break e}W=s.return}}var g=t.current;for(W=g;W!==null;){o=W;var _=o.child;if(o.subtreeFlags&2064&&_!==null)_.return=o,W=_;else e:for(o=g;W!==null;){if(a=W,a.flags&2048)try{switch(a.tag){case 0:case 11:case 15:Tu(9,a)}}catch(R){we(a,a.return,R)}if(a===o){W=null;break e}var E=a.sibling;if(E!==null){E.return=a.return,W=E;break e}W=a.return}}if(G=r,hi(),nn&&typeof nn.onPostCommitFiberRoot=="function")try{nn.onPostCommitFiberRoot(fu,t)}catch{}i=!0}return i}finally{ne=n,St.transition=e}}return!1}function mm(t,e,n){e=Gr(n,e),e=r1(t,e,1),t=Gn(t,e,1),e=Ge(),t!==null&&(Go(t,1,e),lt(t,e))}function we(t,e,n){if(t.tag===3)mm(t,t,n);else for(;e!==null;){if(e.tag===3){mm(e,t,n);break}else if(e.tag===1){var i=e.stateNode;if(typeof e.type.getDerivedStateFromError=="function"||typeof i.componentDidCatch=="function"&&(ei===null||!ei.has(i))){t=Gr(n,t),t=s1(e,t,1),e=Gn(e,t,1),t=Ge(),e!==null&&(Go(e,1,t),lt(e,t));break}}e=e.return}}function Zx(t,e,n){var i=t.pingCache;i!==null&&i.delete(e),e=Ge(),t.pingedLanes|=t.suspendedLanes&n,Ne===t&&(Le&n)===n&&(Pe===4||Pe===3&&(Le&130023424)===Le&&500>Se()-tg?Pi(t,0):eg|=n),lt(t,e)}function x1(t,e){e===0&&(t.mode&1?(e=ba,ba<<=1,!(ba&130023424)&&(ba=4194304)):e=1);var n=Ge();t=An(t,e),t!==null&&(Go(t,e,n),lt(t,n))}function Qx(t){var e=t.memoizedState,n=0;e!==null&&(n=e.retryLane),x1(t,n)}function Jx(t,e){var n=0;switch(t.tag){case 13:var i=t.stateNode,r=t.memoizedState;r!==null&&(n=r.retryLane);break;case 19:i=t.stateNode;break;default:throw Error(B(314))}i!==null&&i.delete(e),x1(t,n)}var R1;R1=function(t,e,n){if(t!==null)if(t.memoizedProps!==e.pendingProps||ot.current)st=!0;else{if(!(t.lanes&n)&&!(e.flags&128))return st=!1,Lx(t,e,n);st=!!(t.flags&131072)}else st=!1,fe&&e.flags&1048576&&PT(e,Ql,e.index);switch(e.lanes=0,e.tag){case 2:var i=e.type;Rl(t,e),t=e.pendingProps;var r=qr(e,Ye.current);jr(e,n),r=Kp(null,e,i,t,r,n);var s=qp();return e.flags|=1,typeof r=="object"&&r!==null&&typeof r.render=="function"&&r.$$typeof===void 0?(e.tag=1,e.memoizedState=null,e.updateQueue=null,at(i)?(s=!0,ql(e)):s=!1,e.memoizedState=r.state!==null&&r.state!==void 0?r.state:null,Wp(e),r.updater=yu,e.stateNode=r,r._reactInternals=e,qf(e,i,t,n),e=Jf(null,e,i,!0,s,n)):(e.tag=0,fe&&s&&Dp(e),Ze(null,e,r,n),e=e.child),e;case 16:i=e.elementType;e:{switch(Rl(t,e),t=e.pendingProps,r=i._init,i=r(i._payload),e.type=i,r=e.tag=eR(i),t=Mt(i,t),r){case 0:e=Qf(null,e,i,t,n);break e;case 1:e=am(null,e,i,t,n);break e;case 11:e=sm(null,e,i,t,n);break e;case 14:e=om(null,e,i,Mt(i.type,t),n);break e}throw Error(B(306,i,""))}return e;case 0:return i=e.type,r=e.pendingProps,r=e.elementType===i?r:Mt(i,r),Qf(t,e,i,r,n);case 1:return i=e.type,r=e.pendingProps,r=e.elementType===i?r:Mt(i,r),am(t,e,i,r,n);case 3:e:{if(c1(e),t===null)throw Error(B(387));i=e.pendingProps,s=e.memoizedState,r=s.element,NT(t,e),ec(e,i,null,n);var o=e.memoizedState;if(i=o.element,s.isDehydrated)if(s={element:i,isDehydrated:!1,cache:o.cache,pendingSuspenseBoundaries:o.pendingSuspenseBoundaries,transitions:o.transitions},e.updateQueue.baseState=s,e.memoizedState=s,e.flags&256){r=Gr(Error(B(423)),e),e=lm(t,e,i,n,r);break e}else if(i!==r){r=Gr(Error(B(424)),e),e=lm(t,e,i,n,r);break e}else for(ht=Jn(e.stateNode.containerInfo.firstChild),ft=e,fe=!0,Ot=null,n=BT(e,null,i,n),e.child=n;n;)n.flags=n.flags&-3|4096,n=n.sibling;else{if(Zr(),i===r){e=xn(t,e,n);break e}Ze(t,e,i,n)}e=e.child}return e;case 5:return UT(e),t===null&&Xf(e),i=e.type,r=e.pendingProps,s=t!==null?t.memoizedProps:null,o=r.children,Vf(i,r)?o=null:s!==null&&Vf(i,s)&&(e.flags|=32),l1(t,e),Ze(t,e,o,n),e.child;case 6:return t===null&&Xf(e),null;case 13:return u1(t,e,n);case 4:return Hp(e,e.stateNode.containerInfo),i=e.pendingProps,t===null?e.child=Qr(e,null,i,n):Ze(t,e,i,n),e.child;case 11:return i=e.type,r=e.pendingProps,r=e.elementType===i?r:Mt(i,r),sm(t,e,i,r,n);case 7:return Ze(t,e,e.pendingProps,n),e.child;case 8:return Ze(t,e,e.pendingProps.children,n),e.child;case 12:return Ze(t,e,e.pendingProps.children,n),e.child;case 10:e:{if(i=e.type._context,r=e.pendingProps,s=e.memoizedProps,o=r.value,ae(Jl,i._currentValue),i._currentValue=o,s!==null)if(zt(s.value,o)){if(s.children===r.children&&!ot.current){e=xn(t,e,n);break e}}else for(s=e.child,s!==null&&(s.return=e);s!==null;){var a=s.dependencies;if(a!==null){o=s.child;for(var l=a.firstContext;l!==null;){if(l.context===i){if(s.tag===1){l=Tn(-1,n&-n),l.tag=2;var c=s.updateQueue;if(c!==null){c=c.shared;var u=c.pending;u===null?l.next=l:(l.next=u.next,u.next=l),c.pending=l}}s.lanes|=n,l=s.alternate,l!==null&&(l.lanes|=n),Yf(s.return,n,e),a.lanes|=n;break}l=l.next}}else if(s.tag===10)o=s.type===e.type?null:s.child;else if(s.tag===18){if(o=s.return,o===null)throw Error(B(341));o.lanes|=n,a=o.alternate,a!==null&&(a.lanes|=n),Yf(o,n,e),o=s.sibling}else o=s.child;if(o!==null)o.return=s;else for(o=s;o!==null;){if(o===e){o=null;break}if(s=o.sibling,s!==null){s.return=o.return,o=s;break}o=o.return}s=o}Ze(t,e,r.children,n),e=e.child}return e;case 9:return r=e.type,i=e.pendingProps.children,jr(e,n),r=xt(r),i=i(r),e.flags|=1,Ze(t,e,i,n),e.child;case 14:return i=e.type,r=Mt(i,e.pendingProps),r=Mt(i.type,r),om(t,e,i,r,n);case 15:return o1(t,e,e.type,e.pendingProps,n);case 17:return i=e.type,r=e.pendingProps,r=e.elementType===i?r:Mt(i,r),Rl(t,e),e.tag=1,at(i)?(t=!0,ql(e)):t=!1,jr(e,n),FT(e,i,r),qf(e,i,r,n),Jf(null,e,i,!0,t,n);case 19:return h1(t,e,n);case 22:return a1(t,e,n)}throw Error(B(156,e.tag))};function b1(t,e){return Gv(t,e)}function Gx(t,e,n,i){this.tag=t,this.key=n,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=e,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=i,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function wt(t,e,n,i){return new Gx(t,e,n,i)}function sg(t){return t=t.prototype,!(!t||!t.isReactComponent)}function eR(t){if(typeof t=="function")return sg(t)?1:0;if(t!=null){if(t=t.$$typeof,t===Ap)return 11;if(t===xp)return 14}return 2}function ni(t,e){var n=t.alternate;return n===null?(n=wt(t.tag,e,t.key,t.mode),n.elementType=t.elementType,n.type=t.type,n.stateNode=t.stateNode,n.alternate=t,t.alternate=n):(n.pendingProps=e,n.type=t.type,n.flags=0,n.subtreeFlags=0,n.deletions=null),n.flags=t.flags&14680064,n.childLanes=t.childLanes,n.lanes=t.lanes,n.child=t.child,n.memoizedProps=t.memoizedProps,n.memoizedState=t.memoizedState,n.updateQueue=t.updateQueue,e=t.dependencies,n.dependencies=e===null?null:{lanes:e.lanes,firstContext:e.firstContext},n.sibling=t.sibling,n.index=t.index,n.ref=t.ref,n}function Pl(t,e,n,i,r,s){var o=2;if(i=t,typeof t=="function")sg(t)&&(o=1);else if(typeof t=="string")o=5;else e:switch(t){case _r:return Mi(n.children,r,s,e);case Sp:o=8,r|=8;break;case vf:return t=wt(12,n,e,r|2),t.elementType=vf,t.lanes=s,t;case Tf:return t=wt(13,n,e,r),t.elementType=Tf,t.lanes=s,t;case wf:return t=wt(19,n,e,r),t.elementType=wf,t.lanes=s,t;case Dv:return Eu(n,r,s,e);default:if(typeof t=="object"&&t!==null)switch(t.$$typeof){case kv:o=10;break e;case Fv:o=9;break e;case Ap:o=11;break e;case xp:o=14;break e;case Bn:o=16,i=null;break e}throw Error(B(130,t==null?t:typeof t,""))}return e=wt(o,n,e,r),e.elementType=t,e.type=i,e.lanes=s,e}function Mi(t,e,n,i){return t=wt(7,t,i,e),t.lanes=n,t}function Eu(t,e,n,i){return t=wt(22,t,i,e),t.elementType=Dv,t.lanes=n,t.stateNode={isHidden:!1},t}function Sh(t,e,n){return t=wt(6,t,null,e),t.lanes=n,t}function Ah(t,e,n){return e=wt(4,t.children!==null?t.children:[],t.key,e),e.lanes=n,e.stateNode={containerInfo:t.containerInfo,pendingChildren:null,implementation:t.implementation},e}function tR(t,e,n,i,r){this.tag=e,this.containerInfo=t,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=rh(0),this.expirationTimes=rh(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=rh(0),this.identifierPrefix=i,this.onRecoverableError=r,this.mutableSourceEagerHydrationData=null}function og(t,e,n,i,r,s,o,a,l){return t=new tR(t,e,n,a,l),e===1?(e=1,s===!0&&(e|=8)):e=0,s=wt(3,null,null,e),t.current=s,s.stateNode=t,s.memoizedState={element:i,isDehydrated:n,cache:null,transitions:null,pendingSuspenseBoundaries:null},Wp(s),t}function nR(t,e,n){var i=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:gr,key:i==null?null:""+i,children:t,containerInfo:e,implementation:n}}function C1(t){if(!t)return oi;t=t._reactInternals;e:{if(Ki(t)!==t||t.tag!==1)throw Error(B(170));var e=t;do{switch(e.tag){case 3:e=e.stateNode.context;break e;case 1:if(at(e.type)){e=e.stateNode.__reactInternalMemoizedMergedChildContext;break e}}e=e.return}while(e!==null);throw Error(B(171))}if(t.tag===1){var n=t.type;if(at(n))return bT(t,n,e)}return e}function P1(t,e,n,i,r,s,o,a,l){return t=og(n,i,!0,t,r,s,o,a,l),t.context=C1(null),n=t.current,i=Ge(),r=ti(n),s=Tn(i,r),s.callback=e??null,Gn(n,s,r),t.current.lanes=r,Go(t,r,i),lt(t,i),t}function Su(t,e,n,i){var r=e.current,s=Ge(),o=ti(r);return n=C1(n),e.context===null?e.context=n:e.pendingContext=n,e=Tn(s,o),e.payload={element:t},i=i===void 0?null:i,i!==null&&(e.callback=i),t=Gn(r,e,o),t!==null&&(Ut(t,r,o,s),Sl(t,r,o)),o}function lc(t){if(t=t.current,!t.child)return null;switch(t.child.tag){case 5:return t.child.stateNode;default:return t.child.stateNode}}function ym(t,e){if(t=t.memoizedState,t!==null&&t.dehydrated!==null){var n=t.retryLane;t.retryLane=n!==0&&n<e?n:e}}function ag(t,e){ym(t,e),(t=t.alternate)&&ym(t,e)}function iR(){return null}var M1=typeof reportError=="function"?reportError:function(t){console.error(t)};function lg(t){this._internalRoot=t}Au.prototype.render=lg.prototype.render=function(t){var e=this._internalRoot;if(e===null)throw Error(B(409));Su(t,e,null,null)};Au.prototype.unmount=lg.prototype.unmount=function(){var t=this._internalRoot;if(t!==null){this._internalRoot=null;var e=t.containerInfo;zi(function(){Su(null,t,null,null)}),e[Sn]=null}};function Au(t){this._internalRoot=t}Au.prototype.unstable_scheduleHydration=function(t){if(t){var e=oT();t={blockedOn:null,target:t,priority:e};for(var n=0;n<Vn.length&&e!==0&&e<Vn[n].priority;n++);Vn.splice(n,0,t),n===0&&lT(t)}};function cg(t){return!(!t||t.nodeType!==1&&t.nodeType!==9&&t.nodeType!==11)}function xu(t){return!(!t||t.nodeType!==1&&t.nodeType!==9&&t.nodeType!==11&&(t.nodeType!==8||t.nodeValue!==" react-mount-point-unstable "))}function vm(){}function rR(t,e,n,i,r){if(r){if(typeof i=="function"){var s=i;i=function(){var c=lc(o);s.call(c)}}var o=P1(e,i,t,0,null,!1,!1,"",vm);return t._reactRootContainer=o,t[Sn]=o.current,Co(t.nodeType===8?t.parentNode:t),zi(),o}for(;r=t.lastChild;)t.removeChild(r);if(typeof i=="function"){var a=i;i=function(){var c=lc(l);a.call(c)}}var l=og(t,0,!1,null,null,!1,!1,"",vm);return t._reactRootContainer=l,t[Sn]=l.current,Co(t.nodeType===8?t.parentNode:t),zi(function(){Su(e,l,n,i)}),l}function Ru(t,e,n,i,r){var s=n._reactRootContainer;if(s){var o=s;if(typeof r=="function"){var a=r;r=function(){var l=lc(o);a.call(l)}}Su(e,o,t,r)}else o=rR(n,e,t,r,i);return lc(o)}rT=function(t){switch(t.tag){case 3:var e=t.stateNode;if(e.current.memoizedState.isDehydrated){var n=$s(e.pendingLanes);n!==0&&(Cp(e,n|1),lt(e,Se()),!(G&6)&&(es=Se()+500,hi()))}break;case 13:zi(function(){var i=An(t,1);if(i!==null){var r=Ge();Ut(i,t,1,r)}}),ag(t,1)}};Pp=function(t){if(t.tag===13){var e=An(t,134217728);if(e!==null){var n=Ge();Ut(e,t,134217728,n)}ag(t,134217728)}};sT=function(t){if(t.tag===13){var e=ti(t),n=An(t,e);if(n!==null){var i=Ge();Ut(n,t,e,i)}ag(t,e)}};oT=function(){return ne};aT=function(t,e){var n=ne;try{return ne=t,e()}finally{ne=n}};If=function(t,e,n){switch(e){case"input":if(Af(t,n),e=n.name,n.type==="radio"&&e!=null){for(n=t;n.parentNode;)n=n.parentNode;for(n=n.querySelectorAll("input[name="+JSON.stringify(""+e)+'][type="radio"]'),e=0;e<n.length;e++){var i=n[e];if(i!==t&&i.form===t.form){var r=_u(i);if(!r)throw Error(B(90));Uv(i),Af(i,r)}}}break;case"textarea":zv(t,n);break;case"select":e=n.value,e!=null&&Ur(t,!!n.multiple,e,!1)}};Yv=ng;Kv=zi;var sR={usingClientEntryPoint:!1,Events:[ta,Tr,_u,$v,Xv,ng]},Os={findFiberByHostInstance:Si,bundleType:0,version:"18.2.0",rendererPackageName:"react-dom"},oR={bundleType:Os.bundleType,version:Os.version,rendererPackageName:Os.rendererPackageName,rendererConfig:Os.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:Pn.ReactCurrentDispatcher,findHostInstanceByFiber:function(t){return t=Qv(t),t===null?null:t.stateNode},findFiberByHostInstance:Os.findFiberByHostInstance||iR,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.2.0-next-9e3b772b8-20220608"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var Ua=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!Ua.isDisabled&&Ua.supportsFiber)try{fu=Ua.inject(oR),nn=Ua}catch{}}pt.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=sR;pt.createPortal=function(t,e){var n=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!cg(e))throw Error(B(200));return nR(t,e,null,n)};pt.createRoot=function(t,e){if(!cg(t))throw Error(B(299));var n=!1,i="",r=M1;return e!=null&&(e.unstable_strictMode===!0&&(n=!0),e.identifierPrefix!==void 0&&(i=e.identifierPrefix),e.onRecoverableError!==void 0&&(r=e.onRecoverableError)),e=og(t,1,!1,null,null,n,!1,i,r),t[Sn]=e.current,Co(t.nodeType===8?t.parentNode:t),new lg(e)};pt.findDOMNode=function(t){if(t==null)return null;if(t.nodeType===1)return t;var e=t._reactInternals;if(e===void 0)throw typeof t.render=="function"?Error(B(188)):(t=Object.keys(t).join(","),Error(B(268,t)));return t=Qv(e),t=t===null?null:t.stateNode,t};pt.flushSync=function(t){return zi(t)};pt.hydrate=function(t,e,n){if(!xu(e))throw Error(B(200));return Ru(null,t,e,!0,n)};pt.hydrateRoot=function(t,e,n){if(!cg(t))throw Error(B(405));var i=n!=null&&n.hydratedSources||null,r=!1,s="",o=M1;if(n!=null&&(n.unstable_strictMode===!0&&(r=!0),n.identifierPrefix!==void 0&&(s=n.identifierPrefix),n.onRecoverableError!==void 0&&(o=n.onRecoverableError)),e=P1(e,null,t,1,n??null,r,!1,s,o),t[Sn]=e.current,Co(t),i)for(t=0;t<i.length;t++)n=i[t],r=n._getVersion,r=r(n._source),e.mutableSourceEagerHydrationData==null?e.mutableSourceEagerHydrationData=[n,r]:e.mutableSourceEagerHydrationData.push(n,r);return new Au(e)};pt.render=function(t,e,n){if(!xu(e))throw Error(B(200));return Ru(null,t,e,!1,n)};pt.unmountComponentAtNode=function(t){if(!xu(t))throw Error(B(40));return t._reactRootContainer?(zi(function(){Ru(null,null,t,!1,function(){t._reactRootContainer=null,t[Sn]=null})}),!0):!1};pt.unstable_batchedUpdates=ng;pt.unstable_renderSubtreeIntoContainer=function(t,e,n,i){if(!xu(n))throw Error(B(200));if(t==null||t._reactInternals===void 0)throw Error(B(38));return Ru(t,e,n,!1,i)};pt.version="18.2.0-next-9e3b772b8-20220608";function I1(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(I1)}catch(t){console.error(t)}}I1(),Pv.exports=pt;var ug=Pv.exports;function Tm(t,e){if(!t)throw new Error(e||"loader assertion failed.")}const O1=!!(typeof process!="object"||String(process)!=="[object process]"||process.browser),wm=typeof process<"u"&&process.version&&/v([0-9]*)/.exec(process.version);wm&&parseFloat(wm[1]);const La=globalThis,sr=globalThis.process||{},aR=globalThis.navigator||{};function N1(t){var i,r;if(typeof window<"u"&&((i=window.process)==null?void 0:i.type)==="renderer"||typeof process<"u"&&((r=process.versions)!=null&&r.electron))return!0;const e=typeof navigator<"u"&&navigator.userAgent,n=t||e;return!!(n&&n.indexOf("Electron")>=0)}function fi(){return!(typeof process=="object"&&String(process)==="[object process]"&&!(process!=null&&process.browser))||N1()}function lR(t){return!t&&!fi()?"Node":N1(t)?"Electron":(t||aR.userAgent||"").indexOf("Edge")>-1?"Edge":globalThis.chrome?"Chrome":globalThis.safari?"Safari":globalThis.mozInnerScreenX?"Firefox":"Unknown"}const k1="4.0.7";function cR(t){try{const e=window[t],n="__storage_test__";return e.setItem(n,n),e.removeItem(n),e}catch{return null}}class uR{constructor(e,n,i="sessionStorage"){this.storage=cR(i),this.id=e,this.config=n,this._loadConfiguration()}getConfiguration(){return this.config}setConfiguration(e){if(Object.assign(this.config,e),this.storage){const n=JSON.stringify(this.config);this.storage.setItem(this.id,n)}}_loadConfiguration(){let e={};if(this.storage){const n=this.storage.getItem(this.id);e=n?JSON.parse(n):{}}return Object.assign(this.config,e),this}}function hR(t){let e;return t<10?e=`${t.toFixed(2)}ms`:t<100?e=`${t.toFixed(1)}ms`:t<1e3?e=`${t.toFixed(0)}ms`:e=`${(t/1e3).toFixed(2)}s`,e}function fR(t,e=8){const n=Math.max(e-t.length,0);return`${" ".repeat(n)}${t}`}var cc;(function(t){t[t.BLACK=30]="BLACK",t[t.RED=31]="RED",t[t.GREEN=32]="GREEN",t[t.YELLOW=33]="YELLOW",t[t.BLUE=34]="BLUE",t[t.MAGENTA=35]="MAGENTA",t[t.CYAN=36]="CYAN",t[t.WHITE=37]="WHITE",t[t.BRIGHT_BLACK=90]="BRIGHT_BLACK",t[t.BRIGHT_RED=91]="BRIGHT_RED",t[t.BRIGHT_GREEN=92]="BRIGHT_GREEN",t[t.BRIGHT_YELLOW=93]="BRIGHT_YELLOW",t[t.BRIGHT_BLUE=94]="BRIGHT_BLUE",t[t.BRIGHT_MAGENTA=95]="BRIGHT_MAGENTA",t[t.BRIGHT_CYAN=96]="BRIGHT_CYAN",t[t.BRIGHT_WHITE=97]="BRIGHT_WHITE"})(cc||(cc={}));const dR=10;function Em(t){return typeof t!="string"?t:(t=t.toUpperCase(),cc[t]||cc.WHITE)}function pR(t,e,n){return!fi&&typeof t=="string"&&(e&&(t=`\x1B[${Em(e)}m${t}\x1B[39m`),n&&(t=`\x1B[${Em(n)+dR}m${t}\x1B[49m`)),t}function gR(t,e=["constructor"]){const n=Object.getPrototypeOf(t),i=Object.getOwnPropertyNames(n),r=t;for(const s of i){const o=r[s];typeof o=="function"&&(e.find(a=>s===a)||(r[s]=o.bind(t)))}}function hg(t,e){if(!t)throw new Error(e||"Assertion failed")}function or(){var e,n,i;let t;if(fi()&&La.performance)t=(n=(e=La==null?void 0:La.performance)==null?void 0:e.now)==null?void 0:n.call(e);else if("hrtime"in sr){const r=(i=sr==null?void 0:sr.hrtime)==null?void 0:i.call(sr);t=r[0]*1e3+r[1]/1e6}else t=Date.now();return t}const ar={debug:fi()&&console.debug||console.log,log:console.log,info:console.info,warn:console.warn,error:console.error},_R={enabled:!0,level:0};function lr(){}const Sm={},Am={once:!0};class ia{constructor({id:e}={id:""}){this.VERSION=k1,this._startTs=or(),this._deltaTs=or(),this.userData={},this.LOG_THROTTLE_TIMEOUT=0,this.id=e,this.userData={},this._storage=new uR(`__probe-${this.id}__`,_R),this.timeStamp(`${this.id} started`),gR(this),Object.seal(this)}set level(e){this.setLevel(e)}get level(){return this.getLevel()}isEnabled(){return this._storage.config.enabled}getLevel(){return this._storage.config.level}getTotal(){return Number((or()-this._startTs).toPrecision(10))}getDelta(){return Number((or()-this._deltaTs).toPrecision(10))}set priority(e){this.level=e}get priority(){return this.level}getPriority(){return this.level}enable(e=!0){return this._storage.setConfiguration({enabled:e}),this}setLevel(e){return this._storage.setConfiguration({level:e}),this}get(e){return this._storage.config[e]}set(e,n){this._storage.setConfiguration({[e]:n})}settings(){console.table?console.table(this._storage.config):console.log(this._storage.config)}assert(e,n){if(!e)throw new Error(n||"Assertion failed")}warn(e){return this._getLogFunction(0,e,ar.warn,arguments,Am)}error(e){return this._getLogFunction(0,e,ar.error,arguments)}deprecated(e,n){return this.warn(`\`${e}\` is deprecated and will be removed in a later version. Use \`${n}\` instead`)}removed(e,n){return this.error(`\`${e}\` has been removed. Use \`${n}\` instead`)}probe(e,n){return this._getLogFunction(e,n,ar.log,arguments,{time:!0,once:!0})}log(e,n){return this._getLogFunction(e,n,ar.debug,arguments)}info(e,n){return this._getLogFunction(e,n,console.info,arguments)}once(e,n){return this._getLogFunction(e,n,ar.debug||ar.info,arguments,Am)}table(e,n,i){return n?this._getLogFunction(e,n,console.table||lr,i&&[i],{tag:yR(n)}):lr}time(e,n){return this._getLogFunction(e,n,console.time?console.time:console.info)}timeEnd(e,n){return this._getLogFunction(e,n,console.timeEnd?console.timeEnd:console.info)}timeStamp(e,n){return this._getLogFunction(e,n,console.timeStamp||lr)}group(e,n,i={collapsed:!1}){const r=xm({logLevel:e,message:n,opts:i}),{collapsed:s}=i;return r.method=(s?console.groupCollapsed:console.group)||console.info,this._getLogFunction(r)}groupCollapsed(e,n,i={}){return this.group(e,n,Object.assign({},i,{collapsed:!0}))}groupEnd(e){return this._getLogFunction(e,"",console.groupEnd||lr)}withGroup(e,n,i){this.group(e,n)();try{i()}finally{this.groupEnd(e)()}}trace(){console.trace&&console.trace()}_shouldLog(e){return this.isEnabled()&&this.getLevel()>=F1(e)}_getLogFunction(e,n,i,r,s){if(this._shouldLog(e)){s=xm({logLevel:e,message:n,args:r,opts:s}),i=i||s.method,hg(i),s.total=this.getTotal(),s.delta=this.getDelta(),this._deltaTs=or();const o=s.tag||s.message;if(s.once&&o)if(!Sm[o])Sm[o]=or();else return lr;return n=mR(this.id,s.message,s),i.bind(console,n,...s.args)}return lr}}ia.VERSION=k1;function F1(t){if(!t)return 0;let e;switch(typeof t){case"number":e=t;break;case"object":e=t.logLevel||t.priority||0;break;default:return 0}return hg(Number.isFinite(e)&&e>=0),e}function xm(t){const{logLevel:e,message:n}=t;t.logLevel=F1(e);const i=t.args?Array.from(t.args):[];for(;i.length&&i.shift()!==n;);switch(typeof e){case"string":case"function":n!==void 0&&i.unshift(n),t.message=e;break;case"object":Object.assign(t,e);break}typeof t.message=="function"&&(t.message=t.message());const r=typeof t.message;return hg(r==="string"||r==="object"),Object.assign(t,{args:i},t.opts)}function mR(t,e,n){if(typeof e=="string"){const i=n.time?fR(hR(n.total)):"";e=n.time?`${t}: ${i}  ${e}`:`${t}: ${e}`,e=pR(e,n.color,n.background)}return e}function yR(t){for(const e in t)for(const n in t[e])return n||"untitled";return"empty"}function vR(t,e){return D1(t||{},e)}function D1(t,e,n=0){if(n>3)return e;const i={...t};for(const[r,s]of Object.entries(e))s&&typeof s=="object"&&!Array.isArray(s)?i[r]=D1(i[r]||{},e[r],n+1):i[r]=e[r];return i}const TR="latest";function wR(){var t;return(t=globalThis._loadersgl_)!=null&&t.version||(globalThis._loadersgl_=globalThis._loadersgl_||{},globalThis._loadersgl_.version="4.2.0-beta.2"),globalThis._loadersgl_.version}const ER=wR();function ai(t,e){if(!t)throw new Error(e||"loaders.gl assertion failed.")}const Ii=typeof process!="object"||String(process)!=="[object process]"||process.browser,SR=typeof window<"u"&&typeof window.orientation<"u",Rm=typeof process<"u"&&process.version&&/v([0-9]*)/.exec(process.version);Rm&&parseFloat(Rm[1]);class AR{constructor(e,n){m(this,"name");m(this,"workerThread");m(this,"isRunning",!0);m(this,"result");m(this,"_resolve",()=>{});m(this,"_reject",()=>{});this.name=e,this.workerThread=n,this.result=new Promise((i,r)=>{this._resolve=i,this._reject=r})}postMessage(e,n){this.workerThread.postMessage({source:"loaders.gl",type:e,payload:n})}done(e){ai(this.isRunning),this.isRunning=!1,this._resolve(e)}error(e){ai(this.isRunning),this.isRunning=!1,this._reject(e)}}class xh{terminate(){}}const Rh=new Map;function xR(t){ai(t.source&&!t.url||!t.source&&t.url);let e=Rh.get(t.source||t.url);return e||(t.url&&(e=RR(t.url),Rh.set(t.url,e)),t.source&&(e=B1(t.source),Rh.set(t.source,e))),ai(e),e}function RR(t){if(!t.startsWith("http"))return t;const e=bR(t);return B1(e)}function B1(t){const e=new Blob([t],{type:"application/javascript"});return URL.createObjectURL(e)}function bR(t){return`try {
  importScripts('${t}');
} catch (error) {
  console.error(error);
  throw error;
}`}function U1(t,e=!0,n){const i=n||new Set;if(t){if(bm(t))i.add(t);else if(bm(t.buffer))i.add(t.buffer);else if(!ArrayBuffer.isView(t)){if(e&&typeof t=="object")for(const r in t)U1(t[r],e,i)}}return n===void 0?Array.from(i):[]}function bm(t){return t?t instanceof ArrayBuffer||typeof MessagePort<"u"&&t instanceof MessagePort||typeof ImageBitmap<"u"&&t instanceof ImageBitmap||typeof OffscreenCanvas<"u"&&t instanceof OffscreenCanvas:!1}const bh=()=>{};class ud{constructor(e){m(this,"name");m(this,"source");m(this,"url");m(this,"terminated",!1);m(this,"worker");m(this,"onMessage");m(this,"onError");m(this,"_loadableURL","");const{name:n,source:i,url:r}=e;ai(i||r),this.name=n,this.source=i,this.url=r,this.onMessage=bh,this.onError=s=>console.log(s),this.worker=Ii?this._createBrowserWorker():this._createNodeWorker()}static isSupported(){return typeof Worker<"u"&&Ii||typeof xh<"u"&&!Ii}destroy(){this.onMessage=bh,this.onError=bh,this.worker.terminate(),this.terminated=!0}get isRunning(){return!!this.onMessage}postMessage(e,n){n=n||U1(e),this.worker.postMessage(e,n)}_getErrorFromErrorEvent(e){let n="Failed to load ";return n+=`worker ${this.name} from ${this.url}. `,e.message&&(n+=`${e.message} in `),e.lineno&&(n+=`:${e.lineno}:${e.colno}`),new Error(n)}_createBrowserWorker(){this._loadableURL=xR({source:this.source,url:this.url});const e=new Worker(this._loadableURL,{name:this.name});return e.onmessage=n=>{n.data?this.onMessage(n.data):this.onError(new Error("No data received"))},e.onerror=n=>{this.onError(this._getErrorFromErrorEvent(n)),this.terminated=!0},e.onmessageerror=n=>console.error(n),e}_createNodeWorker(){let e;if(this.url){const i=this.url.includes(":/")||this.url.startsWith("/")?this.url:`./${this.url}`;e=new xh(i,{eval:!1})}else if(this.source)e=new xh(this.source,{eval:!0});else throw new Error("no worker");return e.on("message",n=>{this.onMessage(n)}),e.on("error",n=>{this.onError(n)}),e.on("exit",n=>{}),e}}class CR{constructor(e){m(this,"name","unnamed");m(this,"source");m(this,"url");m(this,"maxConcurrency",1);m(this,"maxMobileConcurrency",1);m(this,"onDebug",()=>{});m(this,"reuseWorkers",!0);m(this,"props",{});m(this,"jobQueue",[]);m(this,"idleQueue",[]);m(this,"count",0);m(this,"isDestroyed",!1);this.source=e.source,this.url=e.url,this.setProps(e)}static isSupported(){return ud.isSupported()}destroy(){this.idleQueue.forEach(e=>e.destroy()),this.isDestroyed=!0}setProps(e){this.props={...this.props,...e},e.name!==void 0&&(this.name=e.name),e.maxConcurrency!==void 0&&(this.maxConcurrency=e.maxConcurrency),e.maxMobileConcurrency!==void 0&&(this.maxMobileConcurrency=e.maxMobileConcurrency),e.reuseWorkers!==void 0&&(this.reuseWorkers=e.reuseWorkers),e.onDebug!==void 0&&(this.onDebug=e.onDebug)}async startJob(e,n=(r,s,o)=>r.done(o),i=(r,s)=>r.error(s)){const r=new Promise(s=>(this.jobQueue.push({name:e,onMessage:n,onError:i,onStart:s}),this));return this._startQueuedJob(),await r}async _startQueuedJob(){if(!this.jobQueue.length)return;const e=this._getAvailableWorker();if(!e)return;const n=this.jobQueue.shift();if(n){this.onDebug({message:"Starting job",name:n.name,workerThread:e,backlog:this.jobQueue.length});const i=new AR(n.name,e);e.onMessage=r=>n.onMessage(i,r.type,r.payload),e.onError=r=>n.onError(i,r),n.onStart(i);try{await i.result}catch(r){console.error(`Worker exception: ${r}`)}finally{this.returnWorkerToQueue(e)}}}returnWorkerToQueue(e){!Ii||this.isDestroyed||!this.reuseWorkers||this.count>this._getMaxConcurrency()?(e.destroy(),this.count--):this.idleQueue.push(e),this.isDestroyed||this._startQueuedJob()}_getAvailableWorker(){if(this.idleQueue.length>0)return this.idleQueue.shift()||null;if(this.count<this._getMaxConcurrency()){this.count++;const e=`${this.name.toLowerCase()} (#${this.count} of ${this.maxConcurrency})`;return new ud({name:e,source:this.source,url:this.url})}return null}_getMaxConcurrency(){return SR?this.maxMobileConcurrency:this.maxConcurrency}}const PR={maxConcurrency:3,maxMobileConcurrency:1,reuseWorkers:!0,onDebug:()=>{}},zn=class zn{constructor(e){m(this,"props");m(this,"workerPools",new Map);this.props={...PR},this.setProps(e),this.workerPools=new Map}static isSupported(){return ud.isSupported()}static getWorkerFarm(e={}){return zn._workerFarm=zn._workerFarm||new zn({}),zn._workerFarm.setProps(e),zn._workerFarm}destroy(){for(const e of this.workerPools.values())e.destroy();this.workerPools=new Map}setProps(e){this.props={...this.props,...e};for(const n of this.workerPools.values())n.setProps(this._getWorkerPoolProps())}getWorkerPool(e){const{name:n,source:i,url:r}=e;let s=this.workerPools.get(n);return s||(s=new CR({name:n,source:i,url:r}),s.setProps(this._getWorkerPoolProps()),this.workerPools.set(n,s)),s}_getWorkerPoolProps(){return{maxConcurrency:this.props.maxConcurrency,maxMobileConcurrency:this.props.maxMobileConcurrency,reuseWorkers:this.props.reuseWorkers,onDebug:this.props.onDebug}}};m(zn,"_workerFarm");let uc=zn;function MR(t,e={}){const n=e[t.id]||{},i=Ii?`${t.id}-worker.js`:`${t.id}-worker-node.js`;let r=n.workerUrl;if(!r&&t.id==="compression"&&(r=e.workerUrl),e._workerType==="test"&&(Ii?r=`modules/${t.module}/dist/${i}`:r=`modules/${t.module}/src/workers/${t.id}-worker-node.ts`),!r){let s=t.version;s==="latest"&&(s=TR);const o=s?`@${s}`:"";r=`https://unpkg.com/@loaders.gl/${t.module}${o}/dist/${i}`}return ai(r),r}function IR(t,e=ER){ai(t,"no worker provided");const n=t.version;return!(!e||!n)}function OR(t,e){return!uc.isSupported()||!Ii&&!(e!=null&&e._nodeWorkers)?!1:t.worker&&(e==null?void 0:e.worker)}async function NR(t,e,n,i,r){const s=t.id,o=MR(t,n),l=uc.getWorkerFarm(n).getWorkerPool({name:s,url:o});n=JSON.parse(JSON.stringify(n)),i=JSON.parse(JSON.stringify(i||{}));const c=await l.startJob("process-on-worker",kR.bind(null,r));return c.postMessage("process",{input:e,options:n,context:i}),await(await c.result).result}async function kR(t,e,n,i){switch(n){case"done":e.done(i);break;case"error":e.error(new Error(i.error));break;case"process":const{id:r,input:s,options:o}=i;try{const a=await t(s,o);e.postMessage("done",{id:r,result:a})}catch(a){const l=a instanceof Error?a.message:"unknown error";e.postMessage("error",{id:r,error:l})}break;default:console.warn(`parse-with-worker unknown message ${n}`)}}function FR(t,e,n){if(n=n||t.byteLength,t.byteLength<n||e.byteLength<n)return!1;const i=new Uint8Array(t),r=new Uint8Array(e);for(let s=0;s<i.length;++s)if(i[s]!==r[s])return!1;return!0}function DR(...t){return BR(t)}function BR(t){const e=t.map(s=>s instanceof ArrayBuffer?new Uint8Array(s):s),n=e.reduce((s,o)=>s+o.byteLength,0),i=new Uint8Array(n);let r=0;for(const s of e)i.set(s,r),r+=s.byteLength;return i.buffer}async function UR(t){const e=[];for await(const n of t)e.push(n);return DR(...e)}function Cm(){let t;if(typeof window<"u"&&window.performance)t=window.performance.now();else if(typeof process<"u"&&process.hrtime){const e=process.hrtime();t=e[0]*1e3+e[1]/1e6}else t=Date.now();return t}class Pm{constructor(e,n){this.sampleSize=1,this.time=0,this.count=0,this.samples=0,this.lastTiming=0,this.lastSampleTime=0,this.lastSampleCount=0,this._count=0,this._time=0,this._samples=0,this._startTime=0,this._timerPending=!1,this.name=e,this.type=n,this.reset()}reset(){return this.time=0,this.count=0,this.samples=0,this.lastTiming=0,this.lastSampleTime=0,this.lastSampleCount=0,this._count=0,this._time=0,this._samples=0,this._startTime=0,this._timerPending=!1,this}setSampleSize(e){return this.sampleSize=e,this}incrementCount(){return this.addCount(1),this}decrementCount(){return this.subtractCount(1),this}addCount(e){return this._count+=e,this._samples++,this._checkSampling(),this}subtractCount(e){return this._count-=e,this._samples++,this._checkSampling(),this}addTime(e){return this._time+=e,this.lastTiming=e,this._samples++,this._checkSampling(),this}timeStart(){return this._startTime=Cm(),this._timerPending=!0,this}timeEnd(){return this._timerPending?(this.addTime(Cm()-this._startTime),this._timerPending=!1,this._checkSampling(),this):this}getSampleAverageCount(){return this.sampleSize>0?this.lastSampleCount/this.sampleSize:0}getSampleAverageTime(){return this.sampleSize>0?this.lastSampleTime/this.sampleSize:0}getSampleHz(){return this.lastSampleTime>0?this.sampleSize/(this.lastSampleTime/1e3):0}getAverageCount(){return this.samples>0?this.count/this.samples:0}getAverageTime(){return this.samples>0?this.time/this.samples:0}getHz(){return this.time>0?this.samples/(this.time/1e3):0}_checkSampling(){this._samples===this.sampleSize&&(this.lastSampleTime=this._time,this.lastSampleCount=this._count,this.count+=this._count,this.time+=this._time,this.samples+=this._samples,this._time=0,this._count=0,this._samples=0)}}class ra{constructor(e){this.stats={},this.id=e.id,this.stats={},this._initializeStats(e.stats),Object.seal(this)}get(e,n="count"){return this._getOrCreate({name:e,type:n})}get size(){return Object.keys(this.stats).length}reset(){for(const e of Object.values(this.stats))e.reset();return this}forEach(e){for(const n of Object.values(this.stats))e(n)}getTable(){const e={};return this.forEach(n=>{e[n.name]={time:n.time||0,count:n.count||0,average:n.getAverageTime()||0,hz:n.getHz()||0}}),e}_initializeStats(e=[]){e.forEach(n=>this._getOrCreate(n))}_getOrCreate(e){const{name:n,type:i}=e;let r=this.stats[n];return r||(e instanceof Pm?r=e:r=new Pm(n,i),this.stats[n]=r),r}}let LR="";const Mm={};function zR(t){for(const e in Mm)if(t.startsWith(e)){const n=Mm[e];t=t.replace(e,n)}return!t.startsWith("http://")&&!t.startsWith("https://")&&(t=`${LR}${t}`),t}function VR(t){return t&&typeof t=="object"&&t.isBuffer}function L1(t){if(VR(t))return t;if(t instanceof ArrayBuffer)return t;if(ArrayBuffer.isView(t))return t.byteOffset===0&&t.byteLength===t.buffer.byteLength?t.buffer:t.buffer.slice(t.byteOffset,t.byteOffset+t.byteLength);if(typeof t=="string"){const e=t;return new TextEncoder().encode(e).buffer}if(t&&typeof t=="object"&&t._toArrayBuffer)return t._toArrayBuffer();throw new Error("toArrayBuffer")}function z1(t){const e=t?t.lastIndexOf("/"):-1;return e>=0?t.substr(e+1):""}function jR(t){const e=t?t.lastIndexOf("/"):-1;return e>=0?t.substr(0,e):""}const WR=t=>typeof t=="boolean",lo=t=>typeof t=="function",sa=t=>t!==null&&typeof t=="object",Im=t=>sa(t)&&t.constructor==={}.constructor,HR=t=>!!t&&typeof t[Symbol.iterator]=="function",$R=t=>t&&typeof t[Symbol.asyncIterator]=="function",qi=t=>typeof Response<"u"&&t instanceof Response||t&&t.arrayBuffer&&t.text&&t.json,Zi=t=>typeof Blob<"u"&&t instanceof Blob,XR=t=>t&&typeof t=="object"&&t.isBuffer,YR=t=>typeof ReadableStream<"u"&&t instanceof ReadableStream||sa(t)&&lo(t.tee)&&lo(t.cancel)&&lo(t.getReader),KR=t=>sa(t)&&lo(t.read)&&lo(t.pipe)&&WR(t.readable),V1=t=>YR(t)||KR(t);class qR extends Error{constructor(n,i){super(n);m(this,"reason");m(this,"url");m(this,"response");this.reason=i.reason,this.url=i.url,this.response=i.response}}const ZR=/^data:([-\w.]+\/[-\w.+]+)(;|,)/,QR=/^([-\w.]+\/[-\w.+]+)/;function Om(t,e){return t.toLowerCase()===e.toLowerCase()}function JR(t){const e=QR.exec(t);return e?e[1]:t}function Nm(t){const e=ZR.exec(t);return e?e[1]:""}const j1=/\?.*/;function GR(t){const e=t.match(j1);return e&&e[0]}function fg(t){return t.replace(j1,"")}function e3(t){if(t.length<50)return t;const e=t.slice(t.length-15);return`${t.substr(0,32)}...${e}`}function bu(t){return qi(t)?t.url:Zi(t)?t.name||"":typeof t=="string"?t:""}function dg(t){if(qi(t)){const e=t,n=e.headers.get("content-type")||"",i=fg(e.url);return JR(n)||Nm(i)}return Zi(t)?t.type||"":typeof t=="string"?Nm(t):""}function t3(t){return qi(t)?t.headers["content-length"]||-1:Zi(t)?t.size:typeof t=="string"?t.length:t instanceof ArrayBuffer||ArrayBuffer.isView(t)?t.byteLength:-1}async function W1(t){if(qi(t))return t;const e={},n=t3(t);n>=0&&(e["content-length"]=String(n));const i=bu(t),r=dg(t);r&&(e["content-type"]=r);const s=await r3(t);s&&(e["x-first-bytes"]=s),typeof t=="string"&&(t=new TextEncoder().encode(t));const o=new Response(t,{headers:e});return Object.defineProperty(o,"url",{value:i}),o}async function n3(t){if(!t.ok)throw await i3(t)}async function i3(t){const e=e3(t.url);let n=`Failed to fetch resource (${t.status}) ${t.statusText}: ${e}`;n=n.length>100?`${n.slice(0,100)}...`:n;const i={reason:t.statusText,url:t.url,response:t};try{const r=t.headers.get("Content-Type");i.reason=r!=null&&r.includes("application/json")?await t.json():t.text()}catch{}return new qR(n,i)}async function r3(t){if(typeof t=="string")return`data:,${t.slice(0,5)}`;if(t instanceof Blob){const n=t.slice(0,5);return await new Promise(i=>{const r=new FileReader;r.onload=s=>{var o;return i((o=s==null?void 0:s.target)==null?void 0:o.result)},r.readAsDataURL(n)})}if(t instanceof ArrayBuffer){const n=t.slice(0,5);return`data:base64,${s3(n)}`}return null}function s3(t){let e="";const n=new Uint8Array(t);for(let i=0;i<n.byteLength;i++)e+=String.fromCharCode(n[i]);return btoa(e)}function o3(t){return!a3(t)&&!l3(t)}function a3(t){return t.startsWith("http:")||t.startsWith("https:")}function l3(t){return t.startsWith("data:")}async function km(t,e){var n,i;if(typeof t=="string"){const r=zR(t);return o3(r)&&(n=globalThis.loaders)!=null&&n.fetchNode?(i=globalThis.loaders)==null?void 0:i.fetchNode(r,e):await fetch(r,e)}return await W1(t)}const Fm=new ia({id:"loaders.gl"});class c3{log(){return()=>{}}info(){return()=>{}}warn(){return()=>{}}error(){return()=>{}}}class u3{constructor(){m(this,"console");this.console=console}log(...e){return this.console.log.bind(this.console,...e)}info(...e){return this.console.info.bind(this.console,...e)}warn(...e){return this.console.warn.bind(this.console,...e)}error(...e){return this.console.error.bind(this.console,...e)}}const H1={fetch:null,mimeType:void 0,nothrow:!1,log:new u3,useLocalLibraries:!1,CDN:"https://unpkg.com/@loaders.gl",worker:!0,maxConcurrency:3,maxMobileConcurrency:1,reuseWorkers:O1,_nodeWorkers:!1,_workerType:"",limit:0,_limitMB:0,batchSize:"auto",batchDebounceMs:0,metadata:!1,transforms:[]},h3={throws:"nothrow",dataType:"(no longer used)",uri:"baseUri",method:"fetch.method",headers:"fetch.headers",body:"fetch.body",mode:"fetch.mode",credentials:"fetch.credentials",cache:"fetch.cache",redirect:"fetch.redirect",referrer:"fetch.referrer",referrerPolicy:"fetch.referrerPolicy",integrity:"fetch.integrity",keepalive:"fetch.keepalive",signal:"fetch.signal"};function $1(){globalThis.loaders=globalThis.loaders||{};const{loaders:t}=globalThis;return t._state||(t._state={}),t._state}function X1(){const t=$1();return t.globalOptions=t.globalOptions||{...H1},t.globalOptions}function f3(t,e,n,i){return n=n||[],n=Array.isArray(n)?n:[n],d3(t,n),g3(e,t,i)}function d3(t,e){Dm(t,null,H1,h3,e);for(const n of e){const i=t&&t[n.id]||{},r=n.options&&n.options[n.id]||{},s=n.deprecatedOptions&&n.deprecatedOptions[n.id]||{};Dm(i,n.id,r,s,e)}}function Dm(t,e,n,i,r){const s=e||"Top level",o=e?`${e}.`:"";for(const a in t){const l=!e&&sa(t[a]),c=a==="baseUri"&&!e,u=a==="workerUrl"&&e;if(!(a in n)&&!c&&!u){if(a in i)Fm.warn(`${s} loader option '${o}${a}' no longer supported, use '${i[a]}'`)();else if(!l){const h=p3(a,r);Fm.warn(`${s} loader option '${o}${a}' not recognized. ${h}`)()}}}}function p3(t,e){const n=t.toLowerCase();let i="";for(const r of e)for(const s in r.options){if(t===s)return`Did you mean '${r.id}.${s}'?`;const o=s.toLowerCase();(n.startsWith(o)||o.startsWith(n))&&(i=i||`Did you mean '${r.id}.${s}'?`)}return i}function g3(t,e,n){const r={...t.options||{}};return _3(r,n),r.log===null&&(r.log=new c3),Bm(r,X1()),Bm(r,e),r}function Bm(t,e){for(const n in e)if(n in e){const i=e[n];Im(i)&&Im(t[n])?t[n]={...t[n],...e[n]}:t[n]=e[n]}}function _3(t,e){e&&!("baseUri"in t)&&(t.baseUri=e)}function pg(t){return t?(Array.isArray(t)&&(t=t[0]),Array.isArray(t==null?void 0:t.extensions)):!1}function gg(t){Tm(t,"null loader"),Tm(pg(t),"invalid loader");let e;return Array.isArray(t)&&(e=t[1],t=t[0],t={...t,options:{...t.options,...e}}),(t!=null&&t.parseTextSync||t!=null&&t.parseText)&&(t.text=!0),t.text||(t.binary=!0),t}const Y1=()=>{const t=$1();return t.loaderRegistry=t.loaderRegistry||[],t.loaderRegistry};function K1(t){const e=Y1();t=Array.isArray(t)?t:[t];for(const n of t){const i=gg(n);e.find(r=>i===r)||e.unshift(i)}}function m3(){return Y1()}const y3=new ia({id:"loaders.gl"}),v3=/\.([^.]+)$/;async function T3(t,e=[],n,i){if(!q1(t))return null;let r=Um(t,e,{...n,nothrow:!0},i);if(r)return r;if(Zi(t)&&(t=await t.slice(0,10).arrayBuffer(),r=Um(t,e,n,i)),!r&&!(n!=null&&n.nothrow))throw new Error(Z1(t));return r}function Um(t,e=[],n,i){if(!q1(t))return null;if(e&&!Array.isArray(e))return gg(e);let r=[];e&&(r=r.concat(e)),n!=null&&n.ignoreRegisteredLoaders||r.push(...m3()),E3(r);const s=w3(t,r,n,i);if(!s&&!(n!=null&&n.nothrow))throw new Error(Z1(t));return s}function w3(t,e,n,i){const r=bu(t),s=dg(t),o=fg(r)||(i==null?void 0:i.url);let a=null,l="";return n!=null&&n.mimeType&&(a=Ch(e,n==null?void 0:n.mimeType),l=`match forced by supplied MIME type ${n==null?void 0:n.mimeType}`),a=a||S3(e,o),l=l||(a?`matched url ${o}`:""),a=a||Ch(e,s),l=l||(a?`matched MIME type ${s}`:""),a=a||x3(e,t),l=l||(a?`matched initial data ${Q1(t)}`:""),n!=null&&n.fallbackMimeType&&(a=a||Ch(e,n==null?void 0:n.fallbackMimeType),l=l||(a?`matched fallback MIME type ${s}`:"")),l&&y3.log(1,`selectLoader selected ${a==null?void 0:a.name}: ${l}.`),a}function q1(t){return!(t instanceof Response&&t.status===204)}function Z1(t){const e=bu(t),n=dg(t);let i="No valid loader found (";i+=e?`${z1(e)}, `:"no url provided, ",i+=`MIME type: ${n?`"${n}"`:"not provided"}, `;const r=t?Q1(t):"";return i+=r?` first bytes: "${r}"`:"first bytes: not available",i+=")",i}function E3(t){for(const e of t)gg(e)}function S3(t,e){const n=e&&v3.exec(e),i=n&&n[1];return i?A3(t,i):null}function A3(t,e){e=e.toLowerCase();for(const n of t)for(const i of n.extensions)if(i.toLowerCase()===e)return n;return null}function Ch(t,e){var n;for(const i of t)if((n=i.mimeTypes)!=null&&n.some(r=>Om(e,r))||Om(e,`application/x.${i.id}`))return i;return null}function x3(t,e){if(!e)return null;for(const n of t)if(typeof e=="string"){if(R3(e,n))return n}else if(ArrayBuffer.isView(e)){if(Lm(e.buffer,e.byteOffset,n))return n}else if(e instanceof ArrayBuffer&&Lm(e,0,n))return n;return null}function R3(t,e){return e.testText?e.testText(t):(Array.isArray(e.tests)?e.tests:[e.tests]).some(i=>t.startsWith(i))}function Lm(t,e,n){return(Array.isArray(n.tests)?n.tests:[n.tests]).some(r=>b3(t,e,n,r))}function b3(t,e,n,i){if(i instanceof ArrayBuffer)return FR(i,t,i.byteLength);switch(typeof i){case"function":return i(t);case"string":const r=hd(t,e,i.length);return i===r;default:return!1}}function Q1(t,e=5){return typeof t=="string"?t.slice(0,e):ArrayBuffer.isView(t)?hd(t.buffer,t.byteOffset,e):t instanceof ArrayBuffer?hd(t,0,e):""}function hd(t,e,n){if(t.byteLength<e+n)return"";const i=new DataView(t);let r="";for(let s=0;s<n;s++)r+=String.fromCharCode(i.getUint8(e+s));return r}const C3=256*1024;function*P3(t,e){const n=(e==null?void 0:e.chunkSize)||C3;let i=0;const r=new TextEncoder;for(;i<t.length;){const s=Math.min(t.length-i,n),o=t.slice(i,i+s);i+=s,yield r.encode(o)}}const M3=256*1024;function*I3(t,e={}){const{chunkSize:n=M3}=e;let i=0;for(;i<t.byteLength;){const r=Math.min(t.byteLength-i,n),s=new ArrayBuffer(r),o=new Uint8Array(t,i,r);new Uint8Array(s).set(o),i+=r,yield s}}const O3=1024*1024;async function*N3(t,e){const n=(e==null?void 0:e.chunkSize)||O3;let i=0;for(;i<t.size;){const r=i+n,s=await t.slice(i,r).arrayBuffer();i=r,yield s}}function zm(t,e){return O1?k3(t,e):F3(t)}async function*k3(t,e){const n=t.getReader();let i;try{for(;;){const r=i||n.read();e!=null&&e._streamReadAhead&&(i=n.read());const{done:s,value:o}=await r;if(s)return;yield L1(o)}}catch{n.releaseLock()}}async function*F3(t,e){for await(const n of t)yield L1(n)}function D3(t,e){if(typeof t=="string")return P3(t,e);if(t instanceof ArrayBuffer)return I3(t,e);if(Zi(t))return N3(t,e);if(V1(t))return zm(t,e);if(qi(t))return zm(t.body,e);throw new Error("makeIterator")}const J1="Cannot convert supplied data type";function B3(t,e,n){if(e.text&&typeof t=="string")return t;if(XR(t)&&(t=t.buffer),t instanceof ArrayBuffer){const i=t;return e.text&&!e.binary?new TextDecoder("utf8").decode(i):i}if(ArrayBuffer.isView(t)){if(e.text&&!e.binary)return new TextDecoder("utf8").decode(t);let i=t.buffer;const r=t.byteLength||t.length;return(t.byteOffset!==0||r!==i.byteLength)&&(i=i.slice(t.byteOffset,t.byteOffset+r)),i}throw new Error(J1)}async function U3(t,e,n){const i=t instanceof ArrayBuffer||ArrayBuffer.isView(t);if(typeof t=="string"||i)return B3(t,e);if(Zi(t)&&(t=await W1(t)),qi(t)){const r=t;return await n3(r),e.binary?await r.arrayBuffer():await r.text()}if(V1(t)&&(t=D3(t,n)),HR(t)||$R(t))return UR(t);throw new Error(J1)}function G1(t,e){const n=X1(),i=t||n;return typeof i.fetch=="function"?i.fetch:sa(i.fetch)?r=>km(r,i.fetch):e!=null&&e.fetch?e==null?void 0:e.fetch:km}function L3(t,e,n){if(n)return n;const i={fetch:G1(e,t),...t};if(i.url){const r=fg(i.url);i.baseUrl=r,i.queryString=GR(i.url),i.filename=z1(r),i.baseUrl=jR(r)}return Array.isArray(i.loaders)||(i.loaders=null),i}function z3(t,e){if(t&&!Array.isArray(t))return t;let n;if(t&&(n=Array.isArray(t)?t:[t]),e&&e.loaders){const i=Array.isArray(e.loaders)?e.loaders:[e.loaders];n=n?[...n,...i]:i}return n&&n.length?n:void 0}async function hc(t,e,n,i){e&&!Array.isArray(e)&&!pg(e)&&(i=void 0,n=e,e=void 0),t=await t,n=n||{};const r=bu(t),o=z3(e,i),a=await T3(t,o,n);return a?(n=f3(n,a,o,r),i=L3({url:r,_parse:hc,loaders:o},n,i||null),await V3(a,t,n,i)):null}async function V3(t,e,n,i){if(IR(t),n=vR(t.options,n),qi(e)){const s=e,{ok:o,redirected:a,status:l,statusText:c,type:u,url:h}=s,f=Object.fromEntries(s.headers.entries());i.response={headers:f,ok:o,redirected:a,status:l,statusText:c,type:u,url:h}}e=await U3(e,t,n);const r=t;if(r.parseTextSync&&typeof e=="string")return r.parseTextSync(e,n,i);if(OR(t,n))return await NR(t,e,n,i,hc);if(r.parseText&&typeof e=="string")return await r.parseText(e,n,i);if(r.parse)return await r.parse(e,n,i);throw ai(!r.parseSync),new Error(`${t.id} loader - no parser found and worker is disabled`)}async function fc(t,e,n,i){let r,s;!Array.isArray(e)&&!pg(e)?(r=[],s=e):(r=e,s=n);const o=G1(s);let a=t;return typeof t=="string"&&(a=await o(t)),Zi(t)&&(a=await o(t)),Array.isArray(r)?await hc(a,r,s):await hc(a,r,s)}const j3="4.1.4";function ew(t,e){if(!t)throw new Error(e||"loader assertion failed.")}const W3=!!(typeof process!="object"||String(process)!=="[object process]"||process.browser),Vm=typeof process<"u"&&process.version&&/v([0-9]*)/.exec(process.version);Vm&&parseFloat(Vm[1]);const H3="Queued Requests",$3="Active Requests",X3="Cancelled Requests",Y3="Queued Requests Ever",K3="Active Requests Ever",q3={id:"request-scheduler",throttleRequests:!0,maxRequests:6,debounceTime:0};class Z3{constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};this.props=void 0,this.stats=void 0,this.activeRequestCount=0,this.requestQueue=[],this.requestMap=new Map,this.updateTimer=null,this.props={...q3,...e},this.stats=new ra({id:this.props.id}),this.stats.get(H3),this.stats.get($3),this.stats.get(X3),this.stats.get(Y3),this.stats.get(K3)}scheduleRequest(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:()=>0;if(!this.props.throttleRequests)return Promise.resolve({done:()=>{}});if(this.requestMap.has(e))return this.requestMap.get(e);const i={handle:e,priority:0,getPriority:n},r=new Promise(s=>(i.resolve=s,i));return this.requestQueue.push(i),this.requestMap.set(e,r),this._issueNewRequests(),r}_issueRequest(e){const{handle:n,resolve:i}=e;let r=!1;const s=()=>{r||(r=!0,this.requestMap.delete(n),this.activeRequestCount--,this._issueNewRequests())};return this.activeRequestCount++,i?i({done:s}):Promise.resolve({done:s})}_issueNewRequests(){this.updateTimer!==null&&clearTimeout(this.updateTimer),this.updateTimer=setTimeout(()=>this._issueNewRequestsAsync(),this.props.debounceTime)}_issueNewRequestsAsync(){this.updateTimer!==null&&clearTimeout(this.updateTimer),this.updateTimer=null;const e=Math.max(this.props.maxRequests-this.activeRequestCount,0);if(e!==0){this._updateAllRequests();for(let n=0;n<e;++n){const i=this.requestQueue.shift();i&&this._issueRequest(i)}}}_updateAllRequests(){const e=this.requestQueue;for(let n=0;n<e.length;++n){const i=e[n];this._updateRequest(i)||(e.splice(n,1),this.requestMap.delete(i.handle),n--)}e.sort((n,i)=>n.priority-i.priority)}_updateRequest(e){return e.priority=e.getPriority(e.handle),e.priority<0?(e.resolve(null),!1):!0}}var Ph;const Q3=(Ph=globalThis.loaders)===null||Ph===void 0?void 0:Ph.parseImageNode,fd=typeof Image<"u",dd=typeof ImageBitmap<"u",J3=!!Q3,pd=W3?!0:J3;function G3(t){switch(t){case"auto":return dd||fd||pd;case"imagebitmap":return dd;case"image":return fd;case"data":return pd;default:throw new Error(`@loaders.gl/images: image ${t} not supported in this environment`)}}function eb(){if(dd)return"imagebitmap";if(fd)return"image";if(pd)return"data";throw new Error("Install '@loaders.gl/polyfills' to parse images under Node.js")}function tb(t){const e=ib(t);if(!e)throw new Error("Not an image");return e}function nb(t){switch(tb(t)){case"data":return t;case"image":case"imagebitmap":const e=document.createElement("canvas"),n=e.getContext("2d");if(!n)throw new Error("getImageData");return e.width=t.width,e.height=t.height,n.drawImage(t,0,0),n.getImageData(0,0,t.width,t.height);default:throw new Error("getImageData")}}function ib(t){return typeof ImageBitmap<"u"&&t instanceof ImageBitmap?"imagebitmap":typeof Image<"u"&&t instanceof Image?"image":t&&typeof t=="object"&&t.data&&t.width&&t.height?"data":null}const rb=/^data:image\/svg\+xml/,sb=/\.svg((\?|#).*)?$/;function _g(t){return t&&(rb.test(t)||sb.test(t))}function ob(t,e){if(_g(e)){let i=new TextDecoder().decode(t);try{typeof unescape=="function"&&typeof encodeURIComponent=="function"&&(i=unescape(encodeURIComponent(i)))}catch(s){throw new Error(s.message)}return`data:image/svg+xml;base64,${btoa(i)}`}return tw(t,e)}function tw(t,e){if(_g(e))throw new Error("SVG cannot be parsed directly to imagebitmap");return new Blob([new Uint8Array(t)])}async function nw(t,e,n){const i=ob(t,n),r=self.URL||self.webkitURL,s=typeof i!="string"&&r.createObjectURL(i);try{return await ab(s||i,e)}finally{s&&r.revokeObjectURL(s)}}async function ab(t,e){const n=new Image;return n.src=t,e.image&&e.image.decode&&n.decode?(await n.decode(),n):await new Promise((i,r)=>{try{n.onload=()=>i(n),n.onerror=s=>{const o=s instanceof Error?s.message:"error";r(new Error(o))}}catch(s){r(s)}})}const lb={};let jm=!0;async function cb(t,e,n){let i;_g(n)?i=await nw(t,e,n):i=tw(t,n);const r=e&&e.imagebitmap;return await ub(i,r)}async function ub(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null;if((hb(e)||!jm)&&(e=null),e)try{return await createImageBitmap(t,e)}catch(n){console.warn(n),jm=!1}return await createImageBitmap(t)}function hb(t){for(const e in t||lb)return!1;return!0}function fb(t){return!_b(t,"ftyp",4)||!(t[8]&96)?null:db(t)}function db(t){switch(pb(t,8,12).replace("\0"," ").trim()){case"avif":case"avis":return{extension:"avif",mimeType:"image/avif"};default:return null}}function pb(t,e,n){return String.fromCharCode(...t.slice(e,n))}function gb(t){return[...t].map(e=>e.charCodeAt(0))}function _b(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0;const i=gb(e);for(let r=0;r<i.length;++r)if(i[r]!==t[r+n])return!1;return!0}const en=!1,co=!0;function iw(t){const e=oa(t);return yb(e)||wb(e)||vb(e)||Tb(e)||mb(e)}function mb(t){const e=new Uint8Array(t instanceof DataView?t.buffer:t),n=fb(e);return n?{mimeType:n.mimeType,width:0,height:0}:null}function yb(t){const e=oa(t);return e.byteLength>=24&&e.getUint32(0,en)===2303741511?{mimeType:"image/png",width:e.getUint32(16,en),height:e.getUint32(20,en)}:null}function vb(t){const e=oa(t);return e.byteLength>=10&&e.getUint32(0,en)===1195984440?{mimeType:"image/gif",width:e.getUint16(6,co),height:e.getUint16(8,co)}:null}function Tb(t){const e=oa(t);return e.byteLength>=14&&e.getUint16(0,en)===16973&&e.getUint32(2,co)===e.byteLength?{mimeType:"image/bmp",width:e.getUint32(18,co),height:e.getUint32(22,co)}:null}function wb(t){const e=oa(t);if(!(e.byteLength>=3&&e.getUint16(0,en)===65496&&e.getUint8(2)===255))return null;const{tableMarkers:i,sofMarkers:r}=Eb();let s=2;for(;s+9<e.byteLength;){const o=e.getUint16(s,en);if(r.has(o))return{mimeType:"image/jpeg",height:e.getUint16(s+5,en),width:e.getUint16(s+7,en)};if(!i.has(o))return null;s+=2,s+=e.getUint16(s,en)}return null}function Eb(){const t=new Set([65499,65476,65484,65501,65534]);for(let n=65504;n<65520;++n)t.add(n);return{tableMarkers:t,sofMarkers:new Set([65472,65473,65474,65475,65477,65478,65479,65481,65482,65483,65485,65486,65487,65502])}}function oa(t){if(t instanceof DataView)return t;if(ArrayBuffer.isView(t))return new DataView(t.buffer);if(t instanceof ArrayBuffer)return new DataView(t);throw new Error("toDataView")}async function Sb(t,e){var n;const{mimeType:i}=iw(t)||{},r=(n=globalThis.loaders)===null||n===void 0?void 0:n.parseImageNode;return ew(r),await r(t,i)}async function Ab(t,e,n){e=e||{};const r=(e.image||{}).type||"auto",{url:s}=n||{},o=xb(r);let a;switch(o){case"imagebitmap":a=await cb(t,e,s);break;case"image":a=await nw(t,e,s);break;case"data":a=await Sb(t);break;default:ew(!1)}return r==="data"&&(a=nb(a)),a}function xb(t){switch(t){case"auto":case"data":return eb();default:return G3(t),t}}const Rb=["png","jpg","jpeg","gif","webp","bmp","ico","svg","avif"],bb=["image/png","image/jpeg","image/gif","image/webp","image/avif","image/bmp","image/vnd.microsoft.icon","image/svg+xml"],Cb={image:{type:"auto",decode:!0}},Pb={id:"image",module:"images",name:"Images",version:j3,mimeTypes:bb,extensions:Rb,parse:Ab,tests:[t=>!!iw(new DataView(t))],options:Cb},Mb=new ia({id:"deck"}),Q=Mb;let gd={};function Ib(t){gd=t}function He(t,e,n,i){Q.level>0&&gd[t]&&gd[t].call(null,e,n,i)}function Ob(t){const e=t[0],n=t[t.length-1];return e==="{"&&n==="}"||e==="["&&n==="]"}const Nb={id:"JSON",name:"JSON",module:"",version:"",options:{},extensions:["json","geojson"],mimeTypes:["application/json","application/geo+json"],testText:Ob,parseTextSync:JSON.parse};function kb(){const t="9.0.4",e=globalThis.deck&&globalThis.deck.VERSION;if(e&&e!==t)throw new Error(`deck.gl - multiple versions detected: ${e} vs ${t}`);return e||(Q.log(1,`deck.gl ${t}`)(),globalThis.deck={...globalThis.deck,VERSION:t,version:t,log:Q,_registerLoggers:Ib},K1([Nb,[Pb,{imagebitmap:{premultiplyAlpha:"none"}}]])),t}const Fb=kb();function Ri(t,e){if(!t)throw new Error(e||"shadertools: assertion failed.")}const Mh={number:{type:"number",validate(t,e){return Number.isFinite(t)&&typeof e=="object"&&(e.max===void 0||t<=e.max)&&(e.min===void 0||t>=e.min)}},array:{type:"array",validate(t,e){return Array.isArray(t)||ArrayBuffer.isView(t)}}};function Db(t){const e={};for(const[n,i]of Object.entries(t))e[n]=Ub(i);return e}function Bb(t,e,n){const i={};for(const[r,s]of Object.entries(e))t&&r in t&&!s.private?(s.validate&&Ri(s.validate(t[r],s),`${n}: invalid ${r}`),i[r]=t[r]):i[r]=s.value;return i}function Ub(t){let e=Wm(t);if(e!=="object")return{value:t,...Mh[e],type:e};if(typeof t=="object")return t?t.type!==void 0?{...t,...Mh[t.type],type:t.type}:t.value===void 0?{type:"object",value:t}:(e=Wm(t.value),{...t,...Mh[e],type:e}):{type:"object",value:null};throw new Error("props")}function Wm(t){return Array.isArray(t)||ArrayBuffer.isView(t)?"array":typeof t}const Lb=`#ifdef MODULE_LOGDEPTH
logdepth_adjustPosition(gl_Position);
#endif
`,zb=`#ifdef MODULE_MATERIAL
gl_FragColor = material_filterColor(gl_FragColor);
#endif
#ifdef MODULE_LIGHTING
gl_FragColor = lighting_filterColor(gl_FragColor);
#endif
#ifdef MODULE_FOG
gl_FragColor = fog_filterColor(gl_FragColor);
#endif
#ifdef MODULE_PICKING
gl_FragColor = picking_filterHighlightColor(gl_FragColor);
gl_FragColor = picking_filterPickingColor(gl_FragColor);
#endif
#ifdef MODULE_LOGDEPTH
logdepth_setFragDepth();
#endif
`,Vb={vertex:Lb,fragment:zb},Hm=/void\s+main\s*\([^)]*\)\s*\{\n?/,$m=/}\n?[^{}]*$/,Ih=[],Ml="__LUMA_INJECT_DECLARATIONS__";function jb(t){const e={vertex:{},fragment:{}};for(const n in t){let i=t[n];const r=Wb(n);typeof i=="string"&&(i={order:0,injection:i}),e[r][n]=i}return e}function Wb(t){const e=t.slice(0,2);switch(e){case"vs":return"vertex";case"fs":return"fragment";default:throw new Error(e)}}function dc(t,e,n,i=!1){const r=e==="vertex";for(const s in n){const o=n[s];o.sort((l,c)=>l.order-c.order),Ih.length=o.length;for(let l=0,c=o.length;l<c;++l)Ih[l]=o[l].injection;const a=`${Ih.join(`
`)}
`;switch(s){case"vs:#decl":r&&(t=t.replace(Ml,a));break;case"vs:#main-start":r&&(t=t.replace(Hm,l=>l+a));break;case"vs:#main-end":r&&(t=t.replace($m,l=>a+l));break;case"fs:#decl":r||(t=t.replace(Ml,a));break;case"fs:#main-start":r||(t=t.replace(Hm,l=>l+a));break;case"fs:#main-end":r||(t=t.replace($m,l=>a+l));break;default:t=t.replace(s,l=>l+a)}}return t=t.replace(Ml,""),i&&(t=t.replace(/\}\s*$/,s=>s+Vb[e])),t}let Hb=1;class bi{constructor(e){m(this,"name");m(this,"vs");m(this,"fs");m(this,"getModuleUniforms");m(this,"dependencies");m(this,"deprecations");m(this,"defines");m(this,"injections");m(this,"uniforms",{});m(this,"uniformTypes",{});const{name:n,vs:i,fs:r,dependencies:s=[],uniformPropTypes:o={},getUniforms:a,deprecations:l=[],defines:c={},inject:u={}}=e;Ri(typeof n=="string"),this.name=n,this.vs=i,this.fs=r,this.getModuleUniforms=a,this.dependencies=bi.instantiateModules(s),this.deprecations=this._parseDeprecationDefinitions(l),this.defines=c,this.injections=jb(u),o&&(this.uniforms=Db(o))}static instantiateModules(e){return e.map(n=>{if(n instanceof bi)return n;Ri(typeof n!="string",`Shader module use by name is deprecated. Import shader module '${JSON.stringify(n)}' and use it directly.`),n.name||(console.warn("shader module has no name"),n.name=`shader-module-${Hb++}`);const i=new bi(n);return i.dependencies=bi.instantiateModules(n.dependencies||[]),i})}getModuleSource(e){let n;switch(e){case"vertex":n=this.vs||"";break;case"fragment":n=this.fs||"";break;default:Ri(!1)}const i=this.name.toUpperCase().replace(/[^0-9a-z]/gi,"_");return`// ----- MODULE ${this.name} ---------------

#define MODULE_${i}
${n}

`}getUniforms(e,n){return this.getModuleUniforms?this.getModuleUniforms(e,n):Bb(e,this.uniforms,this.name)}getDefines(){return this.defines}checkDeprecations(e,n){this.deprecations.forEach(i=>{var r;(r=i.regex)!=null&&r.test(e)&&(i.deprecated?n.deprecated(i.old,i.new)():n.removed(i.old,i.new)())})}_parseDeprecationDefinitions(e){return e.forEach(n=>{switch(n.type){case"function":n.regex=new RegExp(`\\b${n.old}\\(`);break;default:n.regex=new RegExp(`${n.type} ${n.old};`)}}),e}_defaultGetUniforms(e={}){const n={},i=this.uniforms;for(const r in i){const s=i[r];r in e&&!s.private?(s.validate&&Ri(s.validate(e[r],s),`${this.name}: invalid ${r}`),n[r]=e[r]):n[r]=s.value}return n}}function Xm(t){if(t.source&&t.platformInfo.type==="webgpu")return{...t,vs:void 0,fs:void 0};if(!t.vs)throw new Error("no vertex shader");const e=Ym(t.platformInfo,t.vs);let n;return t.fs&&(n=Ym(t.platformInfo,t.fs)),{...t,vs:e,fs:n}}function Ym(t,e){if(typeof e=="string")return e;switch(t.type){case"webgpu":if(e!=null&&e.wgsl)return e.wgsl;throw new Error("WebGPU does not support GLSL shaders");default:if(e!=null&&e.glsl)return e.glsl;throw new Error("WebGL does not support WGSL shaders")}}function Cu(t){const e=bi.instantiateModules(t);return $b(e)}function $b(t){const e={},n={};return rw({modules:t,level:0,moduleMap:e,moduleDepth:n}),Object.keys(n).sort((i,r)=>n[r]-n[i]).map(i=>e[i])}function rw(t){const{modules:e,level:n,moduleMap:i,moduleDepth:r}=t;if(n>=5)throw new Error("Possible loop in shader dependency graph");for(const s of e)i[s.name]=s,(r[s.name]===void 0||r[s.name]<n)&&(r[s.name]=n);for(const s of e)s.dependencies&&rw({modules:s.dependencies,level:n+1,moduleMap:i,moduleDepth:r})}function Xb(t){switch(t==null?void 0:t.gpu.toLowerCase()){case"apple":return`#define APPLE_GPU
#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1
#define LUMA_FP32_TAN_PRECISION_WORKAROUND 1
#define LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND 1
`;case"nvidia":return`#define NVIDIA_GPU
#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1
`;case"intel":return`#define INTEL_GPU
#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1
#define LUMA_FP32_TAN_PRECISION_WORKAROUND 1
#define LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND 1
`;case"amd":return`#define AMD_GPU
`;default:return`#define DEFAULT_GPU
#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1
#define LUMA_FP32_TAN_PRECISION_WORKAROUND 1
#define LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND 1
`}}function Yb(t,e){var i;if(Number(((i=t.match(/^#version[ \t]+(\d+)/m))==null?void 0:i[1])||100)!==300)throw new Error("luma.gl v9 only supports GLSL 3.00 shader sources");switch(e){case"vertex":return t=Km(t,Kb),t;case"fragment":return t=Km(t,qb),t;default:throw new Error(e)}}const sw=[[/^(#version[ \t]+(100|300[ \t]+es))?[ \t]*\n/,`#version 300 es
`],[/\btexture(2D|2DProj|Cube)Lod(EXT)?\(/g,"textureLod("],[/\btexture(2D|2DProj|Cube)(EXT)?\(/g,"texture("]],Kb=[...sw,[_d("attribute"),"in $1"],[_d("varying"),"out $1"]],qb=[...sw,[_d("varying"),"in $1"]];function Km(t,e){for(const[n,i]of e)t=t.replace(n,i);return t}function _d(t){return new RegExp(`\\b${t}[ \\t]+(\\w+[ \\t]+\\w+(\\[\\w+\\])?;)`,"g")}function ow(t,e){let n="";for(const i in t){const r=t[i];if(n+=`void ${r.signature} {
`,r.header&&(n+=`  ${r.header}`),e[i]){const s=e[i];s.sort((o,a)=>o.order-a.order);for(const o of s)n+=`  ${o.injection}
`}r.footer&&(n+=`  ${r.footer}`),n+=`}
`}return n}function aw(t){const e={vertex:{},fragment:{}};for(const n of t){let i,r;typeof n!="string"?(i=n,r=i.hook):(i={},r=n),r=r.trim();const[s,o]=r.split(":"),a=r.replace(/\(.+/,""),l=Object.assign(i,{signature:o});switch(s){case"vs":e.vertex[a]=l;break;case"fs":e.fragment[a]=l;break;default:throw new Error(s)}}return e}function Zb(t,e){return{name:Qb(t,e),language:"glsl",version:Jb(t)}}function Qb(t,e="unnamed"){const i=/#define[^\S\r\n]*SHADER_NAME[^\S\r\n]*([A-Za-z0-9_-]+)\s*/.exec(t);return i?i[1]:e}function Jb(t){let e=100;const n=t.match(/[^\s]+/g);if(n&&n.length>=2&&n[0]==="#version"){const i=parseInt(n[1],10);Number.isFinite(i)&&(e=i)}if(e!==100&&e!==300)throw new Error(`Invalid GLSL version ${e}`);return e}const lw=`

${Ml}
`,Gb=`precision highp float;
`;function eC(t){const e=Cu(t.modules||[]);return{source:md(t.platformInfo,{...t,source:t.source,stage:"vertex",modules:e}),getUniforms:mg(e)}}function tC(t){const e=Cu(t.modules||[]);return{vs:md(t.platformInfo,{...t,source:t.vs,stage:"vertex",modules:e}),fs:md(t.platformInfo,{...t,source:t.fs,stage:"fragment",modules:e}),getUniforms:mg(e)}}function nC(t){const{vs:e,fs:n}=t,i=Cu(t.modules||[]);return{vs:qm(t.platformInfo,{...t,source:e,stage:"vertex",modules:i}),fs:qm(t.platformInfo,{...t,source:n,stage:"fragment",modules:i}),getUniforms:mg(i)}}function md(t,e){const{source:n,stage:i,modules:r,hookFunctions:s=[],inject:o={},log:a}=e;Ri(typeof n=="string","shader source must be a string");const l=n;let c="";const u=aw(s),h={},f={},d={};for(const v in o){const A=typeof o[v]=="string"?{injection:o[v],order:0}:o[v],y=/^(v|f)s:(#)?([\w-]+)$/.exec(v);if(y){const g=y[2],_=y[3];g?_==="decl"?f[v]=[A]:d[v]=[A]:h[v]=[A]}else d[v]=[A]}const p=t.type!=="webgpu"?r:[];for(const v of p){a&&v.checkDeprecations(l,a);const A=v.getModuleSource(i,"wgsl");c+=A;const y=v.injections[i];for(const g in y){const _=/^(v|f)s:#([\w-]+)$/.exec(g);if(_){const R=_[2]==="decl"?f:d;R[g]=R[g]||[],R[g].push(y[g])}else h[g]=h[g]||[],h[g].push(y[g])}}return c+=lw,c=dc(c,i,f),c+=ow(u[i],h),c+=l,c=dc(c,i,d),c}function qm(t,e){const{id:n,source:i,stage:r,language:s="glsl",modules:o,defines:a={},hookFunctions:l=[],inject:c={},prologue:u=!0,log:h}=e;Ri(typeof i=="string","shader source must be a string");const f=s==="glsl"?Zb(i).version:-1,d=t.shaderLanguageVersion,p=f===100?"#version 100":"#version 300 es",A=i.split(`
`).slice(1).join(`
`),y={};o.forEach(I=>{Object.assign(y,I.getDefines())}),Object.assign(y,a);let g="";switch(s){case"wgsl":break;case"glsl":g=u?`${p}

// ----- PROLOGUE -------------------------
${iC({id:n,source:i,stage:r})}
${`#define SHADER_TYPE_${r.toUpperCase()}`}
${Xb(t)}
${r==="fragment"?Gb:""}

// ----- APPLICATION DEFINES -------------------------

${rC(y)}

`:`${p}
`;break}const _=aw(l),E={},R={},P={};for(const I in c){const O=typeof c[I]=="string"?{injection:c[I],order:0}:c[I],k=/^(v|f)s:(#)?([\w-]+)$/.exec(I);if(k){const D=k[2],H=k[3];D?H==="decl"?R[I]=[O]:P[I]=[O]:E[I]=[O]}else P[I]=[O]}for(const I of o){h&&I.checkDeprecations(A,h);const O=I.getModuleSource(r);g+=O;const k=I.injections[r];for(const D in k){const H=/^(v|f)s:#([\w-]+)$/.exec(D);if(H){const $=H[2]==="decl"?R:P;$[D]=$[D]||[],$[D].push(k[D])}else E[D]=E[D]||[],E[D].push(k[D])}}return g+="// ----- MAIN SHADER SOURCE -------------------------",g+=lw,g=dc(g,r,R),g+=ow(_[r],E),g+=A,g=dc(g,r,P),s==="glsl"&&f!==d&&(g=Yb(g,r)),g.trim()}function mg(t){return function(n){const i={};for(const r of t){const s=r.getUniforms(n,i);Object.assign(i,s)}return i}}function iC(t){const{id:e,source:n,stage:i}=t;return e&&n.indexOf("SHADER_NAME")===-1?`
#define SHADER_NAME ${e}_${i}

`:""}function rC(t={}){let e="";for(const n in t){const i=t[n];(i||Number.isFinite(i))&&(e+=`#define ${n.toUpperCase()} ${t[n]}
`)}return e}const wi=class wi{constructor(){m(this,"_hookFunctions",[]);m(this,"_defaultModules",[])}static getDefaultShaderAssembler(){return wi.defaultShaderAssembler=wi.defaultShaderAssembler||new wi,wi.defaultShaderAssembler}addDefaultModule(e){this._defaultModules.find(n=>n.name===(typeof e=="string"?e:e.name))||this._defaultModules.push(e)}removeDefaultModule(e){const n=typeof e=="string"?e:e.name;this._defaultModules=this._defaultModules.filter(i=>i.name!==n)}addShaderHook(e,n){n&&(e=Object.assign(n,{hook:e})),this._hookFunctions.push(e)}assembleShader(e){const n=this._getModuleList(e.modules),i=this._hookFunctions,r=Xm(e);return{...eC({platformInfo:e.platformInfo,...r,modules:n,hookFunctions:i}),modules:n}}assembleShaderPair(e){const n=Xm(e),i=this._getModuleList(e.modules),r=this._hookFunctions,{platformInfo:s}=e;return{...e.platformInfo.shaderLanguage==="wgsl"?tC({platformInfo:s,...n,modules:i,hookFunctions:r}):nC({platformInfo:s,...n,modules:i,hookFunctions:r}),modules:i}}_getModuleList(e=[]){const n=new Array(this._defaultModules.length+e.length),i={};let r=0;for(let s=0,o=this._defaultModules.length;s<o;++s){const a=this._defaultModules[s],l=a.name;n[r++]=a,i[l]=!0}for(let s=0,o=e.length;s<o;++s){const a=e[s],l=a.name;i[l]||(n[r++]=a,i[l]=!0)}return n.length=r,bi.instantiateModules(n)}};m(wi,"defaultShaderAssembler");let pc=wi;const sC=`out vec4 transform_output;
void main() {
transform_output = vec4(0);
}`,oC=`#version 300 es
${sC}`;function aC(t){const{input:e,inputChannels:n,output:i}=t||{};if(!e)return oC;if(!n)throw new Error("inputChannels");const r=lC(n),s=cC(e,n);return`#version 300 es
in ${r} ${e};
out vec4 ${i};
void main() {
  ${i} = ${s};
}`}function lC(t){switch(t){case 1:return"float";case 2:return"vec2";case 3:return"vec3";case 4:return"vec4";default:throw new Error(`invalid channels: ${t}`)}}function cC(t,e){switch(e){case 1:return`vec4(${t}, 0.0, 0.0, 1.0)`;case 2:return`vec4(${t}, 0.0, 1.0)`;case 3:return`vec4(${t}, 1.0)`;case 4:return t;default:throw new Error(`invalid channels: ${e}`)}}const U=new ia({id:"luma.gl"});class uC{constructor(){m(this,"stats",new Map)}getStats(e){return this.get(e)}get(e){return this.stats.has(e)||this.stats.set(e,new ra({id:e})),this.stats.get(e)}}const yg=new uC;function hC(){const t="9.0.9",e="set luma.log.level=1 (or higher) to trace rendering";if(globalThis.luma&&globalThis.luma.VERSION!==t)throw new Error(`luma.gl - multiple VERSIONs detected: ${globalThis.luma.VERSION} vs ${t}`);return globalThis.luma||(fi()&&U.log(1,`${t} - ${e}`)(),globalThis.luma=globalThis.luma||{VERSION:t,version:t,log:U,stats:yg}),t}const fC=hC();function dC(t){return ArrayBuffer.isView(t)&&!(t instanceof DataView)?t:null}function Bo(t){return Array.isArray(t)?t.length===0||typeof t[0]=="number"?t:null:dC(t)}const Oh={};function Qi(t="id"){Oh[t]=Oh[t]||1;const e=Oh[t]++;return`${t}-${e}`}function gc(t){let e=!0;for(const n in t){e=!1;break}return e}var mf;let se=(mf=class{constructor(e,n,i){m(this,"id");m(this,"props");m(this,"userData",{});m(this,"_device");m(this,"destroyed",!1);m(this,"allocatedBytes",0);m(this,"_attachedResources",new Set);if(!e)throw new Error("no device");this._device=e,this.props=pC(n,i);const r=this.props.id!=="undefined"?this.props.id:Qi(this[Symbol.toStringTag]);this.props.id=r,this.id=r,this.userData=this.props.userData||{},this.addStats()}destroy(){this.destroyResource()}delete(){return this.destroy(),this}toString(){return`${this[Symbol.toStringTag]||this.constructor.name}(${this.id})`}getProps(){return this.props}attachResource(e){this._attachedResources.add(e)}detachResource(e){this._attachedResources.delete(e)}destroyAttachedResource(e){this._attachedResources.delete(e)&&e.destroy()}destroyAttachedResources(){for(const e of Object.values(this._attachedResources))e.destroy();this._attachedResources=new Set}destroyResource(){this.destroyAttachedResources(),this.removeStats(),this.destroyed=!0}removeStats(){const e=this._device.statsManager.getStats("Resource Counts"),n=this[Symbol.toStringTag];e.get(`${n}s Active`).decrementCount()}trackAllocatedMemory(e,n=this[Symbol.toStringTag]){const i=this._device.statsManager.getStats("Resource Counts");i.get("GPU Memory").addCount(e),i.get(`${n} Memory`).addCount(e),this.allocatedBytes=e}trackDeallocatedMemory(e=this[Symbol.toStringTag]){const n=this._device.statsManager.getStats("Resource Counts");n.get("GPU Memory").subtractCount(this.allocatedBytes),n.get(`${e} Memory`).subtractCount(this.allocatedBytes),this.allocatedBytes=0}addStats(){const e=this._device.statsManager.getStats("Resource Counts"),n=this[Symbol.toStringTag];e.get("Resources Created").incrementCount(),e.get(`${n}s Created`).incrementCount(),e.get(`${n}s Active`).incrementCount()}},m(mf,"defaultProps",{id:"undefined",handle:void 0,userData:void 0}),mf);function pC(t,e){const n={...e};for(const i in t)t[i]!==void 0&&(n[i]=t[i]);return n}const Fe=class Fe extends se{constructor(n,i){const r={...i};(i.usage||0)&Fe.INDEX&&!i.indexType&&(i.data instanceof Uint32Array?r.indexType="uint32":i.data instanceof Uint16Array&&(r.indexType="uint16"));super(n,r,Fe.defaultProps);m(this,"usage");m(this,"indexType");m(this,"updateTimestamp");m(this,"debugData",new ArrayBuffer(0));this.usage=i.usage||0,this.indexType=r.indexType,this.updateTimestamp=n.incrementTimestamp()}get[Symbol.toStringTag](){return"Buffer"}readSyncWebGL(n,i){throw new Error("not implemented")}_setDebugData(n,i,r){const s=ArrayBuffer.isView(n)?n.buffer:n,o=Math.min(n?n.byteLength:r,Fe.DEBUG_DATA_MAX_LENGTH);n===null?this.debugData=new ArrayBuffer(o):i===0&&r===n.byteLength?this.debugData=s.slice(0,o):this.debugData=s.slice(i,i+o)}};m(Fe,"defaultProps",{...se.defaultProps,usage:0,byteLength:0,byteOffset:0,data:null,indexType:"uint16",mappedAtCreation:!1}),m(Fe,"MAP_READ",1),m(Fe,"MAP_WRITE",2),m(Fe,"COPY_SRC",4),m(Fe,"COPY_DST",8),m(Fe,"INDEX",16),m(Fe,"VERTEX",32),m(Fe,"UNIFORM",64),m(Fe,"STORAGE",128),m(Fe,"INDIRECT",256),m(Fe,"QUERY_RESOLVE",512),m(Fe,"DEBUG_DATA_MAX_LENGTH",32);let de=Fe;function cw(t){const e=Zm[t],n=gC(e),i=t.includes("norm"),r=!i&&!t.startsWith("float"),s=t.startsWith("s");return{dataType:Zm[t],byteLength:n,integer:r,signed:s,normalized:i}}function gC(t){return _C[t]}const Zm={uint8:"uint8",sint8:"sint8",unorm8:"uint8",snorm8:"sint8",uint16:"uint16",sint16:"sint16",unorm16:"uint16",snorm16:"sint16",float16:"float16",float32:"float32",uint32:"uint32",sint32:"sint32"},_C={uint8:1,sint8:1,uint16:2,sint16:2,float16:2,float32:4,uint32:4,sint32:4},mC=["bc1","bc2","bc3","bc4","bc5","bc6","bc7","etc1","etc2","eac","atc","astc","pvrtc"],yC=/^(rg?b?a?)([0-9]*)([a-z]*)(-srgb)?(-webgl|-unsized)?$/;function vC(t){return mC.some(e=>t.startsWith(e))}function uw(t){const e=yC.exec(t);if(e){const[,n,i,r,s,o]=e;if(n){const a=`${r}${i}`,l=cw(a);return{format:n,components:n.length,srgb:s==="-srgb",unsized:o==="-unsized",webgl:o==="-webgl",...l}}}return wC(t)}const TC={"rgba4unorm-webgl":{format:"rgba",bpp:2},"rgb565unorm-webgl":{format:"rgb",bpp:2},"rgb5a1unorm-webgl":{format:"rgba",bbp:2},rgb9e5ufloat:{format:"rgb",bbp:4},rg11b10ufloat:{format:"rgb",bbp:4},rgb10a2unorm:{format:"rgba",bbp:4},"rgb10a2uint-webgl":{format:"rgba",bbp:4},stencil8:{components:1,bpp:1,a:"stencil"},depth16unorm:{components:1,bpp:2,a:"depth"},depth24plus:{components:1,bpp:3,a:"depth"},depth32float:{components:1,bpp:4,a:"depth"},"depth24plus-stencil8":{components:2,bpp:4,a:"depth-stencil"},"depth24unorm-stencil8":{components:2,bpp:4,a:"depth-stencil"},"depth32float-stencil8":{components:2,bpp:4,a:"depth-stencil"}};function wC(t){var n;const e=TC[t];if(!e)throw new Error(`Unknown format ${t}`);return{format:e.format||"",components:e.components||((n=e.format)==null?void 0:n.length)||1,byteLength:e.bpp||1,srgb:!1,unsized:!1}}class EC{}class SC{constructor(e=[],n){m(this,"features");m(this,"disabledFeatures");this.features=new Set(e),this.disabledFeatures=n||{}}*[Symbol.iterator](){yield*this.features}has(e){return!this.disabledFeatures[e]&&this.features.has(e)}}const mo=class mo{constructor(e){m(this,"id");m(this,"props");m(this,"userData",{});m(this,"statsManager",yg);m(this,"_lumaData",{});m(this,"timestamp",0);this.props={...mo.defaultProps,...e},this.id=this.props.id||Qi(this[Symbol.toStringTag].toLowerCase())}get[Symbol.toStringTag](){return"Device"}isTextureFormatCompressed(e){return vC(e)}loseDevice(){return!1}getCanvasContext(){if(!this.canvasContext)throw new Error("Device has no CanvasContext");return this.canvasContext}createTexture(e){return(e instanceof Promise||typeof e=="string")&&(e={data:e}),this._createTexture(e)}createCommandEncoder(e={}){throw new Error("not implemented")}readPixelsToArrayWebGL(e,n){throw new Error("not implemented")}readPixelsToBufferWebGL(e,n){throw new Error("not implemented")}setParametersWebGL(e){throw new Error("not implemented")}getParametersWebGL(e){throw new Error("not implemented")}withParametersWebGL(e,n){throw new Error("not implemented")}clearWebGL(e){throw new Error("not implemented")}resetWebGL(){throw new Error("not implemented")}incrementTimestamp(){return this.timestamp++}onError(e){this.props.onError(e)}_getBufferProps(e){(e instanceof ArrayBuffer||ArrayBuffer.isView(e))&&(e={data:e});const n={...e};return(e.usage||0)&de.INDEX&&!e.indexType&&(e.data instanceof Uint32Array?n.indexType="uint32":e.data instanceof Uint16Array?n.indexType="uint16":U.warn("indices buffer content must be of integer type")()),n}};m(mo,"defaultProps",{id:null,canvas:null,container:null,manageState:!0,width:800,height:600,requestMaxLimits:!0,debug:!!U.get("debug"),spector:!!U.get("spector"),break:[],initalizeFeatures:!0,disabledFeatures:{"compilation-status-async-webgl":!0},gl:null,onError:e=>U.error(e.message)}),m(mo,"VERSION",fC);let Oi=mo;function le(t,e){if(!t)throw new Error(e||"luma.gl: assertion failed.")}const Ns=new Map;class Ni{static registerDevices(e){for(const n of e)le(n.type&&n.isSupported&&n.create),Ns.set(n.type,n)}static getAvailableDevices(){return Array.from(Ns).map(e=>e.type)}static getSupportedDevices(){return Array.from(Ns).filter(e=>e.isSupported()).map(e=>e.type)}static setDefaultDeviceProps(e){Object.assign(Oi.defaultProps,e)}static async attachDevice(e){const n=Qm(e.devices)||Ns;if(e.handle instanceof WebGL2RenderingContext){const i=n.get("webgl");if(i)return await i.attach(e.handle)}if(e.handle===null){const i=n.get("unknown");if(i)return await i.attach(null)}throw new Error("Failed to attach device. Ensure `@luma.gl/webgl` and/or `@luma.gl/webgpu` modules are imported.")}static async createDevice(e={}){var i,r;e={...Oi.defaultProps,...e},e.gl&&(e.type="webgl");const n=Qm(e.devices)||Ns;switch(e.type){case"webgpu":let s=n.get("webgpu");if(s)return await s.create(e);break;case"webgl":let o=n.get("webgl");if(o)return await o.create(e);break;case"unknown":const a=n.get("unknown");if(a)return await a.create(e);break;case"best-available":if(s=n.get("webgpu"),(i=s==null?void 0:s.isSupported)!=null&&i.call(s))return await s.create(e);if(o=n.get("webgl"),(r=o==null?void 0:o.isSupported)!=null&&r.call(o))return await o.create(e);break}throw new Error("No matching device found. Ensure `@luma.gl/webgl` and/or `@luma.gl/webgpu` modules are imported.")}}m(Ni,"defaultProps",{...Oi.defaultProps,type:"best-available",devices:void 0}),m(Ni,"stats",yg),m(Ni,"log",U);function Qm(t){if(!t||(t==null?void 0:t.length)===0)return null;const e=new Map;for(const n of t)e.set(n.type,n);return e}const AC=fi()&&typeof document<"u",Pu=()=>AC&&document.readyState==="complete",xC={canvas:null,width:800,height:600,useDevicePixels:!0,autoResize:!0,container:null,visible:!0,colorSpace:"srgb",alphaMode:"opaque"};class vg{constructor(e){m(this,"id");m(this,"props");m(this,"canvas");m(this,"htmlCanvas");m(this,"offscreenCanvas");m(this,"type");m(this,"width",1);m(this,"height",1);m(this,"resizeObserver");m(this,"_canvasSizeInfo",{clientWidth:0,clientHeight:0,devicePixelRatio:1});if(this.props={...xC,...e},e=this.props,!fi()){this.id="node-canvas-context",this.type="node",this.width=this.props.width,this.height=this.props.height,this.canvas=null;return}if(e.canvas)typeof e.canvas=="string"?this.canvas=CC(e.canvas):this.canvas=e.canvas;else{const n=PC(e),i=bC((e==null?void 0:e.container)||null);i.insertBefore(n,i.firstChild),this.canvas=n,e!=null&&e.visible||(this.canvas.style.visibility="hidden")}this.canvas instanceof HTMLCanvasElement?(this.id=this.canvas.id,this.type="html-canvas",this.htmlCanvas=this.canvas):(this.id="offscreen-canvas",this.type="offscreen-canvas",this.offscreenCanvas=this.canvas),this.canvas instanceof HTMLCanvasElement&&e.autoResize&&(this.resizeObserver=new ResizeObserver(n=>{for(const i of n)i.target===this.canvas&&this.update()}),this.resizeObserver.observe(this.canvas))}static get isPageLoaded(){return Pu()}getDevicePixelRatio(e){return typeof OffscreenCanvas<"u"&&this.canvas instanceof OffscreenCanvas||(e=e===void 0?this.props.useDevicePixels:e,!e||e<=0)?1:e===!0?typeof window<"u"&&window.devicePixelRatio||1:e}getPixelSize(){switch(this.type){case"node":return[this.width,this.height];case"offscreen-canvas":return[this.canvas.width,this.canvas.height];case"html-canvas":const e=this.getDevicePixelRatio(),n=this.canvas;return n.parentElement?[n.clientWidth*e,n.clientHeight*e]:[this.canvas.width,this.canvas.height];default:throw new Error(this.type)}}getAspect(){const[e,n]=this.getPixelSize();return e/n}cssToDeviceRatio(){try{const[e]=this.getDrawingBufferSize(),{clientWidth:n}=this._canvasSizeInfo;return n?e/n:1}catch{return 1}}cssToDevicePixels(e,n=!0){const i=this.cssToDeviceRatio(),[r,s]=this.getDrawingBufferSize();return MC(e,i,r,s,n)}setDevicePixelRatio(e,n={}){if(!this.htmlCanvas)return;let i="width"in n?n.width:this.htmlCanvas.clientWidth,r="height"in n?n.height:this.htmlCanvas.clientHeight;(!i||!r)&&(U.log(1,"Canvas clientWidth/clientHeight is 0")(),e=1,i=this.htmlCanvas.width||1,r=this.htmlCanvas.height||1);const s=this._canvasSizeInfo;if(s.clientWidth!==i||s.clientHeight!==r||s.devicePixelRatio!==e){let o=e;const a=Math.floor(i*o),l=Math.floor(r*o);this.htmlCanvas.width=a,this.htmlCanvas.height=l;const[c,u]=this.getDrawingBufferSize();(c!==a||u!==l)&&(o=Math.min(c/i,u/r),this.htmlCanvas.width=Math.floor(i*o),this.htmlCanvas.height=Math.floor(r*o),U.warn("Device pixel ratio clamped")()),this._canvasSizeInfo.clientWidth=i,this._canvasSizeInfo.clientHeight=r,this._canvasSizeInfo.devicePixelRatio=e}}getDrawingBufferSize(){const e=this.device.gl;if(!e)throw new Error("canvas size");return[e.drawingBufferWidth,e.drawingBufferHeight]}_setAutoCreatedCanvasId(e){var n;((n=this.htmlCanvas)==null?void 0:n.id)==="lumagl-auto-created-canvas"&&(this.htmlCanvas.id=e)}}m(vg,"pageLoaded",RC());function RC(){return Pu()||typeof window>"u"?Promise.resolve():new Promise(t=>{window.addEventListener("load",()=>t())})}function bC(t){if(typeof t=="string"){const e=document.getElementById(t);if(!e&&!Pu())throw new Error(`Accessing '${t}' before page was loaded`);if(!e)throw new Error(`${t} is not an HTML element`);return e}else if(t)return t;return document.body}function CC(t){const e=document.getElementById(t);if(!e&&!Pu())throw new Error(`Accessing '${t}' before page was loaded`);if(!(e instanceof HTMLCanvasElement))throw new Error("Object is not a canvas element");return e}function PC(t){const{width:e,height:n}=t,i=document.createElement("canvas");return i.id="lumagl-auto-created-canvas",i.width=e||1,i.height=n||1,i.style.width=Number.isFinite(e)?`${e}px`:"100%",i.style.height=Number.isFinite(n)?`${n}px`:"100%",i}function MC(t,e,n,i,r){const s=t,o=Jm(s[0],e,n);let a=Gm(s[1],e,i,r),l=Jm(s[0]+1,e,n);const c=l===n-1?l:l-1;l=Gm(s[1]+1,e,i,r);let u;return r?(l=l===0?l:l+1,u=a,a=l):u=l===i-1?l:l-1,{x:o,y:a,width:Math.max(c-o+1,1),height:Math.max(u-a+1,1)}}function Jm(t,e,n){return Math.min(Math.round(t*e),n-1)}function Gm(t,e,n,i){return i?Math.max(0,n-1-Math.round(t*e)):Math.min(Math.round(t*e),n-1)}const dn=class dn extends se{constructor(n,i,r=dn.defaultProps){super(n,i,r);m(this,"dimension");m(this,"format");m(this,"width");m(this,"height");m(this,"depth");m(this,"updateTimestamp");this.dimension=this.props.dimension,this.format=this.props.format,this.width=this.props.width,this.height=this.props.height,this.depth=this.props.depth,this.updateTimestamp=n.incrementTimestamp()}get[Symbol.toStringTag](){return"Texture"}};m(dn,"defaultProps",{...se.defaultProps,data:null,dimension:"2d",format:"rgba8unorm",width:void 0,height:void 0,depth:1,mipmaps:!0,compressed:!1,usage:0,mipLevels:void 0,samples:void 0,type:void 0,sampler:{},view:void 0}),m(dn,"COPY_SRC",1),m(dn,"COPY_DST",2),m(dn,"TEXTURE_BINDING",4),m(dn,"STORAGE_BINDING",8),m(dn,"RENDER_ATTACHMENT",16);let Et=dn;const Bc=class Bc extends se{get[Symbol.toStringTag](){return"TextureView"}constructor(e,n){super(e,n,Bc.defaultProps)}};m(Bc,"defaultProps",{...se.defaultProps,format:void 0,dimension:void 0,aspect:"all",baseMipLevel:0,mipLevelCount:void 0,baseArrayLayer:0,arrayLayerCount:void 0});let _c=Bc;function IC(t,e,n){let i="";const r=e.split(/\r?\n/),s=t.slice().sort((o,a)=>o.lineNum-a.lineNum);switch((n==null?void 0:n.showSourceCode)||"no"){case"all":let o=0;for(let a=1;a<=r.length;a++)for(i+=hw(r[a-1],a,n);s.length>o&&s[o].lineNum===a;){const l=s[o++];i+=e0(l,r,l.lineNum,{...n,inlineSource:!1})}return i;case"issues":case"no":for(const a of t)i+=e0(a,r,a.lineNum,{inlineSource:(n==null?void 0:n.showSourceCode)!=="no"});return i}}function e0(t,e,n,i){if(i!=null&&i.inlineSource){const r=OC(e,n),s=t.linePos>0?`${" ".repeat(t.linePos+5)}^^^
`:"";return`
${r}${s}${t.type.toUpperCase()}: ${t.message}

`}return i!=null&&i.html?`<div class='luma-compiler-log-error' style="color:red;"><b> ${t.type.toUpperCase()}: ${t.message}</b></div>`:`${t.type.toUpperCase()}: ${t.message}`}function OC(t,e,n){let i="";for(let r=e-2;r<=e;r++){const s=t[r-1];s!==void 0&&(i+=hw(s,e,n))}return i}function hw(t,e,n){const i=n!=null&&n.html?kC(t):t;return`${NC(String(e),4)}: ${i}${n!=null&&n.html?"<br/>":`
`}`}function NC(t,e){let n="";for(let i=t.length;i<e;++i)n+=" ";return n+t}function kC(t){return t.replaceAll("&","&amp;").replaceAll("<","&lt;").replaceAll(">","&gt;").replaceAll('"',"&quot;").replaceAll("'","&#039;")}function fw(t,e){return{name:FC(t,e),language:"glsl",version:DC(t)}}function FC(t,e="unnamed"){const i=/#define[\s*]SHADER_NAME[\s*]([A-Za-z0-9_-]+)[\s*]/.exec(t);return i?i[1]:e}function DC(t){let e=100;const n=t.match(/[^\s]+/g);if(n&&n.length>=2&&n[0]==="#version"){const i=parseInt(n[1],10);Number.isFinite(i)&&(e=i)}return e}const Uc=class Uc extends se{constructor(n,i){super(n,{id:BC(i),...i},Uc.defaultProps);m(this,"stage");m(this,"source");m(this,"compilationStatus","pending");this.stage=this.props.stage,this.source=this.props.source}get[Symbol.toStringTag](){return"Shader"}getCompilationInfoSync(){return null}getTranslatedSource(){return null}async debugShader(n=this.props.debug){switch(n){case"never":return;case"errors":if(this.compilationStatus==="success")return;break}const i=await this.getCompilationInfo();this.props.debug==="warnings"&&(i==null?void 0:i.length)===0||this._displayShaderLog(i)}_displayShaderLog(n){var c;if(typeof document>"u"||!(document!=null&&document.createElement))return;const i=fw(this.source).name,r=`${this.stage} ${i}`;let s=IC(n,this.source,{showSourceCode:"all",html:!0});const o=this.getTranslatedSource();o&&(s+=`<br /><br /><h1>Translated Source</h1><br /><br /><code style="user-select:text;"><pre>${o}</pre></code>`);const a=document.createElement("Button");a.innerHTML=`
<h1>Shader Compilation Error in ${r}</h1><br /><br />
<code style="user-select:text;"><pre>
${s}
</pre></code>`,a.style.top="10px",a.style.left="10px",a.style.position="absolute",a.style.zIndex="9999",a.style.width="100%",a.style.textAlign="left",document.body.appendChild(a);const l=document.getElementsByClassName("luma-compiler-log-error");(c=l[0])!=null&&c.scrollIntoView&&l[0].scrollIntoView(),a.onclick=()=>{const u=`data:text/plain,${encodeURIComponent(this.source)}`;navigator.clipboard.writeText(u)}}};m(Uc,"defaultProps",{...se.defaultProps,language:"auto",stage:void 0,source:"",sourceMap:null,entryPoint:"main",debug:"errors"});let mc=Uc;function BC(t){return fw(t.source).name||t.id||Qi(`unnamed ${t.stage}-shader`)}const Lc=class Lc extends se{get[Symbol.toStringTag](){return"Sampler"}constructor(e,n){super(e,n,Lc.defaultProps)}};m(Lc,"defaultProps",{...se.defaultProps,type:"color-sampler",addressModeU:"clamp-to-edge",addressModeV:"clamp-to-edge",addressModeW:"clamp-to-edge",magFilter:"nearest",minFilter:"nearest",mipmapFilter:"nearest",lodMinClamp:0,lodMaxClamp:32,compare:"less-equal",maxAnisotropy:1});let yc=Lc;const zc=class zc extends se{constructor(n,i={}){super(n,i,zc.defaultProps);m(this,"width");m(this,"height");m(this,"colorAttachments",[]);m(this,"depthStencilAttachment",null);this.width=this.props.width,this.height=this.props.height}get[Symbol.toStringTag](){return"Framebuffer"}resize(n){let i=!n;if(n){const[r,s]=Array.isArray(n)?n:[n.width,n.height];i=i||s!==this.height||r!==this.width,this.width=r,this.height=s}i&&(U.log(2,`Resizing framebuffer ${this.id} to ${this.width}x${this.height}`)(),this.resizeAttachments(this.width,this.height))}autoCreateAttachmentTextures(){if(this.props.colorAttachments.length===0&&!this.props.depthStencilAttachment)throw new Error("Framebuffer has noattachments");this.colorAttachments=this.props.colorAttachments.map(i=>{if(typeof i=="string"){const r=this.createColorTexture(i);return this.attachResource(r),r.view}return i instanceof Et?i.view:i});const n=this.props.depthStencilAttachment;if(n)if(typeof n=="string"){const i=this.createDepthStencilTexture(n);this.attachResource(i),this.depthStencilAttachment=i.view}else n instanceof Et?this.depthStencilAttachment=n.view:this.depthStencilAttachment=n}createColorTexture(n){return this.device.createTexture({id:"color-attachment",usage:Et.RENDER_ATTACHMENT,format:n,width:this.width,height:this.height})}createDepthStencilTexture(n){return this.device.createTexture({id:"depth-stencil-attachment",usage:Et.RENDER_ATTACHMENT,format:n,width:this.width,height:this.height})}resizeAttachments(n,i){for(let r=0;r<this.colorAttachments.length;++r)if(this.colorAttachments[r]){const s=this.device._createTexture({...this.colorAttachments[r].props,width:n,height:i});this.destroyAttachedResource(this.colorAttachments[r]),this.colorAttachments[r]=s.view,this.attachResource(s.view)}if(this.depthStencilAttachment){const r=this.device._createTexture({...this.depthStencilAttachment.props,width:n,height:i});this.destroyAttachedResource(this.depthStencilAttachment),this.depthStencilAttachment=r.view,this.attachResource(r)}}};m(zc,"defaultProps",{...se.defaultProps,width:1,height:1,colorAttachments:[],depthStencilAttachment:null});let vc=zc;const Vc=class Vc extends se{constructor(n,i){super(n,i,Vc.defaultProps);m(this,"shaderLayout");m(this,"bufferLayout");m(this,"linkStatus","pending");m(this,"hash","");this.shaderLayout=this.props.shaderLayout,this.bufferLayout=this.props.bufferLayout||[]}get[Symbol.toStringTag](){return"RenderPipeline"}setUniformsWebGL(n){throw new Error("Use uniform blocks")}};m(Vc,"defaultProps",{...se.defaultProps,vs:null,vertexEntryPoint:"vertexMain",vsConstants:{},fs:null,fragmentEntryPoint:"fragmentMain",fsConstants:{},shaderLayout:null,bufferLayout:[],topology:"triangle-list",parameters:{},vertexCount:0,instanceCount:0,bindings:{},uniforms:{}});let ts=Vc;const jc=class jc extends se{get[Symbol.toStringTag](){return"RenderPass"}constructor(e,n){super(e,n,jc.defaultProps)}};m(jc,"defaultProps",{...se.defaultProps,framebuffer:null,parameters:void 0,clearColor:[0,0,0,0],clearDepth:1,clearStencil:0,depthReadOnly:!1,stencilReadOnly:!1,discard:!1,occlusionQuerySet:void 0,timestampQuerySet:void 0,beginTimestampIndex:void 0,endTimestampIndex:void 0});let yd=jc;const Wc=class Wc extends se{constructor(n,i){super(n,i,Wc.defaultProps);m(this,"hash","")}get[Symbol.toStringTag](){return"ComputePipeline"}};m(Wc,"defaultProps",{...se.defaultProps,shader:void 0,entryPoint:void 0,constants:{},shaderLayout:void 0});let Tc=Wc;const Hc=class Hc extends se{get[Symbol.toStringTag](){return"CommandEncoder"}constructor(e,n){super(e,n,Hc.defaultProps)}};m(Hc,"defaultProps",{...se.defaultProps,measureExecutionTime:void 0});let vd=Hc;const $c=class $c extends se{get[Symbol.toStringTag](){return"CommandBuffer"}constructor(e,n){super(e,n,$c.defaultProps)}};m($c,"defaultProps",{...se.defaultProps});let Td=$c;function UC(t){const[e,n]=zC[t],i=e==="i32"||e==="u32",r=e!=="u32",s=VC[e]*n,o=LC(e,n);return{dataType:e,components:n,defaultVertexFormat:o,byteLength:s,integer:i,signed:r}}function LC(t,e){let n;switch(t){case"f32":n="float32";break;case"i32":n="sint32";break;case"u32":n="uint32";break;case"f16":return e<=2?"float16x2":"float16x4"}return e===1?n:`${n}x${e}`}const zC={f32:["f32",1],"vec2<f32>":["f32",2],"vec3<f32>":["f32",3],"vec4<f32>":["f32",4],f16:["f16",1],"vec2<f16>":["f16",2],"vec3<f16>":["f16",3],"vec4<f16>":["f16",4],i32:["i32",1],"vec2<i32>":["i32",2],"vec3<i32>":["i32",3],"vec4<i32>":["i32",4],u32:["u32",1],"vec2<u32>":["u32",2],"vec3<u32>":["u32",3],"vec4<u32>":["u32",4]},VC={f32:4,f16:2,i32:4,u32:4};function dw(t){let e;t.endsWith("-webgl")&&(t.replace("-webgl",""),e=!0);const[n,i]=t.split("x"),r=n,s=i?parseInt(i):1,o=cw(r),a={type:r,components:s,byteLength:o.byteLength*s,integer:o.integer,signed:o.signed,normalized:o.normalized};return e&&(a.webglOnly=!0),a}function pw(t,e){const n={};for(const i of t.attributes)n[i.name]=WC(t,e,i.name);return n}function jC(t,e,n=16){const i=pw(t,e),r=new Array(n).fill(null);for(const s of Object.values(i))r[s.location]=s;return r}function WC(t,e,n){const i=HC(t,n),r=$C(e,n);if(!i)return null;const s=UC(i.type),o=(r==null?void 0:r.vertexFormat)||s.defaultVertexFormat,a=dw(o);return{attributeName:(r==null?void 0:r.attributeName)||i.name,bufferName:(r==null?void 0:r.bufferName)||i.name,location:i.location,shaderType:i.type,shaderDataType:s.dataType,shaderComponents:s.components,vertexFormat:o,bufferDataType:a.type,bufferComponents:a.components,normalized:a.normalized,integer:s.integer,stepMode:(r==null?void 0:r.stepMode)||i.stepMode,byteOffset:(r==null?void 0:r.byteOffset)||0,byteStride:(r==null?void 0:r.byteStride)||0}}function HC(t,e){const n=t.attributes.find(i=>i.name===e);return n||U.warn(`shader layout attribute "${e}" not present in shader`),n||null}function $C(t,e){XC(t);let n=YC(t,e);return n||(n=KC(t,e),n)?n:(U.warn(`layout for attribute "${e}" not present in buffer layout`),null)}function XC(t){for(const e of t)(e.attributes&&e.format||!e.attributes&&!e.format)&&U.warn(`BufferLayout ${name} must have either 'attributes' or 'format' field`)}function YC(t,e){for(const n of t)if(n.format&&n.name===e)return{attributeName:n.name,bufferName:e,stepMode:n.stepMode,vertexFormat:n.format,byteOffset:0,byteStride:n.byteStride||0};return null}function KC(t,e){var n;for(const i of t){let r=i.byteStride;if(typeof i.byteStride!="number")for(const o of i.attributes||[]){const a=dw(o.format);r+=a.byteLength}const s=(n=i.attributes)==null?void 0:n.find(o=>o.attribute===e);if(s)return{attributeName:s.attribute,bufferName:i.name,stepMode:i.stepMode,vertexFormat:s.format,byteOffset:s.byteOffset,byteStride:r}}return null}function qC(t,e){const n={...t,attributes:t.attributes.map(i=>({...i}))};for(const i of(e==null?void 0:e.attributes)||[]){const r=n.attributes.find(s=>s.name===i.name);r?(r.type=i.type||r.type,r.stepMode=i.stepMode||r.stepMode):U.warn(`shader layout attribute ${i.name} not present in shader`)}return n}const Xc=class Xc extends se{constructor(n,i){super(n,i,Xc.defaultProps);m(this,"maxVertexAttributes");m(this,"attributeInfos");m(this,"indexBuffer",null);m(this,"attributes");this.maxVertexAttributes=n.limits.maxVertexAttributes,this.attributes=new Array(this.maxVertexAttributes).fill(null),this.attributeInfos=jC(i.renderPipeline.shaderLayout,i.renderPipeline.bufferLayout,this.maxVertexAttributes)}get[Symbol.toStringTag](){return"VertexArray"}setConstantWebGL(n,i){throw new Error("constant attributes not supported")}};m(Xc,"defaultProps",{...se.defaultProps,renderPipeline:null});let wd=Xc;const Yc=class Yc extends se{get[Symbol.toStringTag](){return"TransformFeedback"}constructor(e,n){super(e,n,Yc.defaultProps)}};m(Yc,"defaultProps",{...se.defaultProps,layout:void 0,buffers:{}});let Ed=Yc;const Kc=class Kc extends se{get[Symbol.toStringTag](){return"QuerySet"}constructor(e,n){super(e,n,Kc.defaultProps)}};m(Kc,"defaultProps",{...se.defaultProps,type:void 0,count:void 0});let Sd=Kc;const ZC={f32:{type:"f32",components:1},i32:{type:"i32",components:1},u32:{type:"u32",components:1},"vec2<f32>":{type:"f32",components:2},"vec3<f32>":{type:"f32",components:3},"vec4<f32>":{type:"f32",components:4},"vec2<i32>":{type:"i32",components:2},"vec3<i32>":{type:"i32",components:3},"vec4<i32>":{type:"i32",components:4},"vec2<u32>":{type:"u32",components:2},"vec3<u32>":{type:"u32",components:3},"vec4<u32>":{type:"u32",components:4},"mat2x2<f32>":{type:"f32",components:4},"mat2x3<f32>":{type:"f32",components:6},"mat2x4<f32>":{type:"f32",components:8},"mat3x2<f32>":{type:"f32",components:6},"mat3x3<f32>":{type:"f32",components:9},"mat3x4<f32>":{type:"f32",components:12},"mat4x2<f32>":{type:"f32",components:8},"mat4x3<f32>":{type:"f32",components:12},"mat4x4<f32>":{type:"f32",components:16}};function QC(t){const e=ZC[t];return le(t),e}function JC(t,e){switch(e){case 1:return t;case 2:return t+t%2;default:return t+(4-t%4)%4}}let za;function gw(t){return(!za||za.byteLength<t)&&(za=new ArrayBuffer(t)),za}function GC(t,e){const n=gw(t.BYTES_PER_ELEMENT*e);return new t(n,0,e)}function eP(t){const{target:e,source:n,start:i=0,count:r=1}=t,s=n.length,o=r*s;let a=0;for(let l=i;a<s;a++)e[l++]=n[a];for(;a<o;)a<o-a?(e.copyWithin(i+a,i,i+a),a*=2):(e.copyWithin(i+a,i,i+o-a),a=o);return t.target}const t0=1024;class tP{constructor(e){m(this,"layout",{});m(this,"byteLength");let n=0;for(const[r,s]of Object.entries(e)){const o=QC(s),{type:a,components:l}=o;n=JC(n,l);const c=n;n+=l,this.layout[r]={type:a,size:l,offset:c}}n+=(4-n%4)%4;const i=n*4;this.byteLength=Math.max(i,t0)}getData(e){const n=Math.max(this.byteLength,t0),i=gw(n),r={i32:new Int32Array(i),u32:new Uint32Array(i),f32:new Float32Array(i),f16:new Uint16Array(i)};for(const[s,o]of Object.entries(e)){const a=this.layout[s];if(!a){U.warn(`Supplied uniform value ${s} not present in uniform block layout`)();continue}const{type:l,size:c,offset:u}=a,h=r[l];if(c===1){if(typeof o!="number"&&typeof o!="boolean"){U.warn(`Supplied value for single component uniform ${s} is not a number: ${o}`)();continue}h[u]=Number(o)}else{const f=Bo(o);if(!f){U.warn(`Supplied value for multi component / array uniform ${s} is not a numeric array: ${o}`)();continue}h.set(f,u)}}return new Uint8Array(i)}has(e){return!!this.layout[e]}get(e){return this.layout[e]}}function nP(t,e,n=16){if(t!==e)return!1;const i=Bo(t);if(!i)return!1;const r=Bo(e);if(r&&i.length===r.length){for(let s=0;s<i.length;++s)if(r[s]!==i[s])return!1}return!0}function iP(t){const e=Bo(t);return e?e.slice():t}class rP{constructor(e){m(this,"name");m(this,"uniforms",{});m(this,"modifiedUniforms",{});m(this,"modified",!0);m(this,"bindingLayout",{});m(this,"needsRedraw","initialized");var n;if(this.name=e==null?void 0:e.name,e!=null&&e.name&&(e!=null&&e.shaderLayout)){const i=(n=e==null?void 0:e.shaderLayout.bindings)==null?void 0:n.find(s=>s.type==="uniform"&&s.name===(e==null?void 0:e.name));if(!i)throw new Error(e==null?void 0:e.name);const r=i;for(const s of r.uniforms||[])this.bindingLayout[s.name]=s}}setUniforms(e){for(const[n,i]of Object.entries(e))this._setUniform(n,i),this.needsRedraw||this.setNeedsRedraw(`${this.name}.${n}=${i}`)}setNeedsRedraw(e){this.needsRedraw=this.needsRedraw||e}getAllUniforms(){return this.modifiedUniforms={},this.needsRedraw=!1,this.uniforms||{}}_setUniform(e,n){nP(this.uniforms[e],n)||(this.uniforms[e]=iP(n),this.modifiedUniforms[e]=!0,this.modified=!0)}}class sP{constructor(e){m(this,"uniformBlocks",new Map);m(this,"uniformBufferLayouts",new Map);m(this,"uniformBuffers",new Map);for(const[n,i]of Object.entries(e)){const r=n,s=new tP(i.uniformTypes||{});this.uniformBufferLayouts.set(r,s);const o=new rP({name:n});o.setUniforms(i.defaultUniforms||{}),this.uniformBlocks.set(r,o)}}destroy(){for(const e of this.uniformBuffers.values())e.destroy()}setUniforms(e){for(const[n,i]of Object.entries(e))this.uniformBlocks.get(n).setUniforms(i);this.updateUniformBuffers()}getUniformBufferByteLength(e){return this.uniformBufferLayouts.get(e).byteLength}getUniformBufferData(e){const n=this.uniformBlocks.get(e).getAllUniforms();return this.uniformBufferLayouts.get(e).getData(n)}createUniformBuffer(e,n,i){i&&this.setUniforms(i);const r=this.getUniformBufferByteLength(n),s=e.createBuffer({usage:de.UNIFORM|de.COPY_DST,byteLength:r}),o=this.getUniformBufferData(n);return s.write(o),s}getManagedUniformBuffer(e,n){if(!this.uniformBuffers.get(n)){const i=this.getUniformBufferByteLength(n),r=e.createBuffer({usage:de.UNIFORM|de.COPY_DST,byteLength:i});this.uniformBuffers.set(n,r)}return this.uniformBuffers.get(n)}updateUniformBuffers(){let e=!1;for(const n of this.uniformBlocks.keys()){const i=this.updateUniformBuffer(n);e||(e=i)}return e&&U.log(3,`UniformStore.updateUniformBuffers(): ${e}`)(),e}updateUniformBuffer(e){const n=this.uniformBlocks.get(e),i=this.uniformBuffers.get(e);let r=!1;if(i&&n.needsRedraw){r||(r=n.needsRedraw);const s=this.getUniformBufferData(e);this.uniformBuffers.get(e).write(s);const a=this.uniformBlocks.get(e).getAllUniforms();U.log(4,`Writing to uniform buffer ${String(e)}`,s,a)()}return r}}function _w(t){const e=ArrayBuffer.isView(t)?t.constructor:t;switch(e){case Float32Array:return"float32";case Uint16Array:return"uint16";case Uint32Array:return"uint32";case Uint8Array:case Uint8ClampedArray:return"uint8";case Int8Array:return"sint8";case Int16Array:return"sint16";case Int32Array:return"sint32";default:throw new Error(e.constructor.name)}}function mw(t){switch(t){case"float32":return Float32Array;case"uint32":return Uint32Array;case"sint32":return Int32Array;case"uint16":case"unorm16":return Uint16Array;case"sint16":case"snorm16":return Int16Array;case"uint8":case"unorm8":return Uint8Array;case"sint8":case"snorm8":return Int8Array;default:throw new Error(t)}}function oP(t,e,n){if(!e||e>4)throw new Error(`size ${e}`);const i=e;let r=_w(t);if(r==="uint8"||r==="sint8"){if(i===1||i===3)throw new Error(`size: ${e}`);return n&&(r=r.replace("int","norm")),`${r}x${i}`}if(r==="uint16"||r==="sint16"){if(i===1||i===3)throw new Error(`size: ${e}`);return n&&(r=r.replace("int","norm")),`${r}x${i}`}return i===1?r:`${r}x${i}`}function aP(t){return Bo(t)!==null||typeof t=="number"||typeof t=="boolean"}function yw(t){const e={bindings:{},uniforms:{}};return Object.keys(t).forEach(n=>{const i=t[n];aP(i)?e.uniforms[n]=i:e.bindings[n]=i}),e}function lP(t,e,n){const{removedProps:i={},deprecatedProps:r={},replacedProps:s={}}=n;for(const a in i)if(a in e){const c=i[a]?`${t}.${i[a]}`:"N/A";U.removed(`${t}.${a}`,c)()}for(const a in r)if(a in e){const l=r[a];U.deprecated(`${t}.${a}`,`${t}.${l}`)()}let o=null;for(const[a,l]of Object.entries(s))a in e&&(U.deprecated(`${t}.${a}`,`${t}.${l}`)(),o=o||Object.assign({},e),o[l]=e[a],delete o[a]);return o||e}let cP="";async function uP(t,e){return await new Promise((n,i)=>{try{const r=new Image;r.onload=()=>n(r),r.onerror=()=>i(new Error(`Could not load image ${t}.`)),r.crossOrigin=(e==null?void 0:e.crossOrigin)||"anonymous",r.src=t.startsWith("http")?t:cP+t}catch(r){i(r)}})}async function vw(t,e){const n=document.getElementsByTagName("head")[0];if(!n)throw new Error("loadScript");const i=document.createElement("script");return i.setAttribute("type","text/javascript"),i.setAttribute("src",t),e&&(i.id=e),new Promise((r,s)=>{i.onload=r,i.onerror=o=>s(new Error(`Unable to load script '${t}': ${o}`)),n.appendChild(i)})}function Ad(t,e,n){if(t===e)return!0;if(!n||!t||!e)return!1;if(Array.isArray(t)){if(!Array.isArray(e)||t.length!==e.length)return!1;for(let i=0;i<t.length;i++)if(!Ad(t[i],e[i],n-1))return!1;return!0}if(Array.isArray(e))return!1;if(typeof t=="object"&&typeof e=="object"){const i=Object.keys(t),r=Object.keys(e);if(i.length!==r.length)return!1;for(const s of i)if(!e.hasOwnProperty(s)||!Ad(t[s],e[s],n-1))return!1;return!0}return!1}function hP(t){return typeof window<"u"&&window.requestAnimationFrame?window.requestAnimationFrame(t):setTimeout(t,1e3/60)}function fP(t){return typeof window<"u"&&window.cancelAnimationFrame?window.cancelAnimationFrame(t):clearTimeout(t)}class dP{constructor(){this.constants=new Map,this.aliases=new Map,this.structs=new Map}}let Ji=class{constructor(){}get isAstNode(){return!0}get astNodeType(){return""}evaluate(e){throw new Error("Cannot evaluate node")}evaluateString(e){return this.evaluate(e).toString()}};class Ee extends Ji{constructor(){super()}}class Tw extends Ee{constructor(e,n,i,r){super(),this.name=e,this.args=n,this.returnType=i,this.body=r}get astNodeType(){return"function"}}class pP extends Ee{constructor(e){super(),this.expression=e}get astNodeType(){return"staticAssert"}}class gP extends Ee{constructor(e,n){super(),this.condition=e,this.body=n}get astNodeType(){return"while"}}class _P extends Ee{constructor(e){super(),this.body=e}get astNodeType(){return"continuing"}}class mP extends Ee{constructor(e,n,i,r){super(),this.init=e,this.condition=n,this.increment=i,this.body=r}get astNodeType(){return"for"}}class br extends Ee{constructor(e,n,i,r,s){super(),this.name=e,this.type=n,this.storage=i,this.access=r,this.value=s}get astNodeType(){return"var"}}class ww extends Ee{constructor(e,n,i){super(),this.name=e,this.type=n,this.value=i}get astNodeType(){return"override"}}class n0 extends Ee{constructor(e,n,i,r,s){super(),this.name=e,this.type=n,this.storage=i,this.access=r,this.value=s}get astNodeType(){return"let"}}class i0 extends Ee{constructor(e,n,i,r,s){super(),this.name=e,this.type=n,this.storage=i,this.access=r,this.value=s}get astNodeType(){return"const"}evaluate(e){return this.value.evaluate(e)}}var ns;(function(t){t.increment="++",t.decrement="--"})(ns||(ns={}));(function(t){function e(n){const i=n;if(i=="parse")throw new Error("Invalid value for IncrementOperator");return t[i]}t.parse=e})(ns||(ns={}));class yP extends Ee{constructor(e,n){super(),this.operator=e,this.variable=n}get astNodeType(){return"increment"}}var Uo;(function(t){t.assign="=",t.addAssign="+=",t.subtractAssin="-=",t.multiplyAssign="*=",t.divideAssign="/=",t.moduloAssign="%=",t.andAssign="&=",t.orAssign="|=",t.xorAssign="^=",t.shiftLeftAssign="<<=",t.shiftRightAssign=">>="})(Uo||(Uo={}));(function(t){function e(n){const i=n;if(i=="parse")throw new Error("Invalid value for AssignOperator");return t[i]}t.parse=e})(Uo||(Uo={}));class vP extends Ee{constructor(e,n,i){super(),this.operator=e,this.variable=n,this.value=i}get astNodeType(){return"assign"}}class TP extends Ee{constructor(e,n){super(),this.name=e,this.args=n}get astNodeType(){return"call"}}class wP extends Ee{constructor(e,n){super(),this.body=e,this.continuing=n}get astNodeType(){return"loop"}}class EP extends Ee{constructor(e,n){super(),this.condition=e,this.body=n}get astNodeType(){return"body"}}class SP extends Ee{constructor(e,n,i,r){super(),this.condition=e,this.body=n,this.elseif=i,this.else=r}get astNodeType(){return"if"}}class AP extends Ee{constructor(e){super(),this.value=e}get astNodeType(){return"return"}}class xP extends Ee{constructor(e){super(),this.name=e}get astNodeType(){return"enable"}}class Ew extends Ee{constructor(e,n){super(),this.name=e,this.type=n}get astNodeType(){return"alias"}}class RP extends Ee{constructor(){super()}get astNodeType(){return"discard"}}class bP extends Ee{constructor(){super()}get astNodeType(){return"break"}}class CP extends Ee{constructor(){super()}get astNodeType(){return"continue"}}class Gi extends Ee{constructor(e){super(),this.name=e}get astNodeType(){return"type"}get isStruct(){return!1}get isArray(){return!1}}class Ti extends Gi{constructor(e,n){super(e),this.members=n}get astNodeType(){return"struct"}get isStruct(){return!0}getMemberIndex(e){for(let n=0;n<this.members.length;n++)if(this.members[n].name==e)return n;return-1}}class Sw extends Gi{constructor(e,n,i){super(e),this.format=n,this.access=i}get astNodeType(){return"template"}}class PP extends Gi{constructor(e,n,i,r){super(e),this.storage=n,this.type=i,this.access=r}get astNodeType(){return"pointer"}}class Aw extends Gi{constructor(e,n,i,r){super(e),this.attributes=n,this.format=i,this.count=r}get astNodeType(){return"array"}get isArray(){return!0}}class Ys extends Gi{constructor(e,n,i){super(e),this.format=n,this.access=i}get astNodeType(){return"sampler"}}class sn extends Ji{constructor(){super()}}class r0 extends sn{constructor(e){super(),this.value=e}get astNodeType(){return"stringExpr"}toString(){return this.value}evaluateString(){return this.value}}class Ks extends sn{constructor(e,n){super(),this.type=e,this.args=n}get astNodeType(){return"createExpr"}}class MP extends sn{constructor(e,n){super(),this.name=e,this.args=n}get astNodeType(){return"callExpr"}evaluate(e){switch(this.name){case"abs":return Math.abs(this.args[0].evaluate(e));case"acos":return Math.acos(this.args[0].evaluate(e));case"acosh":return Math.acosh(this.args[0].evaluate(e));case"asin":return Math.asin(this.args[0].evaluate(e));case"asinh":return Math.asinh(this.args[0].evaluate(e));case"atan":return Math.atan(this.args[0].evaluate(e));case"atan2":return Math.atan2(this.args[0].evaluate(e),this.args[1].evaluate(e));case"atanh":return Math.atanh(this.args[0].evaluate(e));case"ceil":return Math.ceil(this.args[0].evaluate(e));case"clamp":return Math.min(Math.max(this.args[0].evaluate(e),this.args[1].evaluate(e)),this.args[2].evaluate(e));case"cos":return Math.cos(this.args[0].evaluate(e));case"degrees":return this.args[0].evaluate(e)*180/Math.PI;case"distance":return Math.sqrt(Math.pow(this.args[0].evaluate(e)-this.args[1].evaluate(e),2));case"dot":case"exp":return Math.exp(this.args[0].evaluate(e));case"exp2":return Math.pow(2,this.args[0].evaluate(e));case"floor":return Math.floor(this.args[0].evaluate(e));case"fma":return this.args[0].evaluate(e)*this.args[1].evaluate(e)+this.args[2].evaluate(e);case"fract":return this.args[0].evaluate(e)-Math.floor(this.args[0].evaluate(e));case"inverseSqrt":return 1/Math.sqrt(this.args[0].evaluate(e));case"log":return Math.log(this.args[0].evaluate(e));case"log2":return Math.log2(this.args[0].evaluate(e));case"max":return Math.max(this.args[0].evaluate(e),this.args[1].evaluate(e));case"min":return Math.min(this.args[0].evaluate(e),this.args[1].evaluate(e));case"mix":return this.args[0].evaluate(e)*(1-this.args[2].evaluate(e))+this.args[1].evaluate(e)*this.args[2].evaluate(e);case"modf":return this.args[0].evaluate(e)-Math.floor(this.args[0].evaluate(e));case"pow":return Math.pow(this.args[0].evaluate(e),this.args[1].evaluate(e));case"radians":return this.args[0].evaluate(e)*Math.PI/180;case"round":return Math.round(this.args[0].evaluate(e));case"sign":return Math.sign(this.args[0].evaluate(e));case"sin":return Math.sin(this.args[0].evaluate(e));case"sinh":return Math.sinh(this.args[0].evaluate(e));case"saturate":return Math.min(Math.max(this.args[0].evaluate(e),0),1);case"smoothstep":return this.args[0].evaluate(e)*this.args[0].evaluate(e)*(3-2*this.args[0].evaluate(e));case"sqrt":return Math.sqrt(this.args[0].evaluate(e));case"step":return this.args[0].evaluate(e)<this.args[1].evaluate(e)?0:1;case"tan":return Math.tan(this.args[0].evaluate(e));case"tanh":return Math.tanh(this.args[0].evaluate(e));case"trunc":return Math.trunc(this.args[0].evaluate(e));default:throw new Error("Non const function: "+this.name)}}}class IP extends sn{constructor(e){super(),this.name=e}get astNodeType(){return"varExpr"}}class s0 extends sn{constructor(e,n){super(),this.name=e,this.initializer=n}get astNodeType(){return"constExpr"}evaluate(e){var n,i;if(this.initializer instanceof Ks){const r=(n=this.postfix)===null||n===void 0?void 0:n.evaluateString(e),s=(i=this.initializer.type)===null||i===void 0?void 0:i.name,o=e.structs.get(s),a=o==null?void 0:o.getMemberIndex(r);if(a!=-1)return this.initializer.args[a].evaluate(e);console.log(a)}return this.initializer.evaluate(e)}}class o0 extends sn{constructor(e){super(),this.value=e}get astNodeType(){return"literalExpr"}evaluate(){return this.value}}class OP extends sn{constructor(e,n){super(),this.type=e,this.value=n}get astNodeType(){return"bitcastExpr"}}class NP extends sn{constructor(e,n){super(),this.type=e,this.args=n}get astNodeType(){return"typecastExpr"}evaluate(e){return this.args[0].evaluate(e)}}class a0 extends sn{constructor(e){super(),this.contents=e}get astNodeType(){return"groupExpr"}evaluate(e){return this.contents[0].evaluate(e)}}class xw extends sn{constructor(){super()}}class kP extends xw{constructor(e,n){super(),this.operator=e,this.right=n}get astNodeType(){return"unaryOp"}evaluate(e){switch(this.operator){case"+":return this.right.evaluate(e);case"-":return-this.right.evaluate(e);case"!":return this.right.evaluate(e)?0:1;case"~":return~this.right.evaluate(e);default:throw new Error("Unknown unary operator: "+this.operator)}}}class Xt extends xw{constructor(e,n,i){super(),this.operator=e,this.left=n,this.right=i}get astNodeType(){return"binaryOp"}evaluate(e){switch(this.operator){case"+":return this.left.evaluate(e)+this.right.evaluate(e);case"-":return this.left.evaluate(e)-this.right.evaluate(e);case"*":return this.left.evaluate(e)*this.right.evaluate(e);case"/":return this.left.evaluate(e)/this.right.evaluate(e);case"%":return this.left.evaluate(e)%this.right.evaluate(e);case"==":return this.left.evaluate(e)==this.right.evaluate(e)?1:0;case"!=":return this.left.evaluate(e)!=this.right.evaluate(e)?1:0;case"<":return this.left.evaluate(e)<this.right.evaluate(e)?1:0;case">":return this.left.evaluate(e)>this.right.evaluate(e)?1:0;case"<=":return this.left.evaluate(e)<=this.right.evaluate(e)?1:0;case">=":return this.left.evaluate(e)>=this.right.evaluate(e)?1:0;case"&&":return this.left.evaluate(e)&&this.right.evaluate(e)?1:0;case"||":return this.left.evaluate(e)||this.right.evaluate(e)?1:0;default:throw new Error(`Unknown operator ${this.operator}`)}}}class Rw extends Ji{constructor(){super()}}class FP extends Rw{constructor(e,n){super(),this.selector=e,this.body=n}get astNodeType(){return"case"}}class DP extends Rw{constructor(e){super(),this.body=e}get astNodeType(){return"default"}}class BP extends Ji{constructor(e,n,i){super(),this.name=e,this.type=n,this.attributes=i}get astNodeType(){return"argument"}}class UP extends Ji{constructor(e,n){super(),this.condition=e,this.body=n}get astNodeType(){return"elseif"}}class LP extends Ji{constructor(e,n,i){super(),this.name=e,this.type=n,this.attributes=i}get astNodeType(){return"member"}}let l0=class extends Ji{constructor(e,n){super(),this.name=e,this.value=n}get astNodeType(){return"attribute"}};var N,b;(function(t){t[t.token=0]="token",t[t.keyword=1]="keyword",t[t.reserved=2]="reserved"})(b||(b={}));class C{constructor(e,n,i){this.name=e,this.type=n,this.rule=i}toString(){return this.name}}class S{}N=S;S.none=new C("",b.reserved,"");S.eof=new C("EOF",b.token,"");S.reserved={asm:new C("asm",b.reserved,"asm"),bf16:new C("bf16",b.reserved,"bf16"),do:new C("do",b.reserved,"do"),enum:new C("enum",b.reserved,"enum"),f16:new C("f16",b.reserved,"f16"),f64:new C("f64",b.reserved,"f64"),handle:new C("handle",b.reserved,"handle"),i8:new C("i8",b.reserved,"i8"),i16:new C("i16",b.reserved,"i16"),i64:new C("i64",b.reserved,"i64"),mat:new C("mat",b.reserved,"mat"),premerge:new C("premerge",b.reserved,"premerge"),regardless:new C("regardless",b.reserved,"regardless"),typedef:new C("typedef",b.reserved,"typedef"),u8:new C("u8",b.reserved,"u8"),u16:new C("u16",b.reserved,"u16"),u64:new C("u64",b.reserved,"u64"),unless:new C("unless",b.reserved,"unless"),using:new C("using",b.reserved,"using"),vec:new C("vec",b.reserved,"vec"),void:new C("void",b.reserved,"void")};S.keywords={array:new C("array",b.keyword,"array"),atomic:new C("atomic",b.keyword,"atomic"),bool:new C("bool",b.keyword,"bool"),f32:new C("f32",b.keyword,"f32"),i32:new C("i32",b.keyword,"i32"),mat2x2:new C("mat2x2",b.keyword,"mat2x2"),mat2x3:new C("mat2x3",b.keyword,"mat2x3"),mat2x4:new C("mat2x4",b.keyword,"mat2x4"),mat3x2:new C("mat3x2",b.keyword,"mat3x2"),mat3x3:new C("mat3x3",b.keyword,"mat3x3"),mat3x4:new C("mat3x4",b.keyword,"mat3x4"),mat4x2:new C("mat4x2",b.keyword,"mat4x2"),mat4x3:new C("mat4x3",b.keyword,"mat4x3"),mat4x4:new C("mat4x4",b.keyword,"mat4x4"),ptr:new C("ptr",b.keyword,"ptr"),sampler:new C("sampler",b.keyword,"sampler"),sampler_comparison:new C("sampler_comparison",b.keyword,"sampler_comparison"),struct:new C("struct",b.keyword,"struct"),texture_1d:new C("texture_1d",b.keyword,"texture_1d"),texture_2d:new C("texture_2d",b.keyword,"texture_2d"),texture_2d_array:new C("texture_2d_array",b.keyword,"texture_2d_array"),texture_3d:new C("texture_3d",b.keyword,"texture_3d"),texture_cube:new C("texture_cube",b.keyword,"texture_cube"),texture_cube_array:new C("texture_cube_array",b.keyword,"texture_cube_array"),texture_multisampled_2d:new C("texture_multisampled_2d",b.keyword,"texture_multisampled_2d"),texture_storage_1d:new C("texture_storage_1d",b.keyword,"texture_storage_1d"),texture_storage_2d:new C("texture_storage_2d",b.keyword,"texture_storage_2d"),texture_storage_2d_array:new C("texture_storage_2d_array",b.keyword,"texture_storage_2d_array"),texture_storage_3d:new C("texture_storage_3d",b.keyword,"texture_storage_3d"),texture_depth_2d:new C("texture_depth_2d",b.keyword,"texture_depth_2d"),texture_depth_2d_array:new C("texture_depth_2d_array",b.keyword,"texture_depth_2d_array"),texture_depth_cube:new C("texture_depth_cube",b.keyword,"texture_depth_cube"),texture_depth_cube_array:new C("texture_depth_cube_array",b.keyword,"texture_depth_cube_array"),texture_depth_multisampled_2d:new C("texture_depth_multisampled_2d",b.keyword,"texture_depth_multisampled_2d"),texture_external:new C("texture_external",b.keyword,"texture_external"),u32:new C("u32",b.keyword,"u32"),vec2:new C("vec2",b.keyword,"vec2"),vec3:new C("vec3",b.keyword,"vec3"),vec4:new C("vec4",b.keyword,"vec4"),bitcast:new C("bitcast",b.keyword,"bitcast"),block:new C("block",b.keyword,"block"),break:new C("break",b.keyword,"break"),case:new C("case",b.keyword,"case"),continue:new C("continue",b.keyword,"continue"),continuing:new C("continuing",b.keyword,"continuing"),default:new C("default",b.keyword,"default"),discard:new C("discard",b.keyword,"discard"),else:new C("else",b.keyword,"else"),enable:new C("enable",b.keyword,"enable"),fallthrough:new C("fallthrough",b.keyword,"fallthrough"),false:new C("false",b.keyword,"false"),fn:new C("fn",b.keyword,"fn"),for:new C("for",b.keyword,"for"),function:new C("function",b.keyword,"function"),if:new C("if",b.keyword,"if"),let:new C("let",b.keyword,"let"),const:new C("const",b.keyword,"const"),loop:new C("loop",b.keyword,"loop"),while:new C("while",b.keyword,"while"),private:new C("private",b.keyword,"private"),read:new C("read",b.keyword,"read"),read_write:new C("read_write",b.keyword,"read_write"),return:new C("return",b.keyword,"return"),storage:new C("storage",b.keyword,"storage"),switch:new C("switch",b.keyword,"switch"),true:new C("true",b.keyword,"true"),alias:new C("alias",b.keyword,"alias"),type:new C("type",b.keyword,"type"),uniform:new C("uniform",b.keyword,"uniform"),var:new C("var",b.keyword,"var"),override:new C("override",b.keyword,"override"),workgroup:new C("workgroup",b.keyword,"workgroup"),write:new C("write",b.keyword,"write"),r8unorm:new C("r8unorm",b.keyword,"r8unorm"),r8snorm:new C("r8snorm",b.keyword,"r8snorm"),r8uint:new C("r8uint",b.keyword,"r8uint"),r8sint:new C("r8sint",b.keyword,"r8sint"),r16uint:new C("r16uint",b.keyword,"r16uint"),r16sint:new C("r16sint",b.keyword,"r16sint"),r16float:new C("r16float",b.keyword,"r16float"),rg8unorm:new C("rg8unorm",b.keyword,"rg8unorm"),rg8snorm:new C("rg8snorm",b.keyword,"rg8snorm"),rg8uint:new C("rg8uint",b.keyword,"rg8uint"),rg8sint:new C("rg8sint",b.keyword,"rg8sint"),r32uint:new C("r32uint",b.keyword,"r32uint"),r32sint:new C("r32sint",b.keyword,"r32sint"),r32float:new C("r32float",b.keyword,"r32float"),rg16uint:new C("rg16uint",b.keyword,"rg16uint"),rg16sint:new C("rg16sint",b.keyword,"rg16sint"),rg16float:new C("rg16float",b.keyword,"rg16float"),rgba8unorm:new C("rgba8unorm",b.keyword,"rgba8unorm"),rgba8unorm_srgb:new C("rgba8unorm_srgb",b.keyword,"rgba8unorm_srgb"),rgba8snorm:new C("rgba8snorm",b.keyword,"rgba8snorm"),rgba8uint:new C("rgba8uint",b.keyword,"rgba8uint"),rgba8sint:new C("rgba8sint",b.keyword,"rgba8sint"),bgra8unorm:new C("bgra8unorm",b.keyword,"bgra8unorm"),bgra8unorm_srgb:new C("bgra8unorm_srgb",b.keyword,"bgra8unorm_srgb"),rgb10a2unorm:new C("rgb10a2unorm",b.keyword,"rgb10a2unorm"),rg11b10float:new C("rg11b10float",b.keyword,"rg11b10float"),rg32uint:new C("rg32uint",b.keyword,"rg32uint"),rg32sint:new C("rg32sint",b.keyword,"rg32sint"),rg32float:new C("rg32float",b.keyword,"rg32float"),rgba16uint:new C("rgba16uint",b.keyword,"rgba16uint"),rgba16sint:new C("rgba16sint",b.keyword,"rgba16sint"),rgba16float:new C("rgba16float",b.keyword,"rgba16float"),rgba32uint:new C("rgba32uint",b.keyword,"rgba32uint"),rgba32sint:new C("rgba32sint",b.keyword,"rgba32sint"),rgba32float:new C("rgba32float",b.keyword,"rgba32float"),static_assert:new C("static_assert",b.keyword,"static_assert")};S.tokens={decimal_float_literal:new C("decimal_float_literal",b.token,/((-?[0-9]*\.[0-9]+|-?[0-9]+\.[0-9]*)((e|E)(\+|-)?[0-9]+)?f?)|(-?[0-9]+(e|E)(\+|-)?[0-9]+f?)|([0-9]+f)/),hex_float_literal:new C("hex_float_literal",b.token,/-?0x((([0-9a-fA-F]*\.[0-9a-fA-F]+|[0-9a-fA-F]+\.[0-9a-fA-F]*)((p|P)(\+|-)?[0-9]+f?)?)|([0-9a-fA-F]+(p|P)(\+|-)?[0-9]+f?))/),int_literal:new C("int_literal",b.token,/-?0x[0-9a-fA-F]+|0i?|-?[1-9][0-9]*i?/),uint_literal:new C("uint_literal",b.token,/0x[0-9a-fA-F]+u|0u|[1-9][0-9]*u/),ident:new C("ident",b.token,/[a-zA-Z][0-9a-zA-Z_]*/),and:new C("and",b.token,"&"),and_and:new C("and_and",b.token,"&&"),arrow:new C("arrow ",b.token,"->"),attr:new C("attr",b.token,"@"),attr_left:new C("attr_left",b.token,"[["),attr_right:new C("attr_right",b.token,"]]"),forward_slash:new C("forward_slash",b.token,"/"),bang:new C("bang",b.token,"!"),bracket_left:new C("bracket_left",b.token,"["),bracket_right:new C("bracket_right",b.token,"]"),brace_left:new C("brace_left",b.token,"{"),brace_right:new C("brace_right",b.token,"}"),colon:new C("colon",b.token,":"),comma:new C("comma",b.token,","),equal:new C("equal",b.token,"="),equal_equal:new C("equal_equal",b.token,"=="),not_equal:new C("not_equal",b.token,"!="),greater_than:new C("greater_than",b.token,">"),greater_than_equal:new C("greater_than_equal",b.token,">="),shift_right:new C("shift_right",b.token,">>"),less_than:new C("less_than",b.token,"<"),less_than_equal:new C("less_than_equal",b.token,"<="),shift_left:new C("shift_left",b.token,"<<"),modulo:new C("modulo",b.token,"%"),minus:new C("minus",b.token,"-"),minus_minus:new C("minus_minus",b.token,"--"),period:new C("period",b.token,"."),plus:new C("plus",b.token,"+"),plus_plus:new C("plus_plus",b.token,"++"),or:new C("or",b.token,"|"),or_or:new C("or_or",b.token,"||"),paren_left:new C("paren_left",b.token,"("),paren_right:new C("paren_right",b.token,")"),semicolon:new C("semicolon",b.token,";"),star:new C("star",b.token,"*"),tilde:new C("tilde",b.token,"~"),underscore:new C("underscore",b.token,"_"),xor:new C("xor",b.token,"^"),plus_equal:new C("plus_equal",b.token,"+="),minus_equal:new C("minus_equal",b.token,"-="),times_equal:new C("times_equal",b.token,"*="),division_equal:new C("division_equal",b.token,"/="),modulo_equal:new C("modulo_equal",b.token,"%="),and_equal:new C("and_equal",b.token,"&="),or_equal:new C("or_equal",b.token,"|="),xor_equal:new C("xor_equal",b.token,"^="),shift_right_equal:new C("shift_right_equal",b.token,">>="),shift_left_equal:new C("shift_left_equal",b.token,"<<=")};S.storage_class=[N.keywords.function,N.keywords.private,N.keywords.workgroup,N.keywords.uniform,N.keywords.storage];S.access_mode=[N.keywords.read,N.keywords.write,N.keywords.read_write];S.sampler_type=[N.keywords.sampler,N.keywords.sampler_comparison];S.sampled_texture_type=[N.keywords.texture_1d,N.keywords.texture_2d,N.keywords.texture_2d_array,N.keywords.texture_3d,N.keywords.texture_cube,N.keywords.texture_cube_array];S.multisampled_texture_type=[N.keywords.texture_multisampled_2d];S.storage_texture_type=[N.keywords.texture_storage_1d,N.keywords.texture_storage_2d,N.keywords.texture_storage_2d_array,N.keywords.texture_storage_3d];S.depth_texture_type=[N.keywords.texture_depth_2d,N.keywords.texture_depth_2d_array,N.keywords.texture_depth_cube,N.keywords.texture_depth_cube_array,N.keywords.texture_depth_multisampled_2d];S.texture_external_type=[N.keywords.texture_external];S.any_texture_type=[...N.sampled_texture_type,...N.multisampled_texture_type,...N.storage_texture_type,...N.depth_texture_type,...N.texture_external_type];S.texel_format=[N.keywords.r8unorm,N.keywords.r8snorm,N.keywords.r8uint,N.keywords.r8sint,N.keywords.r16uint,N.keywords.r16sint,N.keywords.r16float,N.keywords.rg8unorm,N.keywords.rg8snorm,N.keywords.rg8uint,N.keywords.rg8sint,N.keywords.r32uint,N.keywords.r32sint,N.keywords.r32float,N.keywords.rg16uint,N.keywords.rg16sint,N.keywords.rg16float,N.keywords.rgba8unorm,N.keywords.rgba8unorm_srgb,N.keywords.rgba8snorm,N.keywords.rgba8uint,N.keywords.rgba8sint,N.keywords.bgra8unorm,N.keywords.bgra8unorm_srgb,N.keywords.rgb10a2unorm,N.keywords.rg11b10float,N.keywords.rg32uint,N.keywords.rg32sint,N.keywords.rg32float,N.keywords.rgba16uint,N.keywords.rgba16sint,N.keywords.rgba16float,N.keywords.rgba32uint,N.keywords.rgba32sint,N.keywords.rgba32float];S.const_literal=[N.tokens.int_literal,N.tokens.uint_literal,N.tokens.decimal_float_literal,N.tokens.hex_float_literal,N.keywords.true,N.keywords.false];S.literal_or_ident=[N.tokens.ident,N.tokens.int_literal,N.tokens.uint_literal,N.tokens.decimal_float_literal,N.tokens.hex_float_literal];S.element_count_expression=[N.tokens.int_literal,N.tokens.uint_literal,N.tokens.ident];S.template_types=[N.keywords.vec2,N.keywords.vec3,N.keywords.vec4,N.keywords.mat2x2,N.keywords.mat2x3,N.keywords.mat2x4,N.keywords.mat3x2,N.keywords.mat3x3,N.keywords.mat3x4,N.keywords.mat4x2,N.keywords.mat4x3,N.keywords.mat4x4,N.keywords.atomic,N.keywords.bitcast,...N.any_texture_type];S.attribute_name=[N.tokens.ident,N.keywords.block];S.assignment_operators=[N.tokens.equal,N.tokens.plus_equal,N.tokens.minus_equal,N.tokens.times_equal,N.tokens.division_equal,N.tokens.modulo_equal,N.tokens.and_equal,N.tokens.or_equal,N.tokens.xor_equal,N.tokens.shift_right_equal,N.tokens.shift_left_equal];S.increment_operators=[N.tokens.plus_plus,N.tokens.minus_minus];class c0{constructor(e,n,i){this.type=e,this.lexeme=n,this.line=i}toString(){return this.lexeme}isTemplateType(){return S.template_types.indexOf(this.type)!=-1}isArrayType(){return this.type==S.keywords.array}isArrayOrTemplateType(){return this.isArrayType()||this.isTemplateType()}}class zP{constructor(e){this._tokens=[],this._start=0,this._current=0,this._line=1,this._source=e??""}scanTokens(){for(;!this._isAtEnd();)if(this._start=this._current,!this.scanToken())throw`Invalid syntax at line ${this._line}`;return this._tokens.push(new c0(S.eof,"",this._line)),this._tokens}scanToken(){let e=this._advance();if(e==`
`)return this._line++,!0;if(this._isWhitespace(e))return!0;if(e=="/"){if(this._peekAhead()=="/"){for(;e!=`
`;){if(this._isAtEnd())return!0;e=this._advance()}return this._line++,!0}else if(this._peekAhead()=="*"){this._advance();let i=1;for(;i>0;){if(this._isAtEnd())return!0;if(e=this._advance(),e==`
`)this._line++;else if(e=="*"){if(this._peekAhead()=="/"&&(this._advance(),i--,i==0))return!0}else e=="/"&&this._peekAhead()=="*"&&(this._advance(),i++)}return!0}}let n=S.none;for(;;){let i=this._findType(e);const r=this._peekAhead();if(e==">"&&(r==">"||r=="=")){let s=!1,o=this._tokens.length-1;for(let a=0;a<5&&o>=0;++a,--o)if(this._tokens[o].type===S.tokens.less_than){o>0&&this._tokens[o-1].isArrayOrTemplateType()&&(s=!0);break}if(s)return this._addToken(i),!0}if(i===S.none){let s=e,o=0;const a=2;for(let l=0;l<a;++l)if(s+=this._peekAhead(l),i=this._findType(s),i!==S.none){o=l;break}if(i===S.none)return n===S.none?!1:(this._current--,this._addToken(n),!0);e=s,this._current+=o+1}if(n=i,this._isAtEnd())break;e+=this._advance()}return n===S.none?!1:(this._addToken(n),!0)}_findType(e){for(const n in S.keywords){const i=S.keywords[n];if(this._match(e,i.rule))return i}for(const n in S.tokens){const i=S.tokens[n];if(this._match(e,i.rule))return i}return S.none}_match(e,n){if(typeof n=="string"){if(n==e)return!0}else{const i=n.exec(e);if(i&&i.index==0&&i[0]==e)return!0}return!1}_isAtEnd(){return this._current>=this._source.length}_isWhitespace(e){return e==" "||e=="	"||e=="\r"}_advance(e=0){let n=this._source[this._current];return e=e||0,e++,this._current+=e,n}_peekAhead(e=0){return e=e||0,this._current+e>=this._source.length?"\0":this._source[this._current+e]}_addToken(e){const n=this._source.substring(this._start,this._current);this._tokens.push(new c0(e,n,this._line))}}class VP{constructor(){this._tokens=[],this._current=0,this._context=new dP}parse(e){this._initialize(e);let n=[];for(;!this._isAtEnd();){const i=this._global_decl_or_directive();if(!i)break;n.push(i)}return n}_initialize(e){if(e)if(typeof e=="string"){const n=new zP(e);this._tokens=n.scanTokens()}else this._tokens=e;else this._tokens=[];this._current=0}_error(e,n){return console.error(e,n),{token:e,message:n,toString:function(){return`${n}`}}}_isAtEnd(){return this._current>=this._tokens.length||this._peek().type==S.eof}_match(e){if(e instanceof C)return this._check(e)?(this._advance(),!0):!1;for(let n=0,i=e.length;n<i;++n){const r=e[n];if(this._check(r))return this._advance(),!0}return!1}_consume(e,n){if(this._check(e))return this._advance();throw this._error(this._peek(),n)}_check(e){if(this._isAtEnd())return!1;const n=this._peek();if(e instanceof Array){let i=n.type;return e.indexOf(i)!=-1}return n.type==e}_advance(){return this._isAtEnd()||this._current++,this._previous()}_peek(){return this._tokens[this._current]}_previous(){return this._tokens[this._current-1]}_global_decl_or_directive(){for(;this._match(S.tokens.semicolon)&&!this._isAtEnd(););if(this._match(S.keywords.alias)){const n=this._type_alias();return this._consume(S.tokens.semicolon,"Expected ';'"),n}if(this._match(S.keywords.enable)){const n=this._enable_directive();return this._consume(S.tokens.semicolon,"Expected ';'"),n}const e=this._attribute();if(this._check(S.keywords.var)){const n=this._global_variable_decl();return n!=null&&(n.attributes=e),this._consume(S.tokens.semicolon,"Expected ';'."),n}if(this._check(S.keywords.override)){const n=this._override_variable_decl();return n!=null&&(n.attributes=e),this._consume(S.tokens.semicolon,"Expected ';'."),n}if(this._check(S.keywords.let)){const n=this._global_let_decl();return n!=null&&(n.attributes=e),this._consume(S.tokens.semicolon,"Expected ';'."),n}if(this._check(S.keywords.const)){const n=this._global_const_decl();return n!=null&&(n.attributes=e),this._consume(S.tokens.semicolon,"Expected ';'."),n}if(this._check(S.keywords.struct)){const n=this._struct_decl();return n!=null&&(n.attributes=e),n}if(this._check(S.keywords.fn)){const n=this._function_decl();return n!=null&&(n.attributes=e),n}return null}_function_decl(){if(!this._match(S.keywords.fn))return null;const e=this._consume(S.tokens.ident,"Expected function name.").toString();this._consume(S.tokens.paren_left,"Expected '(' for function arguments.");const n=[];if(!this._check(S.tokens.paren_right))do{if(this._check(S.tokens.paren_right))break;const s=this._attribute(),o=this._consume(S.tokens.ident,"Expected argument name.").toString();this._consume(S.tokens.colon,"Expected ':' for argument type.");const a=this._attribute(),l=this._type_decl();l!=null&&(l.attributes=a,n.push(new BP(o,l,s)))}while(this._match(S.tokens.comma));this._consume(S.tokens.paren_right,"Expected ')' after function arguments.");let i=null;if(this._match(S.tokens.arrow)){const s=this._attribute();i=this._type_decl(),i!=null&&(i.attributes=s)}const r=this._compound_statement();return new Tw(e,n,i,r)}_compound_statement(){const e=[];for(this._consume(S.tokens.brace_left,"Expected '{' for block.");!this._check(S.tokens.brace_right);){const n=this._statement();n!==null&&e.push(n)}return this._consume(S.tokens.brace_right,"Expected '}' for block."),e}_statement(){for(;this._match(S.tokens.semicolon)&&!this._isAtEnd(););if(this._check(S.keywords.if))return this._if_statement();if(this._check(S.keywords.switch))return this._switch_statement();if(this._check(S.keywords.loop))return this._loop_statement();if(this._check(S.keywords.for))return this._for_statement();if(this._check(S.keywords.while))return this._while_statement();if(this._check(S.keywords.continuing))return this._continuing_statement();if(this._check(S.keywords.static_assert))return this._static_assert_statement();if(this._check(S.tokens.brace_left))return this._compound_statement();let e=null;return this._check(S.keywords.return)?e=this._return_statement():this._check([S.keywords.var,S.keywords.let,S.keywords.const])?e=this._variable_statement():this._match(S.keywords.discard)?e=new RP:this._match(S.keywords.break)?e=new bP:this._match(S.keywords.continue)?e=new CP:e=this._increment_decrement_statement()||this._func_call_statement()||this._assignment_statement(),e!=null&&this._consume(S.tokens.semicolon,"Expected ';' after statement."),e}_static_assert_statement(){if(!this._match(S.keywords.static_assert))return null;let e=this._optional_paren_expression();return new pP(e)}_while_statement(){if(!this._match(S.keywords.while))return null;let e=this._optional_paren_expression();const n=this._compound_statement();return new gP(e,n)}_continuing_statement(){if(!this._match(S.keywords.continuing))return null;const e=this._compound_statement();return new _P(e)}_for_statement(){if(!this._match(S.keywords.for))return null;this._consume(S.tokens.paren_left,"Expected '('.");const e=this._check(S.tokens.semicolon)?null:this._for_init();this._consume(S.tokens.semicolon,"Expected ';'.");const n=this._check(S.tokens.semicolon)?null:this._short_circuit_or_expression();this._consume(S.tokens.semicolon,"Expected ';'.");const i=this._check(S.tokens.paren_right)?null:this._for_increment();this._consume(S.tokens.paren_right,"Expected ')'.");const r=this._compound_statement();return new mP(e,n,i,r)}_for_init(){return this._variable_statement()||this._func_call_statement()||this._assignment_statement()}_for_increment(){return this._func_call_statement()||this._increment_decrement_statement()||this._assignment_statement()}_variable_statement(){if(this._check(S.keywords.var)){const e=this._variable_decl();if(e===null)throw this._error(this._peek(),"Variable declaration expected.");let n=null;return this._match(S.tokens.equal)&&(n=this._short_circuit_or_expression()),new br(e.name,e.type,e.storage,e.access,n)}if(this._match(S.keywords.let)){const e=this._consume(S.tokens.ident,"Expected name for let.").toString();let n=null;if(this._match(S.tokens.colon)){const r=this._attribute();n=this._type_decl(),n!=null&&(n.attributes=r)}this._consume(S.tokens.equal,"Expected '=' for let.");const i=this._short_circuit_or_expression();return new n0(e,n,null,null,i)}if(this._match(S.keywords.const)){const e=this._consume(S.tokens.ident,"Expected name for const.").toString();let n=null;if(this._match(S.tokens.colon)){const r=this._attribute();n=this._type_decl(),n!=null&&(n.attributes=r)}this._consume(S.tokens.equal,"Expected '=' for const.");const i=this._short_circuit_or_expression();return new i0(e,n,null,null,i)}return null}_increment_decrement_statement(){const e=this._current,n=this._unary_expression();if(n==null)return null;if(!this._check(S.increment_operators))return this._current=e,null;const i=this._consume(S.increment_operators,"Expected increment operator");return new yP(i.type===S.tokens.plus_plus?ns.increment:ns.decrement,n)}_assignment_statement(){let e=null;if(this._check(S.tokens.brace_right))return null;let n=this._match(S.tokens.underscore);if(n||(e=this._unary_expression()),!n&&e==null)return null;const i=this._consume(S.assignment_operators,"Expected assignment operator."),r=this._short_circuit_or_expression();return new vP(Uo.parse(i.lexeme),e,r)}_func_call_statement(){if(!this._check(S.tokens.ident))return null;const e=this._current,n=this._consume(S.tokens.ident,"Expected function name."),i=this._argument_expression_list();return i===null?(this._current=e,null):new TP(n.lexeme,i)}_loop_statement(){if(!this._match(S.keywords.loop))return null;this._consume(S.tokens.brace_left,"Expected '{' for loop.");const e=[];let n=this._statement();for(;n!==null;){if(Array.isArray(n))for(let r of n)e.push(r);else e.push(n);n=this._statement()}let i=null;return this._match(S.keywords.continuing)&&(i=this._compound_statement()),this._consume(S.tokens.brace_right,"Expected '}' for loop."),new wP(e,i)}_switch_statement(){if(!this._match(S.keywords.switch))return null;const e=this._optional_paren_expression();this._consume(S.tokens.brace_left,"Expected '{' for switch.");const n=this._switch_body();if(n==null||n.length==0)throw this._error(this._previous(),"Expected 'case' or 'default'.");return this._consume(S.tokens.brace_right,"Expected '}' for switch."),new EP(e,n)}_switch_body(){const e=[];if(this._match(S.keywords.case)){const n=this._case_selectors();this._match(S.tokens.colon),this._consume(S.tokens.brace_left,"Exected '{' for switch case.");const i=this._case_body();this._consume(S.tokens.brace_right,"Exected '}' for switch case."),e.push(new FP(n,i))}if(this._match(S.keywords.default)){this._match(S.tokens.colon),this._consume(S.tokens.brace_left,"Exected '{' for switch default.");const n=this._case_body();this._consume(S.tokens.brace_right,"Exected '}' for switch default."),e.push(new DP(n))}if(this._check([S.keywords.default,S.keywords.case])){const n=this._switch_body();e.push(n[0])}return e}_case_selectors(){var e,n,i,r;const s=[(n=(e=this._shift_expression())===null||e===void 0?void 0:e.evaluate(this._context).toString())!==null&&n!==void 0?n:""];for(;this._match(S.tokens.comma);)s.push((r=(i=this._shift_expression())===null||i===void 0?void 0:i.evaluate(this._context).toString())!==null&&r!==void 0?r:"");return s}_case_body(){if(this._match(S.keywords.fallthrough))return this._consume(S.tokens.semicolon,"Expected ';'"),[];let e=this._statement();if(e==null)return[];e instanceof Array||(e=[e]);const n=this._case_body();return n.length==0?e:[...e,n[0]]}_if_statement(){if(!this._match(S.keywords.if))return null;const e=this._optional_paren_expression(),n=this._compound_statement();let i=[];this._match_elseif()&&(i=this._elseif_statement(i));let r=null;return this._match(S.keywords.else)&&(r=this._compound_statement()),new SP(e,n,i,r)}_match_elseif(){return this._tokens[this._current].type===S.keywords.else&&this._tokens[this._current+1].type===S.keywords.if?(this._advance(),this._advance(),!0):!1}_elseif_statement(e=[]){const n=this._optional_paren_expression(),i=this._compound_statement();return e.push(new UP(n,i)),this._match_elseif()&&this._elseif_statement(e),e}_return_statement(){if(!this._match(S.keywords.return))return null;const e=this._short_circuit_or_expression();return new AP(e)}_short_circuit_or_expression(){let e=this._short_circuit_and_expr();for(;this._match(S.tokens.or_or);)e=new Xt(this._previous().toString(),e,this._short_circuit_and_expr());return e}_short_circuit_and_expr(){let e=this._inclusive_or_expression();for(;this._match(S.tokens.and_and);)e=new Xt(this._previous().toString(),e,this._inclusive_or_expression());return e}_inclusive_or_expression(){let e=this._exclusive_or_expression();for(;this._match(S.tokens.or);)e=new Xt(this._previous().toString(),e,this._exclusive_or_expression());return e}_exclusive_or_expression(){let e=this._and_expression();for(;this._match(S.tokens.xor);)e=new Xt(this._previous().toString(),e,this._and_expression());return e}_and_expression(){let e=this._equality_expression();for(;this._match(S.tokens.and);)e=new Xt(this._previous().toString(),e,this._equality_expression());return e}_equality_expression(){const e=this._relational_expression();return this._match([S.tokens.equal_equal,S.tokens.not_equal])?new Xt(this._previous().toString(),e,this._relational_expression()):e}_relational_expression(){let e=this._shift_expression();for(;this._match([S.tokens.less_than,S.tokens.greater_than,S.tokens.less_than_equal,S.tokens.greater_than_equal]);)e=new Xt(this._previous().toString(),e,this._shift_expression());return e}_shift_expression(){let e=this._additive_expression();for(;this._match([S.tokens.shift_left,S.tokens.shift_right]);)e=new Xt(this._previous().toString(),e,this._additive_expression());return e}_additive_expression(){let e=this._multiplicative_expression();for(;this._match([S.tokens.plus,S.tokens.minus]);)e=new Xt(this._previous().toString(),e,this._multiplicative_expression());return e}_multiplicative_expression(){let e=this._unary_expression();for(;this._match([S.tokens.star,S.tokens.forward_slash,S.tokens.modulo]);)e=new Xt(this._previous().toString(),e,this._unary_expression());return e}_unary_expression(){return this._match([S.tokens.minus,S.tokens.bang,S.tokens.tilde,S.tokens.star,S.tokens.and])?new kP(this._previous().toString(),this._unary_expression()):this._singular_expression()}_singular_expression(){const e=this._primary_expression(),n=this._postfix_expression();return n&&(e.postfix=n),e}_postfix_expression(){if(this._match(S.tokens.bracket_left)){const e=this._short_circuit_or_expression();this._consume(S.tokens.bracket_right,"Expected ']'.");const n=this._postfix_expression();return n&&(e.postfix=n),e}if(this._match(S.tokens.period)){const e=this._consume(S.tokens.ident,"Expected member name."),n=this._postfix_expression(),i=new r0(e.lexeme);return n&&(i.postfix=n),i}return null}_getStruct(e){return this._context.aliases.has(e)?this._context.aliases.get(e).type:this._context.structs.has(e)?this._context.structs.get(e):null}_primary_expression(){if(this._match(S.tokens.ident)){const i=this._previous().toString();if(this._check(S.tokens.paren_left)){const r=this._argument_expression_list(),s=this._getStruct(i);return s!=null?new Ks(s,r):new MP(i,r)}if(this._context.constants.has(i)){const r=this._context.constants.get(i);return new s0(i,r.value)}return new IP(i)}if(this._match(S.const_literal))return new o0(parseFloat(this._previous().toString()));if(this._check(S.tokens.paren_left))return this._paren_expression();if(this._match(S.keywords.bitcast)){this._consume(S.tokens.less_than,"Expected '<'.");const i=this._type_decl();this._consume(S.tokens.greater_than,"Expected '>'.");const r=this._paren_expression();return new OP(i,r)}const e=this._type_decl(),n=this._argument_expression_list();return new NP(e,n)}_argument_expression_list(){if(!this._match(S.tokens.paren_left))return null;const e=[];do{if(this._check(S.tokens.paren_right))break;const n=this._short_circuit_or_expression();e.push(n)}while(this._match(S.tokens.comma));return this._consume(S.tokens.paren_right,"Expected ')' for agument list"),e}_optional_paren_expression(){this._match(S.tokens.paren_left);const e=this._short_circuit_or_expression();return this._match(S.tokens.paren_right),new a0([e])}_paren_expression(){this._consume(S.tokens.paren_left,"Expected '('.");const e=this._short_circuit_or_expression();return this._consume(S.tokens.paren_right,"Expected ')'."),new a0([e])}_struct_decl(){if(!this._match(S.keywords.struct))return null;const e=this._consume(S.tokens.ident,"Expected name for struct.").toString();this._consume(S.tokens.brace_left,"Expected '{' for struct body.");const n=[];for(;!this._check(S.tokens.brace_right);){const r=this._attribute(),s=this._consume(S.tokens.ident,"Expected variable name.").toString();this._consume(S.tokens.colon,"Expected ':' for struct member type.");const o=this._attribute(),a=this._type_decl();a!=null&&(a.attributes=o),this._check(S.tokens.brace_right)?this._match(S.tokens.comma):this._consume(S.tokens.comma,"Expected ',' for struct member."),n.push(new LP(s,a,r))}this._consume(S.tokens.brace_right,"Expected '}' after struct body.");const i=new Ti(e,n);return this._context.structs.set(e,i),i}_global_variable_decl(){const e=this._variable_decl();return e&&this._match(S.tokens.equal)&&(e.value=this._const_expression()),e}_override_variable_decl(){const e=this._override_decl();return e&&this._match(S.tokens.equal)&&(e.value=this._const_expression()),e}_global_const_decl(){if(!this._match(S.keywords.const))return null;const e=this._consume(S.tokens.ident,"Expected variable name");let n=null;if(this._match(S.tokens.colon)){const s=this._attribute();n=this._type_decl(),n!=null&&(n.attributes=s)}let i=null;if(this._match(S.tokens.equal)){const s=this._short_circuit_or_expression();if(s instanceof Ks)i=s;else if(s instanceof s0&&s.initializer instanceof Ks)i=s.initializer;else try{const o=s.evaluate(this._context);i=new o0(o)}catch{i=s}}const r=new i0(e.toString(),n,"","",i);return this._context.constants.set(r.name,r),r}_global_let_decl(){if(!this._match(S.keywords.let))return null;const e=this._consume(S.tokens.ident,"Expected variable name");let n=null;if(this._match(S.tokens.colon)){const r=this._attribute();n=this._type_decl(),n!=null&&(n.attributes=r)}let i=null;return this._match(S.tokens.equal)&&(i=this._const_expression()),new n0(e.toString(),n,"","",i)}_const_expression(){if(this._match(S.const_literal))return new r0(this._previous().toString());const e=this._type_decl();this._consume(S.tokens.paren_left,"Expected '('.");let n=[];for(;!this._check(S.tokens.paren_right)&&(n.push(this._const_expression()),!!this._check(S.tokens.comma));)this._advance();return this._consume(S.tokens.paren_right,"Expected ')'."),new Ks(e,n)}_variable_decl(){if(!this._match(S.keywords.var))return null;let e="",n="";this._match(S.tokens.less_than)&&(e=this._consume(S.storage_class,"Expected storage_class.").toString(),this._match(S.tokens.comma)&&(n=this._consume(S.access_mode,"Expected access_mode.").toString()),this._consume(S.tokens.greater_than,"Expected '>'."));const i=this._consume(S.tokens.ident,"Expected variable name");let r=null;if(this._match(S.tokens.colon)){const s=this._attribute();r=this._type_decl(),r!=null&&(r.attributes=s)}return new br(i.toString(),r,e,n,null)}_override_decl(){if(!this._match(S.keywords.override))return null;const e=this._consume(S.tokens.ident,"Expected variable name");let n=null;if(this._match(S.tokens.colon)){const i=this._attribute();n=this._type_decl(),n!=null&&(n.attributes=i)}return new ww(e.toString(),n,null)}_enable_directive(){const e=this._consume(S.tokens.ident,"identity expected.");return new xP(e.toString())}_type_alias(){const e=this._consume(S.tokens.ident,"identity expected.");this._consume(S.tokens.equal,"Expected '=' for type alias.");let n=this._type_decl();if(n===null)throw this._error(this._peek(),"Expected Type for Alias.");this._context.aliases.has(n.name)&&(n=this._context.aliases.get(n.name).type);const i=new Ew(e.toString(),n);return this._context.aliases.set(i.name,i),i}_type_decl(){if(this._check([S.tokens.ident,...S.texel_format,S.keywords.bool,S.keywords.f32,S.keywords.i32,S.keywords.u32])){const i=this._advance(),r=i.toString();return this._context.structs.has(r)?this._context.structs.get(r):this._context.aliases.has(r)?this._context.aliases.get(r).type:new Gi(i.toString())}let e=this._texture_sampler_types();if(e)return e;if(this._check(S.template_types)){let i=this._advance().toString(),r=null,s=null;return this._match(S.tokens.less_than)&&(r=this._type_decl(),s=null,this._match(S.tokens.comma)&&(s=this._consume(S.access_mode,"Expected access_mode for pointer").toString()),this._consume(S.tokens.greater_than,"Expected '>' for type.")),new Sw(i,r,s)}if(this._match(S.keywords.ptr)){let i=this._previous().toString();this._consume(S.tokens.less_than,"Expected '<' for pointer.");const r=this._consume(S.storage_class,"Expected storage_class for pointer");this._consume(S.tokens.comma,"Expected ',' for pointer.");const s=this._type_decl();let o=null;return this._match(S.tokens.comma)&&(o=this._consume(S.access_mode,"Expected access_mode for pointer").toString()),this._consume(S.tokens.greater_than,"Expected '>' for pointer."),new PP(i,r.toString(),s,o)}const n=this._attribute();if(this._match(S.keywords.array)){let i=null,r=-1;const s=this._previous();if(this._match(S.tokens.less_than)){i=this._type_decl(),this._context.aliases.has(i.name)&&(i=this._context.aliases.get(i.name).type);let o="";this._match(S.tokens.comma)&&(o=this._shift_expression().evaluate(this._context).toString()),this._consume(S.tokens.greater_than,"Expected '>' for array."),r=o?parseInt(o):0}return new Aw(s.toString(),n,i,r)}return null}_texture_sampler_types(){if(this._match(S.sampler_type))return new Ys(this._previous().toString(),null,null);if(this._match(S.depth_texture_type))return new Ys(this._previous().toString(),null,null);if(this._match(S.sampled_texture_type)||this._match(S.multisampled_texture_type)){const e=this._previous();this._consume(S.tokens.less_than,"Expected '<' for sampler type.");const n=this._type_decl();return this._consume(S.tokens.greater_than,"Expected '>' for sampler type."),new Ys(e.toString(),n,null)}if(this._match(S.storage_texture_type)){const e=this._previous();this._consume(S.tokens.less_than,"Expected '<' for sampler type.");const n=this._consume(S.texel_format,"Invalid texel format.").toString();this._consume(S.tokens.comma,"Expected ',' after texel format.");const i=this._consume(S.access_mode,"Expected access mode for storage texture type.").toString();return this._consume(S.tokens.greater_than,"Expected '>' for sampler type."),new Ys(e.toString(),n,i)}return null}_attribute(){let e=[];for(;this._match(S.tokens.attr);){const n=this._consume(S.attribute_name,"Expected attribute name"),i=new l0(n.toString(),null);if(this._match(S.tokens.paren_left)){if(i.value=this._consume(S.literal_or_ident,"Expected attribute value").toString(),this._check(S.tokens.comma)){this._advance();do{const r=this._consume(S.literal_or_ident,"Expected attribute value").toString();i.value instanceof Array||(i.value=[i.value]),i.value.push(r)}while(this._match(S.tokens.comma))}this._consume(S.tokens.paren_right,"Expected ')'")}e.push(i)}for(;this._match(S.tokens.attr_left);){if(!this._check(S.tokens.attr_right))do{const n=this._consume(S.attribute_name,"Expected attribute name"),i=new l0(n.toString(),null);if(this._match(S.tokens.paren_left)){if(i.value=[this._consume(S.literal_or_ident,"Expected attribute value").toString()],this._check(S.tokens.comma)){this._advance();do{const r=this._consume(S.literal_or_ident,"Expected attribute value").toString();i.value.push(r)}while(this._match(S.tokens.comma))}this._consume(S.tokens.paren_right,"Expected ')'")}e.push(i)}while(this._match(S.tokens.comma));this._consume(S.tokens.attr_right,"Expected ']]' after attribute declarations")}return e.length==0?null:e}}class Hr{constructor(e,n){this.name=e,this.attributes=n,this.size=0}get isArray(){return!1}get isStruct(){return!1}get isTemplate(){return!1}}class u0{constructor(e,n,i){this.name=e,this.type=n,this.attributes=i,this.offset=0,this.size=0}get isArray(){return this.type.isArray}get isStruct(){return this.type.isStruct}get isTemplate(){return this.type.isTemplate}get align(){return this.type.isStruct?this.type.align:0}get members(){return this.type.isStruct?this.type.members:null}get format(){return this.type.isArray?this.type.format:this.type.isTemplate?this.type.format:null}get count(){return this.type.isArray?this.type.count:0}get stride(){return this.type.isArray?this.type.stride:this.size}}class Va extends Hr{constructor(e,n){super(e,n),this.members=[],this.align=0}get isStruct(){return!0}}class Nh extends Hr{constructor(e,n){super(e,n),this.count=0,this.stride=0}get isArray(){return!0}}class h0 extends Hr{constructor(e,n,i,r){super(e,i),this.format=n,this.access=r}get isTemplate(){return!0}}var Ln;(function(t){t[t.Uniform=0]="Uniform",t[t.Storage=1]="Storage",t[t.Texture=2]="Texture",t[t.Sampler=3]="Sampler",t[t.StorageTexture=4]="StorageTexture"})(Ln||(Ln={}));class ja{constructor(e,n,i,r,s,o,a){this.name=e,this.type=n,this.group=i,this.binding=r,this.attributes=s,this.resourceType=o,this.access=a}get isArray(){return this.type.isArray}get isStruct(){return this.type.isStruct}get isTemplate(){return this.type.isTemplate}get size(){return this.type.size}get align(){return this.type.isStruct?this.type.align:0}get members(){return this.type.isStruct?this.type.members:null}get format(){return this.type.isArray?this.type.format:this.type.isTemplate?this.type.format:null}get count(){return this.type.isArray?this.type.count:0}get stride(){return this.type.isArray?this.type.stride:this.size}}class jP{constructor(e,n){this.name=e,this.type=n}}class Wa{constructor(e,n){this.align=e,this.size=n}}class WP{constructor(e,n,i,r){this.name=e,this.type=n,this.locationType=i,this.location=r,this.interpolation=null}}class f0{constructor(e,n,i,r){this.name=e,this.type=n,this.locationType=i,this.location=r}}class HP{constructor(e,n=null){this.stage=null,this.inputs=[],this.outputs=[],this.name=e,this.stage=n}}class $P{constructor(){this.vertex=[],this.fragment=[],this.compute=[]}}class XP{constructor(e,n,i,r){this.name=e,this.type=n,this.attributes=i,this.id=r}}class yn{constructor(e){this.uniforms=[],this.storage=[],this.textures=[],this.samplers=[],this.aliases=[],this.overrides=[],this.structs=[],this.entry=new $P,this._types=new Map,e&&this.update(e)}_isStorageTexture(e){return e.name=="texture_storage_1d"||e.name=="texture_storage_2d"||e.name=="texture_storage_2d_array"||e.name=="texture_storage_3d"}update(e){const i=new VP().parse(e);for(const r of i){if(r instanceof Ti){const s=this._getTypeInfo(r,null);s instanceof Va&&this.structs.push(s);continue}if(r instanceof Ew){this.aliases.push(this._getAliasInfo(r));continue}if(r instanceof ww){const s=r,o=this._getAttributeNum(s.attributes,"id",0),a=s.type!=null?this._getTypeInfo(s.type,s.attributes):null;this.overrides.push(new XP(s.name,a,s.attributes,o));continue}if(this._isUniformVar(r)){const s=r,o=this._getAttributeNum(s.attributes,"group",0),a=this._getAttributeNum(s.attributes,"binding",0),l=this._getTypeInfo(s.type,s.attributes),c=new ja(s.name,l,o,a,s.attributes,Ln.Uniform,s.access);this.uniforms.push(c);continue}if(this._isStorageVar(r)){const s=r,o=this._getAttributeNum(s.attributes,"group",0),a=this._getAttributeNum(s.attributes,"binding",0),l=this._getTypeInfo(s.type,s.attributes),c=this._isStorageTexture(l),u=new ja(s.name,l,o,a,s.attributes,c?Ln.StorageTexture:Ln.Storage,s.access);this.storage.push(u);continue}if(this._isTextureVar(r)){const s=r,o=this._getAttributeNum(s.attributes,"group",0),a=this._getAttributeNum(s.attributes,"binding",0),l=this._getTypeInfo(s.type,s.attributes),c=this._isStorageTexture(l),u=new ja(s.name,l,o,a,s.attributes,c?Ln.StorageTexture:Ln.Texture,s.access);c?this.storage.push(u):this.textures.push(u);continue}if(this._isSamplerVar(r)){const s=r,o=this._getAttributeNum(s.attributes,"group",0),a=this._getAttributeNum(s.attributes,"binding",0),l=this._getTypeInfo(s.type,s.attributes),c=new ja(s.name,l,o,a,s.attributes,Ln.Sampler,s.access);this.samplers.push(c);continue}if(r instanceof Tw){const s=this._getAttribute(r,"vertex"),o=this._getAttribute(r,"fragment"),a=this._getAttribute(r,"compute"),l=s||o||a;if(l){const c=new HP(r.name,l.name);c.inputs=this._getInputs(r.args),c.outputs=this._getOutputs(r.returnType),this.entry[l.name].push(c)}continue}}}getBindGroups(){const e=[];function n(i,r){i>=e.length&&(e.length=i+1),e[i]===void 0&&(e[i]=[]),r>=e[i].length&&(e[i].length=r+1)}for(const i of this.uniforms){n(i.group,i.binding);const r=e[i.group];r[i.binding]=i}for(const i of this.storage){n(i.group,i.binding);const r=e[i.group];r[i.binding]=i}for(const i of this.textures){n(i.group,i.binding);const r=e[i.group];r[i.binding]=i}for(const i of this.samplers){n(i.group,i.binding);const r=e[i.group];r[i.binding]=i}return e}_getOutputs(e,n=void 0){if(n===void 0&&(n=[]),e instanceof Ti)this._getStructOutputs(e,n);else{const i=this._getOutputInfo(e);i!==null&&n.push(i)}return n}_getStructOutputs(e,n){for(const i of e.members)if(i.type instanceof Ti)this._getStructOutputs(i.type,n);else{const r=this._getAttribute(i,"location")||this._getAttribute(i,"builtin");if(r!==null){const s=this._getTypeInfo(i.type,i.type.attributes),o=this._parseInt(r.value),a=new f0(i.name,s,r.name,o);n.push(a)}}}_getOutputInfo(e){const n=this._getAttribute(e,"location")||this._getAttribute(e,"builtin");if(n!==null){const i=this._getTypeInfo(e,e.attributes),r=this._parseInt(n.value);return new f0("",i,n.name,r)}return null}_getInputs(e,n=void 0){n===void 0&&(n=[]);for(const i of e)if(i.type instanceof Ti)this._getStructInputs(i.type,n);else{const r=this._getInputInfo(i);r!==null&&n.push(r)}return n}_getStructInputs(e,n){for(const i of e.members)if(i.type instanceof Ti)this._getStructInputs(i.type,n);else{const r=this._getInputInfo(i);r!==null&&n.push(r)}}_getInputInfo(e){const n=this._getAttribute(e,"location")||this._getAttribute(e,"builtin");if(n!==null){const i=this._getAttribute(e,"interpolation"),r=this._getTypeInfo(e.type,e.attributes),s=this._parseInt(n.value),o=new WP(e.name,r,n.name,s);return i!==null&&(o.interpolation=this._parseString(i.value)),o}return null}_parseString(e){return e instanceof Array&&(e=e[0]),e}_parseInt(e){e instanceof Array&&(e=e[0]);const n=parseInt(e);return isNaN(n)?e:n}_getAlias(e){for(const n of this.aliases)if(n.name==e)return n.type;return null}_getAliasInfo(e){return new jP(e.name,this._getTypeInfo(e.type,null))}_getTypeInfo(e,n){if(this._types.has(e))return this._types.get(e);if(e instanceof Aw){const r=e,s=this._getTypeInfo(r.format,r.attributes),o=new Nh(r.name,n);return o.format=s,o.count=r.count,this._types.set(e,o),this._updateTypeInfo(o),o}if(e instanceof Ti){const r=e,s=new Va(r.name,n);for(const o of r.members){const a=this._getTypeInfo(o.type,o.attributes);s.members.push(new u0(o.name,a,o.attributes))}return this._types.set(e,s),this._updateTypeInfo(s),s}if(e instanceof Ys){const r=e,s=r.format instanceof Gi,o=r.format?s?this._getTypeInfo(r.format,null):new Hr(r.format,null):null,a=new h0(r.name,o,n,r.access);return this._types.set(e,a),this._updateTypeInfo(a),a}if(e instanceof Sw){const r=e,s=r.format?this._getTypeInfo(r.format,null):null,o=new h0(r.name,s,n,r.access);return this._types.set(e,o),this._updateTypeInfo(o),o}const i=new Hr(e.name,n);return this._types.set(e,i),this._updateTypeInfo(i),i}_updateTypeInfo(e){var n,i;const r=this._getTypeSize(e);if(e.size=(n=r==null?void 0:r.size)!==null&&n!==void 0?n:0,e instanceof Nh){const s=this._getTypeSize(e.format);e.stride=(i=s==null?void 0:s.size)!==null&&i!==void 0?i:0,this._updateTypeInfo(e.format)}e instanceof Va&&this._updateStructInfo(e)}_updateStructInfo(e){var n;let i=0,r=0,s=0,o=0;for(let a=0,l=e.members.length;a<l;++a){const c=e.members[a],u=this._getTypeSize(c);if(!u)continue;(n=this._getAlias(c.type.name))!==null&&n!==void 0||c.type;const h=u.align,f=u.size;i=this._roundUp(h,i+r),r=f,s=i,o=Math.max(o,h),c.offset=i,c.size=f,this._updateTypeInfo(c.type)}e.size=this._roundUp(o,s+r),e.align=o}_getTypeSize(e){var n;if(e==null)return null;const i=this._getAttributeNum(e.attributes,"size",0),r=this._getAttributeNum(e.attributes,"align",0);if(e instanceof u0&&(e=e.type),e instanceof Hr){const s=this._getAlias(e.name);s!==null&&(e=s)}{const s=yn._typeInfo[e.name];if(s!==void 0){const o=e.format==="f16"?2:1;return new Wa(Math.max(r,s.align/o),Math.max(i,s.size/o))}}{const s=yn._typeInfo[e.name.substring(0,e.name.length-1)];if(s){const o=e.name[e.name.length-1]==="h"?2:1;return new Wa(Math.max(r,s.align/o),Math.max(i,s.size/o))}}if(e instanceof Nh){let s=e,o=8,a=8;const l=this._getTypeSize(s.format);l!==null&&(a=l.size,o=l.align);const c=s.count,u=this._getAttributeNum((n=e==null?void 0:e.attributes)!==null&&n!==void 0?n:null,"stride",this._roundUp(o,a));return a=c*u,i&&(a=i),new Wa(Math.max(r,o),Math.max(i,a))}if(e instanceof Va){let s=0,o=0,a=0,l=0,c=0;for(const u of e.members){const h=this._getTypeSize(u.type);h!==null&&(s=Math.max(h.align,s),a=this._roundUp(h.align,a+l),l=h.size,c=a)}return o=this._roundUp(s,c+l),new Wa(Math.max(r,s),Math.max(i,o))}return null}_isUniformVar(e){return e instanceof br&&e.storage=="uniform"}_isStorageVar(e){return e instanceof br&&e.storage=="storage"}_isTextureVar(e){return e instanceof br&&e.type!==null&&yn._textureTypes.indexOf(e.type.name)!=-1}_isSamplerVar(e){return e instanceof br&&e.type!==null&&yn._samplerTypes.indexOf(e.type.name)!=-1}_getAttribute(e,n){const i=e;if(!i||!i.attributes)return null;const r=i.attributes;for(let s of r)if(s.name==n)return s;return null}_getAttributeNum(e,n,i){if(e===null)return i;for(let r of e)if(r.name==n){let s=r!==null&&r.value!==null?r.value:i;return s instanceof Array&&(s=s[0]),typeof s=="number"?s:typeof s=="string"?parseInt(s):i}return i}_roundUp(e,n){return Math.ceil(n/e)*e}}yn._typeInfo={f16:{align:2,size:2},i32:{align:4,size:4},u32:{align:4,size:4},f32:{align:4,size:4},atomic:{align:4,size:4},vec2:{align:8,size:8},vec3:{align:16,size:12},vec4:{align:16,size:16},mat2x2:{align:8,size:16},mat3x2:{align:8,size:24},mat4x2:{align:8,size:32},mat2x3:{align:16,size:32},mat3x3:{align:16,size:48},mat4x3:{align:16,size:64},mat2x4:{align:16,size:32},mat3x4:{align:16,size:48},mat4x4:{align:16,size:64}};yn._textureTypes=S.any_texture_type.map(t=>t.name);yn._samplerTypes=S.sampler_type.map(t=>t.name);function YP(t){const e={attributes:[],bindings:[]};let n;try{n=KP(t)}catch(s){return U.error(s.message)(),e}for(const s of n.uniforms){const o=[];for(const a of s.type.members)o.push({name:a.name,type:d0(a.type)});e.bindings.push({type:"uniform",name:s.name,location:s.binding,group:s.group,members:o})}const i=n.entry.vertex[0],r=(i==null?void 0:i.inputs.length)||0;for(let s=0;s<r;s++){const o=i.inputs[s];if(o.locationType==="location"){const a=d0(o.type);e.attributes.push({name:o.name,location:o.location,type:a})}}return e}function d0(t){return t.format?`${t.name}<${t.format.name}>`:t.name}function KP(t){try{return new yn(t)}catch(e){if(e instanceof Error)throw e;let n="WGSL parse error";throw typeof e=="object"&&(e!=null&&e.message)&&(n+=`: ${e.message} `),typeof e=="object"&&(e!=null&&e.token)&&(n+=e.token.line||""),new Error(n,{cause:e})}}const qP=`#ifdef LUMA_FP32_TAN_PRECISION_WORKAROUND
const float TWO_PI = 6.2831854820251465;
const float PI_2 = 1.5707963705062866;
const float PI_16 = 0.1963495463132858;
const float SIN_TABLE_0 = 0.19509032368659973;
const float SIN_TABLE_1 = 0.3826834261417389;
const float SIN_TABLE_2 = 0.5555702447891235;
const float SIN_TABLE_3 = 0.7071067690849304;
const float COS_TABLE_0 = 0.9807852506637573;
const float COS_TABLE_1 = 0.9238795042037964;
const float COS_TABLE_2 = 0.8314695954322815;
const float COS_TABLE_3 = 0.7071067690849304;
const float INVERSE_FACTORIAL_3 = 1.666666716337204e-01;
const float INVERSE_FACTORIAL_5 = 8.333333767950535e-03;
const float INVERSE_FACTORIAL_7 = 1.9841270113829523e-04;
const float INVERSE_FACTORIAL_9 = 2.75573188446287533e-06;
float sin_taylor_fp32(float a) {
float r, s, t, x;
if (a == 0.0) {
return 0.0;
}
x = -a * a;
s = a;
r = a;
r = r * x;
t = r * INVERSE_FACTORIAL_3;
s = s + t;
r = r * x;
t = r * INVERSE_FACTORIAL_5;
s = s + t;
r = r * x;
t = r * INVERSE_FACTORIAL_7;
s = s + t;
r = r * x;
t = r * INVERSE_FACTORIAL_9;
s = s + t;
return s;
}
void sincos_taylor_fp32(float a, out float sin_t, out float cos_t) {
if (a == 0.0) {
sin_t = 0.0;
cos_t = 1.0;
}
sin_t = sin_taylor_fp32(a);
cos_t = sqrt(1.0 - sin_t * sin_t);
}
float tan_taylor_fp32(float a) {
float sin_a;
float cos_a;
if (a == 0.0) {
return 0.0;
}
float z = floor(a / TWO_PI);
float r = a - TWO_PI * z;
float t;
float q = floor(r / PI_2 + 0.5);
int j = int(q);
if (j < -2 || j > 2) {
return 1.0 / 0.0;
}
t = r - PI_2 * q;
q = floor(t / PI_16 + 0.5);
int k = int(q);
int abs_k = int(abs(float(k)));
if (abs_k > 4) {
return 1.0 / 0.0;
} else {
t = t - PI_16 * q;
}
float u = 0.0;
float v = 0.0;
float sin_t, cos_t;
float s, c;
sincos_taylor_fp32(t, sin_t, cos_t);
if (k == 0) {
s = sin_t;
c = cos_t;
} else {
if (abs(float(abs_k) - 1.0) < 0.5) {
u = COS_TABLE_0;
v = SIN_TABLE_0;
} else if (abs(float(abs_k) - 2.0) < 0.5) {
u = COS_TABLE_1;
v = SIN_TABLE_1;
} else if (abs(float(abs_k) - 3.0) < 0.5) {
u = COS_TABLE_2;
v = SIN_TABLE_2;
} else if (abs(float(abs_k) - 4.0) < 0.5) {
u = COS_TABLE_3;
v = SIN_TABLE_3;
}
if (k > 0) {
s = u * sin_t + v * cos_t;
c = u * cos_t - v * sin_t;
} else {
s = u * sin_t - v * cos_t;
c = u * cos_t + v * sin_t;
}
}
if (j == 0) {
sin_a = s;
cos_a = c;
} else if (j == 1) {
sin_a = c;
cos_a = -s;
} else if (j == -1) {
sin_a = -c;
cos_a = s;
} else {
sin_a = -s;
cos_a = -c;
}
return sin_a / cos_a;
}
#endif
float tan_fp32(float a) {
#ifdef LUMA_FP32_TAN_PRECISION_WORKAROUND
return tan_taylor_fp32(a);
#else
return tan(a);
#endif
}
`,ZP={name:"fp32",vs:qP},QP=new Float32Array([0,1,1,1]),JP=`uniform pickingUniforms {
float isActive;
float isAttribute;
float isHighlightActive;
float useFloatColors;
vec3 highlightedObjectColor;
vec4 highlightColor;
} picking;
out vec4 picking_vRGBcolor_Avalid;
vec3 picking_normalizeColor(vec3 color) {
return picking.useFloatColors > 0.5 ? color : color / 255.0;
}
vec4 picking_normalizeColor(vec4 color) {
return picking.useFloatColors > 0.5 ? color : color / 255.0;
}
bool picking_isColorZero(vec3 color) {
return dot(color, vec3(1.0)) < 0.00001;
}
bool picking_isColorValid(vec3 color) {
return dot(color, vec3(1.0)) > 0.00001;
}
bool isVertexHighlighted(vec3 vertexColor) {
vec3 highlightedObjectColor = picking_normalizeColor(picking.highlightedObjectColor);
return
bool(picking.isHighlightActive) && picking_isColorZero(abs(vertexColor - highlightedObjectColor));
}
void picking_setPickingColor(vec3 pickingColor) {
pickingColor = picking_normalizeColor(pickingColor);
if (bool(picking.isActive)) {
picking_vRGBcolor_Avalid.a = float(picking_isColorValid(pickingColor));
if (!bool(picking.isAttribute)) {
picking_vRGBcolor_Avalid.rgb = pickingColor;
}
} else {
picking_vRGBcolor_Avalid.a = float(isVertexHighlighted(pickingColor));
}
}
void picking_setPickingAttribute(float value) {
if (bool(picking.isAttribute)) {
picking_vRGBcolor_Avalid.r = value;
}
}
void picking_setPickingAttribute(vec2 value) {
if (bool(picking.isAttribute)) {
picking_vRGBcolor_Avalid.rg = value;
}
}
void picking_setPickingAttribute(vec3 value) {
if (bool(picking.isAttribute)) {
picking_vRGBcolor_Avalid.rgb = value;
}
}
`,GP=`uniform pickingUniforms {
float isActive;
float isAttribute;
float isHighlightActive;
float useFloatColors;
vec3 highlightedObjectColor;
vec4 highlightColor;
} picking;
in vec4 picking_vRGBcolor_Avalid;
vec4 picking_filterHighlightColor(vec4 color) {
if (picking.isActive > 0.5) {
return color;
}
bool selected = bool(picking_vRGBcolor_Avalid.a);
if (selected) {
float highLightAlpha = picking.highlightColor.a;
float blendedAlpha = highLightAlpha + color.a * (1.0 - highLightAlpha);
float highLightRatio = highLightAlpha / blendedAlpha;
vec3 blendedRGB = mix(color.rgb, picking.highlightColor.rgb, highLightRatio);
return vec4(blendedRGB, blendedAlpha);
} else {
return color;
}
}
vec4 picking_filterPickingColor(vec4 color) {
if (bool(picking.isActive)) {
if (picking_vRGBcolor_Avalid.a == 0.0) {
discard;
}
return picking_vRGBcolor_Avalid;
}
return color;
}
vec4 picking_filterColor(vec4 color) {
vec4 highlightColor = picking_filterHighlightColor(color);
return picking_filterPickingColor(highlightColor);
}
`,p0={name:"picking",vs:JP,fs:GP,uniformTypes:{isActive:"f32",isAttribute:"f32",isHighlightActive:"f32",useFloatColors:"f32",highlightedObjectColor:"vec3<f32>",highlightColor:"vec4<f32>"},defaultUniforms:{isActive:!1,isAttribute:!1,isHighlightActive:!1,useFloatColors:!0,highlightedObjectColor:new Float32Array([0,0,0]),highlightColor:QP},getUniforms:e2};function e2(t={},e){const n={};if(t.highlightedObjectColor!==void 0)if(t.highlightedObjectColor===null)n.isHighlightActive=!1;else{n.isHighlightActive=!0;const i=t.highlightedObjectColor.slice(0,3);n.highlightedObjectColor=i}if(t.highlightColor){const i=Array.from(t.highlightColor,r=>r/255);Number.isFinite(i[3])||(i[3]=1),n.highlightColor=i}return t.isActive!==void 0&&(n.isActive=!!t.isActive,n.isAttribute=!!t.isAttribute),t.useFloatColors!==void 0&&(n.useFloatColors=!!t.useFloatColors),n}const t2={EPSILON:1e-12,debug:!1,precision:4,printTypes:!1,printDegrees:!1,printRowMajor:!0,_cartographicRadians:!1};globalThis.mathgl=globalThis.mathgl||{config:{...t2}};const Qe=globalThis.mathgl.config;function n2(t,{precision:e=Qe.precision}={}){return t=i2(t),`${parseFloat(t.toPrecision(e))}`}function Vi(t){return Array.isArray(t)||ArrayBuffer.isView(t)&&!(t instanceof DataView)}function $n(t,e,n){return s2(t,i=>Math.max(e,Math.min(n,i)))}function wc(t,e,n){return Vi(t)?t.map((i,r)=>wc(i,e[r],n)):n*e+(1-n)*t}function wn(t,e,n){const i=Qe.EPSILON;n&&(Qe.EPSILON=n);try{if(t===e)return!0;if(Vi(t)&&Vi(e)){if(t.length!==e.length)return!1;for(let r=0;r<t.length;++r)if(!wn(t[r],e[r]))return!1;return!0}return t&&t.equals?t.equals(e):e&&e.equals?e.equals(t):typeof t=="number"&&typeof e=="number"?Math.abs(t-e)<=Qe.EPSILON*Math.max(1,Math.abs(t),Math.abs(e)):!1}finally{Qe.EPSILON=i}}function i2(t){return Math.round(t/Qe.EPSILON)*Qe.EPSILON}function r2(t){return t.clone?t.clone():new Array(t.length)}function s2(t,e,n){if(Vi(t)){const i=t;n=n||r2(i);for(let r=0;r<n.length&&r<i.length;++r){const s=typeof t=="number"?t:t[r];n[r]=e(s,r,n)}return n}return e(t)}class Tg extends Array{clone(){return new this.constructor().copy(this)}fromArray(e,n=0){for(let i=0;i<this.ELEMENTS;++i)this[i]=e[i+n];return this.check()}toArray(e=[],n=0){for(let i=0;i<this.ELEMENTS;++i)e[n+i]=this[i];return e}toObject(e){return e}from(e){return Array.isArray(e)?this.copy(e):this.fromObject(e)}to(e){return e===this?this:Vi(e)?this.toArray(e):this.toObject(e)}toTarget(e){return e?this.to(e):this}toFloat32Array(){return new Float32Array(this)}toString(){return this.formatString(Qe)}formatString(e){let n="";for(let i=0;i<this.ELEMENTS;++i)n+=(i>0?", ":"")+n2(this[i],e);return`${e.printTypes?this.constructor.name:""}[${n}]`}equals(e){if(!e||this.length!==e.length)return!1;for(let n=0;n<this.ELEMENTS;++n)if(!wn(this[n],e[n]))return!1;return!0}exactEquals(e){if(!e||this.length!==e.length)return!1;for(let n=0;n<this.ELEMENTS;++n)if(this[n]!==e[n])return!1;return!0}negate(){for(let e=0;e<this.ELEMENTS;++e)this[e]=-this[e];return this.check()}lerp(e,n,i){if(i===void 0)return this.lerp(this,e,n);for(let r=0;r<this.ELEMENTS;++r){const s=e[r],o=typeof n=="number"?n:n[r];this[r]=s+i*(o-s)}return this.check()}min(e){for(let n=0;n<this.ELEMENTS;++n)this[n]=Math.min(e[n],this[n]);return this.check()}max(e){for(let n=0;n<this.ELEMENTS;++n)this[n]=Math.max(e[n],this[n]);return this.check()}clamp(e,n){for(let i=0;i<this.ELEMENTS;++i)this[i]=Math.min(Math.max(this[i],e[i]),n[i]);return this.check()}add(...e){for(const n of e)for(let i=0;i<this.ELEMENTS;++i)this[i]+=n[i];return this.check()}subtract(...e){for(const n of e)for(let i=0;i<this.ELEMENTS;++i)this[i]-=n[i];return this.check()}scale(e){if(typeof e=="number")for(let n=0;n<this.ELEMENTS;++n)this[n]*=e;else for(let n=0;n<this.ELEMENTS&&n<e.length;++n)this[n]*=e[n];return this.check()}multiplyByScalar(e){for(let n=0;n<this.ELEMENTS;++n)this[n]*=e;return this.check()}check(){if(Qe.debug&&!this.validate())throw new Error(`math.gl: ${this.constructor.name} some fields set to invalid numbers'`);return this}validate(){let e=this.length===this.ELEMENTS;for(let n=0;n<this.ELEMENTS;++n)e=e&&Number.isFinite(this[n]);return e}sub(e){return this.subtract(e)}setScalar(e){for(let n=0;n<this.ELEMENTS;++n)this[n]=e;return this.check()}addScalar(e){for(let n=0;n<this.ELEMENTS;++n)this[n]+=e;return this.check()}subScalar(e){return this.addScalar(-e)}multiplyScalar(e){for(let n=0;n<this.ELEMENTS;++n)this[n]*=e;return this.check()}divideScalar(e){return this.multiplyByScalar(1/e)}clampScalar(e,n){for(let i=0;i<this.ELEMENTS;++i)this[i]=Math.min(Math.max(this[i],e),n);return this.check()}get elements(){return this}}function o2(t,e){if(t.length!==e)return!1;for(let n=0;n<t.length;++n)if(!Number.isFinite(t[n]))return!1;return!0}function oe(t){if(!Number.isFinite(t))throw new Error(`Invalid number ${JSON.stringify(t)}`);return t}function uo(t,e,n=""){if(Qe.debug&&!o2(t,e))throw new Error(`math.gl: ${n} some fields set to invalid numbers'`);return t}function Lo(t,e){if(!t)throw new Error(`math.gl assertion ${e}`)}class bw extends Tg{get x(){return this[0]}set x(e){this[0]=oe(e)}get y(){return this[1]}set y(e){this[1]=oe(e)}len(){return Math.sqrt(this.lengthSquared())}magnitude(){return this.len()}lengthSquared(){let e=0;for(let n=0;n<this.ELEMENTS;++n)e+=this[n]*this[n];return e}magnitudeSquared(){return this.lengthSquared()}distance(e){return Math.sqrt(this.distanceSquared(e))}distanceSquared(e){let n=0;for(let i=0;i<this.ELEMENTS;++i){const r=this[i]-e[i];n+=r*r}return oe(n)}dot(e){let n=0;for(let i=0;i<this.ELEMENTS;++i)n+=this[i]*e[i];return oe(n)}normalize(){const e=this.magnitude();if(e!==0)for(let n=0;n<this.ELEMENTS;++n)this[n]/=e;return this.check()}multiply(...e){for(const n of e)for(let i=0;i<this.ELEMENTS;++i)this[i]*=n[i];return this.check()}divide(...e){for(const n of e)for(let i=0;i<this.ELEMENTS;++i)this[i]/=n[i];return this.check()}lengthSq(){return this.lengthSquared()}distanceTo(e){return this.distance(e)}distanceToSquared(e){return this.distanceSquared(e)}getComponent(e){return Lo(e>=0&&e<this.ELEMENTS,"index is out of range"),oe(this[e])}setComponent(e,n){return Lo(e>=0&&e<this.ELEMENTS,"index is out of range"),this[e]=n,this.check()}addVectors(e,n){return this.copy(e).add(n)}subVectors(e,n){return this.copy(e).subtract(n)}multiplyVectors(e,n){return this.copy(e).multiply(n)}addScaledVector(e,n){return this.add(new this.constructor(e).multiplyScalar(n))}}const ho=1e-6;let Vt=typeof Float32Array<"u"?Float32Array:Array;function a2(){const t=new Vt(2);return Vt!=Float32Array&&(t[0]=0,t[1]=0),t}function g0(t,e,n){return t[0]=e[0]+n[0],t[1]=e[1]+n[1],t}function l2(t,e){return t[0]=-e[0],t[1]=-e[1],t}function Cw(t,e,n,i){const r=e[0],s=e[1];return t[0]=r+i*(n[0]-r),t[1]=s+i*(n[1]-s),t}function c2(t,e,n){const i=e[0],r=e[1];return t[0]=n[0]*i+n[3]*r+n[6],t[1]=n[1]*i+n[4]*r+n[7],t}function u2(t,e,n){const i=e[0],r=e[1];return t[0]=n[0]*i+n[4]*r+n[12],t[1]=n[1]*i+n[5]*r+n[13],t}(function(){const t=a2();return function(e,n,i,r,s,o){let a,l;for(n||(n=2),i||(i=0),r?l=Math.min(r*n+i,e.length):l=e.length,a=i;a<l;a+=n)t[0]=e[a],t[1]=e[a+1],s(t,t,o),e[a]=t[0],e[a+1]=t[1];return e}})();function h2(t,e,n){const i=e[0],r=e[1],s=n[3]*i+n[7]*r||1;return t[0]=(n[0]*i+n[4]*r)/s,t[1]=(n[1]*i+n[5]*r)/s,t}function Pw(t,e,n){const i=e[0],r=e[1],s=e[2],o=n[3]*i+n[7]*r+n[11]*s||1;return t[0]=(n[0]*i+n[4]*r+n[8]*s)/o,t[1]=(n[1]*i+n[5]*r+n[9]*s)/o,t[2]=(n[2]*i+n[6]*r+n[10]*s)/o,t}function f2(t,e,n){const i=e[0],r=e[1];return t[0]=n[0]*i+n[2]*r,t[1]=n[1]*i+n[3]*r,t[2]=e[2],t}function d2(t,e,n){const i=e[0],r=e[1];return t[0]=n[0]*i+n[2]*r,t[1]=n[1]*i+n[3]*r,t[2]=e[2],t[3]=e[3],t}function Mw(t,e,n){const i=e[0],r=e[1],s=e[2];return t[0]=n[0]*i+n[3]*r+n[6]*s,t[1]=n[1]*i+n[4]*r+n[7]*s,t[2]=n[2]*i+n[5]*r+n[8]*s,t[3]=e[3],t}function Iw(){const t=new Vt(3);return Vt!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t}function p2(t){const e=t[0],n=t[1],i=t[2];return Math.sqrt(e*e+n*n+i*i)}function _0(t,e,n){const i=new Vt(3);return i[0]=t,i[1]=e,i[2]=n,i}function g2(t,e,n){return t[0]=e[0]-n[0],t[1]=e[1]-n[1],t[2]=e[2]-n[2],t}function _2(t){const e=t[0],n=t[1],i=t[2];return e*e+n*n+i*i}function m2(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t}function y2(t,e){const n=e[0],i=e[1],r=e[2];let s=n*n+i*i+r*r;return s>0&&(s=1/Math.sqrt(s)),t[0]=e[0]*s,t[1]=e[1]*s,t[2]=e[2]*s,t}function Ow(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]}function Il(t,e,n){const i=e[0],r=e[1],s=e[2],o=n[0],a=n[1],l=n[2];return t[0]=r*l-s*a,t[1]=s*o-i*l,t[2]=i*a-r*o,t}function v2(t,e,n,i){const r=e[0],s=e[1],o=e[2];return t[0]=r+i*(n[0]-r),t[1]=s+i*(n[1]-s),t[2]=o+i*(n[2]-o),t}function wg(t,e,n){const i=e[0],r=e[1],s=e[2];let o=n[3]*i+n[7]*r+n[11]*s+n[15];return o=o||1,t[0]=(n[0]*i+n[4]*r+n[8]*s+n[12])/o,t[1]=(n[1]*i+n[5]*r+n[9]*s+n[13])/o,t[2]=(n[2]*i+n[6]*r+n[10]*s+n[14])/o,t}function Nw(t,e,n){const i=e[0],r=e[1],s=e[2];return t[0]=i*n[0]+r*n[3]+s*n[6],t[1]=i*n[1]+r*n[4]+s*n[7],t[2]=i*n[2]+r*n[5]+s*n[8],t}function kw(t,e,n){const i=n[0],r=n[1],s=n[2],o=n[3],a=e[0],l=e[1],c=e[2];let u=r*c-s*l,h=s*a-i*c,f=i*l-r*a,d=r*f-s*h,p=s*u-i*f,v=i*h-r*u;const A=o*2;return u*=A,h*=A,f*=A,d*=2,p*=2,v*=2,t[0]=a+u+d,t[1]=l+h+p,t[2]=c+f+v,t}function T2(t,e,n,i){const r=[],s=[];return r[0]=e[0]-n[0],r[1]=e[1]-n[1],r[2]=e[2]-n[2],s[0]=r[0],s[1]=r[1]*Math.cos(i)-r[2]*Math.sin(i),s[2]=r[1]*Math.sin(i)+r[2]*Math.cos(i),t[0]=s[0]+n[0],t[1]=s[1]+n[1],t[2]=s[2]+n[2],t}function w2(t,e,n,i){const r=[],s=[];return r[0]=e[0]-n[0],r[1]=e[1]-n[1],r[2]=e[2]-n[2],s[0]=r[2]*Math.sin(i)+r[0]*Math.cos(i),s[1]=r[1],s[2]=r[2]*Math.cos(i)-r[0]*Math.sin(i),t[0]=s[0]+n[0],t[1]=s[1]+n[1],t[2]=s[2]+n[2],t}function E2(t,e,n,i){const r=[],s=[];return r[0]=e[0]-n[0],r[1]=e[1]-n[1],r[2]=e[2]-n[2],s[0]=r[0]*Math.cos(i)-r[1]*Math.sin(i),s[1]=r[0]*Math.sin(i)+r[1]*Math.cos(i),s[2]=r[2],t[0]=s[0]+n[0],t[1]=s[1]+n[1],t[2]=s[2]+n[2],t}function S2(t,e){const n=t[0],i=t[1],r=t[2],s=e[0],o=e[1],a=e[2],l=Math.sqrt((n*n+i*i+r*r)*(s*s+o*o+a*a)),c=l&&Ow(t,e)/l;return Math.acos(Math.min(Math.max(c,-1),1))}const Fw=g2,Dw=p2,kh=_2;(function(){const t=Iw();return function(e,n,i,r,s,o){let a,l;for(n||(n=3),i||(i=0),r?l=Math.min(r*n+i,e.length):l=e.length,a=i;a<l;a+=n)t[0]=e[a],t[1]=e[a+1],t[2]=e[a+2],s(t,t,o),e[a]=t[0],e[a+1]=t[1],e[a+2]=t[2];return e}})();const Fh=[0,0,0];let Ha;class V extends bw{static get ZERO(){return Ha||(Ha=new V(0,0,0),Object.freeze(Ha)),Ha}constructor(e=0,n=0,i=0){super(-0,-0,-0),arguments.length===1&&Vi(e)?this.copy(e):(Qe.debug&&(oe(e),oe(n),oe(i)),this[0]=e,this[1]=n,this[2]=i)}set(e,n,i){return this[0]=e,this[1]=n,this[2]=i,this.check()}copy(e){return this[0]=e[0],this[1]=e[1],this[2]=e[2],this.check()}fromObject(e){return Qe.debug&&(oe(e.x),oe(e.y),oe(e.z)),this[0]=e.x,this[1]=e.y,this[2]=e.z,this.check()}toObject(e){return e.x=this[0],e.y=this[1],e.z=this[2],e}get ELEMENTS(){return 3}get z(){return this[2]}set z(e){this[2]=oe(e)}angle(e){return S2(this,e)}cross(e){return Il(this,this,e),this.check()}rotateX({radians:e,origin:n=Fh}){return T2(this,this,n,e),this.check()}rotateY({radians:e,origin:n=Fh}){return w2(this,this,n,e),this.check()}rotateZ({radians:e,origin:n=Fh}){return E2(this,this,n,e),this.check()}transform(e){return this.transformAsPoint(e)}transformAsPoint(e){return wg(this,this,e),this.check()}transformAsVector(e){return Pw(this,this,e),this.check()}transformByMatrix3(e){return Nw(this,this,e),this.check()}transformByMatrix2(e){return f2(this,this,e),this.check()}transformByQuaternion(e){return kw(this,this,e),this.check()}}let $a;class Eg extends bw{static get ZERO(){return $a||($a=new Eg(0,0,0,0),Object.freeze($a)),$a}constructor(e=0,n=0,i=0,r=0){super(-0,-0,-0,-0),Vi(e)&&arguments.length===1?this.copy(e):(Qe.debug&&(oe(e),oe(n),oe(i),oe(r)),this[0]=e,this[1]=n,this[2]=i,this[3]=r)}set(e,n,i,r){return this[0]=e,this[1]=n,this[2]=i,this[3]=r,this.check()}copy(e){return this[0]=e[0],this[1]=e[1],this[2]=e[2],this[3]=e[3],this.check()}fromObject(e){return Qe.debug&&(oe(e.x),oe(e.y),oe(e.z),oe(e.w)),this[0]=e.x,this[1]=e.y,this[2]=e.z,this[3]=e.w,this}toObject(e){return e.x=this[0],e.y=this[1],e.z=this[2],e.w=this[3],e}get ELEMENTS(){return 4}get z(){return this[2]}set z(e){this[2]=oe(e)}get w(){return this[3]}set w(e){this[3]=oe(e)}transform(e){return wg(this,this,e),this.check()}transformByMatrix3(e){return Mw(this,this,e),this.check()}transformByMatrix2(e){return d2(this,this,e),this.check()}transformByQuaternion(e){return kw(this,this,e),this.check()}applyMatrix4(e){return e.transform(this,this),this}}class Bw extends Tg{toString(){let e="[";if(Qe.printRowMajor){e+="row-major:";for(let n=0;n<this.RANK;++n)for(let i=0;i<this.RANK;++i)e+=` ${this[i*this.RANK+n]}`}else{e+="column-major:";for(let n=0;n<this.ELEMENTS;++n)e+=` ${this[n]}`}return e+="]",e}getElementIndex(e,n){return n*this.RANK+e}getElement(e,n){return this[n*this.RANK+e]}setElement(e,n,i){return this[n*this.RANK+e]=oe(i),this}getColumn(e,n=new Array(this.RANK).fill(-0)){const i=e*this.RANK;for(let r=0;r<this.RANK;++r)n[r]=this[i+r];return n}setColumn(e,n){const i=e*this.RANK;for(let r=0;r<this.RANK;++r)this[i+r]=n[r];return this}}function A2(){const t=new Vt(9);return Vt!=Float32Array&&(t[1]=0,t[2]=0,t[3]=0,t[5]=0,t[6]=0,t[7]=0),t[0]=1,t[4]=1,t[8]=1,t}function x2(t,e){if(t===e){const n=e[1],i=e[2],r=e[5];t[1]=e[3],t[2]=e[6],t[3]=n,t[5]=e[7],t[6]=i,t[7]=r}else t[0]=e[0],t[1]=e[3],t[2]=e[6],t[3]=e[1],t[4]=e[4],t[5]=e[7],t[6]=e[2],t[7]=e[5],t[8]=e[8];return t}function R2(t,e){const n=e[0],i=e[1],r=e[2],s=e[3],o=e[4],a=e[5],l=e[6],c=e[7],u=e[8],h=u*o-a*c,f=-u*s+a*l,d=c*s-o*l;let p=n*h+i*f+r*d;return p?(p=1/p,t[0]=h*p,t[1]=(-u*i+r*c)*p,t[2]=(a*i-r*o)*p,t[3]=f*p,t[4]=(u*n-r*l)*p,t[5]=(-a*n+r*s)*p,t[6]=d*p,t[7]=(-c*n+i*l)*p,t[8]=(o*n-i*s)*p,t):null}function b2(t){const e=t[0],n=t[1],i=t[2],r=t[3],s=t[4],o=t[5],a=t[6],l=t[7],c=t[8];return e*(c*s-o*l)+n*(-c*r+o*a)+i*(l*r-s*a)}function m0(t,e,n){const i=e[0],r=e[1],s=e[2],o=e[3],a=e[4],l=e[5],c=e[6],u=e[7],h=e[8],f=n[0],d=n[1],p=n[2],v=n[3],A=n[4],y=n[5],g=n[6],_=n[7],E=n[8];return t[0]=f*i+d*o+p*c,t[1]=f*r+d*a+p*u,t[2]=f*s+d*l+p*h,t[3]=v*i+A*o+y*c,t[4]=v*r+A*a+y*u,t[5]=v*s+A*l+y*h,t[6]=g*i+_*o+E*c,t[7]=g*r+_*a+E*u,t[8]=g*s+_*l+E*h,t}function C2(t,e,n){const i=e[0],r=e[1],s=e[2],o=e[3],a=e[4],l=e[5],c=e[6],u=e[7],h=e[8],f=n[0],d=n[1];return t[0]=i,t[1]=r,t[2]=s,t[3]=o,t[4]=a,t[5]=l,t[6]=f*i+d*o+c,t[7]=f*r+d*a+u,t[8]=f*s+d*l+h,t}function P2(t,e,n){const i=e[0],r=e[1],s=e[2],o=e[3],a=e[4],l=e[5],c=e[6],u=e[7],h=e[8],f=Math.sin(n),d=Math.cos(n);return t[0]=d*i+f*o,t[1]=d*r+f*a,t[2]=d*s+f*l,t[3]=d*o-f*i,t[4]=d*a-f*r,t[5]=d*l-f*s,t[6]=c,t[7]=u,t[8]=h,t}function y0(t,e,n){const i=n[0],r=n[1];return t[0]=i*e[0],t[1]=i*e[1],t[2]=i*e[2],t[3]=r*e[3],t[4]=r*e[4],t[5]=r*e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t}function M2(t,e){const n=e[0],i=e[1],r=e[2],s=e[3],o=n+n,a=i+i,l=r+r,c=n*o,u=i*o,h=i*a,f=r*o,d=r*a,p=r*l,v=s*o,A=s*a,y=s*l;return t[0]=1-h-p,t[3]=u-y,t[6]=f+A,t[1]=u+y,t[4]=1-c-p,t[7]=d-v,t[2]=f-A,t[5]=d+v,t[8]=1-c-h,t}var xd;(function(t){t[t.COL0ROW0=0]="COL0ROW0",t[t.COL0ROW1=1]="COL0ROW1",t[t.COL0ROW2=2]="COL0ROW2",t[t.COL1ROW0=3]="COL1ROW0",t[t.COL1ROW1=4]="COL1ROW1",t[t.COL1ROW2=5]="COL1ROW2",t[t.COL2ROW0=6]="COL2ROW0",t[t.COL2ROW1=7]="COL2ROW1",t[t.COL2ROW2=8]="COL2ROW2"})(xd||(xd={}));const I2=Object.freeze([1,0,0,0,1,0,0,0,1]);class Ue extends Bw{static get IDENTITY(){return N2()}static get ZERO(){return O2()}get ELEMENTS(){return 9}get RANK(){return 3}get INDICES(){return xd}constructor(e,...n){super(-0,-0,-0,-0,-0,-0,-0,-0,-0),arguments.length===1&&Array.isArray(e)?this.copy(e):n.length>0?this.copy([e,...n]):this.identity()}copy(e){return this[0]=e[0],this[1]=e[1],this[2]=e[2],this[3]=e[3],this[4]=e[4],this[5]=e[5],this[6]=e[6],this[7]=e[7],this[8]=e[8],this.check()}identity(){return this.copy(I2)}fromObject(e){return this.check()}fromQuaternion(e){return M2(this,e),this.check()}set(e,n,i,r,s,o,a,l,c){return this[0]=e,this[1]=n,this[2]=i,this[3]=r,this[4]=s,this[5]=o,this[6]=a,this[7]=l,this[8]=c,this.check()}setRowMajor(e,n,i,r,s,o,a,l,c){return this[0]=e,this[1]=r,this[2]=a,this[3]=n,this[4]=s,this[5]=l,this[6]=i,this[7]=o,this[8]=c,this.check()}determinant(){return b2(this)}transpose(){return x2(this,this),this.check()}invert(){return R2(this,this),this.check()}multiplyLeft(e){return m0(this,e,this),this.check()}multiplyRight(e){return m0(this,this,e),this.check()}rotate(e){return P2(this,this,e),this.check()}scale(e){return Array.isArray(e)?y0(this,this,e):y0(this,this,[e,e]),this.check()}translate(e){return C2(this,this,e),this.check()}transform(e,n){let i;switch(e.length){case 2:i=c2(n||[-0,-0],e,this);break;case 3:i=Nw(n||[-0,-0,-0],e,this);break;case 4:i=Mw(n||[-0,-0,-0,-0],e,this);break;default:throw new Error("Illegal vector")}return uo(i,e.length),i}transformVector(e,n){return this.transform(e,n)}transformVector2(e,n){return this.transform(e,n)}transformVector3(e,n){return this.transform(e,n)}}let Xa,Ya=null;function O2(){return Xa||(Xa=new Ue([0,0,0,0,0,0,0,0,0]),Object.freeze(Xa)),Xa}function N2(){return Ya||(Ya=new Ue,Object.freeze(Ya)),Ya}function k2(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function F2(t,e){if(t===e){const n=e[1],i=e[2],r=e[3],s=e[6],o=e[7],a=e[11];t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=n,t[6]=e[9],t[7]=e[13],t[8]=i,t[9]=s,t[11]=e[14],t[12]=r,t[13]=o,t[14]=a}else t[0]=e[0],t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=e[1],t[5]=e[5],t[6]=e[9],t[7]=e[13],t[8]=e[2],t[9]=e[6],t[10]=e[10],t[11]=e[14],t[12]=e[3],t[13]=e[7],t[14]=e[11],t[15]=e[15];return t}function Rd(t,e){const n=e[0],i=e[1],r=e[2],s=e[3],o=e[4],a=e[5],l=e[6],c=e[7],u=e[8],h=e[9],f=e[10],d=e[11],p=e[12],v=e[13],A=e[14],y=e[15],g=n*a-i*o,_=n*l-r*o,E=n*c-s*o,R=i*l-r*a,P=i*c-s*a,I=r*c-s*l,O=u*v-h*p,k=u*A-f*p,D=u*y-d*p,H=h*A-f*v,X=h*y-d*v,$=f*y-d*A;let q=g*$-_*X+E*H+R*D-P*k+I*O;return q?(q=1/q,t[0]=(a*$-l*X+c*H)*q,t[1]=(r*X-i*$-s*H)*q,t[2]=(v*I-A*P+y*R)*q,t[3]=(f*P-h*I-d*R)*q,t[4]=(l*D-o*$-c*k)*q,t[5]=(n*$-r*D+s*k)*q,t[6]=(A*E-p*I-y*_)*q,t[7]=(u*I-f*E+d*_)*q,t[8]=(o*X-a*D+c*O)*q,t[9]=(i*D-n*X-s*O)*q,t[10]=(p*P-v*E+y*g)*q,t[11]=(h*E-u*P-d*g)*q,t[12]=(a*k-o*H-l*O)*q,t[13]=(n*H-i*k+r*O)*q,t[14]=(v*_-p*R-A*g)*q,t[15]=(u*R-h*_+f*g)*q,t):null}function D2(t){const e=t[0],n=t[1],i=t[2],r=t[3],s=t[4],o=t[5],a=t[6],l=t[7],c=t[8],u=t[9],h=t[10],f=t[11],d=t[12],p=t[13],v=t[14],A=t[15],y=e*o-n*s,g=e*a-i*s,_=n*a-i*o,E=c*p-u*d,R=c*v-h*d,P=u*v-h*p,I=e*P-n*R+i*E,O=s*P-o*R+a*E,k=c*_-u*g+h*y,D=d*_-p*g+v*y;return l*I-r*O+A*k-f*D}function ki(t,e,n){const i=e[0],r=e[1],s=e[2],o=e[3],a=e[4],l=e[5],c=e[6],u=e[7],h=e[8],f=e[9],d=e[10],p=e[11],v=e[12],A=e[13],y=e[14],g=e[15];let _=n[0],E=n[1],R=n[2],P=n[3];return t[0]=_*i+E*a+R*h+P*v,t[1]=_*r+E*l+R*f+P*A,t[2]=_*s+E*c+R*d+P*y,t[3]=_*o+E*u+R*p+P*g,_=n[4],E=n[5],R=n[6],P=n[7],t[4]=_*i+E*a+R*h+P*v,t[5]=_*r+E*l+R*f+P*A,t[6]=_*s+E*c+R*d+P*y,t[7]=_*o+E*u+R*p+P*g,_=n[8],E=n[9],R=n[10],P=n[11],t[8]=_*i+E*a+R*h+P*v,t[9]=_*r+E*l+R*f+P*A,t[10]=_*s+E*c+R*d+P*y,t[11]=_*o+E*u+R*p+P*g,_=n[12],E=n[13],R=n[14],P=n[15],t[12]=_*i+E*a+R*h+P*v,t[13]=_*r+E*l+R*f+P*A,t[14]=_*s+E*c+R*d+P*y,t[15]=_*o+E*u+R*p+P*g,t}function Ec(t,e,n){const i=n[0],r=n[1],s=n[2];let o,a,l,c,u,h,f,d,p,v,A,y;return e===t?(t[12]=e[0]*i+e[4]*r+e[8]*s+e[12],t[13]=e[1]*i+e[5]*r+e[9]*s+e[13],t[14]=e[2]*i+e[6]*r+e[10]*s+e[14],t[15]=e[3]*i+e[7]*r+e[11]*s+e[15]):(o=e[0],a=e[1],l=e[2],c=e[3],u=e[4],h=e[5],f=e[6],d=e[7],p=e[8],v=e[9],A=e[10],y=e[11],t[0]=o,t[1]=a,t[2]=l,t[3]=c,t[4]=u,t[5]=h,t[6]=f,t[7]=d,t[8]=p,t[9]=v,t[10]=A,t[11]=y,t[12]=o*i+u*r+p*s+e[12],t[13]=a*i+h*r+v*s+e[13],t[14]=l*i+f*r+A*s+e[14],t[15]=c*i+d*r+y*s+e[15]),t}function Sg(t,e,n){const i=n[0],r=n[1],s=n[2];return t[0]=e[0]*i,t[1]=e[1]*i,t[2]=e[2]*i,t[3]=e[3]*i,t[4]=e[4]*r,t[5]=e[5]*r,t[6]=e[6]*r,t[7]=e[7]*r,t[8]=e[8]*s,t[9]=e[9]*s,t[10]=e[10]*s,t[11]=e[11]*s,t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t}function B2(t,e,n,i){let r=i[0],s=i[1],o=i[2],a=Math.sqrt(r*r+s*s+o*o),l,c,u,h,f,d,p,v,A,y,g,_,E,R,P,I,O,k,D,H,X,$,q,nt;return a<ho?null:(a=1/a,r*=a,s*=a,o*=a,c=Math.sin(n),l=Math.cos(n),u=1-l,h=e[0],f=e[1],d=e[2],p=e[3],v=e[4],A=e[5],y=e[6],g=e[7],_=e[8],E=e[9],R=e[10],P=e[11],I=r*r*u+l,O=s*r*u+o*c,k=o*r*u-s*c,D=r*s*u-o*c,H=s*s*u+l,X=o*s*u+r*c,$=r*o*u+s*c,q=s*o*u-r*c,nt=o*o*u+l,t[0]=h*I+v*O+_*k,t[1]=f*I+A*O+E*k,t[2]=d*I+y*O+R*k,t[3]=p*I+g*O+P*k,t[4]=h*D+v*H+_*X,t[5]=f*D+A*H+E*X,t[6]=d*D+y*H+R*X,t[7]=p*D+g*H+P*X,t[8]=h*$+v*q+_*nt,t[9]=f*$+A*q+E*nt,t[10]=d*$+y*q+R*nt,t[11]=p*$+g*q+P*nt,e!==t&&(t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t)}function Uw(t,e,n){const i=Math.sin(n),r=Math.cos(n),s=e[4],o=e[5],a=e[6],l=e[7],c=e[8],u=e[9],h=e[10],f=e[11];return e!==t&&(t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[4]=s*r+c*i,t[5]=o*r+u*i,t[6]=a*r+h*i,t[7]=l*r+f*i,t[8]=c*r-s*i,t[9]=u*r-o*i,t[10]=h*r-a*i,t[11]=f*r-l*i,t}function U2(t,e,n){const i=Math.sin(n),r=Math.cos(n),s=e[0],o=e[1],a=e[2],l=e[3],c=e[8],u=e[9],h=e[10],f=e[11];return e!==t&&(t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=s*r-c*i,t[1]=o*r-u*i,t[2]=a*r-h*i,t[3]=l*r-f*i,t[8]=s*i+c*r,t[9]=o*i+u*r,t[10]=a*i+h*r,t[11]=l*i+f*r,t}function Lw(t,e,n){const i=Math.sin(n),r=Math.cos(n),s=e[0],o=e[1],a=e[2],l=e[3],c=e[4],u=e[5],h=e[6],f=e[7];return e!==t&&(t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=s*r+c*i,t[1]=o*r+u*i,t[2]=a*r+h*i,t[3]=l*r+f*i,t[4]=c*r-s*i,t[5]=u*r-o*i,t[6]=h*r-a*i,t[7]=f*r-l*i,t}function L2(t,e){const n=e[0],i=e[1],r=e[2],s=e[4],o=e[5],a=e[6],l=e[8],c=e[9],u=e[10];return t[0]=Math.sqrt(n*n+i*i+r*r),t[1]=Math.sqrt(s*s+o*o+a*a),t[2]=Math.sqrt(l*l+c*c+u*u),t}function z2(t,e){const n=e[0],i=e[1],r=e[2],s=e[3],o=n+n,a=i+i,l=r+r,c=n*o,u=i*o,h=i*a,f=r*o,d=r*a,p=r*l,v=s*o,A=s*a,y=s*l;return t[0]=1-h-p,t[1]=u+y,t[2]=f-A,t[3]=0,t[4]=u-y,t[5]=1-c-p,t[6]=d+v,t[7]=0,t[8]=f+A,t[9]=d-v,t[10]=1-c-h,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function V2(t,e,n,i,r,s,o){const a=1/(n-e),l=1/(r-i),c=1/(s-o);return t[0]=s*2*a,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=s*2*l,t[6]=0,t[7]=0,t[8]=(n+e)*a,t[9]=(r+i)*l,t[10]=(o+s)*c,t[11]=-1,t[12]=0,t[13]=0,t[14]=o*s*2*c,t[15]=0,t}function j2(t,e,n,i,r){const s=1/Math.tan(e/2);if(t[0]=s/n,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=s,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=-1,t[12]=0,t[13]=0,t[15]=0,r!=null&&r!==1/0){const o=1/(i-r);t[10]=(r+i)*o,t[14]=2*r*i*o}else t[10]=-1,t[14]=-2*i;return t}const W2=j2;function H2(t,e,n,i,r,s,o){const a=1/(e-n),l=1/(i-r),c=1/(s-o);return t[0]=-2*a,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=-2*l,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=2*c,t[11]=0,t[12]=(e+n)*a,t[13]=(r+i)*l,t[14]=(o+s)*c,t[15]=1,t}const $2=H2;function X2(t,e,n,i){let r,s,o,a,l,c,u,h,f,d;const p=e[0],v=e[1],A=e[2],y=i[0],g=i[1],_=i[2],E=n[0],R=n[1],P=n[2];return Math.abs(p-E)<ho&&Math.abs(v-R)<ho&&Math.abs(A-P)<ho?k2(t):(h=p-E,f=v-R,d=A-P,r=1/Math.sqrt(h*h+f*f+d*d),h*=r,f*=r,d*=r,s=g*d-_*f,o=_*h-y*d,a=y*f-g*h,r=Math.sqrt(s*s+o*o+a*a),r?(r=1/r,s*=r,o*=r,a*=r):(s=0,o=0,a=0),l=f*a-d*o,c=d*s-h*a,u=h*o-f*s,r=Math.sqrt(l*l+c*c+u*u),r?(r=1/r,l*=r,c*=r,u*=r):(l=0,c=0,u=0),t[0]=s,t[1]=l,t[2]=h,t[3]=0,t[4]=o,t[5]=c,t[6]=f,t[7]=0,t[8]=a,t[9]=u,t[10]=d,t[11]=0,t[12]=-(s*p+o*v+a*A),t[13]=-(l*p+c*v+u*A),t[14]=-(h*p+f*v+d*A),t[15]=1,t)}function Y2(){const t=new Vt(4);return Vt!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0,t[3]=0),t}function K2(t,e,n){return t[0]=e[0]+n[0],t[1]=e[1]+n[1],t[2]=e[2]+n[2],t[3]=e[3]+n[3],t}function Ag(t,e,n){return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t[3]=e[3]*n,t}function q2(t){const e=t[0],n=t[1],i=t[2],r=t[3];return Math.sqrt(e*e+n*n+i*i+r*r)}function Z2(t){const e=t[0],n=t[1],i=t[2],r=t[3];return e*e+n*n+i*i+r*r}function Q2(t,e){const n=e[0],i=e[1],r=e[2],s=e[3];let o=n*n+i*i+r*r+s*s;return o>0&&(o=1/Math.sqrt(o)),t[0]=n*o,t[1]=i*o,t[2]=r*o,t[3]=s*o,t}function J2(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]+t[3]*e[3]}function G2(t,e,n,i){const r=e[0],s=e[1],o=e[2],a=e[3];return t[0]=r+i*(n[0]-r),t[1]=s+i*(n[1]-s),t[2]=o+i*(n[2]-o),t[3]=a+i*(n[3]-a),t}function ps(t,e,n){const i=e[0],r=e[1],s=e[2],o=e[3];return t[0]=n[0]*i+n[4]*r+n[8]*s+n[12]*o,t[1]=n[1]*i+n[5]*r+n[9]*s+n[13]*o,t[2]=n[2]*i+n[6]*r+n[10]*s+n[14]*o,t[3]=n[3]*i+n[7]*r+n[11]*s+n[15]*o,t}function eM(t,e,n){const i=e[0],r=e[1],s=e[2],o=n[0],a=n[1],l=n[2],c=n[3],u=c*i+a*s-l*r,h=c*r+l*i-o*s,f=c*s+o*r-a*i,d=-o*i-a*r-l*s;return t[0]=u*c+d*-o+h*-l-f*-a,t[1]=h*c+d*-a+f*-o-u*-l,t[2]=f*c+d*-l+u*-a-h*-o,t[3]=e[3],t}(function(){const t=Y2();return function(e,n,i,r,s,o){let a,l;for(n||(n=4),i||(i=0),r?l=Math.min(r*n+i,e.length):l=e.length,a=i;a<l;a+=n)t[0]=e[a],t[1]=e[a+1],t[2]=e[a+2],t[3]=e[a+3],s(t,t,o),e[a]=t[0],e[a+1]=t[1],e[a+2]=t[2],e[a+3]=t[3];return e}})();var bd;(function(t){t[t.COL0ROW0=0]="COL0ROW0",t[t.COL0ROW1=1]="COL0ROW1",t[t.COL0ROW2=2]="COL0ROW2",t[t.COL0ROW3=3]="COL0ROW3",t[t.COL1ROW0=4]="COL1ROW0",t[t.COL1ROW1=5]="COL1ROW1",t[t.COL1ROW2=6]="COL1ROW2",t[t.COL1ROW3=7]="COL1ROW3",t[t.COL2ROW0=8]="COL2ROW0",t[t.COL2ROW1=9]="COL2ROW1",t[t.COL2ROW2=10]="COL2ROW2",t[t.COL2ROW3=11]="COL2ROW3",t[t.COL3ROW0=12]="COL3ROW0",t[t.COL3ROW1=13]="COL3ROW1",t[t.COL3ROW2=14]="COL3ROW2",t[t.COL3ROW3=15]="COL3ROW3"})(bd||(bd={}));const tM=45*Math.PI/180,nM=1,Dh=.1,Bh=500,iM=Object.freeze([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]);class Je extends Bw{static get IDENTITY(){return sM()}static get ZERO(){return rM()}get ELEMENTS(){return 16}get RANK(){return 4}get INDICES(){return bd}constructor(e){super(-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0),arguments.length===1&&Array.isArray(e)?this.copy(e):this.identity()}copy(e){return this[0]=e[0],this[1]=e[1],this[2]=e[2],this[3]=e[3],this[4]=e[4],this[5]=e[5],this[6]=e[6],this[7]=e[7],this[8]=e[8],this[9]=e[9],this[10]=e[10],this[11]=e[11],this[12]=e[12],this[13]=e[13],this[14]=e[14],this[15]=e[15],this.check()}set(e,n,i,r,s,o,a,l,c,u,h,f,d,p,v,A){return this[0]=e,this[1]=n,this[2]=i,this[3]=r,this[4]=s,this[5]=o,this[6]=a,this[7]=l,this[8]=c,this[9]=u,this[10]=h,this[11]=f,this[12]=d,this[13]=p,this[14]=v,this[15]=A,this.check()}setRowMajor(e,n,i,r,s,o,a,l,c,u,h,f,d,p,v,A){return this[0]=e,this[1]=s,this[2]=c,this[3]=d,this[4]=n,this[5]=o,this[6]=u,this[7]=p,this[8]=i,this[9]=a,this[10]=h,this[11]=v,this[12]=r,this[13]=l,this[14]=f,this[15]=A,this.check()}toRowMajor(e){return e[0]=this[0],e[1]=this[4],e[2]=this[8],e[3]=this[12],e[4]=this[1],e[5]=this[5],e[6]=this[9],e[7]=this[13],e[8]=this[2],e[9]=this[6],e[10]=this[10],e[11]=this[14],e[12]=this[3],e[13]=this[7],e[14]=this[11],e[15]=this[15],e}identity(){return this.copy(iM)}fromObject(e){return this.check()}fromQuaternion(e){return z2(this,e),this.check()}frustum(e){const{left:n,right:i,bottom:r,top:s,near:o=Dh,far:a=Bh}=e;return a===1/0?oM(this,n,i,r,s,o):V2(this,n,i,r,s,o,a),this.check()}lookAt(e){const{eye:n,center:i=[0,0,0],up:r=[0,1,0]}=e;return X2(this,n,i,r),this.check()}ortho(e){const{left:n,right:i,bottom:r,top:s,near:o=Dh,far:a=Bh}=e;return $2(this,n,i,r,s,o,a),this.check()}orthographic(e){const{fovy:n=tM,aspect:i=nM,focalDistance:r=1,near:s=Dh,far:o=Bh}=e;v0(n);const a=n/2,l=r*Math.tan(a),c=l*i;return this.ortho({left:-c,right:c,bottom:-l,top:l,near:s,far:o})}perspective(e){const{fovy:n=45*Math.PI/180,aspect:i=1,near:r=.1,far:s=500}=e;return v0(n),W2(this,n,i,r,s),this.check()}determinant(){return D2(this)}getScale(e=[-0,-0,-0]){return e[0]=Math.sqrt(this[0]*this[0]+this[1]*this[1]+this[2]*this[2]),e[1]=Math.sqrt(this[4]*this[4]+this[5]*this[5]+this[6]*this[6]),e[2]=Math.sqrt(this[8]*this[8]+this[9]*this[9]+this[10]*this[10]),e}getTranslation(e=[-0,-0,-0]){return e[0]=this[12],e[1]=this[13],e[2]=this[14],e}getRotation(e,n){e=e||[-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0],n=n||[-0,-0,-0];const i=this.getScale(n),r=1/i[0],s=1/i[1],o=1/i[2];return e[0]=this[0]*r,e[1]=this[1]*s,e[2]=this[2]*o,e[3]=0,e[4]=this[4]*r,e[5]=this[5]*s,e[6]=this[6]*o,e[7]=0,e[8]=this[8]*r,e[9]=this[9]*s,e[10]=this[10]*o,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}getRotationMatrix3(e,n){e=e||[-0,-0,-0,-0,-0,-0,-0,-0,-0],n=n||[-0,-0,-0];const i=this.getScale(n),r=1/i[0],s=1/i[1],o=1/i[2];return e[0]=this[0]*r,e[1]=this[1]*s,e[2]=this[2]*o,e[3]=this[4]*r,e[4]=this[5]*s,e[5]=this[6]*o,e[6]=this[8]*r,e[7]=this[9]*s,e[8]=this[10]*o,e}transpose(){return F2(this,this),this.check()}invert(){return Rd(this,this),this.check()}multiplyLeft(e){return ki(this,e,this),this.check()}multiplyRight(e){return ki(this,this,e),this.check()}rotateX(e){return Uw(this,this,e),this.check()}rotateY(e){return U2(this,this,e),this.check()}rotateZ(e){return Lw(this,this,e),this.check()}rotateXYZ(e){return this.rotateX(e[0]).rotateY(e[1]).rotateZ(e[2])}rotateAxis(e,n){return B2(this,this,e,n),this.check()}scale(e){return Sg(this,this,Array.isArray(e)?e:[e,e,e]),this.check()}translate(e){return Ec(this,this,e),this.check()}transform(e,n){return e.length===4?(n=ps(n||[-0,-0,-0,-0],e,this),uo(n,4),n):this.transformAsPoint(e,n)}transformAsPoint(e,n){const{length:i}=e;let r;switch(i){case 2:r=u2(n||[-0,-0],e,this);break;case 3:r=wg(n||[-0,-0,-0],e,this);break;default:throw new Error("Illegal vector")}return uo(r,e.length),r}transformAsVector(e,n){let i;switch(e.length){case 2:i=h2(n||[-0,-0],e,this);break;case 3:i=Pw(n||[-0,-0,-0],e,this);break;default:throw new Error("Illegal vector")}return uo(i,e.length),i}transformPoint(e,n){return this.transformAsPoint(e,n)}transformVector(e,n){return this.transformAsPoint(e,n)}transformDirection(e,n){return this.transformAsVector(e,n)}makeRotationX(e){return this.identity().rotateX(e)}makeTranslation(e,n,i){return this.identity().translate([e,n,i])}}let Ka,qa;function rM(){return Ka||(Ka=new Je([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]),Object.freeze(Ka)),Ka}function sM(){return qa||(qa=new Je,Object.freeze(qa)),qa}function v0(t){if(t>Math.PI*2)throw Error("expected radians")}function oM(t,e,n,i,r,s){const o=2*s/(n-e),a=2*s/(r-i),l=(n+e)/(n-e),c=(r+i)/(r-i),u=-1,h=-1,f=-2*s;return t[0]=o,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=a,t[6]=0,t[7]=0,t[8]=l,t[9]=c,t[10]=u,t[11]=h,t[12]=0,t[13]=0,t[14]=f,t[15]=0,t}function T0(){const t=new Vt(4);return Vt!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t[3]=1,t}function aM(t){return t[0]=0,t[1]=0,t[2]=0,t[3]=1,t}function zw(t,e,n){n=n*.5;const i=Math.sin(n);return t[0]=i*e[0],t[1]=i*e[1],t[2]=i*e[2],t[3]=Math.cos(n),t}function w0(t,e,n){const i=e[0],r=e[1],s=e[2],o=e[3],a=n[0],l=n[1],c=n[2],u=n[3];return t[0]=i*u+o*a+r*c-s*l,t[1]=r*u+o*l+s*a-i*c,t[2]=s*u+o*c+i*l-r*a,t[3]=o*u-i*a-r*l-s*c,t}function lM(t,e,n){n*=.5;const i=e[0],r=e[1],s=e[2],o=e[3],a=Math.sin(n),l=Math.cos(n);return t[0]=i*l+o*a,t[1]=r*l+s*a,t[2]=s*l-r*a,t[3]=o*l-i*a,t}function cM(t,e,n){n*=.5;const i=e[0],r=e[1],s=e[2],o=e[3],a=Math.sin(n),l=Math.cos(n);return t[0]=i*l-s*a,t[1]=r*l+o*a,t[2]=s*l+i*a,t[3]=o*l-r*a,t}function uM(t,e,n){n*=.5;const i=e[0],r=e[1],s=e[2],o=e[3],a=Math.sin(n),l=Math.cos(n);return t[0]=i*l+r*a,t[1]=r*l-i*a,t[2]=s*l+o*a,t[3]=o*l-s*a,t}function hM(t,e){const n=e[0],i=e[1],r=e[2];return t[0]=n,t[1]=i,t[2]=r,t[3]=Math.sqrt(Math.abs(1-n*n-i*i-r*r)),t}function Ol(t,e,n,i){const r=e[0],s=e[1],o=e[2],a=e[3];let l=n[0],c=n[1],u=n[2],h=n[3],f,d,p,v,A;return f=r*l+s*c+o*u+a*h,f<0&&(f=-f,l=-l,c=-c,u=-u,h=-h),1-f>ho?(d=Math.acos(f),A=Math.sin(d),p=Math.sin((1-i)*d)/A,v=Math.sin(i*d)/A):(p=1-i,v=i),t[0]=p*r+v*l,t[1]=p*s+v*c,t[2]=p*o+v*u,t[3]=p*a+v*h,t}function fM(t,e){const n=e[0],i=e[1],r=e[2],s=e[3],o=n*n+i*i+r*r+s*s,a=o?1/o:0;return t[0]=-n*a,t[1]=-i*a,t[2]=-r*a,t[3]=s*a,t}function dM(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=e[3],t}function Vw(t,e){const n=e[0]+e[4]+e[8];let i;if(n>0)i=Math.sqrt(n+1),t[3]=.5*i,i=.5/i,t[0]=(e[5]-e[7])*i,t[1]=(e[6]-e[2])*i,t[2]=(e[1]-e[3])*i;else{let r=0;e[4]>e[0]&&(r=1),e[8]>e[r*3+r]&&(r=2);const s=(r+1)%3,o=(r+2)%3;i=Math.sqrt(e[r*3+r]-e[s*3+s]-e[o*3+o]+1),t[r]=.5*i,i=.5/i,t[3]=(e[s*3+o]-e[o*3+s])*i,t[s]=(e[s*3+r]+e[r*3+s])*i,t[o]=(e[o*3+r]+e[r*3+o])*i}return t}const pM=K2,gM=Ag,_M=J2,mM=G2,yM=q2,vM=Z2,jw=Q2,TM=function(){const t=Iw(),e=_0(1,0,0),n=_0(0,1,0);return function(i,r,s){const o=Ow(r,s);return o<-.999999?(Il(t,e,r),Dw(t)<1e-6&&Il(t,n,r),y2(t,t),zw(i,t,Math.PI),i):o>.999999?(i[0]=0,i[1]=0,i[2]=0,i[3]=1,i):(Il(t,r,s),i[0]=t[0],i[1]=t[1],i[2]=t[2],i[3]=1+o,jw(i,i))}}();(function(){const t=T0(),e=T0();return function(n,i,r,s,o,a){return Ol(t,i,o,a),Ol(e,r,s,a),Ol(n,t,e,2*a*(1-a)),n}})();(function(){const t=A2();return function(e,n,i,r){return t[0]=i[0],t[3]=i[1],t[6]=i[2],t[1]=r[0],t[4]=r[1],t[7]=r[2],t[2]=-n[0],t[5]=-n[1],t[8]=-n[2],jw(e,Vw(e,t))}})();const wM=[0,0,0,1];class E0 extends Tg{constructor(e=0,n=0,i=0,r=1){super(-0,-0,-0,-0),Array.isArray(e)&&arguments.length===1?this.copy(e):this.set(e,n,i,r)}copy(e){return this[0]=e[0],this[1]=e[1],this[2]=e[2],this[3]=e[3],this.check()}set(e,n,i,r){return this[0]=e,this[1]=n,this[2]=i,this[3]=r,this.check()}fromObject(e){return this[0]=e.x,this[1]=e.y,this[2]=e.z,this[3]=e.w,this.check()}fromMatrix3(e){return Vw(this,e),this.check()}fromAxisRotation(e,n){return zw(this,e,n),this.check()}identity(){return aM(this),this.check()}setAxisAngle(e,n){return this.fromAxisRotation(e,n)}get ELEMENTS(){return 4}get x(){return this[0]}set x(e){this[0]=oe(e)}get y(){return this[1]}set y(e){this[1]=oe(e)}get z(){return this[2]}set z(e){this[2]=oe(e)}get w(){return this[3]}set w(e){this[3]=oe(e)}len(){return yM(this)}lengthSquared(){return vM(this)}dot(e){return _M(this,e)}rotationTo(e,n){return TM(this,e,n),this.check()}add(e){return pM(this,this,e),this.check()}calculateW(){return hM(this,this),this.check()}conjugate(){return dM(this,this),this.check()}invert(){return fM(this,this),this.check()}lerp(e,n,i){return i===void 0?this.lerp(this,e,n):(mM(this,e,n,i),this.check())}multiplyRight(e){return w0(this,this,e),this.check()}multiplyLeft(e){return w0(this,e,this),this.check()}normalize(){const e=this.len(),n=e>0?1/e:0;return this[0]=this[0]*n,this[1]=this[1]*n,this[2]=this[2]*n,this[3]=this[3]*n,e===0&&(this[3]=1),this.check()}rotateX(e){return lM(this,this,e),this.check()}rotateY(e){return cM(this,this,e),this.check()}rotateZ(e){return uM(this,this,e),this.check()}scale(e){return gM(this,this,e),this.check()}slerp(e,n,i){let r,s,o;switch(arguments.length){case 1:({start:r=wM,target:s,ratio:o}=e);break;case 2:r=this,s=e,o=n;break;default:r=e,s=n,o=i}return Ol(this,r,s,o),this.check()}transformVector4(e,n=new Eg){return eM(n,e,this),uo(n,4)}lengthSq(){return this.lengthSquared()}setFromAxisAngle(e,n){return this.setAxisAngle(e,n)}premultiply(e){return this.multiplyLeft(e)}multiply(e){return this.multiplyRight(e)}}const EM=1e-15,SM=1e-20,S0=`#if (defined(SHADER_TYPE_FRAGMENT) && defined(LIGHTING_FRAGMENT)) || (defined(SHADER_TYPE_VERTEX) && defined(LIGHTING_VERTEX))
struct AmbientLight {
vec3 color;
};
struct PointLight {
vec3 color;
vec3 position;
vec3 attenuation;
};
struct DirectionalLight {
vec3 color;
vec3 direction;
};
uniform AmbientLight lighting_uAmbientLight;
uniform PointLight lighting_uPointLight[MAX_LIGHTS];
uniform DirectionalLight lighting_uDirectionalLight[MAX_LIGHTS];
uniform int lighting_uPointLightCount;
uniform int lighting_uDirectionalLightCount;
uniform bool lighting_uEnabled;
float getPointLightAttenuation(PointLight pointLight, float distance) {
return pointLight.attenuation.x
+ pointLight.attenuation.y * distance
+ pointLight.attenuation.z * distance * distance;
}
#endif
`,AM={lightSources:{}};function Uh(t={}){const{color:e=[0,0,0],intensity:n=1}=t;return e.map(i=>i*n/255)}function xM({ambientLight:t,pointLights:e=[],directionalLights:n=[]}){const i={};return t?i["lighting_uAmbientLight.color"]=Uh(t):i["lighting_uAmbientLight.color"]=[0,0,0],e.forEach((r,s)=>{i[`lighting_uPointLight[${s}].color`]=Uh(r),i[`lighting_uPointLight[${s}].position`]=r.position,i[`lighting_uPointLight[${s}].attenuation`]=r.attenuation||[1,0,0]}),i.lighting_uPointLightCount=e.length,n.forEach((r,s)=>{i[`lighting_uDirectionalLight[${s}].color`]=Uh(r),i[`lighting_uDirectionalLight[${s}].direction`]=r.direction}),i.lighting_uDirectionalLightCount=n.length,i}function Ww(t=AM){var e,n;if("lightSources"in t){const{ambientLight:i,pointLights:r,directionalLights:s}=t.lightSources||{};return i||r&&r.length>0||s&&s.length>0?Object.assign({},xM({ambientLight:i,pointLights:r,directionalLights:s}),{lighting_uEnabled:!0}):{lighting_uEnabled:!1}}if("lights"in t){const i={pointLights:[],directionalLights:[]};for(const r of t.lights||[])switch(r.type){case"ambient":i.ambientLight=r;break;case"directional":(e=i.directionalLights)==null||e.push(r);break;case"point":(n=i.pointLights)==null||n.push(r);break}return Ww({lightSources:i})}return{}}const RM={name:"lights",vs:S0,fs:S0,getUniforms:Ww,defines:{MAX_LIGHTS:3}},bM=`uniform float lighting_uAmbient;
uniform float lighting_uDiffuse;
uniform float lighting_uShininess;
uniform vec3  lighting_uSpecularColor;
vec3 lighting_getLightColor(vec3 surfaceColor, vec3 light_direction, vec3 view_direction, vec3 normal_worldspace, vec3 color) {
vec3 halfway_direction = normalize(light_direction + view_direction);
float lambertian = dot(light_direction, normal_worldspace);
float specular = 0.0;
if (lambertian > 0.0) {
float specular_angle = max(dot(normal_worldspace, halfway_direction), 0.0);
specular = pow(specular_angle, lighting_uShininess);
}
lambertian = max(lambertian, 0.0);
return (lambertian * lighting_uDiffuse * surfaceColor + specular * lighting_uSpecularColor) * color;
}
vec3 lighting_getLightColor(vec3 surfaceColor, vec3 cameraPosition, vec3 position_worldspace, vec3 normal_worldspace) {
vec3 lightColor = surfaceColor;
if (lighting_uEnabled) {
vec3 view_direction = normalize(cameraPosition - position_worldspace);
lightColor = lighting_uAmbient * surfaceColor * lighting_uAmbientLight.color;
for (int i = 0; i < MAX_LIGHTS; i++) {
if (i >= lighting_uPointLightCount) {
break;
}
PointLight pointLight = lighting_uPointLight[i];
vec3 light_position_worldspace = pointLight.position;
vec3 light_direction = normalize(light_position_worldspace - position_worldspace);
lightColor += lighting_getLightColor(surfaceColor, light_direction, view_direction, normal_worldspace, pointLight.color);
}
for (int i = 0; i < MAX_LIGHTS; i++) {
if (i >= lighting_uDirectionalLightCount) {
break;
}
DirectionalLight directionalLight = lighting_uDirectionalLight[i];
lightColor += lighting_getLightColor(surfaceColor, -directionalLight.direction, view_direction, normal_worldspace, directionalLight.color);
}
}
return lightColor;
}
vec3 lighting_getSpecularLightColor(vec3 cameraPosition, vec3 position_worldspace, vec3 normal_worldspace) {
vec3 lightColor = vec3(0, 0, 0);
vec3 surfaceColor = vec3(0, 0, 0);
if (lighting_uEnabled) {
vec3 view_direction = normalize(cameraPosition - position_worldspace);
for (int i = 0; i < MAX_LIGHTS; i++) {
if (i >= lighting_uPointLightCount) {
break;
}
PointLight pointLight = lighting_uPointLight[i];
vec3 light_position_worldspace = pointLight.position;
vec3 light_direction = normalize(light_position_worldspace - position_worldspace);
lightColor += lighting_getLightColor(surfaceColor, light_direction, view_direction, normal_worldspace, pointLight.color);
}
for (int i = 0; i < MAX_LIGHTS; i++) {
if (i >= lighting_uDirectionalLightCount) {
break;
}
DirectionalLight directionalLight = lighting_uDirectionalLight[i];
lightColor += lighting_getLightColor(surfaceColor, -directionalLight.direction, view_direction, normal_worldspace, directionalLight.color);
}
}
return lightColor;
}
`,CM={};function PM(t){const{ambient:e=.35,diffuse:n=.6,shininess:i=32,specularColor:r=[30,30,30]}=t;return{lighting_uAmbient:e,lighting_uDiffuse:n,lighting_uShininess:i,lighting_uSpecularColor:r.map(s=>s/255)}}function MM(t=CM){if(!("material"in t))return{};const{material:e}=t;return e?PM(e):{lighting_uEnabled:!1}}const IM={name:"gouraud-lighting",dependencies:[RM],vs:bM,defines:{LIGHTING_VERTEX:1},getUniforms:MM},Hw="#define SMOOTH_EDGE_RADIUS 0.5",OM=`
${Hw}

struct VertexGeometry {
  vec4 position;
  vec3 worldPosition;
  vec3 worldPositionAlt;
  vec3 normal;
  vec2 uv;
  vec3 pickingColor;
} geometry = VertexGeometry(
  vec4(0.0, 0.0, 1.0, 0.0),
  vec3(0.0),
  vec3(0.0),
  vec3(0.0),
  vec2(0.0),
  vec3(0.0)
);
`,NM=`
${Hw}

struct FragmentGeometry {
  vec2 uv;
} geometry;

float smoothedge(float edge, float x) {
  return smoothstep(edge - SMOOTH_EDGE_RADIUS, edge + SMOOTH_EDGE_RADIUS, x);
}
`,kM={name:"geometry",vs:OM,fs:NM},ee={DEFAULT:-1,LNGLAT:1,METER_OFFSETS:2,LNGLAT_OFFSETS:3,CARTESIAN:0};Object.defineProperty(ee,"IDENTITY",{get:()=>(Q.deprecated("COORDINATE_SYSTEM.IDENTITY","COORDINATE_SYSTEM.CARTESIAN")(),0)});const Nt={WEB_MERCATOR:1,GLOBE:2,WEB_MERCATOR_AUTO_OFFSET:4,IDENTITY:0},ji={common:0,meters:1,pixels:2},Cd={click:{handler:"onClick"},panstart:{handler:"onDragStart"},panmove:{handler:"onDrag"},panend:{handler:"onDragEnd"}},FM=Object.keys(ee).map(t=>`const int COORDINATE_SYSTEM_${t} = ${ee[t]};`).join(""),DM=Object.keys(Nt).map(t=>`const int PROJECTION_MODE_${t} = ${Nt[t]};`).join(""),BM=Object.keys(ji).map(t=>`const int UNIT_${t.toUpperCase()} = ${ji[t]};`).join(""),UM=`${FM}
${DM}
${BM}
uniform int project_uCoordinateSystem;
uniform int project_uProjectionMode;
uniform float project_uScale;
uniform bool project_uWrapLongitude;
uniform vec3 project_uCommonUnitsPerMeter;
uniform vec3 project_uCommonUnitsPerWorldUnit;
uniform vec3 project_uCommonUnitsPerWorldUnit2;
uniform vec4 project_uCenter;
uniform mat4 project_uModelMatrix;
uniform mat4 project_uViewProjectionMatrix;
uniform vec2 project_uViewportSize;
uniform float project_uDevicePixelRatio;
uniform float project_uFocalDistance;
uniform vec3 project_uCameraPosition;
uniform vec3 project_uCoordinateOrigin;
uniform vec3 project_uCommonOrigin;
uniform bool project_uPseudoMeters;
const float TILE_SIZE = 512.0;
const float PI = 3.1415926536;
const float WORLD_SCALE = TILE_SIZE / (PI * 2.0);
const vec3 ZERO_64_LOW = vec3(0.0);
const float EARTH_RADIUS = 6370972.0;
const float GLOBE_RADIUS = 256.0;
float project_size_at_latitude(float lat) {
float y = clamp(lat, -89.9, 89.9);
return 1.0 / cos(radians(y));
}
float project_size() {
if (project_uProjectionMode == PROJECTION_MODE_WEB_MERCATOR &&
project_uCoordinateSystem == COORDINATE_SYSTEM_LNGLAT &&
project_uPseudoMeters == false) {
if (geometry.position.w == 0.0) {
return project_size_at_latitude(geometry.worldPosition.y);
}
float y = geometry.position.y / TILE_SIZE * 2.0 - 1.0;
float y2 = y * y;
float y4 = y2 * y2;
float y6 = y4 * y2;
return 1.0 + 4.9348 * y2 + 4.0587 * y4 + 1.5642 * y6;
}
return 1.0;
}
float project_size_at_latitude(float meters, float lat) {
return meters * project_uCommonUnitsPerMeter.z * project_size_at_latitude(lat);
}
float project_size(float meters) {
return meters * project_uCommonUnitsPerMeter.z * project_size();
}
vec2 project_size(vec2 meters) {
return meters * project_uCommonUnitsPerMeter.xy * project_size();
}
vec3 project_size(vec3 meters) {
return meters * project_uCommonUnitsPerMeter * project_size();
}
vec4 project_size(vec4 meters) {
return vec4(meters.xyz * project_uCommonUnitsPerMeter, meters.w);
}
mat3 project_get_orientation_matrix(vec3 up) {
vec3 uz = normalize(up);
vec3 ux = abs(uz.z) == 1.0 ? vec3(1.0, 0.0, 0.0) : normalize(vec3(uz.y, -uz.x, 0));
vec3 uy = cross(uz, ux);
return mat3(ux, uy, uz);
}
bool project_needs_rotation(vec3 commonPosition, out mat3 transform) {
if (project_uProjectionMode == PROJECTION_MODE_GLOBE) {
transform = project_get_orientation_matrix(commonPosition);
return true;
}
return false;
}
vec3 project_normal(vec3 vector) {
vec4 normal_modelspace = project_uModelMatrix * vec4(vector, 0.0);
vec3 n = normalize(normal_modelspace.xyz * project_uCommonUnitsPerMeter);
mat3 rotation;
if (project_needs_rotation(geometry.position.xyz, rotation)) {
n = rotation * n;
}
return n;
}
vec4 project_offset_(vec4 offset) {
float dy = offset.y;
vec3 commonUnitsPerWorldUnit = project_uCommonUnitsPerWorldUnit + project_uCommonUnitsPerWorldUnit2 * dy;
return vec4(offset.xyz * commonUnitsPerWorldUnit, offset.w);
}
vec2 project_mercator_(vec2 lnglat) {
float x = lnglat.x;
if (project_uWrapLongitude) {
x = mod(x + 180., 360.0) - 180.;
}
float y = clamp(lnglat.y, -89.9, 89.9);
return vec2(
radians(x) + PI,
PI + log(tan_fp32(PI * 0.25 + radians(y) * 0.5))
) * WORLD_SCALE;
}
vec3 project_globe_(vec3 lnglatz) {
float lambda = radians(lnglatz.x);
float phi = radians(lnglatz.y);
float cosPhi = cos(phi);
float D = (lnglatz.z / EARTH_RADIUS + 1.0) * GLOBE_RADIUS;
return vec3(
sin(lambda) * cosPhi,
-cos(lambda) * cosPhi,
sin(phi)
) * D;
}
vec4 project_position(vec4 position, vec3 position64Low) {
vec4 position_world = project_uModelMatrix * position;
if (project_uProjectionMode == PROJECTION_MODE_WEB_MERCATOR) {
if (project_uCoordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
return vec4(
project_mercator_(position_world.xy),
project_size_at_latitude(position_world.z, position_world.y),
position_world.w
);
}
if (project_uCoordinateSystem == COORDINATE_SYSTEM_CARTESIAN) {
position_world.xyz += project_uCoordinateOrigin;
}
}
if (project_uProjectionMode == PROJECTION_MODE_GLOBE) {
if (project_uCoordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
return vec4(
project_globe_(position_world.xyz),
position_world.w
);
}
}
if (project_uProjectionMode == PROJECTION_MODE_WEB_MERCATOR_AUTO_OFFSET) {
if (project_uCoordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
if (abs(position_world.y - project_uCoordinateOrigin.y) > 0.25) {
return vec4(
project_mercator_(position_world.xy) - project_uCommonOrigin.xy,
project_size(position_world.z),
position_world.w
);
}
}
}
if (project_uProjectionMode == PROJECTION_MODE_IDENTITY ||
(project_uProjectionMode == PROJECTION_MODE_WEB_MERCATOR_AUTO_OFFSET &&
(project_uCoordinateSystem == COORDINATE_SYSTEM_LNGLAT ||
project_uCoordinateSystem == COORDINATE_SYSTEM_CARTESIAN))) {
position_world.xyz -= project_uCoordinateOrigin;
}
return project_offset_(position_world) + project_offset_(project_uModelMatrix * vec4(position64Low, 0.0));
}
vec4 project_position(vec4 position) {
return project_position(position, ZERO_64_LOW);
}
vec3 project_position(vec3 position, vec3 position64Low) {
vec4 projected_position = project_position(vec4(position, 1.0), position64Low);
return projected_position.xyz;
}
vec3 project_position(vec3 position) {
vec4 projected_position = project_position(vec4(position, 1.0), ZERO_64_LOW);
return projected_position.xyz;
}
vec2 project_position(vec2 position) {
vec4 projected_position = project_position(vec4(position, 0.0, 1.0), ZERO_64_LOW);
return projected_position.xy;
}
vec4 project_common_position_to_clipspace(vec4 position, mat4 viewProjectionMatrix, vec4 center) {
return viewProjectionMatrix * position + center;
}
vec4 project_common_position_to_clipspace(vec4 position) {
return project_common_position_to_clipspace(position, project_uViewProjectionMatrix, project_uCenter);
}
vec2 project_pixel_size_to_clipspace(vec2 pixels) {
vec2 offset = pixels / project_uViewportSize * project_uDevicePixelRatio * 2.0;
return offset * project_uFocalDistance;
}
float project_size_to_pixel(float meters) {
return project_size(meters) * project_uScale;
}
float project_size_to_pixel(float size, int unit) {
if (unit == UNIT_METERS) return project_size_to_pixel(size);
if (unit == UNIT_COMMON) return size * project_uScale;
return size;
}
float project_pixel_size(float pixels) {
return pixels / project_uScale;
}
vec2 project_pixel_size(vec2 pixels) {
return pixels / project_uScale;
}
`;function LM(t,e){if(t===e)return!0;if(Array.isArray(t)){const n=t.length;if(!e||e.length!==n)return!1;for(let i=0;i<n;i++)if(t[i]!==e[i])return!1;return!0}return!1}function aa(t){let e={},n;return i=>{for(const r in i)if(!LM(i[r],e[r])){n=t(i),e=i;break}return n}}const A0=[0,0,0,0],zM=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0],$w=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],VM=[0,0,0],Xw=[0,0,0],jM=aa($M);function Yw(t,e,n=Xw){n.length<3&&(n=[n[0],n[1],0]);let i=n,r,s=!0;switch(e===ee.LNGLAT_OFFSETS||e===ee.METER_OFFSETS?r=n:r=t.isGeospatial?[Math.fround(t.longitude),Math.fround(t.latitude),0]:null,t.projectionMode){case Nt.WEB_MERCATOR:(e===ee.LNGLAT||e===ee.CARTESIAN)&&(r=[0,0,0],s=!1);break;case Nt.WEB_MERCATOR_AUTO_OFFSET:e===ee.LNGLAT?i=r:e===ee.CARTESIAN&&(i=[Math.fround(t.center[0]),Math.fround(t.center[1]),0],r=t.unprojectPosition(i),i[0]-=n[0],i[1]-=n[1],i[2]-=n[2]);break;case Nt.IDENTITY:i=t.position.map(Math.fround),i[2]=i[2]||0;break;case Nt.GLOBE:s=!1,r=null;break;default:s=!1}return{geospatialOrigin:r,shaderCoordinateOrigin:i,offsetMode:s}}function WM(t,e,n){const{viewMatrixUncentered:i,projectionMatrix:r}=t;let{viewMatrix:s,viewProjectionMatrix:o}=t,a=A0,l=A0,c=t.cameraPosition;const{geospatialOrigin:u,shaderCoordinateOrigin:h,offsetMode:f}=Yw(t,e,n);return f&&(l=t.projectPosition(u||h),c=[c[0]-l[0],c[1]-l[1],c[2]-l[2]],l[3]=1,a=ps([],l,o),s=i||s,o=ki([],r,s),o=ki([],o,zM)),{viewMatrix:s,viewProjectionMatrix:o,projectionCenter:a,originCommon:l,cameraPosCommon:c,shaderCoordinateOrigin:h,geospatialOrigin:u}}function HM({viewport:t,devicePixelRatio:e=1,modelMatrix:n=null,coordinateSystem:i=ee.DEFAULT,coordinateOrigin:r=Xw,autoWrapLongitude:s=!1}){i===ee.DEFAULT&&(i=t.isGeospatial?ee.LNGLAT:ee.CARTESIAN);const o=jM({viewport:t,devicePixelRatio:e,coordinateSystem:i,coordinateOrigin:r});return o.project_uWrapLongitude=s,o.project_uModelMatrix=n||$w,o}function $M({viewport:t,devicePixelRatio:e,coordinateSystem:n,coordinateOrigin:i}){const{projectionCenter:r,viewProjectionMatrix:s,originCommon:o,cameraPosCommon:a,shaderCoordinateOrigin:l,geospatialOrigin:c}=WM(t,n,i),u=t.getDistanceScales(),h=[t.width*e,t.height*e],f=ps([],[0,0,-t.focalDistance,1],t.projectionMatrix)[3]||1,d={project_uCoordinateSystem:n,project_uProjectionMode:t.projectionMode,project_uCoordinateOrigin:l,project_uCommonOrigin:o.slice(0,3),project_uCenter:r,project_uPseudoMeters:!!t._pseudoMeters,project_uViewportSize:h,project_uDevicePixelRatio:e,project_uFocalDistance:f,project_uCommonUnitsPerMeter:u.unitsPerMeter,project_uCommonUnitsPerWorldUnit:u.unitsPerMeter,project_uCommonUnitsPerWorldUnit2:VM,project_uScale:t.scale,project_uWrapLongitude:!1,project_uViewProjectionMatrix:s,project_uModelMatrix:$w,project_uCameraPosition:a};if(c){const p=t.getDistanceScales(c);switch(n){case ee.METER_OFFSETS:d.project_uCommonUnitsPerWorldUnit=p.unitsPerMeter,d.project_uCommonUnitsPerWorldUnit2=p.unitsPerMeter2;break;case ee.LNGLAT:case ee.LNGLAT_OFFSETS:t._pseudoMeters||(d.project_uCommonUnitsPerMeter=p.unitsPerMeter),d.project_uCommonUnitsPerWorldUnit=p.unitsPerDegree,d.project_uCommonUnitsPerWorldUnit2=p.unitsPerDegree2;break;case ee.CARTESIAN:d.project_uCommonUnitsPerWorldUnit=[1,1,p.unitsPerMeter[2]],d.project_uCommonUnitsPerWorldUnit2=[0,0,p.unitsPerMeter2[2]];break}}return d}const XM={};function YM(t=XM){return"viewport"in t?HM(t):{}}const xg={name:"project",dependencies:[ZP,kM],vs:UM,getUniforms:YM},KM=`
vec4 project_position_to_clipspace(
  vec3 position, vec3 position64Low, vec3 offset, out vec4 commonPosition
) {
  vec3 projectedPosition = project_position(position, position64Low);
  mat3 rotation;
  if (project_needs_rotation(projectedPosition, rotation)) {
    // offset is specified as ENU
    // when in globe projection, rotate offset so that the ground alighs with the surface of the globe
    offset = rotation * offset;
  }
  commonPosition = vec4(projectedPosition + offset, 1.0);
  return project_common_position_to_clipspace(commonPosition);
}

vec4 project_position_to_clipspace(
  vec3 position, vec3 position64Low, vec3 offset
) {
  vec4 commonPosition;
  return project_position_to_clipspace(position, position64Low, offset, commonPosition);
}
`,la={name:"project32",dependencies:[xg],vs:KM};function qM(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}function $r(t,e){const n=ps([],e,t);return Ag(n,n,1/n[3]),n}function x0(t,e){const n=t%e;return n<0?e+n:n}function Pd(t,e,n){return t<e?e:t>n?n:t}function ZM(t){return Math.log(t)*Math.LOG2E}const Rg=Math.log2||ZM;function Rn(t,e){if(!t)throw new Error(e||"@math.gl/web-mercator: assertion failed.")}const kt=Math.PI,Kw=kt/4,At=kt/180,Md=180/kt,is=512,Sc=4003e4,Za=85.051129,QM=1.5;function JM(t){return Rg(t)}function rs(t){const[e,n]=t;Rn(Number.isFinite(e)),Rn(Number.isFinite(n)&&n>=-90&&n<=90,"invalid latitude");const i=e*At,r=n*At,s=is*(i+kt)/(2*kt),o=is*(kt+Math.log(Math.tan(Kw+r*.5)))/(2*kt);return[s,o]}function ss(t){const[e,n]=t,i=e/is*(2*kt)-kt,r=2*(Math.atan(Math.exp(n/is*(2*kt)-kt))-Kw);return[i*Md,r*Md]}function GM(t){const{latitude:e}=t;Rn(Number.isFinite(e));const n=Math.cos(e*At);return JM(Sc*n)-9}function Lh(t){const e=Math.cos(t*At);return is/Sc/e}function Id(t){const{latitude:e,longitude:n,highPrecision:i=!1}=t;Rn(Number.isFinite(e)&&Number.isFinite(n));const r=is,s=Math.cos(e*At),o=r/360,a=o/s,l=r/Sc/s,c={unitsPerMeter:[l,l,l],metersPerUnit:[1/l,1/l,1/l],unitsPerDegree:[o,a,l],degreesPerUnit:[1/o,1/a,1/l]};if(i){const u=At*Math.tan(e*At)/s,h=o*u/2,f=r/Sc*u,d=f/a*l;c.unitsPerDegree2=[0,h,f],c.unitsPerMeter2=[d,0,d]}return c}function qw(t,e){const[n,i,r]=t,[s,o,a]=e,{unitsPerMeter:l,unitsPerMeter2:c}=Id({longitude:n,latitude:i,highPrecision:!0}),u=rs(t);u[0]+=s*(l[0]+c[0]*o),u[1]+=o*(l[1]+c[1]*o);const h=ss(u),f=(r||0)+(a||0);return Number.isFinite(r)||Number.isFinite(a)?[h[0],h[1],f]:h}function eI(t){const{height:e,pitch:n,bearing:i,altitude:r,scale:s,center:o}=t,a=qM();Ec(a,a,[0,0,-r]),Uw(a,a,-n*At),Lw(a,a,i*At);const l=s/e;return Sg(a,a,[l,l,l]),o&&Ec(a,a,m2([],o)),a}function tI(t){const{width:e,height:n,altitude:i,pitch:r=0,offset:s,center:o,scale:a,nearZMultiplier:l=1,farZMultiplier:c=1}=t;let{fovy:u=Ac(QM)}=t;i!==void 0&&(u=Ac(i));const h=u*At,f=r*At,d=Zw(u);let p=d;o&&(p+=o[2]*a/Math.cos(f)/n);const v=h*(.5+(s?s[1]:0)/n),A=Math.sin(v)*p/Math.sin(Pd(Math.PI/2-f-v,.01,Math.PI-.01)),y=Math.sin(f)*A+p,g=p*10,_=Math.min(y*c,g);return{fov:h,aspect:e/n,focalDistance:d,near:l,far:_}}function Ac(t){return 2*Math.atan(.5/t)*Md}function Zw(t){return .5/Math.tan(.5*t*At)}function Qw(t,e){const[n,i,r=0]=t;return Rn(Number.isFinite(n)&&Number.isFinite(i)&&Number.isFinite(r)),$r(e,[n,i,r,1])}function bg(t,e,n=0){const[i,r,s]=t;if(Rn(Number.isFinite(i)&&Number.isFinite(r),"invalid pixel coordinate"),Number.isFinite(s))return $r(e,[i,r,s,1]);const o=$r(e,[i,r,0,1]),a=$r(e,[i,r,1,1]),l=o[2],c=a[2],u=l===c?0:((n||0)-l)/(c-l);return Cw([],o,a,u)}function nI(t){const{width:e,height:n,bounds:i,minExtent:r=0,maxZoom:s=24,offset:o=[0,0]}=t,[[a,l],[c,u]]=i,h=iI(t.padding),f=rs([a,Pd(u,-Za,Za)]),d=rs([c,Pd(l,-Za,Za)]),p=[Math.max(Math.abs(d[0]-f[0]),r),Math.max(Math.abs(d[1]-f[1]),r)],v=[e-h.left-h.right-Math.abs(o[0])*2,n-h.top-h.bottom-Math.abs(o[1])*2];Rn(v[0]>0&&v[1]>0);const A=v[0]/p[0],y=v[1]/p[1],g=(h.right-h.left)/2/A,_=(h.top-h.bottom)/2/y,E=[(d[0]+f[0])/2+g,(d[1]+f[1])/2+_],R=ss(E),P=Math.min(s,Rg(Math.abs(Math.min(A,y))));return Rn(Number.isFinite(P)),{longitude:R[0],latitude:R[1],zoom:P}}function iI(t=0){return typeof t=="number"?{top:t,bottom:t,left:t,right:t}:(Rn(Number.isFinite(t.top)&&Number.isFinite(t.bottom)&&Number.isFinite(t.left)&&Number.isFinite(t.right)),t)}const R0=Math.PI/180;function rI(t,e=0){const{width:n,height:i,unproject:r}=t,s={targetZ:e},o=r([0,i],s),a=r([n,i],s);let l,c;const u=t.fovy?.5*t.fovy*R0:Math.atan(.5/t.altitude),h=(90-t.pitch)*R0;return u>h-.01?(l=b0(t,0,e),c=b0(t,n,e)):(l=r([0,0],s),c=r([n,0],s)),[o,a,c,l]}function b0(t,e,n){const{pixelUnprojectionMatrix:i}=t,r=$r(i,[e,0,1,1]),s=$r(i,[e,t.height,1,1]),a=(n*t.distanceScales.unitsPerMeter[2]-r[2])/(s[2]-r[2]),l=Cw([],r,s,a),c=ss(l);return c.push(n),c}const C0=512;function sI(t){const{width:e,height:n,pitch:i=0}=t;let{longitude:r,latitude:s,zoom:o,bearing:a=0}=t;(r<-180||r>180)&&(r=x0(r+180,360)-180),(a<-180||a>180)&&(a=x0(a+180,360)-180);const l=Rg(n/C0);if(o<=l)o=l,s=0;else{const c=n/2/Math.pow(2,o),u=ss([0,c])[1];if(s<u)s=u;else{const h=ss([0,C0-c])[1];s>h&&(s=h)}}return{width:e,height:n,longitude:r,latitude:s,zoom:o,pitch:i,bearing:a}}const oI=`
const int max_lights = 2;
uniform mat4 shadow_uViewProjectionMatrices[max_lights];
uniform vec4 shadow_uProjectCenters[max_lights];
uniform bool shadow_uDrawShadowMap;
uniform bool shadow_uUseShadowMap;
uniform int shadow_uLightId;
uniform float shadow_uLightCount;

out vec3 shadow_vPosition[max_lights];

vec4 shadow_setVertexPosition(vec4 position_commonspace) {
  if (shadow_uDrawShadowMap) {
    return project_common_position_to_clipspace(position_commonspace, shadow_uViewProjectionMatrices[shadow_uLightId], shadow_uProjectCenters[shadow_uLightId]);
  }
  if (shadow_uUseShadowMap) {
    for (int i = 0; i < max_lights; i++) {
      if(i < int(shadow_uLightCount)) {
        vec4 shadowMap_position = project_common_position_to_clipspace(position_commonspace, shadow_uViewProjectionMatrices[i], shadow_uProjectCenters[i]);
        shadow_vPosition[i] = (shadowMap_position.xyz / shadowMap_position.w + 1.0) / 2.0;
      }
    }
  }
  return gl_Position;
}
`,aI=`
const int max_lights = 2;
uniform bool shadow_uDrawShadowMap;
uniform bool shadow_uUseShadowMap;
uniform sampler2D shadow_uShadowMap0;
uniform sampler2D shadow_uShadowMap1;
uniform vec4 shadow_uColor;
uniform float shadow_uLightCount;

in vec3 shadow_vPosition[max_lights];

const vec4 bitPackShift = vec4(1.0, 255.0, 65025.0, 16581375.0);
const vec4 bitUnpackShift = 1.0 / bitPackShift;
const vec4 bitMask = vec4(1.0 / 255.0, 1.0 / 255.0, 1.0 / 255.0,  0.0);

float shadow_getShadowWeight(vec3 position, sampler2D shadowMap) {
  vec4 rgbaDepth = texture(shadowMap, position.xy);

  float z = dot(rgbaDepth, bitUnpackShift);
  return smoothstep(0.001, 0.01, position.z - z);
}

vec4 shadow_filterShadowColor(vec4 color) {
  if (shadow_uDrawShadowMap) {
    vec4 rgbaDepth = fract(gl_FragCoord.z * bitPackShift);
    rgbaDepth -= rgbaDepth.gbaa * bitMask;
    return rgbaDepth;
  }
  if (shadow_uUseShadowMap) {
    float shadowAlpha = 0.0;
    shadowAlpha += shadow_getShadowWeight(shadow_vPosition[0], shadow_uShadowMap0);
    if(shadow_uLightCount > 1.0) {
      shadowAlpha += shadow_getShadowWeight(shadow_vPosition[1], shadow_uShadowMap1);
    }
    shadowAlpha *= shadow_uColor.a / shadow_uLightCount;
    float blendedAlpha = shadowAlpha + color.a * (1.0 - shadowAlpha);

    return vec4(
      mix(color.rgb, shadow_uColor.rgb, shadowAlpha / blendedAlpha),
      blendedAlpha
    );
  }
  return color;
}
`,lI=aa(dI),cI=aa(pI),uI=[0,0,0,1],hI=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0];function fI(t,e){const[n,i,r]=t,s=bg([n,i,r],e);return Number.isFinite(r)?s:[s[0],s[1],0]}function dI({viewport:t,center:e}){return new Je(t.viewProjectionMatrix).invert().transform(e)}function pI({viewport:t,shadowMatrices:e}){const n=[],i=t.pixelUnprojectionMatrix,r=t.isGeospatial?void 0:1,s=[[0,0,r],[t.width,0,r],[0,t.height,r],[t.width,t.height,r],[0,0,-1],[t.width,0,-1],[0,t.height,-1],[t.width,t.height,-1]].map(o=>fI(o,i));for(const o of e){const a=o.clone().translate(new V(t.center).negate()),l=s.map(u=>a.transform(u)),c=new Je().ortho({left:Math.min(...l.map(u=>u[0])),right:Math.max(...l.map(u=>u[0])),bottom:Math.min(...l.map(u=>u[1])),top:Math.max(...l.map(u=>u[1])),near:Math.min(...l.map(u=>-u[2])),far:Math.max(...l.map(u=>-u[2]))});n.push(c.multiplyRight(o))}return n}function gI(t,e){const{shadowEnabled:n=!0}=t;if(!n||!t.shadowMatrices||!t.shadowMatrices.length)return{shadow_uDrawShadowMap:!1,shadow_uUseShadowMap:!1,shadow_uShadowMap0:t.dummyShadowMap,shadow_uShadowMap1:t.dummyShadowMap};const i={shadow_uDrawShadowMap:!!t.drawToShadowMap,shadow_uUseShadowMap:t.shadowMaps?t.shadowMaps.length>0:!1,shadow_uColor:t.shadowColor||uI,shadow_uLightId:t.shadowLightId||0,shadow_uLightCount:t.shadowMatrices.length},r=lI({viewport:t.viewport,center:e.project_uCenter}),s=[],o=cI({shadowMatrices:t.shadowMatrices,viewport:t.viewport}).slice();for(let a=0;a<t.shadowMatrices.length;a++){const l=o[a],c=l.clone().translate(new V(t.viewport.center).negate());e.project_uCoordinateSystem===ee.LNGLAT&&e.project_uProjectionMode===Nt.WEB_MERCATOR?(o[a]=c,s[a]=r):(o[a]=l.clone().multiplyRight(hI),s[a]=c.transform(r))}for(let a=0;a<o.length;a++)i[`shadow_uViewProjectionMatrices[${a}]`]=o[a],i[`shadow_uProjectCenters[${a}]`]=s[a];for(let a=0;a<2;a++)i[`shadow_uShadowMap${a}`]=t.shadowMaps&&t.shadowMaps[a]||t.dummyShadowMap;return i}const P0={name:"shadow",dependencies:[xg],vs:oI,fs:aI,inject:{"vs:DECKGL_FILTER_GL_POSITION":`
    position = shadow_setVertexPosition(geometry.position);
    `,"fs:DECKGL_FILTER_COLOR":`
    color = shadow_filterShadowColor(color);
    `},getUniforms:(t={},e={})=>"viewport"in t&&(t.drawToShadowMap||t.shadowMaps&&t.shadowMaps.length>0)?gI(t,e):{}},ca={...p0,defaultUniforms:{...p0.defaultUniforms,useFloatColors:!1},inject:{"vs:DECKGL_FILTER_GL_POSITION":`
    // for picking depth values
    picking_setPickingAttribute(position.z / position.w);
  `,"vs:DECKGL_FILTER_COLOR":`
  picking_setPickingColor(geometry.pickingColor);
  `,"fs:DECKGL_FILTER_COLOR":{order:99,injection:`
  // use highlight color if this fragment belongs to the selected object.
  color = picking_filterHighlightColor(color);

  // use picking color if rendering to picking FBO.
  color = picking_filterPickingColor(color);
    `}}},_I=[xg],mI=["vs:DECKGL_FILTER_SIZE(inout vec3 size, VertexGeometry geometry)","vs:DECKGL_FILTER_GL_POSITION(inout vec4 position, VertexGeometry geometry)","vs:DECKGL_FILTER_COLOR(inout vec4 color, VertexGeometry geometry)","fs:DECKGL_FILTER_COLOR(inout vec4 color, FragmentGeometry geometry)"];function yI(){const t=pc.getDefaultShaderAssembler();for(const e of _I)t.addDefaultModule(e);for(const e of mI)t.addShaderHook(e);return t}const vI=[255,255,255],TI=1;let wI=0;class EI{constructor(e={}){this.type="ambient";const{color:n=vI}=e,{intensity:i=TI}=e;this.id=e.id||`ambient-${wI++}`,this.color=n,this.intensity=i}}const SI=[255,255,255],AI=1,xI=[0,0,-1];let RI=0;class M0{constructor(e={}){this.type="directional";const{color:n=SI}=e,{intensity:i=AI}=e,{direction:r=xI}=e,{_shadow:s=!1}=e;this.id=e.id||`directional-${RI++}`,this.color=n,this.intensity=i,this.type="directional",this.direction=new V(r).normalize().toArray(),this.shadow=s}getProjectedLight(e){return this}}class bI{constructor(e,n={id:"pass"}){const{id:i}=n;this.id=i,this.device=e,this.props={...n}}setProps(e){Object.assign(this.props,e)}render(e){}cleanup(){}}class Cg extends bI{constructor(){super(...arguments),this._lastRenderIndex=-1}render(e){const[n,i]=this.device.canvasContext.getDrawingBufferSize(),r=e.clearCanvas??!0,s=e.clearColor??(r?[0,0,0,0]:!1),o=r?1:!1,a=e.colorMask??15,l={viewport:[0,0,n,i]};e.colorMask&&(l.colorMask=a),e.scissorRect&&(l.scissorRect=e.scissorRect);const c=this.device.beginRenderPass({framebuffer:e.target,parameters:l,clearColor:s,clearDepth:o});try{return this._drawLayers(c,e)}finally{c.end()}}_drawLayers(e,n){const{target:i,moduleParameters:r,viewports:s,views:o,onViewportActive:a,clearStack:l=!0}=n;n.pass=n.pass||"unknown",l&&(this._lastRenderIndex=-1);const c=[];for(const u of s){const h=o&&o[u.id];a==null||a(u);const f=this._getDrawLayerParams(u,n),d=u.subViewports||[u];for(const p of d){const v=this._drawLayersInViewport(e,{target:i,moduleParameters:r,viewport:p,view:h,pass:n.pass,layers:n.layers},f);c.push(v)}}return c}_getDrawLayerParams(e,{layers:n,pass:i,isPicking:r=!1,layerFilter:s,cullRect:o,effects:a,moduleParameters:l},c=!1){var p;const u=[],h=Jw(this._lastRenderIndex+1),f={layer:n[0],viewport:e,isPicking:r,renderPass:i,cullRect:o},d={};for(let v=0;v<n.length;v++){const A=n[v],y=this._shouldDrawLayer(A,f,s,d),g={shouldDrawLayer:y};y&&!c&&(g.layerRenderIndex=h(A,y),g.moduleParameters=this._getModuleParameters(A,a,i,l),g.layerParameters={...(p=A.context.deck)==null?void 0:p.props.parameters,...this.getLayerParameters(A,v,e)}),u[v]=g}return u}_drawLayersInViewport(e,{layers:n,moduleParameters:i,pass:r,target:s,viewport:o,view:a},l){const c=CI(this.device,{moduleParameters:i,target:s,viewport:o});if(a&&a.props.clear){const h=a.props.clear===!0?{color:!0,depth:!0}:a.props.clear;this.device.withParametersWebGL({scissorTest:!0,scissor:c},()=>this.device.clearWebGL(h))}const u={totalCount:n.length,visibleCount:0,compositeCount:0,pickableCount:0};e.setParameters({viewport:c});for(let h=0;h<n.length;h++){const f=n[h],{shouldDrawLayer:d,layerRenderIndex:p,moduleParameters:v,layerParameters:A}=l[h];if(d&&f.props.pickable&&u.pickableCount++,f.isComposite)u.compositeCount++;else if(d){u.visibleCount++,this._lastRenderIndex=Math.max(this._lastRenderIndex,p),v.viewport=o,f.context.renderPass=e;try{f._drawLayer({renderPass:e,moduleParameters:v,uniforms:{layerIndex:p},parameters:A})}catch(y){f.raiseError(y,`drawing ${f} to ${r}`)}}}return u}shouldDrawLayer(e){return!0}getModuleParameters(e,n){return null}getLayerParameters(e,n,i){return e.props.parameters}_shouldDrawLayer(e,n,i,r){if(!(e.props.visible&&this.shouldDrawLayer(e)))return!1;n.layer=e;let o=e.parent;for(;o;){if(!o.props.visible||!o.filterSubLayer(n))return!1;n.layer=o,o=o.parent}if(i){const a=n.layer.id;if(a in r||(r[a]=i(n)),!r[a])return!1}return e.activateViewport(n.viewport),!0}_getModuleParameters(e,n,i,r){var a,l;const s=this.device.canvasContext.cssToDeviceRatio(),o=Object.assign(Object.create(((a=e.internalState)==null?void 0:a.propsInTransition)||e.props),{autoWrapLongitude:e.wrapLongitude,viewport:e.context.viewport,mousePosition:e.context.mousePosition,picking:{isActive:0},devicePixelRatio:s});if(n)for(const c of n)Object.assign(o,(l=c.getModuleParameters)==null?void 0:l.call(c,e));return Object.assign(o,this.getModuleParameters(e,n),r)}}function Jw(t=0,e={}){const n={},i=(r,s)=>{const o=r.props._offset,a=r.id,l=r.parent&&r.parent.id;let c;if(l&&!(l in e)&&i(r.parent,!1),l in n){const u=n[l]=n[l]||Jw(e[l],e);c=u(r,s),n[a]=u}else Number.isFinite(o)?(c=o+(e[l]||0),n[a]=null):c=t;return s&&c>=t&&(t=c+1),e[a]=c,c};return i}function CI(t,{moduleParameters:e,target:n,viewport:i}){const r=e&&e.devicePixelRatio||t.canvasContext.cssToDeviceRatio(),[,s]=t.canvasContext.getDrawingBufferSize(),o=n?n.height:s,a=i;return[a.x*r,o-(a.y+a.height)*r,a.width*r,a.height*r]}class PI extends Cg{constructor(e,n){super(e,n),this.shadowMap=e.createTexture({width:1,height:1,sampler:{minFilter:"linear",magFilter:"linear",addressModeU:"clamp-to-edge",addressModeV:"clamp-to-edge"}}),this.depthBuffer=e.createTexture({format:"depth16unorm",width:1,height:1,mipmaps:!1,dataFormat:6402,type:5125}),this.fbo=e.createFramebuffer({id:"shadowmap",width:1,height:1,colorAttachments:[this.shadowMap],depthStencilAttachment:this.depthBuffer})}render(e){const n=this.fbo,i=this.device.canvasContext.cssToDeviceRatio(),r=e.viewports[0],s=r.width*i,o=r.height*i,a=[1,1,1,1];(s!==n.width||o!==n.height)&&n.resize({width:s,height:o}),super.render({...e,clearColor:a,target:n,pass:"shadow"})}getLayerParameters(e,n,i){return{...e.props.parameters,blend:!1,depthRange:[0,1],depthTest:!0}}shouldDrawLayer(e){return e.props.shadowEnabled!==!1}getModuleParameters(){return{drawToShadowMap:!0}}delete(){this.fbo&&(this.fbo.destroy(),this.fbo=null),this.shadowMap&&(this.shadowMap.destroy(),this.shadowMap=null),this.depthBuffer&&(this.depthBuffer.destroy(),this.depthBuffer=null)}}const MI={color:[255,255,255],intensity:1},I0=[{color:[255,255,255],intensity:1,direction:[-1,3,-1]},{color:[255,255,255],intensity:.9,direction:[1,-8,-2.5]}],II=[0,0,0,200/255];class Gw{constructor(e={}){this.id="lighting-effect",this.shadowColor=II,this.shadow=!1,this.ambientLight=null,this.directionalLights=[],this.pointLights=[],this.shadowPasses=[],this.shadowMaps=[],this.dummyShadowMap=null,this.setProps(e)}setup(e){this.context=e;const{device:n,deck:i}=e;this.shadow&&!this.dummyShadowMap&&(this._createShadowPasses(n),i._addDefaultShaderModule(P0),this.dummyShadowMap=n.createTexture({width:1,height:1}))}setProps(e){this.ambientLight=null,this.directionalLights=[],this.pointLights=[];for(const n in e){const i=e[n];switch(i.type){case"ambient":this.ambientLight=i;break;case"directional":this.directionalLights.push(i);break;case"point":this.pointLights.push(i);break}}this._applyDefaultLights(),this.shadow=this.directionalLights.some(n=>n.shadow),this.context&&this.setup(this.context),this.props=e}preRender({layers:e,layerFilter:n,viewports:i,onViewportActive:r,views:s}){if(this.shadow){this.shadowMatrices=this._calculateMatrices();for(let o=0;o<this.shadowPasses.length;o++)this.shadowPasses[o].render({layers:e,layerFilter:n,viewports:i,onViewportActive:r,views:s,moduleParameters:{shadowLightId:o,dummyShadowMap:this.dummyShadowMap,shadowMatrices:this.shadowMatrices}})}}getModuleParameters(e){const n=this.shadow?{shadowMaps:this.shadowMaps,dummyShadowMap:this.dummyShadowMap,shadowColor:this.shadowColor,shadowMatrices:this.shadowMatrices}:{};return n.lightSources={ambientLight:this.ambientLight,directionalLights:this.directionalLights.map(i=>i.getProjectedLight({layer:e})),pointLights:this.pointLights.map(i=>i.getProjectedLight({layer:e}))},n}cleanup(e){for(const n of this.shadowPasses)n.delete();this.shadowPasses.length=0,this.shadowMaps.length=0,this.dummyShadowMap&&(this.dummyShadowMap.destroy(),this.dummyShadowMap=null,e.deck._removeDefaultShaderModule(P0))}_calculateMatrices(){const e=[];for(const n of this.directionalLights){const i=new Je().lookAt({eye:new V(n.direction).negate()});e.push(i)}return e}_createShadowPasses(e){for(let n=0;n<this.directionalLights.length;n++){const i=new PI(e);this.shadowPasses[n]=i,this.shadowMaps[n]=i.shadowMap}}_applyDefaultLights(){const{ambientLight:e,pointLights:n,directionalLights:i}=this;!e&&n.length===0&&i.length===0&&(this.ambientLight=new EI(MI),this.directionalLights.push(new M0(I0[0]),new M0(I0[1])))}}class OI{constructor(e={}){this._pool=[],this.opts={overAlloc:2,poolSize:100},this.setOptions(e)}setOptions(e){Object.assign(this.opts,e)}allocate(e,n,{size:i=1,type:r,padding:s=0,copy:o=!1,initialize:a=!1,maxCount:l}){const c=r||e&&e.constructor||Float32Array,u=n*i+s;if(ArrayBuffer.isView(e)){if(u<=e.length)return e;if(u*e.BYTES_PER_ELEMENT<=e.buffer.byteLength)return new c(e.buffer,0,u)}let h=1/0;l&&(h=l*i+s);const f=this._allocate(c,u,a,h);return e&&o?f.set(e):a||f.fill(0,0,4),this._release(e),f}release(e){this._release(e)}_allocate(e,n,i,r){let s=Math.max(Math.ceil(n*this.opts.overAlloc),1);s>r&&(s=r);const o=this._pool,a=e.BYTES_PER_ELEMENT*s,l=o.findIndex(c=>c.byteLength>=a);if(l>=0){const c=new e(o.splice(l,1)[0],0,s);return i&&c.fill(0),c}return new e(s)}_release(e){if(!ArrayBuffer.isView(e))return;const n=this._pool,{buffer:i}=e,{byteLength:r}=i,s=n.findIndex(o=>o.byteLength>=r);s<0?n.push(i):(s>0||n.length<this.opts.poolSize)&&n.splice(s,0,i),n.length>this.opts.poolSize&&n.shift()}}const os=new OI;function qs(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}function NI(t){return[t[12],t[13],t[14]]}function kI(t){return{left:cr(t[3]+t[0],t[7]+t[4],t[11]+t[8],t[15]+t[12]),right:cr(t[3]-t[0],t[7]-t[4],t[11]-t[8],t[15]-t[12]),bottom:cr(t[3]+t[1],t[7]+t[5],t[11]+t[9],t[15]+t[13]),top:cr(t[3]-t[1],t[7]-t[5],t[11]-t[9],t[15]-t[13]),near:cr(t[3]+t[2],t[7]+t[6],t[11]+t[10],t[15]+t[14]),far:cr(t[3]-t[2],t[7]-t[6],t[11]-t[10],t[15]-t[14])}}const O0=new V;function cr(t,e,n,i){O0.set(t,e,n);const r=O0.len();return{distance:i/r,normal:new V(-t/r,-e/r,-n/r)}}function FI(t){return t-Math.fround(t)}let ks;function zh(t,e){const{size:n=1,startIndex:i=0}=e,r=e.endIndex!==void 0?e.endIndex:t.length,s=(r-i)/n;ks=os.allocate(ks,s,{type:Float32Array,size:n*2});let o=i,a=0;for(;o<r;){for(let l=0;l<n;l++){const c=t[o++];ks[a+l]=c,ks[a+l+n]=FI(c)}a+=n*2}return ks.subarray(0,s*n*2)}function DI(t){let e=null,n=!1;for(const i of t)i&&(e?(n||(e=[[e[0][0],e[0][1]],[e[1][0],e[1][1]]],n=!0),e[0][0]=Math.min(e[0][0],i[0][0]),e[0][1]=Math.min(e[0][1],i[0][1]),e[1][0]=Math.max(e[1][0],i[1][0]),e[1][1]=Math.max(e[1][1],i[1][1])):e=i);return e}const BI=Math.PI/180,UI=qs(),N0=[0,0,0],LI={unitsPerMeter:[1,1,1],metersPerUnit:[1,1,1]};function zI({width:t,height:e,orthographic:n,fovyRadians:i,focalDistance:r,padding:s,near:o,far:a}){const l=t/e,c=n?new Je().orthographic({fovy:i,aspect:l,focalDistance:r,near:o,far:a}):new Je().perspective({fovy:i,aspect:l,near:o,far:a});if(s){const{left:u=0,right:h=0,top:f=0,bottom:d=0}=s,p=$n((u+t-h)/2,0,t)-t/2,v=$n((f+e-d)/2,0,e)-e/2;c[8]-=p*2/t,c[9]+=v*2/e}return c}const qc=class qc{constructor(e={}){this._frustumPlanes={},this.id=e.id||this.constructor.displayName||"viewport",this.x=e.x||0,this.y=e.y||0,this.width=e.width||1,this.height=e.height||1,this.zoom=e.zoom||0,this.padding=e.padding,this.distanceScales=e.distanceScales||LI,this.focalDistance=e.focalDistance||1,this.position=e.position||N0,this.modelMatrix=e.modelMatrix||null;const{longitude:n,latitude:i}=e;this.isGeospatial=Number.isFinite(i)&&Number.isFinite(n),this._initProps(e),this._initMatrices(e),this.equals=this.equals.bind(this),this.project=this.project.bind(this),this.unproject=this.unproject.bind(this),this.projectPosition=this.projectPosition.bind(this),this.unprojectPosition=this.unprojectPosition.bind(this),this.projectFlat=this.projectFlat.bind(this),this.unprojectFlat=this.unprojectFlat.bind(this)}get subViewports(){return null}get metersPerPixel(){return this.distanceScales.metersPerUnit[2]/this.scale}get projectionMode(){return this.isGeospatial?this.zoom<12?Nt.WEB_MERCATOR:Nt.WEB_MERCATOR_AUTO_OFFSET:Nt.IDENTITY}equals(e){return e instanceof qc?this===e?!0:e.width===this.width&&e.height===this.height&&e.scale===this.scale&&wn(e.projectionMatrix,this.projectionMatrix)&&wn(e.viewMatrix,this.viewMatrix):!1}project(e,{topLeft:n=!0}={}){const i=this.projectPosition(e),r=Qw(i,this.pixelProjectionMatrix),[s,o]=r,a=n?o:this.height-o;return e.length===2?[s,a]:[s,a,r[2]]}unproject(e,{topLeft:n=!0,targetZ:i}={}){const[r,s,o]=e,a=n?s:this.height-s,l=i&&i*this.distanceScales.unitsPerMeter[2],c=bg([r,a,o],this.pixelUnprojectionMatrix,l),[u,h,f]=this.unprojectPosition(c);return Number.isFinite(o)?[u,h,f]:Number.isFinite(i)?[u,h,i]:[u,h]}projectPosition(e){const[n,i]=this.projectFlat(e),r=(e[2]||0)*this.distanceScales.unitsPerMeter[2];return[n,i,r]}unprojectPosition(e){const[n,i]=this.unprojectFlat(e),r=(e[2]||0)*this.distanceScales.metersPerUnit[2];return[n,i,r]}projectFlat(e){if(this.isGeospatial){const n=rs(e);return n[1]=$n(n[1],-318,830),n}return e}unprojectFlat(e){return this.isGeospatial?ss(e):e}getBounds(e={}){const n={targetZ:e.z||0},i=this.unproject([0,0],n),r=this.unproject([this.width,0],n),s=this.unproject([0,this.height],n),o=this.unproject([this.width,this.height],n);return[Math.min(i[0],r[0],s[0],o[0]),Math.min(i[1],r[1],s[1],o[1]),Math.max(i[0],r[0],s[0],o[0]),Math.max(i[1],r[1],s[1],o[1])]}getDistanceScales(e){return e?Id({longitude:e[0],latitude:e[1],highPrecision:!0}):this.distanceScales}containsPixel({x:e,y:n,width:i=1,height:r=1}){return e<this.x+this.width&&this.x<e+i&&n<this.y+this.height&&this.y<n+r}getFrustumPlanes(){return this._frustumPlanes.near?this._frustumPlanes:(Object.assign(this._frustumPlanes,kI(this.viewProjectionMatrix)),this._frustumPlanes)}panByPosition(e,n){return null}_initProps(e){const n=e.longitude,i=e.latitude;this.isGeospatial&&(Number.isFinite(e.zoom)||(this.zoom=GM({latitude:i})+Math.log2(this.focalDistance)),this.distanceScales=e.distanceScales||Id({latitude:i,longitude:n}));const r=Math.pow(2,this.zoom);this.scale=r;const{position:s,modelMatrix:o}=e;let a=N0;if(s&&(a=o?new Je(o).transformAsVector(s,[]):s),this.isGeospatial){const l=this.projectPosition([n,i,0]);this.center=new V(a).scale(this.distanceScales.unitsPerMeter).add(l)}else this.center=this.projectPosition(a)}_initMatrices(e){const{viewMatrix:n=UI,projectionMatrix:i=null,orthographic:r=!1,fovyRadians:s,fovy:o=75,near:a=.1,far:l=1e3,padding:c=null,focalDistance:u=1}=e;this.viewMatrixUncentered=n,this.viewMatrix=new Je().multiplyRight(n).translate(new V(this.center).negate()),this.projectionMatrix=i||zI({width:this.width,height:this.height,orthographic:r,fovyRadians:s||o*BI,focalDistance:u,padding:c,near:a,far:l});const h=qs();ki(h,h,this.projectionMatrix),ki(h,h,this.viewMatrix),this.viewProjectionMatrix=h,this.viewMatrixInverse=Rd([],this.viewMatrix)||this.viewMatrix,this.cameraPosition=NI(this.viewMatrixInverse);const f=qs(),d=qs();Sg(f,f,[this.width/2,-this.height/2,1]),Ec(f,f,[1,-1,0]),ki(d,f,this.viewProjectionMatrix),this.pixelProjectionMatrix=d,this.pixelUnprojectionMatrix=Rd(qs(),this.pixelProjectionMatrix),this.pixelUnprojectionMatrix||Q.warn("Pixel project matrix not invertible")()}};qc.displayName="Viewport";let zo=qc;const yo=class yo extends zo{constructor(e={}){const{latitude:n=0,longitude:i=0,zoom:r=0,pitch:s=0,bearing:o=0,nearZMultiplier:a=.1,farZMultiplier:l=1.01,nearZ:c,farZ:u,orthographic:h=!1,projectionMatrix:f,repeat:d=!1,worldOffset:p=0,position:v,padding:A,legacyMeterSizes:y=!1}=e;let{width:g,height:_,altitude:E=1.5}=e;const R=Math.pow(2,r);g=g||1,_=_||1;let P,I=null;if(f)E=f[5]/2,P=Ac(E);else{e.fovy?(P=e.fovy,E=Zw(P)):P=Ac(E);let k;if(A){const{top:D=0,bottom:H=0}=A;k=[0,$n((D+_-H)/2,0,_)-_/2]}I=tI({width:g,height:_,scale:R,center:v&&[0,0,v[2]*Lh(n)],offset:k,pitch:s,fovy:P,nearZMultiplier:a,farZMultiplier:l}),Number.isFinite(c)&&(I.near=c),Number.isFinite(u)&&(I.far=u)}let O=eI({height:_,pitch:s,bearing:o,scale:R,altitude:E});p&&(O=new Je().translate([512*p,0,0]).multiplyLeft(O)),super({...e,width:g,height:_,viewMatrix:O,longitude:i,latitude:n,zoom:r,...I,fovy:P,focalDistance:E}),this.latitude=n,this.longitude=i,this.zoom=r,this.pitch=s,this.bearing=o,this.altitude=E,this.fovy=P,this.orthographic=h,this._subViewports=d?[]:null,this._pseudoMeters=y,Object.freeze(this)}get subViewports(){if(this._subViewports&&!this._subViewports.length){const e=this.getBounds(),n=Math.floor((e[0]+180)/360),i=Math.ceil((e[2]-180)/360);for(let r=n;r<=i;r++){const s=r?new yo({...this,worldOffset:r}):this;this._subViewports.push(s)}}return this._subViewports}projectPosition(e){if(this._pseudoMeters)return super.projectPosition(e);const[n,i]=this.projectFlat(e),r=(e[2]||0)*Lh(e[1]);return[n,i,r]}unprojectPosition(e){if(this._pseudoMeters)return super.unprojectPosition(e);const[n,i]=this.unprojectFlat(e),r=(e[2]||0)/Lh(i);return[n,i,r]}addMetersToLngLat(e,n){return qw(e,n)}panByPosition(e,n){const i=bg(n,this.pixelUnprojectionMatrix),r=this.projectFlat(e),s=g0([],r,l2([],i)),o=g0([],this.center,s),[a,l]=this.unprojectFlat(o);return{longitude:a,latitude:l}}getBounds(e={}){const n=rI(this,e.z||0);return[Math.min(n[0][0],n[1][0],n[2][0],n[3][0]),Math.min(n[0][1],n[1][1],n[2][1],n[3][1]),Math.max(n[0][0],n[1][0],n[2][0],n[3][0]),Math.max(n[0][1],n[1][1],n[2][1],n[3][1])]}fitBounds(e,n={}){const{width:i,height:r}=this,{longitude:s,latitude:o,zoom:a}=nI({width:i,height:r,bounds:e,...n});return new yo({width:i,height:r,longitude:s,latitude:o,zoom:a})}};yo.displayName="WebMercatorViewport";let as=yo;const k0=[0,0,0];function Vh(t,e,n=!1){const i=e.projectPosition(t);if(n&&e instanceof as){const[r,s,o=0]=t,a=e.getDistanceScales([r,s]);i[2]=o*a.unitsPerMeter[2]}return i}function VI(t){const{viewport:e,modelMatrix:n,coordinateOrigin:i}=t;let{coordinateSystem:r,fromCoordinateSystem:s,fromCoordinateOrigin:o}=t;return r===ee.DEFAULT&&(r=e.isGeospatial?ee.LNGLAT:ee.CARTESIAN),s===void 0&&(s=r),o===void 0&&(o=i),{viewport:e,coordinateSystem:r,coordinateOrigin:i,modelMatrix:n,fromCoordinateSystem:s,fromCoordinateOrigin:o}}function eE(t,{viewport:e,modelMatrix:n,coordinateSystem:i,coordinateOrigin:r,offsetMode:s}){let[o,a,l=0]=t;switch(n&&([o,a,l]=ps([],[o,a,l,1],n)),i){case ee.LNGLAT:return Vh([o,a,l],e,s);case ee.LNGLAT_OFFSETS:return Vh([o+r[0],a+r[1],l+(r[2]||0)],e,s);case ee.METER_OFFSETS:return Vh(qw(r,[o,a,l]),e,s);case ee.CARTESIAN:default:return e.isGeospatial?[o+r[0],a+r[1],l+r[2]]:e.projectPosition([o,a,l])}}function jI(t,e){const{viewport:n,coordinateSystem:i,coordinateOrigin:r,modelMatrix:s,fromCoordinateSystem:o,fromCoordinateOrigin:a}=VI(e),{autoOffset:l=!0}=e,{geospatialOrigin:c=k0,shaderCoordinateOrigin:u=k0,offsetMode:h=!1}=l?Yw(n,i,r):{},f=eE(t,{viewport:n,modelMatrix:s,coordinateSystem:o,coordinateOrigin:a,offsetMode:h});if(h){const d=n.projectPosition(c||u);Fw(f,f,d)}return f}let WI=1,HI=1;class tE{constructor(){m(this,"time",0);m(this,"channels",new Map);m(this,"animations",new Map);m(this,"playing",!1);m(this,"lastEngineTime",-1)}addChannel(e){const{delay:n=0,duration:i=Number.POSITIVE_INFINITY,rate:r=1,repeat:s=1}=e,o=WI++,a={time:0,delay:n,duration:i,rate:r,repeat:s};return this._setChannelTime(a,this.time),this.channels.set(o,a),o}removeChannel(e){this.channels.delete(e);for(const[n,i]of this.animations)i.channel===e&&this.detachAnimation(n)}isFinished(e){const n=this.channels.get(e);return n===void 0?!1:this.time>=n.delay+n.duration*n.repeat}getTime(e){if(e===void 0)return this.time;const n=this.channels.get(e);return n===void 0?-1:n.time}setTime(e){this.time=Math.max(0,e);const n=this.channels.values();for(const r of n)this._setChannelTime(r,this.time);const i=this.animations.values();for(const r of i){const{animation:s,channel:o}=r;s.setTime(this.getTime(o))}}play(){this.playing=!0}pause(){this.playing=!1,this.lastEngineTime=-1}reset(){this.setTime(0)}attachAnimation(e,n){const i=HI++;return this.animations.set(i,{animation:e,channel:n}),e.setTime(this.getTime(n)),i}detachAnimation(e){this.animations.delete(e)}update(e){this.playing&&(this.lastEngineTime===-1&&(this.lastEngineTime=e),this.setTime(this.time+(e-this.lastEngineTime)),this.lastEngineTime=e)}_setChannelTime(e,n){const i=n-e.delay,r=e.duration*e.repeat;i>=r?e.time=e.duration*e.rate:(e.time=Math.max(0,i)%e.duration,e.time*=e.rate)}}let $I=0;const XI={device:null,onAddHTML:()=>"",onInitialize:async()=>null,onRender:()=>{},onFinalize:()=>{},onError:t=>console.error(t),stats:Ni.stats.get(`animation-loop-${$I++}`),useDevicePixels:!0,autoResizeViewport:!1,autoResizeDrawingBuffer:!1};class YI{constructor(e){m(this,"device",null);m(this,"canvas",null);m(this,"props");m(this,"animationProps",null);m(this,"timeline",null);m(this,"stats");m(this,"cpuTime");m(this,"gpuTime");m(this,"frameRate");m(this,"display");m(this,"needsRedraw","initialized");m(this,"_initialized",!1);m(this,"_running",!1);m(this,"_animationFrameId",null);m(this,"_nextFramePromise",null);m(this,"_resolveNextFrame",null);m(this,"_cpuStartTime",0);if(this.props={...XI,...e},e=this.props,!e.device)throw new Error("No device provided");const{useDevicePixels:n=!0}=this.props;this.stats=e.stats||new ra({id:"animation-loop-stats"}),this.cpuTime=this.stats.get("CPU Time"),this.gpuTime=this.stats.get("GPU Time"),this.frameRate=this.stats.get("Frame Rate"),this.setProps({autoResizeViewport:e.autoResizeViewport,autoResizeDrawingBuffer:e.autoResizeDrawingBuffer,useDevicePixels:n}),this.start=this.start.bind(this),this.stop=this.stop.bind(this),this._onMousemove=this._onMousemove.bind(this),this._onMouseleave=this._onMouseleave.bind(this)}destroy(){this.stop(),this._setDisplay(null)}delete(){this.destroy()}setNeedsRedraw(e){return this.needsRedraw=this.needsRedraw||e,this}setProps(e){return"autoResizeViewport"in e&&(this.props.autoResizeViewport=e.autoResizeViewport||!1),"autoResizeDrawingBuffer"in e&&(this.props.autoResizeDrawingBuffer=e.autoResizeDrawingBuffer||!1),"useDevicePixels"in e&&(this.props.useDevicePixels=e.useDevicePixels||!1),this}async start(){if(this._running)return this;this._running=!0;try{let e;return this._initialized||(this._initialized=!0,await this._initDevice(),this._initialize(),await this.props.onInitialize(this._getAnimationProps())),this._running?(e!==!1&&(this._cancelAnimationFrame(),this._requestAnimationFrame()),this):null}catch(e){const n=e instanceof Error?e:new Error("Unknown error");throw this.props.onError(n),n}}stop(){return this._running&&(this.animationProps&&this.props.onFinalize(this.animationProps),this._cancelAnimationFrame(),this._nextFramePromise=null,this._resolveNextFrame=null,this._running=!1),this}redraw(){var e;return(e=this.device)!=null&&e.isLost?this:(this._beginFrameTimers(),this._setupFrame(),this._updateAnimationProps(),this._renderFrame(this._getAnimationProps()),this._clearNeedsRedraw(),this._resolveNextFrame&&(this._resolveNextFrame(this),this._nextFramePromise=null,this._resolveNextFrame=null),this._endFrameTimers(),this)}attachTimeline(e){return this.timeline=e,this.timeline}detachTimeline(){this.timeline=null}waitForRender(){return this.setNeedsRedraw("waitForRender"),this._nextFramePromise||(this._nextFramePromise=new Promise(e=>{this._resolveNextFrame=e})),this._nextFramePromise}async toDataURL(){if(this.setNeedsRedraw("toDataURL"),await this.waitForRender(),this.canvas instanceof HTMLCanvasElement)return this.canvas.toDataURL();throw new Error("OffscreenCanvas")}_initialize(){this._startEventHandling(),this._initializeAnimationProps(),this._updateAnimationProps(),this._resizeCanvasDrawingBuffer(),this._resizeViewport()}_setDisplay(e){this.display&&(this.display.destroy(),this.display.animationLoop=null),e&&(e.animationLoop=this),this.display=e}_requestAnimationFrame(){this._running&&(this._animationFrameId=hP(this._animationFrame.bind(this)))}_cancelAnimationFrame(){this._animationFrameId!==null&&(fP(this._animationFrameId),this._animationFrameId=null)}_animationFrame(){this._running&&(this.redraw(),this._requestAnimationFrame())}_renderFrame(e){if(this.display){this.display._renderFrame(e);return}this.props.onRender(this._getAnimationProps()),this.device.submit()}_clearNeedsRedraw(){this.needsRedraw=!1}_setupFrame(){this._resizeCanvasDrawingBuffer(),this._resizeViewport()}_initializeAnimationProps(){var e,n;if(!this.device)throw new Error("loop");this.animationProps={animationLoop:this,device:this.device,canvas:(n=(e=this.device)==null?void 0:e.canvasContext)==null?void 0:n.canvas,timeline:this.timeline,useDevicePixels:this.props.useDevicePixels,needsRedraw:!1,width:1,height:1,aspect:1,time:0,startTime:Date.now(),engineTime:0,tick:0,tock:0,_mousePosition:null}}_getAnimationProps(){if(!this.animationProps)throw new Error("animationProps");return this.animationProps}_updateAnimationProps(){if(!this.animationProps)return;const{width:e,height:n,aspect:i}=this._getSizeAndAspect();(e!==this.animationProps.width||n!==this.animationProps.height)&&this.setNeedsRedraw("drawing buffer resized"),i!==this.animationProps.aspect&&this.setNeedsRedraw("drawing buffer aspect changed"),this.animationProps.width=e,this.animationProps.height=n,this.animationProps.aspect=i,this.animationProps.needsRedraw=this.needsRedraw,this.animationProps.engineTime=Date.now()-this.animationProps.startTime,this.timeline&&this.timeline.update(this.animationProps.engineTime),this.animationProps.tick=Math.floor(this.animationProps.time/1e3*60),this.animationProps.tock++,this.animationProps.time=this.timeline?this.timeline.getTime():this.animationProps.engineTime}async _initDevice(){var e;if(this.device=await this.props.device,!this.device)throw new Error("No device provided");this.canvas=((e=this.device.canvasContext)==null?void 0:e.canvas)||null}_createInfoDiv(){if(this.canvas&&this.props.onAddHTML){const e=document.createElement("div");document.body.appendChild(e),e.style.position="relative";const n=document.createElement("div");n.style.position="absolute",n.style.left="10px",n.style.bottom="10px",n.style.width="300px",n.style.background="white",this.canvas instanceof HTMLCanvasElement&&e.appendChild(this.canvas),e.appendChild(n);const i=this.props.onAddHTML(n);i&&(n.innerHTML=i)}}_getSizeAndAspect(){var s,o,a,l;if(!this.device)return{width:1,height:1,aspect:1};const[e,n]=((o=(s=this.device)==null?void 0:s.canvasContext)==null?void 0:o.getPixelSize())||[1,1];let i=1;const r=(l=(a=this.device)==null?void 0:a.canvasContext)==null?void 0:l.canvas;return r&&r.clientHeight?i=r.clientWidth/r.clientHeight:e>0&&n>0&&(i=e/n),{width:e,height:n,aspect:i}}_resizeViewport(){this.props.autoResizeViewport&&this.device.gl&&this.device.gl.viewport(0,0,this.device.gl.drawingBufferWidth,this.device.gl.drawingBufferHeight)}_resizeCanvasDrawingBuffer(){var e,n;this.props.autoResizeDrawingBuffer&&((n=(e=this.device)==null?void 0:e.canvasContext)==null||n.resize({useDevicePixels:this.props.useDevicePixels}))}_beginFrameTimers(){this.frameRate.timeEnd(),this.frameRate.timeStart(),this.cpuTime.timeStart()}_endFrameTimers(){this.cpuTime.timeEnd()}_startEventHandling(){this.canvas&&(this.canvas.addEventListener("mousemove",this._onMousemove.bind(this)),this.canvas.addEventListener("mouseleave",this._onMouseleave.bind(this)))}_onMousemove(e){e instanceof MouseEvent&&(this._getAnimationProps()._mousePosition=[e.offsetX,e.offsetY])}_onMouseleave(e){this._getAnimationProps()._mousePosition=null}}class F0{constructor(e){m(this,"id");m(this,"userData",{});m(this,"topology");m(this,"bufferLayout",[]);m(this,"vertexCount");m(this,"indices");m(this,"attributes");this.id=e.id||Qi("geometry"),this.topology=e.topology,this.indices=e.indices||null,this.attributes=e.attributes,this.vertexCount=e.vertexCount,this.bufferLayout=e.bufferLayout||[],this.indices&&le(this.indices.usage===de.INDEX)}destroy(){var e;(e=this.indices)==null||e.destroy();for(const n of Object.values(this.attributes))n.destroy()}getVertexCount(){return this.vertexCount}getAttributes(){return this.attributes}getIndexes(){return this.indices}_calculateVertexCount(e){return e.byteLength/12}}function KI(t,e){if(e instanceof F0)return e;const n=qI(t,e),{attributes:i,bufferLayout:r}=ZI(t,e);return new F0({topology:e.topology||"triangle-list",bufferLayout:r,vertexCount:e.vertexCount,indices:n,attributes:i})}function qI(t,e){if(!e.indices)return;const n=e.indices.value;return t.createBuffer({usage:de.INDEX,data:n})}function ZI(t,e){const n=[],i={};for(const[s,o]of Object.entries(e.attributes)){let a=s;switch(s){case"POSITION":a="positions";break;case"NORMAL":a="normals";break;case"TEXCOORD_0":a="texCoords";break;case"COLOR_0":a="colors";break}i[a]=t.createBuffer({data:o.value,id:`${s}-buffer`});const{value:l,size:c,normalized:u}=o;n.push({name:a,format:oP(l,c,u)})}const r=e._calculateVertexCount(e.attributes,e.indices);return{attributes:i,bufferLayout:n,vertexCount:r}}class QI{constructor(e){m(this,"modules");m(this,"moduleUniforms");m(this,"moduleBindings");m(this,"moduleUniformsChanged");const n=Cu(Object.values(e));U.log(1,"Creating ShaderInputs with modules",n.map(i=>i.name))(),this.modules=e,this.moduleUniforms={},this.moduleBindings={};for(const[i,r]of Object.entries(e)){const s=i;this.moduleUniforms[s]=r.defaultUniforms||{},this.moduleBindings[s]={}}}destroy(){}setProps(e){var n;for(const i of Object.keys(e)){const r=i,s=e[r],o=this.modules[r];if(!o){U.warn(`Module ${i} not found`)();continue}const a=this.moduleUniforms[r],l=((n=o.getUniforms)==null?void 0:n.call(o,s,this.moduleUniforms[r]))||s;this.moduleUniforms[r]={...a,...l}}}getModules(){return Object.values(this.modules)}getUniformValues(){return this.moduleUniforms}getBindings(){const e={};for(const n of Object.values(this.moduleBindings))Object.assign(e,n);return e}getDebugTable(){var n;const e={};for(const[i,r]of Object.entries(this.moduleUniforms))for(const[s,o]of Object.entries(r))e[`${i}.${s}`]={type:(n=this.modules[i].uniformTypes)==null?void 0:n[s],value:String(o)};return e}}const Zc=class Zc{constructor(e){m(this,"device");m(this,"_hashCounter",0);m(this,"_hashes",{});m(this,"_renderPipelineCache",{});m(this,"_computePipelineCache",{});this.device=e}static getDefaultPipelineFactory(e){return e._lumaData.defaultPipelineFactory=e._lumaData.defaultPipelineFactory||new Zc(e),e._lumaData.defaultPipelineFactory}createRenderPipeline(e){const n={...ts.defaultProps,...e},i=this._hashRenderPipeline(n);if(!this._renderPipelineCache[i]){const r=this.device.createRenderPipeline({...n,id:n.id?`${n.id}-cached`:void 0});r.hash=i,this._renderPipelineCache[i]={pipeline:r,useCount:0}}return this._renderPipelineCache[i].useCount++,this._renderPipelineCache[i].pipeline}createComputePipeline(e){const n={...Tc.defaultProps,...e},i=this._hashComputePipeline(n);if(!this._computePipelineCache[i]){const r=this.device.createComputePipeline({...n,id:n.id?`${n.id}-cached`:void 0});r.hash=i,this._computePipelineCache[i]={pipeline:r,useCount:0}}return this._computePipelineCache[i].useCount++,this._computePipelineCache[i].pipeline}release(e){const n=e.hash,i=e instanceof Tc?this._computePipelineCache:this._renderPipelineCache;i[n].useCount--,i[n].useCount===0&&(i[n].pipeline.destroy(),delete i[n])}_hashComputePipeline(e){return`${this._getHash(e.shader.source)}`}_hashRenderPipeline(e){const n=this._getHash(e.vs.source),i=e.fs?this._getHash(e.fs.source):0,r="-",s=this._getHash(JSON.stringify(e.bufferLayout));switch(this.device.type){case"webgl":return`${n}/${i}V${r}BL${s}`;default:const o=this._getHash(JSON.stringify(e.parameters));return`${n}/${i}V${r}T${e.topology}P${o}BL${s}`}}_getHash(e){return this._hashes[e]===void 0&&(this._hashes[e]=this._hashCounter++),this._hashes[e]}};m(Zc,"defaultProps",{...ts.defaultProps});let Od=Zc;const Qc=class Qc{constructor(e){m(this,"device");m(this,"_cache",{});this.device=e}static getDefaultShaderFactory(e){var n;return(n=e._lumaData).defaultShaderFactory||(n.defaultShaderFactory=new Qc(e)),e._lumaData.defaultShaderFactory}createShader(e){const n=this._hashShader(e);let i=this._cache[n];if(!i){const r=this.device.createShader({...e,id:e.id?`${e.id}-cached`:void 0});this._cache[n]=i={shader:r,useCount:0}}return i.useCount++,i.shader}release(e){const n=this._hashShader(e),i=this._cache[n];i&&(i.useCount--,i.useCount===0&&(delete this._cache[n],i.shader.destroy()))}_hashShader(e){return`${e.stage}:${e.source}`}};m(Qc,"defaultProps",{...mc.defaultProps});let Nd=Qc;function JI(t,e){var r;const n={},i="Values";if(t.attributes.length===0&&!((r=t.varyings)!=null&&r.length))return{"No attributes or varyings":{[i]:"N/A"}};for(const s of t.attributes)if(s){const o=`${s.location} ${s.name}: ${s.type}`;n[`in ${o}`]={[i]:s.stepMode||"vertex"}}for(const s of t.varyings||[]){const o=`${s.location} ${s.name}`;n[`out ${o}`]={[i]:JSON.stringify(s.accessor)}}return n}let Ie=null,jh=null;function GI(t,{id:e,minimap:n,opaque:i,top:r="0",left:s="0",rgbaScale:o=1}){Ie||(Ie=document.createElement("canvas"),Ie.id=e,Ie.title=e,Ie.style.zIndex="100",Ie.style.position="absolute",Ie.style.top=r,Ie.style.left=s,Ie.style.border="blue 1px solid",Ie.style.transform="scaleY(-1)",document.body.appendChild(Ie),jh=Ie.getContext("2d")),(Ie.width!==t.width||Ie.height!==t.height)&&(Ie.width=t.width/2,Ie.height=t.height/2,Ie.style.width="400px",Ie.style.height="400px");const a=t.device.readPixelsToArrayWebGL(t),l=jh.createImageData(t.width,t.height),c=0;for(let u=0;u<a.length;u+=4)l.data[c+u+0]=a[u+0]*o,l.data[c+u+1]=a[u+1]*o,l.data[c+u+2]=a[u+2]*o,l.data[c+u+3]=i?255:a[u+3]*o;jh.putImageData(l,0,0)}const ur=2,eO=1e4,Jc=class Jc{constructor(e,n){m(this,"device");m(this,"id");m(this,"source");m(this,"vs");m(this,"fs");m(this,"pipelineFactory");m(this,"shaderFactory");m(this,"userData",{});m(this,"parameters");m(this,"topology");m(this,"bufferLayout");m(this,"vertexCount");m(this,"instanceCount",0);m(this,"indexBuffer",null);m(this,"bufferAttributes",{});m(this,"constantAttributes",{});m(this,"bindings",{});m(this,"uniforms",{});m(this,"vertexArray");m(this,"transformFeedback",null);m(this,"pipeline");m(this,"shaderInputs");m(this,"_uniformStore");m(this,"_attributeInfos",{});m(this,"_gpuGeometry",null);m(this,"_getModuleUniforms");m(this,"props");m(this,"_pipelineNeedsUpdate","newly created");m(this,"_needsRedraw","initializing");m(this,"_destroyed",!1);m(this,"_lastDrawTimestamp",-1);m(this,"_lastLogTime",0);m(this,"_logOpen",!1);m(this,"_drawCount",0);var a,l,c,u;this.props={...Jc.defaultProps,...n},n=this.props,this.id=n.id||Qi("model"),this.device=e,Object.assign(this.userData,n.userData);const i=Object.fromEntries(((a=this.props.modules)==null?void 0:a.map(h=>[h.name,h]))||[]);this.setShaderInputs(n.shaderInputs||new QI(i));const r=tO(e),s=(((l=this.props.modules)==null?void 0:l.length)>0?this.props.modules:(c=this.shaderInputs)==null?void 0:c.getModules())||[];if(this.device.type==="webgpu"&&this.props.source){(u=this.props).shaderLayout||(u.shaderLayout=YP(this.props.source));const{source:h,getUniforms:f}=this.props.shaderAssembler.assembleShader({platformInfo:r,...this.props,modules:s});this.source=h,this._getModuleUniforms=f}else{const{vs:h,fs:f,getUniforms:d}=this.props.shaderAssembler.assembleShaderPair({platformInfo:r,...this.props,modules:s});this.vs=h,this.fs=f,this._getModuleUniforms=d}this.vertexCount=this.props.vertexCount,this.instanceCount=this.props.instanceCount,this.topology=this.props.topology,this.bufferLayout=this.props.bufferLayout,this.parameters=this.props.parameters,n.geometry&&this.setGeometry(n.geometry),this.pipelineFactory=n.pipelineFactory||Od.getDefaultPipelineFactory(this.device),this.shaderFactory=n.shaderFactory||Nd.getDefaultShaderFactory(this.device),this.pipeline=this._updatePipeline(),this.vertexArray=e.createVertexArray({renderPipeline:this.pipeline}),this._gpuGeometry&&this._setGeometryAttributes(this._gpuGeometry),n.vertexCount&&this.setVertexCount(n.vertexCount),n.instanceCount&&this.setInstanceCount(n.instanceCount),n.indexBuffer&&this.setIndexBuffer(n.indexBuffer),n.attributes&&this.setAttributes(n.attributes),n.constantAttributes&&this.setConstantAttributes(n.constantAttributes),n.bindings&&this.setBindings(n.bindings),n.uniforms&&this.setUniforms(n.uniforms),n.moduleSettings&&this.updateModuleSettings(n.moduleSettings),n.transformFeedback&&(this.transformFeedback=n.transformFeedback),Object.seal(this)}destroy(){var e;this._destroyed||(this.pipelineFactory.release(this.pipeline),this.shaderFactory.release(this.pipeline.vs),this.pipeline.fs&&this.shaderFactory.release(this.pipeline.fs),this._uniformStore.destroy(),(e=this._gpuGeometry)==null||e.destroy(),this._destroyed=!0)}needsRedraw(){this._getBindingsUpdateTimestamp()>this._lastDrawTimestamp&&this.setNeedsRedraw("contents of bound textures or buffers updated");const e=this._needsRedraw;return this._needsRedraw=!1,e}setNeedsRedraw(e){this._needsRedraw||(this._needsRedraw=e)}predraw(){this.updateShaderInputs(),this.pipeline=this._updatePipeline()}draw(e){this.predraw();let n;try{this._logDrawCallStart(),this.pipeline=this._updatePipeline(),this.pipeline.setBindings(this.bindings,{disableWarnings:this.props.disableWarnings}),gc(this.uniforms)||this.pipeline.setUniformsWebGL(this.uniforms);const{indexBuffer:i}=this.vertexArray,r=i?i.byteLength/(i.indexType==="uint32"?4:2):void 0;n=this.pipeline.draw({renderPass:e,vertexArray:this.vertexArray,vertexCount:this.vertexCount,instanceCount:this.instanceCount,indexCount:r,transformFeedback:this.transformFeedback||void 0,parameters:this.parameters,topology:this.topology})}finally{this._logDrawCallEnd()}return this._logFramebuffer(e),n?(this._lastDrawTimestamp=this.device.timestamp,this._needsRedraw=!1):this._needsRedraw="waiting for resource initialization",n}setGeometry(e){var i;(i=this._gpuGeometry)==null||i.destroy();const n=e&&KI(this.device,e);n&&(this.setTopology(n.topology||"triangle-list"),this.bufferLayout=D0(n.bufferLayout,this.bufferLayout),this.vertexArray&&this._setGeometryAttributes(n)),this._gpuGeometry=n}setTopology(e){e!==this.topology&&(this.topology=e,this._setPipelineNeedsUpdate("topology"))}setBufferLayout(e){this.bufferLayout=this._gpuGeometry?D0(e,this._gpuGeometry.bufferLayout):e,this._setPipelineNeedsUpdate("bufferLayout"),this.pipeline=this._updatePipeline(),this.vertexArray=this.device.createVertexArray({renderPipeline:this.pipeline}),this._gpuGeometry&&this._setGeometryAttributes(this._gpuGeometry)}setParameters(e){Ad(e,this.parameters,2)||(this.parameters=e,this._setPipelineNeedsUpdate("parameters"))}setVertexCount(e){this.vertexCount=e,this.setNeedsRedraw("vertexCount")}setInstanceCount(e){this.instanceCount=e,this.setNeedsRedraw("instanceCount")}setShaderInputs(e){this.shaderInputs=e,this._uniformStore=new sP(this.shaderInputs.modules);for(const n of Object.keys(this.shaderInputs.modules)){const i=this._uniformStore.getManagedUniformBuffer(this.device,n);this.bindings[`${n}Uniforms`]=i}this.setNeedsRedraw("shaderInputs")}updateShaderInputs(){this._uniformStore.setUniforms(this.shaderInputs.getUniformValues()),this.setNeedsRedraw("shaderInputs")}setBindings(e){Object.assign(this.bindings,e),this.setNeedsRedraw("bindings")}setTransformFeedback(e){this.transformFeedback=e,this.setNeedsRedraw("transformFeedback")}setIndexBuffer(e){this.vertexArray.setIndexBuffer(e),this.setNeedsRedraw("indexBuffer")}setAttributes(e,n){e.indices&&U.warn(`Model:${this.id} setAttributes() - indexBuffer should be set using setIndexBuffer()`)();for(const[i,r]of Object.entries(e)){const s=this.bufferLayout.find(l=>B0(l).includes(i));if(!s){U.warn(`Model(${this.id}): Missing layout for buffer "${i}".`)();continue}const o=B0(s);let a=!1;for(const l of o){const c=this._attributeInfos[l];c&&(this.vertexArray.setBuffer(c.location,r),a=!0)}!a&&!((n==null?void 0:n.disableWarnings)??this.props.disableWarnings)&&U.warn(`Model(${this.id}): Ignoring buffer "${r.id}" for unknown attribute "${i}"`)()}this.setNeedsRedraw("attributes")}setConstantAttributes(e,n){for(const[i,r]of Object.entries(e)){const s=this._attributeInfos[i];s?this.vertexArray.setConstantWebGL(s.location,r):((n==null?void 0:n.disableWarnings)??this.props.disableWarnings)||U.warn(`Model "${this.id}: Ignoring constant supplied for unknown attribute "${i}"`)()}this.setNeedsRedraw("constants")}setUniforms(e){gc(e)||(this.pipeline.setUniformsWebGL(e),Object.assign(this.uniforms,e)),this.setNeedsRedraw("uniforms")}updateModuleSettings(e){const{bindings:n,uniforms:i}=yw(this._getModuleUniforms(e));Object.assign(this.bindings,n),Object.assign(this.uniforms,i),this.setNeedsRedraw("moduleSettings")}_getBindingsUpdateTimestamp(){let e=0;for(const n of Object.values(this.bindings))n instanceof _c?e=Math.max(e,n.texture.updateTimestamp):n instanceof de||n instanceof Et?e=Math.max(e,n.updateTimestamp):n instanceof yc||(e=Math.max(e,n.buffer.updateTimestamp));return e}_setGeometryAttributes(e){const n={...e.attributes};for(const[i]of Object.entries(n))!this.pipeline.shaderLayout.attributes.find(r=>r.name===i)&&i!=="positions"&&delete n[i];this.vertexCount=e.vertexCount,this.setIndexBuffer(e.indices||null),this.setAttributes(e.attributes,{disableWarnings:!0}),this.setAttributes(n,{disableWarnings:this.props.disableWarnings}),this.setNeedsRedraw("geometry attributes")}_setPipelineNeedsUpdate(e){this._pipelineNeedsUpdate||(this._pipelineNeedsUpdate=e),this.setNeedsRedraw(e)}_updatePipeline(){if(this._pipelineNeedsUpdate){let e=null,n=null;this.pipeline&&(U.log(1,`Model ${this.id}: Recreating pipeline because "${this._pipelineNeedsUpdate}".`)(),e=this.pipeline.vs,n=this.pipeline.fs),this._pipelineNeedsUpdate=!1;const i=this.shaderFactory.createShader({id:`${this.id}-vertex`,stage:"vertex",source:this.source||this.vs,debug:this.props.debugShaders});let r=null;this.source?r=i:this.fs&&(r=this.shaderFactory.createShader({id:`${this.id}-fragment`,stage:"fragment",source:this.source||this.fs,debug:this.props.debugShaders})),this.pipeline=this.pipelineFactory.createRenderPipeline({...this.props,bufferLayout:this.bufferLayout,topology:this.topology,parameters:this.parameters,vs:i,fs:r}),this._attributeInfos=pw(this.pipeline.shaderLayout,this.bufferLayout),e&&this.shaderFactory.release(e),n&&this.shaderFactory.release(n)}return this.pipeline}_logDrawCallStart(){const e=U.level>3?0:eO;U.level<2||Date.now()-this._lastLogTime<e||(this._lastLogTime=Date.now(),this._logOpen=!0,U.group(ur,`>>> DRAWING MODEL ${this.id}`,{collapsed:U.level<=2})())}_logDrawCallEnd(){if(this._logOpen){const e=JI(this.pipeline.shaderLayout,this.id);U.table(ur,e)();const n=this.shaderInputs.getDebugTable();for(const[r,s]of Object.entries(this.uniforms))n[r]={value:s};U.table(ur,n)();const i=this._getAttributeDebugTable();U.table(ur,this._attributeInfos)(),U.table(ur,i)(),U.groupEnd(ur)(),this._logOpen=!1}}_logFramebuffer(e){const n=U.get("framebuffer");if(this._drawCount++,!n||this._drawCount++>3&&this._drawCount%60)return;const i=e.props.framebuffer;i&&GI(i,{id:i.id,minimap:!0})}_getAttributeDebugTable(){const e={};for(const[n,i]of Object.entries(this._attributeInfos))e[i.location]={name:n,type:i.shaderType,values:this._getBufferOrConstantValues(this.vertexArray.attributes[i.location],i.bufferDataType)};if(this.vertexArray.indexBuffer){const{indexBuffer:n}=this.vertexArray,i=n.indexType==="uint32"?new Uint32Array(n.debugData):new Uint16Array(n.debugData);e.indices={name:"indices",type:n.indexType,values:i.toString()}}return e}_getBufferOrConstantValues(e,n){const i=mw(n);return(e instanceof de?new i(e.debugData):e).toString()}};m(Jc,"defaultProps",{...ts.defaultProps,source:null,vs:null,fs:null,id:"unnamed",handle:void 0,userData:{},defines:{},modules:[],moduleSettings:void 0,geometry:null,indexBuffer:null,attributes:{},constantAttributes:{},varyings:[],shaderInputs:void 0,pipelineFactory:void 0,shaderFactory:void 0,transformFeedback:void 0,shaderAssembler:pc.getDefaultShaderAssembler(),debugShaders:void 0,disableWarnings:void 0});let Lt=Jc;function D0(t,e){const n=[...t];for(const i of e){const r=n.findIndex(s=>s.name===i.name);r<0?n.push(i):n[r]=i}return n}function tO(t){return{type:t.type,shaderLanguage:t.info.shadingLanguage,shaderLanguageVersion:t.info.shadingLanguageVersion,gpu:t.info.gpu,features:t.features}}function B0(t){var e;return t.attributes?(e=t.attributes)==null?void 0:e.map(n=>n.attribute):[t.name]}class Mu{constructor(e,n=Lt.defaultProps){m(this,"device");m(this,"model");m(this,"transformFeedback");le(Mu.isSupported(e),"BufferTransform not yet implemented on WebGPU"),this.device=e,this.model=new Lt(this.device,{id:n.id||"buffer-transform-model",fs:n.fs||aC(),topology:n.topology||"point-list",...n}),this.transformFeedback=this.device.createTransformFeedback({layout:this.model.pipeline.shaderLayout,buffers:n.feedbackBuffers}),this.model.setTransformFeedback(this.transformFeedback),Object.seal(this)}static isSupported(e){var n;return((n=e==null?void 0:e.info)==null?void 0:n.type)==="webgl"}destroy(){this.model&&this.model.destroy()}delete(){this.destroy()}run(e){const n=this.device.beginRenderPass(e);this.model.draw(n),n.end()}update(...e){console.warn("TextureTransform#update() not implemented")}getBuffer(e){return this.transformFeedback.getBuffer(e)}readAsync(e){const n=this.getBuffer(e);if(n instanceof de)return n.readAsync();const{buffer:i,byteOffset:r=0,byteLength:s=i.byteLength}=n;return i.readAsync(r,s)}}class ls{constructor(e){m(this,"id");m(this,"topology");m(this,"vertexCount");m(this,"indices");m(this,"attributes");m(this,"userData",{});const{attributes:n={},indices:i=null,vertexCount:r=null}=e;this.id=e.id||Qi("geometry"),this.topology=e.topology,i&&(this.indices=ArrayBuffer.isView(i)?{value:i,size:1}:i),this.attributes={};for(const[s,o]of Object.entries(n)){const a=ArrayBuffer.isView(o)?{value:o}:o;le(ArrayBuffer.isView(a.value),`${this._print(s)}: must be typed array or object with value as typed array`),(s==="POSITION"||s==="positions")&&!a.size&&(a.size=3),s==="indices"?(le(!this.indices),this.indices=a):this.attributes[s]=a}this.indices&&this.indices.isIndexed!==void 0&&(this.indices=Object.assign({},this.indices),delete this.indices.isIndexed),this.vertexCount=r||this._calculateVertexCount(this.attributes,this.indices)}getVertexCount(){return this.vertexCount}getAttributes(){return this.indices?{indices:this.indices,...this.attributes}:this.attributes}_print(e){return`Geometry ${this.id} attribute ${e}`}_setAttributes(e,n){return this}_calculateVertexCount(e,n){if(n)return n.value.length;let i=1/0;for(const r of Object.values(e)){const{value:s,size:o,constant:a}=r;!a&&s&&o>=1&&(i=Math.min(i,s.length/o))}return le(Number.isFinite(i)),i}}const nO={blendColorOperation:"add",blendColorSrcFactor:"one",blendColorDstFactor:"zero",blendAlphaOperation:"add",blendAlphaSrcFactor:"constant-alpha",blendAlphaDstFactor:"zero"};class nE extends Cg{constructor(){super(...arguments),this._colorEncoderState=null}render(e){return"pickingFBO"in e?this._drawPickingBuffer(e):super.render(e)}_drawPickingBuffer({layers:e,layerFilter:n,views:i,viewports:r,onViewportActive:s,pickingFBO:o,deviceRect:{x:a,y:l,width:c,height:u},cullRect:h,effects:f,pass:d="picking",pickZ:p,moduleParameters:v}){this.pickZ=p;const A=this._resetColorEncoder(p),y=[a,l,c,u],g=super.render({target:o,layers:e,layerFilter:n,views:i,viewports:r,onViewportActive:s,cullRect:h,effects:f==null?void 0:f.filter(E=>E.useInPicking),pass:d,isPicking:!0,moduleParameters:v,clearColor:[0,0,0,0],colorMask:15,scissorRect:y});return this._colorEncoderState=null,{decodePickingColor:A&&rO.bind(null,A),stats:g}}shouldDrawLayer(e){const{pickable:n,operation:i}=e.props;return n&&i.includes("draw")||i.includes("terrain")||i.includes("mask")}getModuleParameters(){return{picking:{isActive:1,isAttribute:this.pickZ},lightSources:{}}}getLayerParameters(e,n,i){const r={depthMask:!0,depthTest:!0,depthRange:[0,1],...e.props.parameters},{pickable:s,operation:o}=e.props;return!this._colorEncoderState||o.includes("terrain")?r.blend=!1:s&&o.includes("draw")&&(Object.assign(r,nO),r.blend=!0,r.blendColor=iO(this._colorEncoderState,e,i)),r}_resetColorEncoder(e){return this._colorEncoderState=e?null:{byLayer:new Map,byAlpha:[]},this._colorEncoderState}}function iO(t,e,n){const{byLayer:i,byAlpha:r}=t;let s,o=i.get(e);return o?(o.viewports.push(n),s=o.a):(s=i.size+1,s<=255?(o={a:s,layer:e,viewports:[n]},i.set(e,o),r[s]=o):(Q.warn("Too many pickable layers, only picking the first 255")(),s=0)),[0,0,0,s/255]}function rO(t,e){const n=t.byAlpha[e[3]];return n&&{pickedLayer:n.layer,pickedViewports:n.viewports,pickedObjectIndex:n.layer.decodePickingColor(e)}}const pr={NO_STATE:"Awaiting state",MATCHED:"Matched. State transferred from previous layer",INITIALIZED:"Initialized",AWAITING_GC:"Discarded. Awaiting garbage collection",AWAITING_FINALIZATION:"No longer matched. Awaiting garbage collection",FINALIZED:"Finalized! Awaiting garbage collection"},xc=Symbol.for("component"),ii=Symbol.for("propTypes"),Wh=Symbol.for("deprecatedProps"),Xr=Symbol.for("asyncPropDefaults"),Wi=Symbol.for("asyncPropOriginal"),Xn=Symbol.for("asyncPropResolved");function Iu(t,e=()=>!0){return Array.isArray(t)?iE(t,e,[]):e(t)?[t]:[]}function iE(t,e,n){let i=-1;for(;++i<t.length;){const r=t[i];Array.isArray(r)?iE(r,e,n):e(r)&&n.push(r)}return n}function sO({target:t,source:e,start:n=0,count:i=1}){const r=e.length,s=i*r;let o=0;for(let a=n;o<r;o++)t[a++]=e[o];for(;o<s;)o<s-o?(t.copyWithin(n+o,n,n+o),o*=2):(t.copyWithin(n+o,n,n+s-o),o=s);return t}class oO{constructor(e,n,i){this._loadCount=0,this._subscribers=new Set,this.id=e,this.context=i,this.setData(n)}subscribe(e){this._subscribers.add(e)}unsubscribe(e){this._subscribers.delete(e)}inUse(){return this._subscribers.size>0}delete(){}getData(){return this.isLoaded?this._error?Promise.reject(this._error):this._content:this._loader.then(()=>this.getData())}setData(e,n){if(e===this._data&&!n)return;this._data=e;const i=++this._loadCount;let r=e;typeof e=="string"&&(r=fc(e)),r instanceof Promise?(this.isLoaded=!1,this._loader=r.then(s=>{this._loadCount===i&&(this.isLoaded=!0,this._error=void 0,this._content=s)}).catch(s=>{this._loadCount===i&&(this.isLoaded=!0,this._error=s||!0)})):(this.isLoaded=!0,this._error=void 0,this._content=e);for(const s of this._subscribers)s.onChange(this.getData())}}class aO{constructor(e){var n;this.protocol=e.protocol||"resource://",this._context={device:e.device,gl:(n=e.device)==null?void 0:n.gl,resourceManager:this},this._resources={},this._consumers={},this._pruneRequest=null}contains(e){return e.startsWith(this.protocol)?!0:e in this._resources}add({resourceId:e,data:n,forceUpdate:i=!1,persistent:r=!0}){let s=this._resources[e];s?s.setData(n,i):(s=new oO(e,n,this._context),this._resources[e]=s),s.persistent=r}remove(e){const n=this._resources[e];n&&(n.delete(),delete this._resources[e])}unsubscribe({consumerId:e}){const n=this._consumers[e];if(n){for(const i in n){const r=n[i],s=this._resources[r.resourceId];s&&s.unsubscribe(r)}delete this._consumers[e],this.prune()}}subscribe({resourceId:e,onChange:n,consumerId:i,requestId:r="default"}){const{_resources:s,protocol:o}=this;e.startsWith(o)&&(e=e.replace(o,""),s[e]||this.add({resourceId:e,data:null,persistent:!1}));const a=s[e];if(this._track(i,r,a,n),a)return a.getData()}prune(){this._pruneRequest||(this._pruneRequest=setTimeout(()=>this._prune(),0))}finalize(){for(const e in this._resources)this._resources[e].delete()}_track(e,n,i,r){const s=this._consumers,o=s[e]=s[e]||{};let a=o[n];const l=a&&a.resourceId&&this._resources[a.resourceId];l&&(l.unsubscribe(a),this.prune()),i&&(a?(a.onChange=r,a.resourceId=i.id):a={onChange:r,resourceId:i.id},o[n]=a,i.subscribe(a))}_prune(){this._pruneRequest=null;for(const e of Object.keys(this._resources)){const n=this._resources[e];!n.persistent&&!n.inUse()&&(n.delete(),delete this._resources[e])}}}const lO="layerManager.setLayers",cO="layerManager.activateViewport";class uO{constructor(e,n){this._lastRenderedLayers=[],this._needsRedraw=!1,this._needsUpdate=!1,this._nextLayers=null,this._debug=!1,this._defaultShaderModulesChanged=!1,this.activateViewport=a=>{He(cO,this,a),a&&(this.context.viewport=a)};const{deck:i,stats:r,viewport:s,timeline:o}=n||{};this.layers=[],this.resourceManager=new aO({device:e,protocol:"deck://"}),this.context={mousePosition:null,userData:{},layerManager:this,device:e,gl:e==null?void 0:e.gl,deck:i,shaderAssembler:yI(),defaultShaderModules:[],renderPass:void 0,stats:r||new ra({id:"deck.gl"}),viewport:s||new zo({id:"DEFAULT-INITIAL-VIEWPORT"}),timeline:o||new tE,resourceManager:this.resourceManager,onError:void 0},Object.seal(this)}finalize(){this.resourceManager.finalize();for(const e of this.layers)this._finalizeLayer(e)}needsRedraw(e={clearRedrawFlags:!1}){let n=this._needsRedraw;e.clearRedrawFlags&&(this._needsRedraw=!1);for(const i of this.layers){const r=i.getNeedsRedraw(e);n=n||r}return n}needsUpdate(){return this._nextLayers&&this._nextLayers!==this._lastRenderedLayers?"layers changed":this._defaultShaderModulesChanged?"shader modules changed":this._needsUpdate}setNeedsRedraw(e){this._needsRedraw=this._needsRedraw||e}setNeedsUpdate(e){this._needsUpdate=this._needsUpdate||e}getLayers({layerIds:e}={}){return e?this.layers.filter(n=>e.find(i=>n.id.indexOf(i)===0)):this.layers}setProps(e){"debug"in e&&(this._debug=e.debug),"userData"in e&&(this.context.userData=e.userData),"layers"in e&&(this._nextLayers=e.layers),"onError"in e&&(this.context.onError=e.onError)}setLayers(e,n){He(lO,this,n,e),this._lastRenderedLayers=e;const i=Iu(e,Boolean);for(const r of i)r.context=this.context;this._updateLayers(this.layers,i)}updateLayers(){const e=this.needsUpdate();e&&(this.setNeedsRedraw(`updating layers: ${e}`),this.setLayers(this._nextLayers||this._lastRenderedLayers,e)),this._nextLayers=null}addDefaultShaderModule(e){const{defaultShaderModules:n}=this.context;n.find(i=>i.name===e.name)||(n.push(e),this._defaultShaderModulesChanged=!0)}removeDefaultShaderModule(e){const{defaultShaderModules:n}=this.context,i=n.findIndex(r=>r.name===e.name);i>=0&&(n.splice(i,1),this._defaultShaderModulesChanged=!0)}_handleError(e,n,i){i.raiseError(n,`${e} of ${i}`)}_updateLayers(e,n){const i={};for(const o of e)i[o.id]?Q.warn(`Multiple old layers with same id ${o.id}`)():i[o.id]=o;if(this._defaultShaderModulesChanged){for(const o of e)o.setNeedsUpdate(),o.setChangeFlags({extensionsChanged:!0});this._defaultShaderModulesChanged=!1}const r=[];this._updateSublayersRecursively(n,i,r),this._finalizeOldLayers(i);let s=!1;for(const o of r)if(o.hasUniformTransition()){s=`Uniform transition in ${o}`;break}this._needsUpdate=s,this.layers=r}_updateSublayersRecursively(e,n,i){for(const r of e){r.context=this.context;const s=n[r.id];s===null&&Q.warn(`Multiple new layers with same id ${r.id}`)(),n[r.id]=null;let o=null;try{this._debug&&s!==r&&r.validateProps(),s?(this._transferLayerState(s,r),this._updateLayer(r)):this._initializeLayer(r),i.push(r),o=r.isComposite?r.getSubLayers():null}catch(a){this._handleError("matching",a,r)}o&&this._updateSublayersRecursively(o,n,i)}}_finalizeOldLayers(e){for(const n in e){const i=e[n];i&&this._finalizeLayer(i)}}_initializeLayer(e){try{e._initialize(),e.lifecycle=pr.INITIALIZED}catch(n){this._handleError("initialization",n,e)}}_transferLayerState(e,n){n._transferState(e),n.lifecycle=pr.MATCHED,n!==e&&(e.lifecycle=pr.AWAITING_GC)}_updateLayer(e){try{e._update()}catch(n){this._handleError("update",n,e)}}_finalizeLayer(e){this._needsRedraw=this._needsRedraw||`finalized ${e}`,e.lifecycle=pr.AWAITING_FINALIZATION;try{e._finalize(),e.lifecycle=pr.FINALIZED}catch(n){this._handleError("finalization",n,e)}}}function Ft(t,e,n){if(t===e)return!0;if(!n||!t||!e)return!1;if(Array.isArray(t)){if(!Array.isArray(e)||t.length!==e.length)return!1;for(let i=0;i<t.length;i++)if(!Ft(t[i],e[i],n-1))return!1;return!0}if(Array.isArray(e))return!1;if(typeof t=="object"&&typeof e=="object"){const i=Object.keys(t),r=Object.keys(e);if(i.length!==r.length)return!1;for(const s of i)if(!e.hasOwnProperty(s)||!Ft(t[s],e[s],n-1))return!1;return!0}return!1}class hO{constructor(e){this.views=[],this.width=100,this.height=100,this.viewState={},this.controllers={},this.timeline=e.timeline,this._viewports=[],this._viewportMap={},this._isUpdating=!1,this._needsRedraw="First render",this._needsUpdate="Initialize",this._eventManager=e.eventManager,this._eventCallbacks={onViewStateChange:e.onViewStateChange,onInteractionStateChange:e.onInteractionStateChange},Object.seal(this),this.setProps(e)}finalize(){for(const e in this.controllers){const n=this.controllers[e];n&&n.finalize()}this.controllers={}}needsRedraw(e={clearRedrawFlags:!1}){const n=this._needsRedraw;return e.clearRedrawFlags&&(this._needsRedraw=!1),n}setNeedsUpdate(e){this._needsUpdate=this._needsUpdate||e,this._needsRedraw=this._needsRedraw||e}updateViewStates(){for(const e in this.controllers){const n=this.controllers[e];n&&n.updateTransition()}}getViewports(e){return e?this._viewports.filter(n=>n.containsPixel(e)):this._viewports}getViews(){const e={};return this.views.forEach(n=>{e[n.id]=n}),e}getView(e){return this.views.find(n=>n.id===e)}getViewState(e){const n=typeof e=="string"?this.getView(e):e,i=n&&this.viewState[n.getViewStateId()]||this.viewState;return n?n.filterViewState(i):i}getViewport(e){return this._viewportMap[e]}unproject(e,n){const i=this.getViewports(),r={x:e[0],y:e[1]};for(let s=i.length-1;s>=0;--s){const o=i[s];if(o.containsPixel(r)){const a=e.slice();return a[0]-=o.x,a[1]-=o.y,o.unproject(a,n)}}return null}setProps(e){e.views&&this._setViews(e.views),e.viewState&&this._setViewState(e.viewState),("width"in e||"height"in e)&&this._setSize(e.width,e.height),this._isUpdating||this._update()}_update(){this._isUpdating=!0,this._needsUpdate&&(this._needsUpdate=!1,this._rebuildViewports()),this._needsUpdate&&(this._needsUpdate=!1,this._rebuildViewports()),this._isUpdating=!1}_setSize(e,n){(e!==this.width||n!==this.height)&&(this.width=e,this.height=n,this.setNeedsUpdate("Size changed"))}_setViews(e){e=Iu(e,Boolean),this._diffViews(e,this.views)&&this.setNeedsUpdate("views changed"),this.views=e}_setViewState(e){e?(!Ft(e,this.viewState,3)&&this.setNeedsUpdate("viewState changed"),this.viewState=e):Q.warn("missing `viewState` or `initialViewState`")()}_onViewStateChange(e,n){this._eventCallbacks.onViewStateChange&&this._eventCallbacks.onViewStateChange({...n,viewId:e})}_createController(e,n){const i=n.type;return new i({timeline:this.timeline,eventManager:this._eventManager,onViewStateChange:this._onViewStateChange.bind(this,n.id),onStateChange:this._eventCallbacks.onInteractionStateChange,makeViewport:s=>{var o;return(o=this.getView(e.id))==null?void 0:o.makeViewport({viewState:s,width:this.width,height:this.height})}})}_updateController(e,n,i,r){const s=e.controller;if(s&&i){const o={...n,...s,id:e.id,x:i.x,y:i.y,width:i.width,height:i.height};return(!r||r.constructor!==s.type)&&(r=this._createController(e,o)),r&&r.setProps(o),r}return null}_rebuildViewports(){const{views:e}=this,n=this.controllers;this._viewports=[],this.controllers={};let i=!1;for(let r=e.length;r--;){const s=e[r],o=this.getViewState(s),a=s.makeViewport({viewState:o,width:this.width,height:this.height});let l=n[s.id];const c=!!s.controller;c&&!l&&(i=!0),(i||!c)&&l&&(l.finalize(),l=null),this.controllers[s.id]=this._updateController(s,o,a,l),a&&this._viewports.unshift(a)}for(const r in n){const s=n[r];s&&!this.controllers[r]&&s.finalize()}this._buildViewportMap()}_buildViewportMap(){this._viewportMap={},this._viewports.forEach(e=>{e.id&&(this._viewportMap[e.id]=this._viewportMap[e.id]||e)})}_diffViews(e,n){return e.length!==n.length?!0:e.some((i,r)=>!e[r].equals(n[r]))}}const fO=/([0-9]+\.?[0-9]*)(%|px)/;function On(t){switch(typeof t){case"number":return{position:t,relative:!1};case"string":const e=fO.exec(t);if(e&&e.length>=3){const n=e[2]==="%",i=parseFloat(e[1]);return{position:n?i/100:i,relative:n}}default:throw new Error(`Could not parse position string ${t}`)}}function Nn(t,e){return t.relative?Math.round(t.position*e):t.position}class cs{constructor(e={}){const{id:n,x:i=0,y:r=0,width:s="100%",height:o="100%",padding:a=null}=e;this.id=n||this.constructor.displayName||"view",this.props={...e,id:this.id},this._x=On(i),this._y=On(r),this._width=On(s),this._height=On(o),this._padding=a&&{left:On(a.left||0),right:On(a.right||0),top:On(a.top||0),bottom:On(a.bottom||0)},this.equals=this.equals.bind(this),Object.seal(this)}equals(e){return this===e?!0:this.ViewportType===e.ViewportType&&Ft(this.props,e.props,2)}makeViewport({width:e,height:n,viewState:i}){i=this.filterViewState(i);const r=this.getDimensions({width:e,height:n});return!r.height||!r.width?null:new this.ViewportType({...i,...this.props,...r})}getViewStateId(){const{viewState:e}=this.props;return typeof e=="string"?e:(e==null?void 0:e.id)||this.id}filterViewState(e){if(this.props.viewState&&typeof this.props.viewState=="object"){if(!this.props.viewState.id)return this.props.viewState;const n={...e};for(const i in this.props.viewState)i!=="id"&&(n[i]=this.props.viewState[i]);return n}return e}getDimensions({width:e,height:n}){const i={x:Nn(this._x,e),y:Nn(this._y,n),width:Nn(this._width,e),height:Nn(this._height,n)};return this._padding&&(i.padding={left:Nn(this._padding.left,e),top:Nn(this._padding.top,n),right:Nn(this._padding.right,e),bottom:Nn(this._padding.bottom,n)}),i}get controller(){const e=this.props.controller;return e?e===!0?{type:this.ControllerType}:typeof e=="function"?{type:e}:{type:this.ControllerType,...e}:null}}class Ou{constructor(e){this._inProgress=!1,this._handle=null,this.time=0,this.settings={duration:0},this._timeline=e}get inProgress(){return this._inProgress}start(e){var n,i;this.cancel(),this.settings=e,this._inProgress=!0,(i=(n=this.settings).onStart)==null||i.call(n,this)}end(){var e,n;this._inProgress&&(this._timeline.removeChannel(this._handle),this._handle=null,this._inProgress=!1,(n=(e=this.settings).onEnd)==null||n.call(e,this))}cancel(){var e,n;this._inProgress&&((n=(e=this.settings).onInterrupt)==null||n.call(e,this),this._timeline.removeChannel(this._handle),this._handle=null,this._inProgress=!1)}update(){var e,n;if(!this._inProgress)return!1;if(this._handle===null){const{_timeline:i,settings:r}=this;this._handle=i.addChannel({delay:i.getTime(),duration:r.duration})}return this.time=this._timeline.getTime(this._handle),this._onUpdate(),(n=(e=this.settings).onUpdate)==null||n.call(e,this),this._timeline.isFinished(this._handle)&&this.end(),!0}_onUpdate(){}}const U0=()=>{},kd={BREAK:1,SNAP_TO_END:2,IGNORE:3},dO=t=>t,pO=kd.BREAK;class gO{constructor(e){this._onTransitionUpdate=n=>{const{time:i,settings:{interpolator:r,startProps:s,endProps:o,duration:a,easing:l}}=n,c=l(i/a),u=r.interpolateProps(s,o,c);this.propsInTransition=this.getControllerState({...this.props,...u}).getViewportProps(),this.onViewStateChange({viewState:this.propsInTransition,oldViewState:this.props})},this.getControllerState=e.getControllerState,this.propsInTransition=null,this.transition=new Ou(e.timeline),this.onViewStateChange=e.onViewStateChange||U0,this.onStateChange=e.onStateChange||U0}finalize(){this.transition.cancel()}getViewportInTransition(){return this.propsInTransition}processViewStateChange(e){let n=!1;const i=this.props;if(this.props=e,!i||this._shouldIgnoreViewportChange(i,e))return!1;if(this._isTransitionEnabled(e)){let r=i;if(this.transition.inProgress){const{interruption:s,endProps:o}=this.transition.settings;r={...i,...s===kd.SNAP_TO_END?o:this.propsInTransition||i}}this._triggerTransition(r,e),n=!0}else this.transition.cancel();return n}updateTransition(){this.transition.update()}_isTransitionEnabled(e){const{transitionDuration:n,transitionInterpolator:i}=e;return(n>0||n==="auto")&&!!i}_isUpdateDueToCurrentTransition(e){return this.transition.inProgress&&this.propsInTransition?this.transition.settings.interpolator.arePropsEqual(e,this.propsInTransition):!1}_shouldIgnoreViewportChange(e,n){return this.transition.inProgress?this.transition.settings.interruption===kd.IGNORE||this._isUpdateDueToCurrentTransition(n):this._isTransitionEnabled(n)?n.transitionInterpolator.arePropsEqual(e,n):!0}_triggerTransition(e,n){const i=this.getControllerState(e),r=this.getControllerState(n).shortestPathFrom(i),s=n.transitionInterpolator,o=s.getDuration?s.getDuration(e,n):n.transitionDuration;if(o===0)return;const a=s.initializeProps(e,r);this.propsInTransition={};const l={duration:o,easing:n.transitionEasing||dO,interpolator:s,interruption:n.transitionInterruption||pO,startProps:a.start,endProps:a.end,onStart:n.onTransitionStart,onUpdate:this._onTransitionUpdate,onInterrupt:this._onTransitionEnd(n.onTransitionInterrupt),onEnd:this._onTransitionEnd(n.onTransitionEnd)};this.transition.start(l),this.onStateChange({inTransition:!0}),this.updateTransition()}_onTransitionEnd(e){return n=>{this.propsInTransition=null,this.onStateChange({inTransition:!1,isZooming:!1,isPanning:!1,isRotating:!1}),e==null||e(n)}}}function Be(t,e){if(!t)throw new Error(e||"deck.gl: assertion failed.")}class _O{constructor(e){const{compare:n,extract:i,required:r}=e;this._propsToCompare=n,this._propsToExtract=i||n,this._requiredProps=r}arePropsEqual(e,n){for(const i of this._propsToCompare)if(!(i in e)||!(i in n)||!wn(e[i],n[i]))return!1;return!0}initializeProps(e,n){const i={},r={};for(const s of this._propsToExtract)(s in e||s in n)&&(i[s]=e[s],r[s]=n[s]);return this._checkRequiredProps(i),this._checkRequiredProps(r),{start:i,end:r}}getDuration(e,n){return n.transitionDuration}_checkRequiredProps(e){this._requiredProps&&this._requiredProps.forEach(n=>{const i=e[n];Be(Number.isFinite(i)||Array.isArray(i),`${n} is required for transition`)})}}const mO=["longitude","latitude","zoom","bearing","pitch"],yO=["longitude","latitude","zoom"];class rE extends _O{constructor(e={}){const n=Array.isArray(e)?e:e.transitionProps,i=Array.isArray(e)?{}:e;i.transitionProps=Array.isArray(n)?{compare:n,required:n}:n||{compare:mO,required:yO},super(i.transitionProps),this.opts=i}initializeProps(e,n){const i=super.initializeProps(e,n),{makeViewport:r,around:s}=this.opts;if(r&&s){const o=r(e),a=r(n),l=o.unproject(s);i.start.around=s,Object.assign(i.end,{around:a.project(l),aroundPosition:l,width:n.width,height:n.height})}return i}interpolateProps(e,n,i){const r={};for(const s of this._propsToExtract)r[s]=wc(e[s]||0,n[s]||0,i);if(n.aroundPosition&&this.opts.makeViewport){const s=this.opts.makeViewport({...n,...r});Object.assign(r,s.panByPosition(n.aroundPosition,wc(e.around,n.around,i)))}return r}}const kn={transitionDuration:0},vO=300,Qa=t=>1-(1-t)*(1-t),hr={WHEEL:["wheel"],PAN:["panstart","panmove","panend"],PINCH:["pinchstart","pinchmove","pinchend"],TRIPLE_PAN:["tripanstart","tripanmove","tripanend"],DOUBLE_TAP:["doubletap"],KEYBOARD:["keydown"]},_i={};class TO{constructor(e){this.state={},this._events={},this._interactionState={isDragging:!1},this._customEvents=[],this._eventStartBlocked=null,this._panMove=!1,this.invertPan=!1,this.dragMode="rotate",this.inertia=0,this.scrollZoom=!0,this.dragPan=!0,this.dragRotate=!0,this.doubleClickZoom=!0,this.touchZoom=!0,this.touchRotate=!1,this.keyboard=!0,this.transitionManager=new gO({...e,getControllerState:n=>new this.ControllerState(n),onViewStateChange:this._onTransition.bind(this),onStateChange:this._setInteractionState.bind(this)}),this.handleEvent=this.handleEvent.bind(this),this.eventManager=e.eventManager,this.onViewStateChange=e.onViewStateChange||(()=>{}),this.onStateChange=e.onStateChange||(()=>{}),this.makeViewport=e.makeViewport}set events(e){this.toggleEvents(this._customEvents,!1),this.toggleEvents(e,!0),this._customEvents=e,this.props&&this.setProps(this.props)}finalize(){var e;for(const n in this._events)this._events[n]&&((e=this.eventManager)==null||e.off(n,this.handleEvent));this.transitionManager.finalize()}handleEvent(e){this._controllerState=void 0;const n=this._eventStartBlocked;switch(e.type){case"panstart":return n?!1:this._onPanStart(e);case"panmove":return this._onPan(e);case"panend":return this._onPanEnd(e);case"pinchstart":return n?!1:this._onPinchStart(e);case"pinchmove":return this._onPinch(e);case"pinchend":return this._onPinchEnd(e);case"tripanstart":return n?!1:this._onTriplePanStart(e);case"tripanmove":return this._onTriplePan(e);case"tripanend":return this._onTriplePanEnd(e);case"doubletap":return this._onDoubleTap(e);case"wheel":return this._onWheel(e);case"keydown":return this._onKeyDown(e);default:return!1}}get controllerState(){return this._controllerState=this._controllerState||new this.ControllerState({makeViewport:this.makeViewport,...this.props,...this.state}),this._controllerState}getCenter(e){const{x:n,y:i}=this.props,{offsetCenter:r}=e;return[r.x-n,r.y-i]}isPointInBounds(e,n){const{width:i,height:r}=this.props;if(n&&n.handled)return!1;const s=e[0]>=0&&e[0]<=i&&e[1]>=0&&e[1]<=r;return s&&n&&n.stopPropagation(),s}isFunctionKeyPressed(e){const{srcEvent:n}=e;return!!(n.metaKey||n.altKey||n.ctrlKey||n.shiftKey)}isDragging(){return this._interactionState.isDragging||!1}blockEvents(e){const n=setTimeout(()=>{this._eventStartBlocked===n&&(this._eventStartBlocked=null)},e);this._eventStartBlocked=n}setProps(e){e.dragMode&&(this.dragMode=e.dragMode),this.props=e,"transitionInterpolator"in e||(e.transitionInterpolator=this._getTransitionProps().transitionInterpolator),this.transitionManager.processViewStateChange(e);const{inertia:n}=e;this.inertia=Number.isFinite(n)?n:n===!0?vO:0;const{scrollZoom:i=!0,dragPan:r=!0,dragRotate:s=!0,doubleClickZoom:o=!0,touchZoom:a=!0,touchRotate:l=!1,keyboard:c=!0}=e,u=!!this.onViewStateChange;this.toggleEvents(hr.WHEEL,u&&i),this.toggleEvents(hr.PAN,u),this.toggleEvents(hr.PINCH,u&&(a||l)),this.toggleEvents(hr.TRIPLE_PAN,u&&l),this.toggleEvents(hr.DOUBLE_TAP,u&&o),this.toggleEvents(hr.KEYBOARD,u&&c),this.scrollZoom=i,this.dragPan=r,this.dragRotate=s,this.doubleClickZoom=o,this.touchZoom=a,this.touchRotate=l,this.keyboard=c}updateTransition(){this.transitionManager.updateTransition()}toggleEvents(e,n){this.eventManager&&e.forEach(i=>{this._events[i]!==n&&(this._events[i]=n,n?this.eventManager.on(i,this.handleEvent):this.eventManager.off(i,this.handleEvent))})}updateViewport(e,n=null,i={}){const r={...e.getViewportProps(),...n},s=this.controllerState!==e;if(this.state=e.getState(),this._setInteractionState(i),s){const o=this.controllerState&&this.controllerState.getViewportProps();this.onViewStateChange&&this.onViewStateChange({viewState:r,interactionState:this._interactionState,oldViewState:o})}}_onTransition(e){this.onViewStateChange({...e,interactionState:this._interactionState})}_setInteractionState(e){Object.assign(this._interactionState,e),this.onStateChange(this._interactionState)}_onPanStart(e){const n=this.getCenter(e);if(!this.isPointInBounds(n,e))return!1;let i=this.isFunctionKeyPressed(e)||e.rightButton||!1;(this.invertPan||this.dragMode==="pan")&&(i=!i);const r=this.controllerState[i?"panStart":"rotateStart"]({pos:n});return this._panMove=i,this.updateViewport(r,kn,{isDragging:!0}),!0}_onPan(e){return this.isDragging()?this._panMove?this._onPanMove(e):this._onPanRotate(e):!1}_onPanEnd(e){return this.isDragging()?this._panMove?this._onPanMoveEnd(e):this._onPanRotateEnd(e):!1}_onPanMove(e){if(!this.dragPan)return!1;const n=this.getCenter(e),i=this.controllerState.pan({pos:n});return this.updateViewport(i,kn,{isDragging:!0,isPanning:!0}),!0}_onPanMoveEnd(e){const{inertia:n}=this;if(this.dragPan&&n&&e.velocity){const i=this.getCenter(e),r=[i[0]+e.velocityX*n/2,i[1]+e.velocityY*n/2],s=this.controllerState.pan({pos:r}).panEnd();this.updateViewport(s,{...this._getTransitionProps(),transitionDuration:n,transitionEasing:Qa},{isDragging:!1,isPanning:!0})}else{const i=this.controllerState.panEnd();this.updateViewport(i,null,{isDragging:!1,isPanning:!1})}return!0}_onPanRotate(e){if(!this.dragRotate)return!1;const n=this.getCenter(e),i=this.controllerState.rotate({pos:n});return this.updateViewport(i,kn,{isDragging:!0,isRotating:!0}),!0}_onPanRotateEnd(e){const{inertia:n}=this;if(this.dragRotate&&n&&e.velocity){const i=this.getCenter(e),r=[i[0]+e.velocityX*n/2,i[1]+e.velocityY*n/2],s=this.controllerState.rotate({pos:r}).rotateEnd();this.updateViewport(s,{...this._getTransitionProps(),transitionDuration:n,transitionEasing:Qa},{isDragging:!1,isRotating:!0})}else{const i=this.controllerState.rotateEnd();this.updateViewport(i,null,{isDragging:!1,isRotating:!1})}return!0}_onWheel(e){if(!this.scrollZoom)return!1;const n=this.getCenter(e);if(!this.isPointInBounds(n,e))return!1;e.srcEvent.preventDefault();const{speed:i=.01,smooth:r=!1}=this.scrollZoom===!0?{}:this.scrollZoom,{delta:s}=e;let o=2/(1+Math.exp(-Math.abs(s*i)));s<0&&o!==0&&(o=1/o);const a=this.controllerState.zoom({pos:n,scale:o});return this.updateViewport(a,{...this._getTransitionProps({around:n}),transitionDuration:r?250:1},{isZooming:!0,isPanning:!0}),!0}_onTriplePanStart(e){const n=this.getCenter(e);if(!this.isPointInBounds(n,e))return!1;const i=this.controllerState.rotateStart({pos:n});return this.updateViewport(i,kn,{isDragging:!0}),!0}_onTriplePan(e){if(!this.touchRotate||!this.isDragging())return!1;const n=this.getCenter(e);n[0]-=e.deltaX;const i=this.controllerState.rotate({pos:n});return this.updateViewport(i,kn,{isDragging:!0,isRotating:!0}),!0}_onTriplePanEnd(e){if(!this.isDragging())return!1;const{inertia:n}=this;if(this.touchRotate&&n&&e.velocityY){const i=this.getCenter(e),r=[i[0],i[1]+=e.velocityY*n/2],s=this.controllerState.rotate({pos:r});this.updateViewport(s,{...this._getTransitionProps(),transitionDuration:n,transitionEasing:Qa},{isDragging:!1,isRotating:!0}),this.blockEvents(n)}else{const i=this.controllerState.rotateEnd();this.updateViewport(i,null,{isDragging:!1,isRotating:!1})}return!0}_onPinchStart(e){const n=this.getCenter(e);if(!this.isPointInBounds(n,e))return!1;const i=this.controllerState.zoomStart({pos:n}).rotateStart({pos:n});return _i._startPinchRotation=e.rotation,_i._lastPinchEvent=e,this.updateViewport(i,kn,{isDragging:!0}),!0}_onPinch(e){if(!this.touchZoom&&!this.touchRotate||!this.isDragging())return!1;let n=this.controllerState;if(this.touchZoom){const{scale:i}=e,r=this.getCenter(e);n=n.zoom({pos:r,scale:i})}if(this.touchRotate){const{rotation:i}=e;n=n.rotate({deltaAngleX:_i._startPinchRotation-i})}return this.updateViewport(n,kn,{isDragging:!0,isPanning:this.touchZoom,isZooming:this.touchZoom,isRotating:this.touchRotate}),_i._lastPinchEvent=e,!0}_onPinchEnd(e){if(!this.isDragging())return!1;const{inertia:n}=this,{_lastPinchEvent:i}=_i;if(this.touchZoom&&n&&i&&e.scale!==i.scale){const r=this.getCenter(e);let s=this.controllerState.rotateEnd();const o=Math.log2(e.scale),a=(o-Math.log2(i.scale))/(e.deltaTime-i.deltaTime),l=Math.pow(2,o+a*n/2);s=s.zoom({pos:r,scale:l}).zoomEnd(),this.updateViewport(s,{...this._getTransitionProps({around:r}),transitionDuration:n,transitionEasing:Qa},{isDragging:!1,isPanning:this.touchZoom,isZooming:this.touchZoom,isRotating:!1}),this.blockEvents(n)}else{const r=this.controllerState.zoomEnd().rotateEnd();this.updateViewport(r,null,{isDragging:!1,isPanning:!1,isZooming:!1,isRotating:!1})}return _i._startPinchRotation=null,_i._lastPinchEvent=null,!0}_onDoubleTap(e){if(!this.doubleClickZoom)return!1;const n=this.getCenter(e);if(!this.isPointInBounds(n,e))return!1;const i=this.isFunctionKeyPressed(e),r=this.controllerState.zoom({pos:n,scale:i?.5:2});return this.updateViewport(r,this._getTransitionProps({around:n}),{isZooming:!0,isPanning:!0}),this.blockEvents(100),!0}_onKeyDown(e){if(!this.keyboard)return!1;const n=this.isFunctionKeyPressed(e),{zoomSpeed:i,moveSpeed:r,rotateSpeedX:s,rotateSpeedY:o}=this.keyboard===!0?{}:this.keyboard,{controllerState:a}=this;let l;const c={};switch(e.srcEvent.code){case"Minus":l=n?a.zoomOut(i).zoomOut(i):a.zoomOut(i),c.isZooming=!0;break;case"Equal":l=n?a.zoomIn(i).zoomIn(i):a.zoomIn(i),c.isZooming=!0;break;case"ArrowLeft":n?(l=a.rotateLeft(s),c.isRotating=!0):(l=a.moveLeft(r),c.isPanning=!0);break;case"ArrowRight":n?(l=a.rotateRight(s),c.isRotating=!0):(l=a.moveRight(r),c.isPanning=!0);break;case"ArrowUp":n?(l=a.rotateUp(o),c.isRotating=!0):(l=a.moveUp(r),c.isPanning=!0);break;case"ArrowDown":n?(l=a.rotateDown(o),c.isRotating=!0):(l=a.moveDown(r),c.isPanning=!0);break;default:return!1}return this.updateViewport(l,this._getTransitionProps(),c),!0}_getTransitionProps(e){const{transition:n}=this;return!n||!n.transitionInterpolator?kn:e?{...n,transitionInterpolator:new rE({...e,...n.transitionInterpolator.opts,makeViewport:this.controllerState.makeViewport})}:n}}class wO{constructor(e,n){this._viewportProps=this.applyConstraints(e),this._state=n}getViewportProps(){return this._viewportProps}getState(){return this._state}}const L0=5,EO=1.2;class SO extends wO{constructor(e){const{width:n,height:i,latitude:r,longitude:s,zoom:o,bearing:a=0,pitch:l=0,altitude:c=1.5,position:u=[0,0,0],maxZoom:h=20,minZoom:f=0,maxPitch:d=60,minPitch:p=0,startPanLngLat:v,startZoomLngLat:A,startRotatePos:y,startBearing:g,startPitch:_,startZoom:E,normalize:R=!0}=e;Be(Number.isFinite(s)),Be(Number.isFinite(r)),Be(Number.isFinite(o)),super({width:n,height:i,latitude:r,longitude:s,zoom:o,bearing:a,pitch:l,altitude:c,maxZoom:h,minZoom:f,maxPitch:d,minPitch:p,normalize:R,position:u},{startPanLngLat:v,startZoomLngLat:A,startRotatePos:y,startBearing:g,startPitch:_,startZoom:E}),this.makeViewport=e.makeViewport}panStart({pos:e}){return this._getUpdatedState({startPanLngLat:this._unproject(e)})}pan({pos:e,startPos:n}){const i=this.getState().startPanLngLat||this._unproject(n);if(!i)return this;const s=this.makeViewport(this.getViewportProps()).panByPosition(i,e);return this._getUpdatedState(s)}panEnd(){return this._getUpdatedState({startPanLngLat:null})}rotateStart({pos:e}){return this._getUpdatedState({startRotatePos:e,startBearing:this.getViewportProps().bearing,startPitch:this.getViewportProps().pitch})}rotate({pos:e,deltaAngleX:n=0,deltaAngleY:i=0}){const{startRotatePos:r,startBearing:s,startPitch:o}=this.getState();if(!r||s===void 0||o===void 0)return this;let a;return e?a=this._getNewRotation(e,r,o,s):a={bearing:s+n,pitch:o+i},this._getUpdatedState(a)}rotateEnd(){return this._getUpdatedState({startBearing:null,startPitch:null})}zoomStart({pos:e}){return this._getUpdatedState({startZoomLngLat:this._unproject(e),startZoom:this.getViewportProps().zoom})}zoom({pos:e,startPos:n,scale:i}){let{startZoom:r,startZoomLngLat:s}=this.getState();if(s||(r=this.getViewportProps().zoom,s=this._unproject(n)||this._unproject(e)),!s)return this;const{maxZoom:o,minZoom:a}=this.getViewportProps();let l=r+Math.log2(i);l=$n(l,a,o);const c=this.makeViewport({...this.getViewportProps(),zoom:l});return this._getUpdatedState({zoom:l,...c.panByPosition(s,e)})}zoomEnd(){return this._getUpdatedState({startZoomLngLat:null,startZoom:null})}zoomIn(e=2){return this._zoomFromCenter(e)}zoomOut(e=2){return this._zoomFromCenter(1/e)}moveLeft(e=100){return this._panFromCenter([e,0])}moveRight(e=100){return this._panFromCenter([-e,0])}moveUp(e=100){return this._panFromCenter([0,e])}moveDown(e=100){return this._panFromCenter([0,-e])}rotateLeft(e=15){return this._getUpdatedState({bearing:this.getViewportProps().bearing-e})}rotateRight(e=15){return this._getUpdatedState({bearing:this.getViewportProps().bearing+e})}rotateUp(e=10){return this._getUpdatedState({pitch:this.getViewportProps().pitch+e})}rotateDown(e=10){return this._getUpdatedState({pitch:this.getViewportProps().pitch-e})}shortestPathFrom(e){const n=e.getViewportProps(),i={...this.getViewportProps()},{bearing:r,longitude:s}=i;return Math.abs(r-n.bearing)>180&&(i.bearing=r<0?r+360:r-360),Math.abs(s-n.longitude)>180&&(i.longitude=s<0?s+360:s-360),i}applyConstraints(e){const{maxZoom:n,minZoom:i,zoom:r}=e;e.zoom=$n(r,i,n);const{maxPitch:s,minPitch:o,pitch:a}=e;e.pitch=$n(a,o,s);const{normalize:l=!0}=e;return l&&Object.assign(e,sI(e)),e}_zoomFromCenter(e){const{width:n,height:i}=this.getViewportProps();return this.zoom({pos:[n/2,i/2],scale:e})}_panFromCenter(e){const{width:n,height:i}=this.getViewportProps();return this.pan({startPos:[n/2,i/2],pos:[n/2+e[0],i/2+e[1]]})}_getUpdatedState(e){return new this.constructor({makeViewport:this.makeViewport,...this.getViewportProps(),...this.getState(),...e})}_unproject(e){const n=this.makeViewport(this.getViewportProps());return e&&n.unproject(e)}_getNewRotation(e,n,i,r){const s=e[0]-n[0],o=e[1]-n[1],a=e[1],l=n[1],{width:c,height:u}=this.getViewportProps(),h=s/c;let f=0;o>0?Math.abs(u-l)>L0&&(f=o/(l-u)*EO):o<0&&l>L0&&(f=1-a/l),f=$n(f,-1,1);const{minPitch:d,maxPitch:p}=this.getViewportProps(),v=r+180*h;let A=i;return f>0?A=i+f*(p-i):f<0&&(A=i-f*(d-i)),{pitch:A,bearing:v}}}class AO extends TO{constructor(){super(...arguments),this.ControllerState=SO,this.transition={transitionDuration:300,transitionInterpolator:new rE({transitionProps:{compare:["longitude","latitude","zoom","bearing","pitch","position"],required:["longitude","latitude","zoom"]}})},this.dragMode="pan"}setProps(e){e.position=e.position||[0,0,0];const n=this.props;super.setProps(e),(!n||n.height!==e.height)&&this.updateViewport(new this.ControllerState({makeViewport:this.makeViewport,...e,...this.state}))}}const $g=class $g extends cs{get ViewportType(){return as}get ControllerType(){return AO}};$g.displayName="MapView";let Fd=$g;const xO=new Gw;function RO(t,e){const n=t.order??1/0,i=e.order??1/0;return n-i}class bO{constructor(e){this._resolvedEffects=[],this._defaultEffects=[],this.effects=[],this._context=e,this._needsRedraw="Initial render",this._setEffects([])}addDefaultEffect(e){const n=this._defaultEffects;if(!n.find(i=>i.id===e.id)){const i=n.findIndex(r=>RO(r,e)>0);i<0?n.push(e):n.splice(i,0,e),e.setup(this._context),this._setEffects(this.effects)}}setProps(e){"effects"in e&&(Ft(e.effects,this.effects,1)||this._setEffects(e.effects))}needsRedraw(e={clearRedrawFlags:!1}){const n=this._needsRedraw;return e.clearRedrawFlags&&(this._needsRedraw=!1),n}getEffects(){return this._resolvedEffects}_setEffects(e){const n={};for(const r of this.effects)n[r.id]=r;const i=[];for(const r of e){const s=n[r.id];let o=r;s&&s!==r?s.setProps?(s.setProps(r.props),o=s):s.cleanup(this._context):s||r.setup(this._context),i.push(o),delete n[r.id]}for(const r in n)n[r].cleanup(this._context);this.effects=i,this._resolvedEffects=i.concat(this._defaultEffects),e.some(r=>r instanceof Gw)||this._resolvedEffects.push(xO),this._needsRedraw="effects changed"}finalize(){for(const e of this._resolvedEffects)e.cleanup(this._context);this.effects.length=0,this._resolvedEffects.length=0,this._defaultEffects.length=0}}class CO extends Cg{shouldDrawLayer(e){const{operation:n}=e.props;return n.includes("draw")||n.includes("terrain")}}const PO="deckRenderer.renderLayers";class MO{constructor(e){this.device=e,this.gl=e.gl,this.layerFilter=null,this.drawPickingColors=!1,this.drawLayersPass=new CO(e),this.pickLayersPass=new nE(e),this.renderCount=0,this._needsRedraw="Initial render",this.renderBuffers=[],this.lastPostProcessEffect=null}setProps(e){this.layerFilter!==e.layerFilter&&(this.layerFilter=e.layerFilter,this._needsRedraw="layerFilter changed"),this.drawPickingColors!==e.drawPickingColors&&(this.drawPickingColors=e.drawPickingColors,this._needsRedraw="drawPickingColors changed")}renderLayers(e){if(!e.viewports.length)return;const n=this.drawPickingColors?this.pickLayersPass:this.drawLayersPass,i={layerFilter:this.layerFilter,isPicking:this.drawPickingColors,...e};i.effects&&this._preRender(i.effects,i);const r=this.lastPostProcessEffect?this.renderBuffers[0]:i.target;this.lastPostProcessEffect&&(i.clearColor=[0,0,0,0],i.clearCanvas=!0);const s=n.render({...i,target:r});i.effects&&this._postRender(i.effects,i),this.renderCount++,He(PO,this,s,e)}needsRedraw(e={clearRedrawFlags:!1}){const n=this._needsRedraw;return e.clearRedrawFlags&&(this._needsRedraw=!1),n}finalize(){const{renderBuffers:e}=this;for(const n of e)n.delete();e.length=0}_preRender(e,n){this.lastPostProcessEffect=null,n.preRenderStats=n.preRenderStats||{};for(const i of e)n.preRenderStats[i.id]=i.preRender(n),i.postRender&&(this.lastPostProcessEffect=i.id);this.lastPostProcessEffect&&this._resizeRenderBuffers()}_resizeRenderBuffers(){const{renderBuffers:e}=this,n=this.device.canvasContext.getDrawingBufferSize();e.length===0&&[0,1].map(i=>{const r=this.device.createTexture({sampler:{minFilter:"linear",magFilter:"linear"}});e.push(this.device.createFramebuffer({id:`deck-renderbuffer-${i}`,colorAttachments:[r]}))});for(const i of e)i.resize(n)}_postRender(e,n){const{renderBuffers:i}=this,r={...n,inputBuffer:i[0],swapBuffer:i[1]};for(const s of e)if(s.postRender){r.target=s.id===this.lastPostProcessEffect?n.target:void 0;const o=s.postRender(r);r.inputBuffer=o,r.swapBuffer=o===i[0]?i[1]:i[0]}}}const IO={pickedColor:null,pickedObjectIndex:-1};function OO({pickedColors:t,decodePickingColor:e,deviceX:n,deviceY:i,deviceRadius:r,deviceRect:s}){const{x:o,y:a,width:l,height:c}=s;let u=r*r,h=-1,f=0;for(let d=0;d<c;d++){const p=d+a-i,v=p*p;if(v>u)f+=4*l;else for(let A=0;A<l;A++){if(t[f+3]-1>=0){const g=A+o-n,_=g*g+v;_<=u&&(u=_,h=f)}f+=4}}if(h>=0){const d=t.slice(h,h+4),p=e(d);if(p){const v=Math.floor(h/4/l),A=h/4-v*l;return{...p,pickedColor:d,pickedX:o+A,pickedY:a+v}}Q.error("Picked non-existent layer. Is picking buffer corrupt?")()}return IO}function NO({pickedColors:t,decodePickingColor:e}){const n=new Map;if(t){for(let i=0;i<t.length;i+=4)if(t[i+3]-1>=0){const s=t.slice(i,i+4),o=s.join(",");if(!n.has(o)){const a=e(s);a?n.set(o,{...a,color:s}):Q.error("Picked non-existent layer. Is picking buffer corrupt?")()}}}return Array.from(n.values())}function sE({pickInfo:t,viewports:e,pixelRatio:n,x:i,y:r,z:s}){let o=e[0];e.length>1&&(o=FO((t==null?void 0:t.pickedViewports)||e,{x:i,y:r}));let a;if(o){const l=[i-o.x,r-o.y];s!==void 0&&(l[2]=s),a=o.unproject(l)}return{color:null,layer:null,viewport:o,index:-1,picked:!1,x:i,y:r,pixel:[i,r],coordinate:a,devicePixel:t&&"pickedX"in t?[t.pickedX,t.pickedY]:void 0,pixelRatio:n}}function kO(t){const{pickInfo:e,lastPickedInfo:n,mode:i,layers:r}=t,{pickedColor:s,pickedLayer:o,pickedObjectIndex:a}=e,l=o?[o]:[];if(i==="hover"){const h=n.index,f=n.layerId,d=o?o.props.id:null;if(d!==f||a!==h){if(d!==f){const p=r.find(v=>v.props.id===f);p&&l.unshift(p)}n.layerId=d,n.index=a,n.info=null}}const c=sE(t),u=new Map;return u.set(null,c),l.forEach(h=>{let f={...c};h===o&&(f.color=s,f.index=a,f.picked=!0),f=oE({layer:h,info:f,mode:i});const d=f.layer;h===o&&i==="hover"&&(n.info=f),u.set(d.id,f),i==="hover"&&d.updateAutoHighlight(f)}),u}function oE({layer:t,info:e,mode:n}){for(;t&&e;){const i=e.layer||null;e.sourceLayer=i,e.layer=t,e=t.getPickingInfo({info:e,mode:n,sourceLayer:i}),t=t.parent}return e}function FO(t,e){for(let n=t.length-1;n>=0;n--){const i=t[n];if(i.containsPixel(e))return i}return t[0]}class DO{constructor(e){this._pickable=!0,this.device=e,this.pickLayersPass=new nE(e),this.lastPickedInfo={index:-1,layerId:null,info:null}}setProps(e){"layerFilter"in e&&(this.layerFilter=e.layerFilter),"_pickable"in e&&(this._pickable=e._pickable)}finalize(){this.pickingFBO&&this.pickingFBO.destroy(),this.depthFBO&&this.depthFBO.destroy()}pickObject(e){return this._pickClosestObject(e)}pickObjects(e){return this._pickVisibleObjects(e)}getLastPickedObject({x:e,y:n,layers:i,viewports:r},s=this.lastPickedInfo.info){const o=s&&s.layer&&s.layer.id,a=s&&s.viewport&&s.viewport.id,l=o?i.find(f=>f.id===o):null,c=a&&r.find(f=>f.id===a)||r[0],u=c&&c.unproject([e-c.x,n-c.y]);return{...s,...{x:e,y:n,viewport:c,coordinate:u,layer:l}}}_resizeBuffer(){var n,i;if(!this.pickingFBO&&(this.pickingFBO=this.device.createFramebuffer({colorAttachments:["rgba8unorm"],depthStencilAttachment:"depth16unorm"}),this.device.isTextureFormatRenderable("rgba32float"))){const r=this.device.createFramebuffer({colorAttachments:["rgba32float"],depthStencilAttachment:"depth16unorm"});this.depthFBO=r}const e=this.device.gl;(n=this.pickingFBO)==null||n.resize({width:e.canvas.width,height:e.canvas.height}),(i=this.depthFBO)==null||i.resize({width:e.canvas.width,height:e.canvas.height})}_getPickable(e){if(this._pickable===!1)return null;const n=e.filter(i=>this.pickLayersPass.shouldDrawLayer(i)&&!i.isComposite);return n.length?n:null}_pickClosestObject({layers:e,views:n,viewports:i,x:r,y:s,radius:o=0,depth:a=1,mode:l="query",unproject3D:c,onViewportActive:u,effects:h}){const f=this.device.canvasContext.cssToDeviceRatio(),d=this._getPickable(e);if(!d||i.length===0)return{result:[],emptyInfo:sE({viewports:i,x:r,y:s,pixelRatio:f})};this._resizeBuffer();const p=this.device.canvasContext.cssToDevicePixels([r,s],!0),v=[p.x+Math.floor(p.width/2),p.y+Math.floor(p.height/2)],A=Math.round(o*f),{width:y,height:g}=this.pickingFBO,_=this._getPickingRect({deviceX:v[0],deviceY:v[1],deviceRadius:A,deviceWidth:y,deviceHeight:g}),E={x:r-o,y:s-o,width:o*2+1,height:o*2+1};let R;const P=[],I=new Set;for(let O=0;O<a;O++){let k;if(_){const H=this._drawAndSample({layers:d,views:n,viewports:i,onViewportActive:u,deviceRect:_,cullRect:E,effects:h,pass:`picking:${l}`});k=OO({...H,deviceX:v[0],deviceY:v[1],deviceRadius:A,deviceRect:_})}else k={pickedColor:null,pickedObjectIndex:-1};let D;if(k.pickedLayer&&c&&this.depthFBO){const{pickedColors:H}=this._drawAndSample({layers:[k.pickedLayer],views:n,viewports:i,onViewportActive:u,deviceRect:{x:k.pickedX,y:k.pickedY,width:1,height:1},cullRect:E,effects:h,pass:`picking:${l}:z`},!0);H[3]&&(D=H[0])}k.pickedLayer&&O+1<a&&(I.add(k.pickedLayer),k.pickedLayer.disablePickingIndex(k.pickedObjectIndex)),R=kO({pickInfo:k,lastPickedInfo:this.lastPickedInfo,mode:l,layers:d,viewports:i,x:r,y:s,z:D,pixelRatio:f});for(const H of R.values())H.layer&&P.push(H);if(!k.pickedColor)break}for(const O of I)O.restorePickingColors();return{result:P,emptyInfo:R.get(null)}}_pickVisibleObjects({layers:e,views:n,viewports:i,x:r,y:s,width:o=1,height:a=1,mode:l="query",maxObjects:c=null,onViewportActive:u,effects:h}){const f=this._getPickable(e);if(!f||i.length===0)return[];this._resizeBuffer();const d=this.device.canvasContext.cssToDeviceRatio(),p=this.device.canvasContext.cssToDevicePixels([r,s],!0),v=p.x,A=p.y+p.height,y=this.device.canvasContext.cssToDevicePixels([r+o,s+a],!0),g=y.x+y.width,_=y.y,E={x:v,y:_,width:g-v,height:A-_},R=this._drawAndSample({layers:f,views:n,viewports:i,onViewportActive:u,deviceRect:E,cullRect:{x:r,y:s,width:o,height:a},effects:h,pass:`picking:${l}`}),P=NO(R),I=new Map,O=[],k=Number.isFinite(c);for(let D=0;D<P.length&&!(k&&O.length>=c);D++){const H=P[D];let X={color:H.pickedColor,layer:null,index:H.pickedObjectIndex,picked:!0,x:r,y:s,pixelRatio:d};X=oE({layer:H.pickedLayer,info:X,mode:l});const $=X.layer.id;I.has($)||I.set($,new Set);const q=I.get($),nt=X.object??X.index;q.has(nt)||(q.add(nt),O.push(X))}return O}_drawAndSample({layers:e,views:n,viewports:i,onViewportActive:r,deviceRect:s,cullRect:o,effects:a,pass:l},c=!1){const u=c?this.depthFBO:this.pickingFBO,h={layers:e,layerFilter:this.layerFilter,views:n,viewports:i,onViewportActive:r,pickingFBO:u,deviceRect:s,cullRect:o,effects:a,pass:l,pickZ:c,preRenderStats:{}};for(const g of a)g.useInPicking&&(h.preRenderStats[g.id]=g.preRender(h));const{decodePickingColor:f}=this.pickLayersPass.render(h),{x:d,y:p,width:v,height:A}=s,y=new(c?Float32Array:Uint8Array)(v*A*4);return this.device.readPixelsToArrayWebGL(u,{sourceX:d,sourceY:p,sourceWidth:v,sourceHeight:A,target:y}),{pickedColors:y,decodePickingColor:f}}_getPickingRect({deviceX:e,deviceY:n,deviceRadius:i,deviceWidth:r,deviceHeight:s}){const o=Math.max(0,e-i),a=Math.max(0,n-i),l=Math.min(r,e+i+1)-o,c=Math.min(s,n+i+1)-a;return l<=0||c<=0?null:{x:o,y:a,width:l,height:c}}}const BO={"top-left":{top:0,left:0},"top-right":{top:0,right:0},"bottom-left":{bottom:0,left:0},"bottom-right":{bottom:0,right:0},fill:{top:0,left:0,bottom:0,right:0}},UO="top-left",z0="__root";class LO{constructor({deck:e,parentElement:n}){this.defaultWidgets=[],this.widgets=[],this.resolvedWidgets=[],this.containers={},this.lastViewports={},this.deck=e,this.parentElement=n}getWidgets(){return this.resolvedWidgets}setProps(e){e.widgets&&!Ft(e.widgets,this.widgets,1)&&this._setWidgets(e.widgets)}finalize(){for(const e of this.getWidgets())this._remove(e);this.defaultWidgets.length=0,this.resolvedWidgets.length=0;for(const e in this.containers)this.containers[e].remove()}addDefault(e){this.defaultWidgets.find(n=>n.id===e.id)||(this._add(e),this.defaultWidgets.push(e),this._setWidgets(this.widgets))}_setWidgets(e){const n={};for(const i of this.resolvedWidgets)n[i.id]=i;this.resolvedWidgets.length=0;for(const i of this.defaultWidgets)n[i.id]=null,this.resolvedWidgets.push(i);for(let i of e){const r=n[i.id];r?r.viewId!==i.viewId||r.placement!==i.placement?(this._remove(r),this._add(i)):i!==r&&(r.setProps(i.props),i=r):this._add(i),n[i.id]=null,this.resolvedWidgets.push(i)}for(const i in n){const r=n[i];r&&this._remove(r)}this.widgets=e}_add(e){const{viewId:n=null,placement:i=UO}=e,r=e.onAdd({deck:this.deck,viewId:n});r&&this._getContainer(n,i).append(r),e._element=r}_remove(e){e.onRemove(),e._element&&e._element.remove(),e._element=void 0}_getContainer(e,n){var o;const i=e||z0;let r=this.containers[i];r||(r=document.createElement("div"),r.style.pointerEvents="none",r.style.position="absolute",r.style.overflow="hidden",(o=this.parentElement)==null||o.append(r),this.containers[i]=r);let s=r.querySelector(`.${n}`);return s||(s=document.createElement("div"),s.className=n,s.style.position="absolute",Object.assign(s.style,BO[n]),r.append(s)),s}_updateContainers(){const e=this.deck.width,n=this.deck.height;for(const i in this.containers){const r=this.lastViewports[i]||null,s=i===z0||r,o=this.containers[i];s?(o.style.display="block",o.style.left=`${r?r.x:0}px`,o.style.top=`${r?r.y:0}px`,o.style.width=`${r?r.width:e}px`,o.style.height=`${r?r.height:n}px`):o.style.display="none"}}onRedraw({viewports:e,layers:n}){var s,o;const i=e.reduce((a,l)=>(a[l.id]=l,a),{}),{lastViewports:r}=this;for(const a of this.getWidgets()){const{viewId:l}=a;if(l){const c=i[l];c&&(a.onViewportChange&&!c.equals(r[l])&&a.onViewportChange(c),(s=a.onRedraw)==null||s.call(a,{viewports:[c],layers:n}))}else{if(a.onViewportChange)for(const c of e)c.equals(r[c.id])||a.onViewportChange(c);(o=a.onRedraw)==null||o.call(a,{viewports:e,layers:n})}}this.lastViewports=i,this._updateContainers()}onHover(e,n){var i,r;for(const s of this.getWidgets()){const{viewId:o}=s;(!o||o===((i=e.viewport)==null?void 0:i.id))&&((r=s.onHover)==null||r.call(s,e,n))}}onEvent(e,n){var r,s;const i=Cd[n.type];if(i)for(const o of this.getWidgets()){const{viewId:a}=o;(!a||a===((r=e.viewport)==null?void 0:r.id))&&((s=o[i.handler])==null||s.call(o,e,n))}}}const zO={zIndex:"1",position:"absolute",pointerEvents:"none",color:"#a0a7b4",backgroundColor:"#29323c",padding:"10px",top:"0",left:"0",display:"none"};let VO=class{constructor(){this.id="default-tooltip",this.placement="fill",this.props={},this.isVisible=!1}onAdd({deck:e}){const n=document.createElement("div");return n.className="deck-tooltip",Object.assign(n.style,zO),this.deck=e,this.element=n,n}onRemove(){this.deck=void 0,this.element=void 0}setProps(){}onViewportChange(e){var n;this.isVisible&&e.id===((n=this.lastViewport)==null?void 0:n.id)&&e!==this.lastViewport&&this.setTooltip(null)}onHover(e){const{deck:n}=this,i=n&&n.props.getTooltip;if(!i)return;const r=i(e);this.lastViewport=e.viewport,this.setTooltip(r,e.x,e.y)}setTooltip(e,n,i){const r=this.element;if(r){if(typeof e=="string")r.innerText=e;else if(e)e.text&&(r.innerText=e.text),e.html&&(r.innerHTML=e.html),e.className&&(r.className=e.className);else{this.isVisible=!1,r.style.display="none";return}this.isVisible=!0,r.style.display="block",r.style.transform=`translate(${n}px, ${i}px)`,e&&typeof e=="object"&&"style"in e&&Object.assign(r.style,e.style)}}};var Cr;(function(t){t[t.DEPTH_BUFFER_BIT=256]="DEPTH_BUFFER_BIT",t[t.STENCIL_BUFFER_BIT=1024]="STENCIL_BUFFER_BIT",t[t.COLOR_BUFFER_BIT=16384]="COLOR_BUFFER_BIT",t[t.POINTS=0]="POINTS",t[t.LINES=1]="LINES",t[t.LINE_LOOP=2]="LINE_LOOP",t[t.LINE_STRIP=3]="LINE_STRIP",t[t.TRIANGLES=4]="TRIANGLES",t[t.TRIANGLE_STRIP=5]="TRIANGLE_STRIP",t[t.TRIANGLE_FAN=6]="TRIANGLE_FAN",t[t.ZERO=0]="ZERO",t[t.ONE=1]="ONE",t[t.SRC_COLOR=768]="SRC_COLOR",t[t.ONE_MINUS_SRC_COLOR=769]="ONE_MINUS_SRC_COLOR",t[t.SRC_ALPHA=770]="SRC_ALPHA",t[t.ONE_MINUS_SRC_ALPHA=771]="ONE_MINUS_SRC_ALPHA",t[t.DST_ALPHA=772]="DST_ALPHA",t[t.ONE_MINUS_DST_ALPHA=773]="ONE_MINUS_DST_ALPHA",t[t.DST_COLOR=774]="DST_COLOR",t[t.ONE_MINUS_DST_COLOR=775]="ONE_MINUS_DST_COLOR",t[t.SRC_ALPHA_SATURATE=776]="SRC_ALPHA_SATURATE",t[t.CONSTANT_COLOR=32769]="CONSTANT_COLOR",t[t.ONE_MINUS_CONSTANT_COLOR=32770]="ONE_MINUS_CONSTANT_COLOR",t[t.CONSTANT_ALPHA=32771]="CONSTANT_ALPHA",t[t.ONE_MINUS_CONSTANT_ALPHA=32772]="ONE_MINUS_CONSTANT_ALPHA",t[t.FUNC_ADD=32774]="FUNC_ADD",t[t.FUNC_SUBTRACT=32778]="FUNC_SUBTRACT",t[t.FUNC_REVERSE_SUBTRACT=32779]="FUNC_REVERSE_SUBTRACT",t[t.BLEND_EQUATION=32777]="BLEND_EQUATION",t[t.BLEND_EQUATION_RGB=32777]="BLEND_EQUATION_RGB",t[t.BLEND_EQUATION_ALPHA=34877]="BLEND_EQUATION_ALPHA",t[t.BLEND_DST_RGB=32968]="BLEND_DST_RGB",t[t.BLEND_SRC_RGB=32969]="BLEND_SRC_RGB",t[t.BLEND_DST_ALPHA=32970]="BLEND_DST_ALPHA",t[t.BLEND_SRC_ALPHA=32971]="BLEND_SRC_ALPHA",t[t.BLEND_COLOR=32773]="BLEND_COLOR",t[t.ARRAY_BUFFER_BINDING=34964]="ARRAY_BUFFER_BINDING",t[t.ELEMENT_ARRAY_BUFFER_BINDING=34965]="ELEMENT_ARRAY_BUFFER_BINDING",t[t.LINE_WIDTH=2849]="LINE_WIDTH",t[t.ALIASED_POINT_SIZE_RANGE=33901]="ALIASED_POINT_SIZE_RANGE",t[t.ALIASED_LINE_WIDTH_RANGE=33902]="ALIASED_LINE_WIDTH_RANGE",t[t.CULL_FACE_MODE=2885]="CULL_FACE_MODE",t[t.FRONT_FACE=2886]="FRONT_FACE",t[t.DEPTH_RANGE=2928]="DEPTH_RANGE",t[t.DEPTH_WRITEMASK=2930]="DEPTH_WRITEMASK",t[t.DEPTH_CLEAR_VALUE=2931]="DEPTH_CLEAR_VALUE",t[t.DEPTH_FUNC=2932]="DEPTH_FUNC",t[t.STENCIL_CLEAR_VALUE=2961]="STENCIL_CLEAR_VALUE",t[t.STENCIL_FUNC=2962]="STENCIL_FUNC",t[t.STENCIL_FAIL=2964]="STENCIL_FAIL",t[t.STENCIL_PASS_DEPTH_FAIL=2965]="STENCIL_PASS_DEPTH_FAIL",t[t.STENCIL_PASS_DEPTH_PASS=2966]="STENCIL_PASS_DEPTH_PASS",t[t.STENCIL_REF=2967]="STENCIL_REF",t[t.STENCIL_VALUE_MASK=2963]="STENCIL_VALUE_MASK",t[t.STENCIL_WRITEMASK=2968]="STENCIL_WRITEMASK",t[t.STENCIL_BACK_FUNC=34816]="STENCIL_BACK_FUNC",t[t.STENCIL_BACK_FAIL=34817]="STENCIL_BACK_FAIL",t[t.STENCIL_BACK_PASS_DEPTH_FAIL=34818]="STENCIL_BACK_PASS_DEPTH_FAIL",t[t.STENCIL_BACK_PASS_DEPTH_PASS=34819]="STENCIL_BACK_PASS_DEPTH_PASS",t[t.STENCIL_BACK_REF=36003]="STENCIL_BACK_REF",t[t.STENCIL_BACK_VALUE_MASK=36004]="STENCIL_BACK_VALUE_MASK",t[t.STENCIL_BACK_WRITEMASK=36005]="STENCIL_BACK_WRITEMASK",t[t.VIEWPORT=2978]="VIEWPORT",t[t.SCISSOR_BOX=3088]="SCISSOR_BOX",t[t.COLOR_CLEAR_VALUE=3106]="COLOR_CLEAR_VALUE",t[t.COLOR_WRITEMASK=3107]="COLOR_WRITEMASK",t[t.UNPACK_ALIGNMENT=3317]="UNPACK_ALIGNMENT",t[t.PACK_ALIGNMENT=3333]="PACK_ALIGNMENT",t[t.MAX_TEXTURE_SIZE=3379]="MAX_TEXTURE_SIZE",t[t.MAX_VIEWPORT_DIMS=3386]="MAX_VIEWPORT_DIMS",t[t.SUBPIXEL_BITS=3408]="SUBPIXEL_BITS",t[t.RED_BITS=3410]="RED_BITS",t[t.GREEN_BITS=3411]="GREEN_BITS",t[t.BLUE_BITS=3412]="BLUE_BITS",t[t.ALPHA_BITS=3413]="ALPHA_BITS",t[t.DEPTH_BITS=3414]="DEPTH_BITS",t[t.STENCIL_BITS=3415]="STENCIL_BITS",t[t.POLYGON_OFFSET_UNITS=10752]="POLYGON_OFFSET_UNITS",t[t.POLYGON_OFFSET_FACTOR=32824]="POLYGON_OFFSET_FACTOR",t[t.TEXTURE_BINDING_2D=32873]="TEXTURE_BINDING_2D",t[t.SAMPLE_BUFFERS=32936]="SAMPLE_BUFFERS",t[t.SAMPLES=32937]="SAMPLES",t[t.SAMPLE_COVERAGE_VALUE=32938]="SAMPLE_COVERAGE_VALUE",t[t.SAMPLE_COVERAGE_INVERT=32939]="SAMPLE_COVERAGE_INVERT",t[t.COMPRESSED_TEXTURE_FORMATS=34467]="COMPRESSED_TEXTURE_FORMATS",t[t.VENDOR=7936]="VENDOR",t[t.RENDERER=7937]="RENDERER",t[t.VERSION=7938]="VERSION",t[t.IMPLEMENTATION_COLOR_READ_TYPE=35738]="IMPLEMENTATION_COLOR_READ_TYPE",t[t.IMPLEMENTATION_COLOR_READ_FORMAT=35739]="IMPLEMENTATION_COLOR_READ_FORMAT",t[t.BROWSER_DEFAULT_WEBGL=37444]="BROWSER_DEFAULT_WEBGL",t[t.STATIC_DRAW=35044]="STATIC_DRAW",t[t.STREAM_DRAW=35040]="STREAM_DRAW",t[t.DYNAMIC_DRAW=35048]="DYNAMIC_DRAW",t[t.ARRAY_BUFFER=34962]="ARRAY_BUFFER",t[t.ELEMENT_ARRAY_BUFFER=34963]="ELEMENT_ARRAY_BUFFER",t[t.BUFFER_SIZE=34660]="BUFFER_SIZE",t[t.BUFFER_USAGE=34661]="BUFFER_USAGE",t[t.CURRENT_VERTEX_ATTRIB=34342]="CURRENT_VERTEX_ATTRIB",t[t.VERTEX_ATTRIB_ARRAY_ENABLED=34338]="VERTEX_ATTRIB_ARRAY_ENABLED",t[t.VERTEX_ATTRIB_ARRAY_SIZE=34339]="VERTEX_ATTRIB_ARRAY_SIZE",t[t.VERTEX_ATTRIB_ARRAY_STRIDE=34340]="VERTEX_ATTRIB_ARRAY_STRIDE",t[t.VERTEX_ATTRIB_ARRAY_TYPE=34341]="VERTEX_ATTRIB_ARRAY_TYPE",t[t.VERTEX_ATTRIB_ARRAY_NORMALIZED=34922]="VERTEX_ATTRIB_ARRAY_NORMALIZED",t[t.VERTEX_ATTRIB_ARRAY_POINTER=34373]="VERTEX_ATTRIB_ARRAY_POINTER",t[t.VERTEX_ATTRIB_ARRAY_BUFFER_BINDING=34975]="VERTEX_ATTRIB_ARRAY_BUFFER_BINDING",t[t.CULL_FACE=2884]="CULL_FACE",t[t.FRONT=1028]="FRONT",t[t.BACK=1029]="BACK",t[t.FRONT_AND_BACK=1032]="FRONT_AND_BACK",t[t.BLEND=3042]="BLEND",t[t.DEPTH_TEST=2929]="DEPTH_TEST",t[t.DITHER=3024]="DITHER",t[t.POLYGON_OFFSET_FILL=32823]="POLYGON_OFFSET_FILL",t[t.SAMPLE_ALPHA_TO_COVERAGE=32926]="SAMPLE_ALPHA_TO_COVERAGE",t[t.SAMPLE_COVERAGE=32928]="SAMPLE_COVERAGE",t[t.SCISSOR_TEST=3089]="SCISSOR_TEST",t[t.STENCIL_TEST=2960]="STENCIL_TEST",t[t.NO_ERROR=0]="NO_ERROR",t[t.INVALID_ENUM=1280]="INVALID_ENUM",t[t.INVALID_VALUE=1281]="INVALID_VALUE",t[t.INVALID_OPERATION=1282]="INVALID_OPERATION",t[t.OUT_OF_MEMORY=1285]="OUT_OF_MEMORY",t[t.CONTEXT_LOST_WEBGL=37442]="CONTEXT_LOST_WEBGL",t[t.CW=2304]="CW",t[t.CCW=2305]="CCW",t[t.DONT_CARE=4352]="DONT_CARE",t[t.FASTEST=4353]="FASTEST",t[t.NICEST=4354]="NICEST",t[t.GENERATE_MIPMAP_HINT=33170]="GENERATE_MIPMAP_HINT",t[t.BYTE=5120]="BYTE",t[t.UNSIGNED_BYTE=5121]="UNSIGNED_BYTE",t[t.SHORT=5122]="SHORT",t[t.UNSIGNED_SHORT=5123]="UNSIGNED_SHORT",t[t.INT=5124]="INT",t[t.UNSIGNED_INT=5125]="UNSIGNED_INT",t[t.FLOAT=5126]="FLOAT",t[t.DOUBLE=5130]="DOUBLE",t[t.DEPTH_COMPONENT=6402]="DEPTH_COMPONENT",t[t.ALPHA=6406]="ALPHA",t[t.RGB=6407]="RGB",t[t.RGBA=6408]="RGBA",t[t.LUMINANCE=6409]="LUMINANCE",t[t.LUMINANCE_ALPHA=6410]="LUMINANCE_ALPHA",t[t.UNSIGNED_SHORT_4_4_4_4=32819]="UNSIGNED_SHORT_4_4_4_4",t[t.UNSIGNED_SHORT_5_5_5_1=32820]="UNSIGNED_SHORT_5_5_5_1",t[t.UNSIGNED_SHORT_5_6_5=33635]="UNSIGNED_SHORT_5_6_5",t[t.FRAGMENT_SHADER=35632]="FRAGMENT_SHADER",t[t.VERTEX_SHADER=35633]="VERTEX_SHADER",t[t.COMPILE_STATUS=35713]="COMPILE_STATUS",t[t.DELETE_STATUS=35712]="DELETE_STATUS",t[t.LINK_STATUS=35714]="LINK_STATUS",t[t.VALIDATE_STATUS=35715]="VALIDATE_STATUS",t[t.ATTACHED_SHADERS=35717]="ATTACHED_SHADERS",t[t.ACTIVE_ATTRIBUTES=35721]="ACTIVE_ATTRIBUTES",t[t.ACTIVE_UNIFORMS=35718]="ACTIVE_UNIFORMS",t[t.MAX_VERTEX_ATTRIBS=34921]="MAX_VERTEX_ATTRIBS",t[t.MAX_VERTEX_UNIFORM_VECTORS=36347]="MAX_VERTEX_UNIFORM_VECTORS",t[t.MAX_VARYING_VECTORS=36348]="MAX_VARYING_VECTORS",t[t.MAX_COMBINED_TEXTURE_IMAGE_UNITS=35661]="MAX_COMBINED_TEXTURE_IMAGE_UNITS",t[t.MAX_VERTEX_TEXTURE_IMAGE_UNITS=35660]="MAX_VERTEX_TEXTURE_IMAGE_UNITS",t[t.MAX_TEXTURE_IMAGE_UNITS=34930]="MAX_TEXTURE_IMAGE_UNITS",t[t.MAX_FRAGMENT_UNIFORM_VECTORS=36349]="MAX_FRAGMENT_UNIFORM_VECTORS",t[t.SHADER_TYPE=35663]="SHADER_TYPE",t[t.SHADING_LANGUAGE_VERSION=35724]="SHADING_LANGUAGE_VERSION",t[t.CURRENT_PROGRAM=35725]="CURRENT_PROGRAM",t[t.NEVER=512]="NEVER",t[t.LESS=513]="LESS",t[t.EQUAL=514]="EQUAL",t[t.LEQUAL=515]="LEQUAL",t[t.GREATER=516]="GREATER",t[t.NOTEQUAL=517]="NOTEQUAL",t[t.GEQUAL=518]="GEQUAL",t[t.ALWAYS=519]="ALWAYS",t[t.KEEP=7680]="KEEP",t[t.REPLACE=7681]="REPLACE",t[t.INCR=7682]="INCR",t[t.DECR=7683]="DECR",t[t.INVERT=5386]="INVERT",t[t.INCR_WRAP=34055]="INCR_WRAP",t[t.DECR_WRAP=34056]="DECR_WRAP",t[t.NEAREST=9728]="NEAREST",t[t.LINEAR=9729]="LINEAR",t[t.NEAREST_MIPMAP_NEAREST=9984]="NEAREST_MIPMAP_NEAREST",t[t.LINEAR_MIPMAP_NEAREST=9985]="LINEAR_MIPMAP_NEAREST",t[t.NEAREST_MIPMAP_LINEAR=9986]="NEAREST_MIPMAP_LINEAR",t[t.LINEAR_MIPMAP_LINEAR=9987]="LINEAR_MIPMAP_LINEAR",t[t.TEXTURE_MAG_FILTER=10240]="TEXTURE_MAG_FILTER",t[t.TEXTURE_MIN_FILTER=10241]="TEXTURE_MIN_FILTER",t[t.TEXTURE_WRAP_S=10242]="TEXTURE_WRAP_S",t[t.TEXTURE_WRAP_T=10243]="TEXTURE_WRAP_T",t[t.TEXTURE_2D=3553]="TEXTURE_2D",t[t.TEXTURE=5890]="TEXTURE",t[t.TEXTURE_CUBE_MAP=34067]="TEXTURE_CUBE_MAP",t[t.TEXTURE_BINDING_CUBE_MAP=34068]="TEXTURE_BINDING_CUBE_MAP",t[t.TEXTURE_CUBE_MAP_POSITIVE_X=34069]="TEXTURE_CUBE_MAP_POSITIVE_X",t[t.TEXTURE_CUBE_MAP_NEGATIVE_X=34070]="TEXTURE_CUBE_MAP_NEGATIVE_X",t[t.TEXTURE_CUBE_MAP_POSITIVE_Y=34071]="TEXTURE_CUBE_MAP_POSITIVE_Y",t[t.TEXTURE_CUBE_MAP_NEGATIVE_Y=34072]="TEXTURE_CUBE_MAP_NEGATIVE_Y",t[t.TEXTURE_CUBE_MAP_POSITIVE_Z=34073]="TEXTURE_CUBE_MAP_POSITIVE_Z",t[t.TEXTURE_CUBE_MAP_NEGATIVE_Z=34074]="TEXTURE_CUBE_MAP_NEGATIVE_Z",t[t.MAX_CUBE_MAP_TEXTURE_SIZE=34076]="MAX_CUBE_MAP_TEXTURE_SIZE",t[t.TEXTURE0=33984]="TEXTURE0",t[t.ACTIVE_TEXTURE=34016]="ACTIVE_TEXTURE",t[t.REPEAT=10497]="REPEAT",t[t.CLAMP_TO_EDGE=33071]="CLAMP_TO_EDGE",t[t.MIRRORED_REPEAT=33648]="MIRRORED_REPEAT",t[t.TEXTURE_WIDTH=4096]="TEXTURE_WIDTH",t[t.TEXTURE_HEIGHT=4097]="TEXTURE_HEIGHT",t[t.FLOAT_VEC2=35664]="FLOAT_VEC2",t[t.FLOAT_VEC3=35665]="FLOAT_VEC3",t[t.FLOAT_VEC4=35666]="FLOAT_VEC4",t[t.INT_VEC2=35667]="INT_VEC2",t[t.INT_VEC3=35668]="INT_VEC3",t[t.INT_VEC4=35669]="INT_VEC4",t[t.BOOL=35670]="BOOL",t[t.BOOL_VEC2=35671]="BOOL_VEC2",t[t.BOOL_VEC3=35672]="BOOL_VEC3",t[t.BOOL_VEC4=35673]="BOOL_VEC4",t[t.FLOAT_MAT2=35674]="FLOAT_MAT2",t[t.FLOAT_MAT3=35675]="FLOAT_MAT3",t[t.FLOAT_MAT4=35676]="FLOAT_MAT4",t[t.SAMPLER_2D=35678]="SAMPLER_2D",t[t.SAMPLER_CUBE=35680]="SAMPLER_CUBE",t[t.LOW_FLOAT=36336]="LOW_FLOAT",t[t.MEDIUM_FLOAT=36337]="MEDIUM_FLOAT",t[t.HIGH_FLOAT=36338]="HIGH_FLOAT",t[t.LOW_INT=36339]="LOW_INT",t[t.MEDIUM_INT=36340]="MEDIUM_INT",t[t.HIGH_INT=36341]="HIGH_INT",t[t.FRAMEBUFFER=36160]="FRAMEBUFFER",t[t.RENDERBUFFER=36161]="RENDERBUFFER",t[t.RGBA4=32854]="RGBA4",t[t.RGB5_A1=32855]="RGB5_A1",t[t.RGB565=36194]="RGB565",t[t.DEPTH_COMPONENT16=33189]="DEPTH_COMPONENT16",t[t.STENCIL_INDEX=6401]="STENCIL_INDEX",t[t.STENCIL_INDEX8=36168]="STENCIL_INDEX8",t[t.DEPTH_STENCIL=34041]="DEPTH_STENCIL",t[t.RENDERBUFFER_WIDTH=36162]="RENDERBUFFER_WIDTH",t[t.RENDERBUFFER_HEIGHT=36163]="RENDERBUFFER_HEIGHT",t[t.RENDERBUFFER_INTERNAL_FORMAT=36164]="RENDERBUFFER_INTERNAL_FORMAT",t[t.RENDERBUFFER_RED_SIZE=36176]="RENDERBUFFER_RED_SIZE",t[t.RENDERBUFFER_GREEN_SIZE=36177]="RENDERBUFFER_GREEN_SIZE",t[t.RENDERBUFFER_BLUE_SIZE=36178]="RENDERBUFFER_BLUE_SIZE",t[t.RENDERBUFFER_ALPHA_SIZE=36179]="RENDERBUFFER_ALPHA_SIZE",t[t.RENDERBUFFER_DEPTH_SIZE=36180]="RENDERBUFFER_DEPTH_SIZE",t[t.RENDERBUFFER_STENCIL_SIZE=36181]="RENDERBUFFER_STENCIL_SIZE",t[t.FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE=36048]="FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE",t[t.FRAMEBUFFER_ATTACHMENT_OBJECT_NAME=36049]="FRAMEBUFFER_ATTACHMENT_OBJECT_NAME",t[t.FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL=36050]="FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL",t[t.FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE=36051]="FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE",t[t.COLOR_ATTACHMENT0=36064]="COLOR_ATTACHMENT0",t[t.DEPTH_ATTACHMENT=36096]="DEPTH_ATTACHMENT",t[t.STENCIL_ATTACHMENT=36128]="STENCIL_ATTACHMENT",t[t.DEPTH_STENCIL_ATTACHMENT=33306]="DEPTH_STENCIL_ATTACHMENT",t[t.NONE=0]="NONE",t[t.FRAMEBUFFER_COMPLETE=36053]="FRAMEBUFFER_COMPLETE",t[t.FRAMEBUFFER_INCOMPLETE_ATTACHMENT=36054]="FRAMEBUFFER_INCOMPLETE_ATTACHMENT",t[t.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT=36055]="FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT",t[t.FRAMEBUFFER_INCOMPLETE_DIMENSIONS=36057]="FRAMEBUFFER_INCOMPLETE_DIMENSIONS",t[t.FRAMEBUFFER_UNSUPPORTED=36061]="FRAMEBUFFER_UNSUPPORTED",t[t.FRAMEBUFFER_BINDING=36006]="FRAMEBUFFER_BINDING",t[t.RENDERBUFFER_BINDING=36007]="RENDERBUFFER_BINDING",t[t.READ_FRAMEBUFFER=36008]="READ_FRAMEBUFFER",t[t.DRAW_FRAMEBUFFER=36009]="DRAW_FRAMEBUFFER",t[t.MAX_RENDERBUFFER_SIZE=34024]="MAX_RENDERBUFFER_SIZE",t[t.INVALID_FRAMEBUFFER_OPERATION=1286]="INVALID_FRAMEBUFFER_OPERATION",t[t.UNPACK_FLIP_Y_WEBGL=37440]="UNPACK_FLIP_Y_WEBGL",t[t.UNPACK_PREMULTIPLY_ALPHA_WEBGL=37441]="UNPACK_PREMULTIPLY_ALPHA_WEBGL",t[t.UNPACK_COLORSPACE_CONVERSION_WEBGL=37443]="UNPACK_COLORSPACE_CONVERSION_WEBGL",t[t.READ_BUFFER=3074]="READ_BUFFER",t[t.UNPACK_ROW_LENGTH=3314]="UNPACK_ROW_LENGTH",t[t.UNPACK_SKIP_ROWS=3315]="UNPACK_SKIP_ROWS",t[t.UNPACK_SKIP_PIXELS=3316]="UNPACK_SKIP_PIXELS",t[t.PACK_ROW_LENGTH=3330]="PACK_ROW_LENGTH",t[t.PACK_SKIP_ROWS=3331]="PACK_SKIP_ROWS",t[t.PACK_SKIP_PIXELS=3332]="PACK_SKIP_PIXELS",t[t.TEXTURE_BINDING_3D=32874]="TEXTURE_BINDING_3D",t[t.UNPACK_SKIP_IMAGES=32877]="UNPACK_SKIP_IMAGES",t[t.UNPACK_IMAGE_HEIGHT=32878]="UNPACK_IMAGE_HEIGHT",t[t.MAX_3D_TEXTURE_SIZE=32883]="MAX_3D_TEXTURE_SIZE",t[t.MAX_ELEMENTS_VERTICES=33e3]="MAX_ELEMENTS_VERTICES",t[t.MAX_ELEMENTS_INDICES=33001]="MAX_ELEMENTS_INDICES",t[t.MAX_TEXTURE_LOD_BIAS=34045]="MAX_TEXTURE_LOD_BIAS",t[t.MAX_FRAGMENT_UNIFORM_COMPONENTS=35657]="MAX_FRAGMENT_UNIFORM_COMPONENTS",t[t.MAX_VERTEX_UNIFORM_COMPONENTS=35658]="MAX_VERTEX_UNIFORM_COMPONENTS",t[t.MAX_ARRAY_TEXTURE_LAYERS=35071]="MAX_ARRAY_TEXTURE_LAYERS",t[t.MIN_PROGRAM_TEXEL_OFFSET=35076]="MIN_PROGRAM_TEXEL_OFFSET",t[t.MAX_PROGRAM_TEXEL_OFFSET=35077]="MAX_PROGRAM_TEXEL_OFFSET",t[t.MAX_VARYING_COMPONENTS=35659]="MAX_VARYING_COMPONENTS",t[t.FRAGMENT_SHADER_DERIVATIVE_HINT=35723]="FRAGMENT_SHADER_DERIVATIVE_HINT",t[t.RASTERIZER_DISCARD=35977]="RASTERIZER_DISCARD",t[t.VERTEX_ARRAY_BINDING=34229]="VERTEX_ARRAY_BINDING",t[t.MAX_VERTEX_OUTPUT_COMPONENTS=37154]="MAX_VERTEX_OUTPUT_COMPONENTS",t[t.MAX_FRAGMENT_INPUT_COMPONENTS=37157]="MAX_FRAGMENT_INPUT_COMPONENTS",t[t.MAX_SERVER_WAIT_TIMEOUT=37137]="MAX_SERVER_WAIT_TIMEOUT",t[t.MAX_ELEMENT_INDEX=36203]="MAX_ELEMENT_INDEX",t[t.RED=6403]="RED",t[t.RGB8=32849]="RGB8",t[t.RGBA8=32856]="RGBA8",t[t.RGB10_A2=32857]="RGB10_A2",t[t.TEXTURE_3D=32879]="TEXTURE_3D",t[t.TEXTURE_WRAP_R=32882]="TEXTURE_WRAP_R",t[t.TEXTURE_MIN_LOD=33082]="TEXTURE_MIN_LOD",t[t.TEXTURE_MAX_LOD=33083]="TEXTURE_MAX_LOD",t[t.TEXTURE_BASE_LEVEL=33084]="TEXTURE_BASE_LEVEL",t[t.TEXTURE_MAX_LEVEL=33085]="TEXTURE_MAX_LEVEL",t[t.TEXTURE_COMPARE_MODE=34892]="TEXTURE_COMPARE_MODE",t[t.TEXTURE_COMPARE_FUNC=34893]="TEXTURE_COMPARE_FUNC",t[t.SRGB=35904]="SRGB",t[t.SRGB8=35905]="SRGB8",t[t.SRGB8_ALPHA8=35907]="SRGB8_ALPHA8",t[t.COMPARE_REF_TO_TEXTURE=34894]="COMPARE_REF_TO_TEXTURE",t[t.RGBA32F=34836]="RGBA32F",t[t.RGB32F=34837]="RGB32F",t[t.RGBA16F=34842]="RGBA16F",t[t.RGB16F=34843]="RGB16F",t[t.TEXTURE_2D_ARRAY=35866]="TEXTURE_2D_ARRAY",t[t.TEXTURE_BINDING_2D_ARRAY=35869]="TEXTURE_BINDING_2D_ARRAY",t[t.R11F_G11F_B10F=35898]="R11F_G11F_B10F",t[t.RGB9_E5=35901]="RGB9_E5",t[t.RGBA32UI=36208]="RGBA32UI",t[t.RGB32UI=36209]="RGB32UI",t[t.RGBA16UI=36214]="RGBA16UI",t[t.RGB16UI=36215]="RGB16UI",t[t.RGBA8UI=36220]="RGBA8UI",t[t.RGB8UI=36221]="RGB8UI",t[t.RGBA32I=36226]="RGBA32I",t[t.RGB32I=36227]="RGB32I",t[t.RGBA16I=36232]="RGBA16I",t[t.RGB16I=36233]="RGB16I",t[t.RGBA8I=36238]="RGBA8I",t[t.RGB8I=36239]="RGB8I",t[t.RED_INTEGER=36244]="RED_INTEGER",t[t.RGB_INTEGER=36248]="RGB_INTEGER",t[t.RGBA_INTEGER=36249]="RGBA_INTEGER",t[t.R8=33321]="R8",t[t.RG8=33323]="RG8",t[t.R16F=33325]="R16F",t[t.R32F=33326]="R32F",t[t.RG16F=33327]="RG16F",t[t.RG32F=33328]="RG32F",t[t.R8I=33329]="R8I",t[t.R8UI=33330]="R8UI",t[t.R16I=33331]="R16I",t[t.R16UI=33332]="R16UI",t[t.R32I=33333]="R32I",t[t.R32UI=33334]="R32UI",t[t.RG8I=33335]="RG8I",t[t.RG8UI=33336]="RG8UI",t[t.RG16I=33337]="RG16I",t[t.RG16UI=33338]="RG16UI",t[t.RG32I=33339]="RG32I",t[t.RG32UI=33340]="RG32UI",t[t.R8_SNORM=36756]="R8_SNORM",t[t.RG8_SNORM=36757]="RG8_SNORM",t[t.RGB8_SNORM=36758]="RGB8_SNORM",t[t.RGBA8_SNORM=36759]="RGBA8_SNORM",t[t.RGB10_A2UI=36975]="RGB10_A2UI",t[t.TEXTURE_IMMUTABLE_FORMAT=37167]="TEXTURE_IMMUTABLE_FORMAT",t[t.TEXTURE_IMMUTABLE_LEVELS=33503]="TEXTURE_IMMUTABLE_LEVELS",t[t.UNSIGNED_INT_2_10_10_10_REV=33640]="UNSIGNED_INT_2_10_10_10_REV",t[t.UNSIGNED_INT_10F_11F_11F_REV=35899]="UNSIGNED_INT_10F_11F_11F_REV",t[t.UNSIGNED_INT_5_9_9_9_REV=35902]="UNSIGNED_INT_5_9_9_9_REV",t[t.FLOAT_32_UNSIGNED_INT_24_8_REV=36269]="FLOAT_32_UNSIGNED_INT_24_8_REV",t[t.UNSIGNED_INT_24_8=34042]="UNSIGNED_INT_24_8",t[t.HALF_FLOAT=5131]="HALF_FLOAT",t[t.RG=33319]="RG",t[t.RG_INTEGER=33320]="RG_INTEGER",t[t.INT_2_10_10_10_REV=36255]="INT_2_10_10_10_REV",t[t.CURRENT_QUERY=34917]="CURRENT_QUERY",t[t.QUERY_RESULT=34918]="QUERY_RESULT",t[t.QUERY_RESULT_AVAILABLE=34919]="QUERY_RESULT_AVAILABLE",t[t.ANY_SAMPLES_PASSED=35887]="ANY_SAMPLES_PASSED",t[t.ANY_SAMPLES_PASSED_CONSERVATIVE=36202]="ANY_SAMPLES_PASSED_CONSERVATIVE",t[t.MAX_DRAW_BUFFERS=34852]="MAX_DRAW_BUFFERS",t[t.DRAW_BUFFER0=34853]="DRAW_BUFFER0",t[t.DRAW_BUFFER1=34854]="DRAW_BUFFER1",t[t.DRAW_BUFFER2=34855]="DRAW_BUFFER2",t[t.DRAW_BUFFER3=34856]="DRAW_BUFFER3",t[t.DRAW_BUFFER4=34857]="DRAW_BUFFER4",t[t.DRAW_BUFFER5=34858]="DRAW_BUFFER5",t[t.DRAW_BUFFER6=34859]="DRAW_BUFFER6",t[t.DRAW_BUFFER7=34860]="DRAW_BUFFER7",t[t.DRAW_BUFFER8=34861]="DRAW_BUFFER8",t[t.DRAW_BUFFER9=34862]="DRAW_BUFFER9",t[t.DRAW_BUFFER10=34863]="DRAW_BUFFER10",t[t.DRAW_BUFFER11=34864]="DRAW_BUFFER11",t[t.DRAW_BUFFER12=34865]="DRAW_BUFFER12",t[t.DRAW_BUFFER13=34866]="DRAW_BUFFER13",t[t.DRAW_BUFFER14=34867]="DRAW_BUFFER14",t[t.DRAW_BUFFER15=34868]="DRAW_BUFFER15",t[t.MAX_COLOR_ATTACHMENTS=36063]="MAX_COLOR_ATTACHMENTS",t[t.COLOR_ATTACHMENT1=36065]="COLOR_ATTACHMENT1",t[t.COLOR_ATTACHMENT2=36066]="COLOR_ATTACHMENT2",t[t.COLOR_ATTACHMENT3=36067]="COLOR_ATTACHMENT3",t[t.COLOR_ATTACHMENT4=36068]="COLOR_ATTACHMENT4",t[t.COLOR_ATTACHMENT5=36069]="COLOR_ATTACHMENT5",t[t.COLOR_ATTACHMENT6=36070]="COLOR_ATTACHMENT6",t[t.COLOR_ATTACHMENT7=36071]="COLOR_ATTACHMENT7",t[t.COLOR_ATTACHMENT8=36072]="COLOR_ATTACHMENT8",t[t.COLOR_ATTACHMENT9=36073]="COLOR_ATTACHMENT9",t[t.COLOR_ATTACHMENT10=36074]="COLOR_ATTACHMENT10",t[t.COLOR_ATTACHMENT11=36075]="COLOR_ATTACHMENT11",t[t.COLOR_ATTACHMENT12=36076]="COLOR_ATTACHMENT12",t[t.COLOR_ATTACHMENT13=36077]="COLOR_ATTACHMENT13",t[t.COLOR_ATTACHMENT14=36078]="COLOR_ATTACHMENT14",t[t.COLOR_ATTACHMENT15=36079]="COLOR_ATTACHMENT15",t[t.SAMPLER_3D=35679]="SAMPLER_3D",t[t.SAMPLER_2D_SHADOW=35682]="SAMPLER_2D_SHADOW",t[t.SAMPLER_2D_ARRAY=36289]="SAMPLER_2D_ARRAY",t[t.SAMPLER_2D_ARRAY_SHADOW=36292]="SAMPLER_2D_ARRAY_SHADOW",t[t.SAMPLER_CUBE_SHADOW=36293]="SAMPLER_CUBE_SHADOW",t[t.INT_SAMPLER_2D=36298]="INT_SAMPLER_2D",t[t.INT_SAMPLER_3D=36299]="INT_SAMPLER_3D",t[t.INT_SAMPLER_CUBE=36300]="INT_SAMPLER_CUBE",t[t.INT_SAMPLER_2D_ARRAY=36303]="INT_SAMPLER_2D_ARRAY",t[t.UNSIGNED_INT_SAMPLER_2D=36306]="UNSIGNED_INT_SAMPLER_2D",t[t.UNSIGNED_INT_SAMPLER_3D=36307]="UNSIGNED_INT_SAMPLER_3D",t[t.UNSIGNED_INT_SAMPLER_CUBE=36308]="UNSIGNED_INT_SAMPLER_CUBE",t[t.UNSIGNED_INT_SAMPLER_2D_ARRAY=36311]="UNSIGNED_INT_SAMPLER_2D_ARRAY",t[t.MAX_SAMPLES=36183]="MAX_SAMPLES",t[t.SAMPLER_BINDING=35097]="SAMPLER_BINDING",t[t.PIXEL_PACK_BUFFER=35051]="PIXEL_PACK_BUFFER",t[t.PIXEL_UNPACK_BUFFER=35052]="PIXEL_UNPACK_BUFFER",t[t.PIXEL_PACK_BUFFER_BINDING=35053]="PIXEL_PACK_BUFFER_BINDING",t[t.PIXEL_UNPACK_BUFFER_BINDING=35055]="PIXEL_UNPACK_BUFFER_BINDING",t[t.COPY_READ_BUFFER=36662]="COPY_READ_BUFFER",t[t.COPY_WRITE_BUFFER=36663]="COPY_WRITE_BUFFER",t[t.COPY_READ_BUFFER_BINDING=36662]="COPY_READ_BUFFER_BINDING",t[t.COPY_WRITE_BUFFER_BINDING=36663]="COPY_WRITE_BUFFER_BINDING",t[t.FLOAT_MAT2x3=35685]="FLOAT_MAT2x3",t[t.FLOAT_MAT2x4=35686]="FLOAT_MAT2x4",t[t.FLOAT_MAT3x2=35687]="FLOAT_MAT3x2",t[t.FLOAT_MAT3x4=35688]="FLOAT_MAT3x4",t[t.FLOAT_MAT4x2=35689]="FLOAT_MAT4x2",t[t.FLOAT_MAT4x3=35690]="FLOAT_MAT4x3",t[t.UNSIGNED_INT_VEC2=36294]="UNSIGNED_INT_VEC2",t[t.UNSIGNED_INT_VEC3=36295]="UNSIGNED_INT_VEC3",t[t.UNSIGNED_INT_VEC4=36296]="UNSIGNED_INT_VEC4",t[t.UNSIGNED_NORMALIZED=35863]="UNSIGNED_NORMALIZED",t[t.SIGNED_NORMALIZED=36764]="SIGNED_NORMALIZED",t[t.VERTEX_ATTRIB_ARRAY_INTEGER=35069]="VERTEX_ATTRIB_ARRAY_INTEGER",t[t.VERTEX_ATTRIB_ARRAY_DIVISOR=35070]="VERTEX_ATTRIB_ARRAY_DIVISOR",t[t.TRANSFORM_FEEDBACK_BUFFER_MODE=35967]="TRANSFORM_FEEDBACK_BUFFER_MODE",t[t.MAX_TRANSFORM_FEEDBACK_SEPARATE_COMPONENTS=35968]="MAX_TRANSFORM_FEEDBACK_SEPARATE_COMPONENTS",t[t.TRANSFORM_FEEDBACK_VARYINGS=35971]="TRANSFORM_FEEDBACK_VARYINGS",t[t.TRANSFORM_FEEDBACK_BUFFER_START=35972]="TRANSFORM_FEEDBACK_BUFFER_START",t[t.TRANSFORM_FEEDBACK_BUFFER_SIZE=35973]="TRANSFORM_FEEDBACK_BUFFER_SIZE",t[t.TRANSFORM_FEEDBACK_PRIMITIVES_WRITTEN=35976]="TRANSFORM_FEEDBACK_PRIMITIVES_WRITTEN",t[t.MAX_TRANSFORM_FEEDBACK_INTERLEAVED_COMPONENTS=35978]="MAX_TRANSFORM_FEEDBACK_INTERLEAVED_COMPONENTS",t[t.MAX_TRANSFORM_FEEDBACK_SEPARATE_ATTRIBS=35979]="MAX_TRANSFORM_FEEDBACK_SEPARATE_ATTRIBS",t[t.INTERLEAVED_ATTRIBS=35980]="INTERLEAVED_ATTRIBS",t[t.SEPARATE_ATTRIBS=35981]="SEPARATE_ATTRIBS",t[t.TRANSFORM_FEEDBACK_BUFFER=35982]="TRANSFORM_FEEDBACK_BUFFER",t[t.TRANSFORM_FEEDBACK_BUFFER_BINDING=35983]="TRANSFORM_FEEDBACK_BUFFER_BINDING",t[t.TRANSFORM_FEEDBACK=36386]="TRANSFORM_FEEDBACK",t[t.TRANSFORM_FEEDBACK_PAUSED=36387]="TRANSFORM_FEEDBACK_PAUSED",t[t.TRANSFORM_FEEDBACK_ACTIVE=36388]="TRANSFORM_FEEDBACK_ACTIVE",t[t.TRANSFORM_FEEDBACK_BINDING=36389]="TRANSFORM_FEEDBACK_BINDING",t[t.FRAMEBUFFER_ATTACHMENT_COLOR_ENCODING=33296]="FRAMEBUFFER_ATTACHMENT_COLOR_ENCODING",t[t.FRAMEBUFFER_ATTACHMENT_COMPONENT_TYPE=33297]="FRAMEBUFFER_ATTACHMENT_COMPONENT_TYPE",t[t.FRAMEBUFFER_ATTACHMENT_RED_SIZE=33298]="FRAMEBUFFER_ATTACHMENT_RED_SIZE",t[t.FRAMEBUFFER_ATTACHMENT_GREEN_SIZE=33299]="FRAMEBUFFER_ATTACHMENT_GREEN_SIZE",t[t.FRAMEBUFFER_ATTACHMENT_BLUE_SIZE=33300]="FRAMEBUFFER_ATTACHMENT_BLUE_SIZE",t[t.FRAMEBUFFER_ATTACHMENT_ALPHA_SIZE=33301]="FRAMEBUFFER_ATTACHMENT_ALPHA_SIZE",t[t.FRAMEBUFFER_ATTACHMENT_DEPTH_SIZE=33302]="FRAMEBUFFER_ATTACHMENT_DEPTH_SIZE",t[t.FRAMEBUFFER_ATTACHMENT_STENCIL_SIZE=33303]="FRAMEBUFFER_ATTACHMENT_STENCIL_SIZE",t[t.FRAMEBUFFER_DEFAULT=33304]="FRAMEBUFFER_DEFAULT",t[t.DEPTH24_STENCIL8=35056]="DEPTH24_STENCIL8",t[t.DRAW_FRAMEBUFFER_BINDING=36006]="DRAW_FRAMEBUFFER_BINDING",t[t.READ_FRAMEBUFFER_BINDING=36010]="READ_FRAMEBUFFER_BINDING",t[t.RENDERBUFFER_SAMPLES=36011]="RENDERBUFFER_SAMPLES",t[t.FRAMEBUFFER_ATTACHMENT_TEXTURE_LAYER=36052]="FRAMEBUFFER_ATTACHMENT_TEXTURE_LAYER",t[t.FRAMEBUFFER_INCOMPLETE_MULTISAMPLE=36182]="FRAMEBUFFER_INCOMPLETE_MULTISAMPLE",t[t.UNIFORM_BUFFER=35345]="UNIFORM_BUFFER",t[t.UNIFORM_BUFFER_BINDING=35368]="UNIFORM_BUFFER_BINDING",t[t.UNIFORM_BUFFER_START=35369]="UNIFORM_BUFFER_START",t[t.UNIFORM_BUFFER_SIZE=35370]="UNIFORM_BUFFER_SIZE",t[t.MAX_VERTEX_UNIFORM_BLOCKS=35371]="MAX_VERTEX_UNIFORM_BLOCKS",t[t.MAX_FRAGMENT_UNIFORM_BLOCKS=35373]="MAX_FRAGMENT_UNIFORM_BLOCKS",t[t.MAX_COMBINED_UNIFORM_BLOCKS=35374]="MAX_COMBINED_UNIFORM_BLOCKS",t[t.MAX_UNIFORM_BUFFER_BINDINGS=35375]="MAX_UNIFORM_BUFFER_BINDINGS",t[t.MAX_UNIFORM_BLOCK_SIZE=35376]="MAX_UNIFORM_BLOCK_SIZE",t[t.MAX_COMBINED_VERTEX_UNIFORM_COMPONENTS=35377]="MAX_COMBINED_VERTEX_UNIFORM_COMPONENTS",t[t.MAX_COMBINED_FRAGMENT_UNIFORM_COMPONENTS=35379]="MAX_COMBINED_FRAGMENT_UNIFORM_COMPONENTS",t[t.UNIFORM_BUFFER_OFFSET_ALIGNMENT=35380]="UNIFORM_BUFFER_OFFSET_ALIGNMENT",t[t.ACTIVE_UNIFORM_BLOCKS=35382]="ACTIVE_UNIFORM_BLOCKS",t[t.UNIFORM_TYPE=35383]="UNIFORM_TYPE",t[t.UNIFORM_SIZE=35384]="UNIFORM_SIZE",t[t.UNIFORM_BLOCK_INDEX=35386]="UNIFORM_BLOCK_INDEX",t[t.UNIFORM_OFFSET=35387]="UNIFORM_OFFSET",t[t.UNIFORM_ARRAY_STRIDE=35388]="UNIFORM_ARRAY_STRIDE",t[t.UNIFORM_MATRIX_STRIDE=35389]="UNIFORM_MATRIX_STRIDE",t[t.UNIFORM_IS_ROW_MAJOR=35390]="UNIFORM_IS_ROW_MAJOR",t[t.UNIFORM_BLOCK_BINDING=35391]="UNIFORM_BLOCK_BINDING",t[t.UNIFORM_BLOCK_DATA_SIZE=35392]="UNIFORM_BLOCK_DATA_SIZE",t[t.UNIFORM_BLOCK_ACTIVE_UNIFORMS=35394]="UNIFORM_BLOCK_ACTIVE_UNIFORMS",t[t.UNIFORM_BLOCK_ACTIVE_UNIFORM_INDICES=35395]="UNIFORM_BLOCK_ACTIVE_UNIFORM_INDICES",t[t.UNIFORM_BLOCK_REFERENCED_BY_VERTEX_SHADER=35396]="UNIFORM_BLOCK_REFERENCED_BY_VERTEX_SHADER",t[t.UNIFORM_BLOCK_REFERENCED_BY_FRAGMENT_SHADER=35398]="UNIFORM_BLOCK_REFERENCED_BY_FRAGMENT_SHADER",t[t.OBJECT_TYPE=37138]="OBJECT_TYPE",t[t.SYNC_CONDITION=37139]="SYNC_CONDITION",t[t.SYNC_STATUS=37140]="SYNC_STATUS",t[t.SYNC_FLAGS=37141]="SYNC_FLAGS",t[t.SYNC_FENCE=37142]="SYNC_FENCE",t[t.SYNC_GPU_COMMANDS_COMPLETE=37143]="SYNC_GPU_COMMANDS_COMPLETE",t[t.UNSIGNALED=37144]="UNSIGNALED",t[t.SIGNALED=37145]="SIGNALED",t[t.ALREADY_SIGNALED=37146]="ALREADY_SIGNALED",t[t.TIMEOUT_EXPIRED=37147]="TIMEOUT_EXPIRED",t[t.CONDITION_SATISFIED=37148]="CONDITION_SATISFIED",t[t.WAIT_FAILED=37149]="WAIT_FAILED",t[t.SYNC_FLUSH_COMMANDS_BIT=1]="SYNC_FLUSH_COMMANDS_BIT",t[t.COLOR=6144]="COLOR",t[t.DEPTH=6145]="DEPTH",t[t.STENCIL=6146]="STENCIL",t[t.MIN=32775]="MIN",t[t.MAX=32776]="MAX",t[t.DEPTH_COMPONENT24=33190]="DEPTH_COMPONENT24",t[t.STREAM_READ=35041]="STREAM_READ",t[t.STREAM_COPY=35042]="STREAM_COPY",t[t.STATIC_READ=35045]="STATIC_READ",t[t.STATIC_COPY=35046]="STATIC_COPY",t[t.DYNAMIC_READ=35049]="DYNAMIC_READ",t[t.DYNAMIC_COPY=35050]="DYNAMIC_COPY",t[t.DEPTH_COMPONENT32F=36012]="DEPTH_COMPONENT32F",t[t.DEPTH32F_STENCIL8=36013]="DEPTH32F_STENCIL8",t[t.INVALID_INDEX=4294967295]="INVALID_INDEX",t[t.TIMEOUT_IGNORED=-1]="TIMEOUT_IGNORED",t[t.MAX_CLIENT_WAIT_TIMEOUT_WEBGL=37447]="MAX_CLIENT_WAIT_TIMEOUT_WEBGL",t[t.UNMASKED_VENDOR_WEBGL=37445]="UNMASKED_VENDOR_WEBGL",t[t.UNMASKED_RENDERER_WEBGL=37446]="UNMASKED_RENDERER_WEBGL",t[t.MAX_TEXTURE_MAX_ANISOTROPY_EXT=34047]="MAX_TEXTURE_MAX_ANISOTROPY_EXT",t[t.TEXTURE_MAX_ANISOTROPY_EXT=34046]="TEXTURE_MAX_ANISOTROPY_EXT",t[t.R16_EXT=33322]="R16_EXT",t[t.RG16_EXT=33324]="RG16_EXT",t[t.RGB16_EXT=32852]="RGB16_EXT",t[t.RGBA16_EXT=32859]="RGBA16_EXT",t[t.R16_SNORM_EXT=36760]="R16_SNORM_EXT",t[t.RG16_SNORM_EXT=36761]="RG16_SNORM_EXT",t[t.RGB16_SNORM_EXT=36762]="RGB16_SNORM_EXT",t[t.RGBA16_SNORM_EXT=36763]="RGBA16_SNORM_EXT",t[t.COMPRESSED_RGB_S3TC_DXT1_EXT=33776]="COMPRESSED_RGB_S3TC_DXT1_EXT",t[t.COMPRESSED_RGBA_S3TC_DXT1_EXT=33777]="COMPRESSED_RGBA_S3TC_DXT1_EXT",t[t.COMPRESSED_RGBA_S3TC_DXT3_EXT=33778]="COMPRESSED_RGBA_S3TC_DXT3_EXT",t[t.COMPRESSED_RGBA_S3TC_DXT5_EXT=33779]="COMPRESSED_RGBA_S3TC_DXT5_EXT",t[t.COMPRESSED_SRGB_S3TC_DXT1_EXT=35916]="COMPRESSED_SRGB_S3TC_DXT1_EXT",t[t.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT=35917]="COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT",t[t.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT=35918]="COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT",t[t.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT=35919]="COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT",t[t.COMPRESSED_RED_RGTC1_EXT=36283]="COMPRESSED_RED_RGTC1_EXT",t[t.COMPRESSED_SIGNED_RED_RGTC1_EXT=36284]="COMPRESSED_SIGNED_RED_RGTC1_EXT",t[t.COMPRESSED_RED_GREEN_RGTC2_EXT=36285]="COMPRESSED_RED_GREEN_RGTC2_EXT",t[t.COMPRESSED_SIGNED_RED_GREEN_RGTC2_EXT=36286]="COMPRESSED_SIGNED_RED_GREEN_RGTC2_EXT",t[t.COMPRESSED_RGBA_BPTC_UNORM_EXT=36492]="COMPRESSED_RGBA_BPTC_UNORM_EXT",t[t.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT=36493]="COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT",t[t.COMPRESSED_RGB_BPTC_SIGNED_FLOAT_EXT=36494]="COMPRESSED_RGB_BPTC_SIGNED_FLOAT_EXT",t[t.COMPRESSED_RGB_BPTC_UNSIGNED_FLOAT_EXT=36495]="COMPRESSED_RGB_BPTC_UNSIGNED_FLOAT_EXT",t[t.COMPRESSED_R11_EAC=37488]="COMPRESSED_R11_EAC",t[t.COMPRESSED_SIGNED_R11_EAC=37489]="COMPRESSED_SIGNED_R11_EAC",t[t.COMPRESSED_RG11_EAC=37490]="COMPRESSED_RG11_EAC",t[t.COMPRESSED_SIGNED_RG11_EAC=37491]="COMPRESSED_SIGNED_RG11_EAC",t[t.COMPRESSED_RGB8_ETC2=37492]="COMPRESSED_RGB8_ETC2",t[t.COMPRESSED_RGBA8_ETC2_EAC=37493]="COMPRESSED_RGBA8_ETC2_EAC",t[t.COMPRESSED_SRGB8_ETC2=37494]="COMPRESSED_SRGB8_ETC2",t[t.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC=37495]="COMPRESSED_SRGB8_ALPHA8_ETC2_EAC",t[t.COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2=37496]="COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2",t[t.COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2=37497]="COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2",t[t.COMPRESSED_RGB_PVRTC_4BPPV1_IMG=35840]="COMPRESSED_RGB_PVRTC_4BPPV1_IMG",t[t.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG=35842]="COMPRESSED_RGBA_PVRTC_4BPPV1_IMG",t[t.COMPRESSED_RGB_PVRTC_2BPPV1_IMG=35841]="COMPRESSED_RGB_PVRTC_2BPPV1_IMG",t[t.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG=35843]="COMPRESSED_RGBA_PVRTC_2BPPV1_IMG",t[t.COMPRESSED_RGB_ETC1_WEBGL=36196]="COMPRESSED_RGB_ETC1_WEBGL",t[t.COMPRESSED_RGB_ATC_WEBGL=35986]="COMPRESSED_RGB_ATC_WEBGL",t[t.COMPRESSED_RGBA_ATC_EXPLICIT_ALPHA_WEBGL=35986]="COMPRESSED_RGBA_ATC_EXPLICIT_ALPHA_WEBGL",t[t.COMPRESSED_RGBA_ATC_INTERPOLATED_ALPHA_WEBGL=34798]="COMPRESSED_RGBA_ATC_INTERPOLATED_ALPHA_WEBGL",t[t.COMPRESSED_RGBA_ASTC_4x4_KHR=37808]="COMPRESSED_RGBA_ASTC_4x4_KHR",t[t.COMPRESSED_RGBA_ASTC_5x4_KHR=37809]="COMPRESSED_RGBA_ASTC_5x4_KHR",t[t.COMPRESSED_RGBA_ASTC_5x5_KHR=37810]="COMPRESSED_RGBA_ASTC_5x5_KHR",t[t.COMPRESSED_RGBA_ASTC_6x5_KHR=37811]="COMPRESSED_RGBA_ASTC_6x5_KHR",t[t.COMPRESSED_RGBA_ASTC_6x6_KHR=37812]="COMPRESSED_RGBA_ASTC_6x6_KHR",t[t.COMPRESSED_RGBA_ASTC_8x5_KHR=37813]="COMPRESSED_RGBA_ASTC_8x5_KHR",t[t.COMPRESSED_RGBA_ASTC_8x6_KHR=37814]="COMPRESSED_RGBA_ASTC_8x6_KHR",t[t.COMPRESSED_RGBA_ASTC_8x8_KHR=37815]="COMPRESSED_RGBA_ASTC_8x8_KHR",t[t.COMPRESSED_RGBA_ASTC_10x5_KHR=37816]="COMPRESSED_RGBA_ASTC_10x5_KHR",t[t.COMPRESSED_RGBA_ASTC_10x6_KHR=37817]="COMPRESSED_RGBA_ASTC_10x6_KHR",t[t.COMPRESSED_RGBA_ASTC_10x8_KHR=37818]="COMPRESSED_RGBA_ASTC_10x8_KHR",t[t.COMPRESSED_RGBA_ASTC_10x10_KHR=37819]="COMPRESSED_RGBA_ASTC_10x10_KHR",t[t.COMPRESSED_RGBA_ASTC_12x10_KHR=37820]="COMPRESSED_RGBA_ASTC_12x10_KHR",t[t.COMPRESSED_RGBA_ASTC_12x12_KHR=37821]="COMPRESSED_RGBA_ASTC_12x12_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR=37840]="COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR=37841]="COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR=37842]="COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR=37843]="COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR=37844]="COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR=37845]="COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR=37846]="COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR=37847]="COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR=37848]="COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR=37849]="COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR=37850]="COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR=37851]="COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR=37852]="COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR=37853]="COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR",t[t.QUERY_COUNTER_BITS_EXT=34916]="QUERY_COUNTER_BITS_EXT",t[t.CURRENT_QUERY_EXT=34917]="CURRENT_QUERY_EXT",t[t.QUERY_RESULT_EXT=34918]="QUERY_RESULT_EXT",t[t.QUERY_RESULT_AVAILABLE_EXT=34919]="QUERY_RESULT_AVAILABLE_EXT",t[t.TIME_ELAPSED_EXT=35007]="TIME_ELAPSED_EXT",t[t.TIMESTAMP_EXT=36392]="TIMESTAMP_EXT",t[t.GPU_DISJOINT_EXT=36795]="GPU_DISJOINT_EXT",t[t.COMPLETION_STATUS_KHR=37297]="COMPLETION_STATUS_KHR",t[t.DEPTH_CLAMP_EXT=34383]="DEPTH_CLAMP_EXT",t[t.FIRST_VERTEX_CONVENTION_WEBGL=36429]="FIRST_VERTEX_CONVENTION_WEBGL",t[t.LAST_VERTEX_CONVENTION_WEBGL=36430]="LAST_VERTEX_CONVENTION_WEBGL",t[t.PROVOKING_VERTEX_WEBL=36431]="PROVOKING_VERTEX_WEBL",t[t.POLYGON_MODE_WEBGL=2880]="POLYGON_MODE_WEBGL",t[t.POLYGON_OFFSET_LINE_WEBGL=10754]="POLYGON_OFFSET_LINE_WEBGL",t[t.LINE_WEBGL=6913]="LINE_WEBGL",t[t.FILL_WEBGL=6914]="FILL_WEBGL",t[t.MAX_CLIP_DISTANCES_WEBGL=3378]="MAX_CLIP_DISTANCES_WEBGL",t[t.MAX_CULL_DISTANCES_WEBGL=33529]="MAX_CULL_DISTANCES_WEBGL",t[t.MAX_COMBINED_CLIP_AND_CULL_DISTANCES_WEBGL=33530]="MAX_COMBINED_CLIP_AND_CULL_DISTANCES_WEBGL",t[t.CLIP_DISTANCE0_WEBGL=12288]="CLIP_DISTANCE0_WEBGL",t[t.CLIP_DISTANCE1_WEBGL=12289]="CLIP_DISTANCE1_WEBGL",t[t.CLIP_DISTANCE2_WEBGL=12290]="CLIP_DISTANCE2_WEBGL",t[t.CLIP_DISTANCE3_WEBGL=12291]="CLIP_DISTANCE3_WEBGL",t[t.CLIP_DISTANCE4_WEBGL=12292]="CLIP_DISTANCE4_WEBGL",t[t.CLIP_DISTANCE5_WEBGL=12293]="CLIP_DISTANCE5_WEBGL",t[t.CLIP_DISTANCE6_WEBGL=12294]="CLIP_DISTANCE6_WEBGL",t[t.CLIP_DISTANCE7_WEBGL=12295]="CLIP_DISTANCE7_WEBGL",t[t.POLYGON_OFFSET_CLAMP_EXT=36379]="POLYGON_OFFSET_CLAMP_EXT",t[t.LOWER_LEFT_EXT=36001]="LOWER_LEFT_EXT",t[t.UPPER_LEFT_EXT=36002]="UPPER_LEFT_EXT",t[t.NEGATIVE_ONE_TO_ONE_EXT=37726]="NEGATIVE_ONE_TO_ONE_EXT",t[t.ZERO_TO_ONE_EXT=37727]="ZERO_TO_ONE_EXT",t[t.CLIP_ORIGIN_EXT=37724]="CLIP_ORIGIN_EXT",t[t.CLIP_DEPTH_MODE_EXT=37725]="CLIP_DEPTH_MODE_EXT",t[t.SRC1_COLOR_WEBGL=35065]="SRC1_COLOR_WEBGL",t[t.SRC1_ALPHA_WEBGL=34185]="SRC1_ALPHA_WEBGL",t[t.ONE_MINUS_SRC1_COLOR_WEBGL=35066]="ONE_MINUS_SRC1_COLOR_WEBGL",t[t.ONE_MINUS_SRC1_ALPHA_WEBGL=35067]="ONE_MINUS_SRC1_ALPHA_WEBGL",t[t.MAX_DUAL_SOURCE_DRAW_BUFFERS_WEBGL=35068]="MAX_DUAL_SOURCE_DRAW_BUFFERS_WEBGL",t[t.MIRROR_CLAMP_TO_EDGE_EXT=34627]="MIRROR_CLAMP_TO_EDGE_EXT"})(Cr||(Cr={}));const Pg={3042:!1,32773:new Float32Array([0,0,0,0]),32777:32774,34877:32774,32969:1,32968:0,32971:1,32970:0,3106:new Float32Array([0,0,0,0]),3107:[!0,!0,!0,!0],2884:!1,2885:1029,2929:!1,2931:1,2932:513,2928:new Float32Array([0,1]),2930:!0,3024:!0,35725:null,36006:null,36007:null,34229:null,34964:null,2886:2305,33170:4352,2849:1,32823:!1,32824:0,10752:0,32926:!1,32928:!1,32938:1,32939:!1,3089:!1,3088:new Int32Array([0,0,1024,1024]),2960:!1,2961:0,2968:4294967295,36005:4294967295,2962:519,2967:0,2963:4294967295,34816:519,36003:0,36004:4294967295,2964:7680,2965:7680,2966:7680,34817:7680,34818:7680,34819:7680,2978:[0,0,1024,1024],36389:null,36662:null,36663:null,35053:null,35055:null,35723:4352,36010:null,35977:!1,3333:4,3317:4,37440:!1,37441:!1,37443:37444,3330:0,3332:0,3331:0,3314:0,32878:0,3316:0,3315:0,32877:0},Re=(t,e,n)=>e?t.enable(n):t.disable(n),V0=(t,e,n)=>t.hint(n,e),ct=(t,e,n)=>t.pixelStorei(n,e),j0=(t,e,n)=>{const i=n===36006?36009:36008;return t.bindFramebuffer(i,e)},Fs=(t,e,n)=>{const r={34964:34962,36662:36662,36663:36663,35053:35051,35055:35052}[n];t.bindBuffer(r,e)};function Hh(t){return Array.isArray(t)||ArrayBuffer.isView(t)&&!(t instanceof DataView)}const jO={3042:Re,32773:(t,e)=>t.blendColor(...e),32777:"blendEquation",34877:"blendEquation",32969:"blendFunc",32968:"blendFunc",32971:"blendFunc",32970:"blendFunc",3106:(t,e)=>t.clearColor(...e),3107:(t,e)=>t.colorMask(...e),2884:Re,2885:(t,e)=>t.cullFace(e),2929:Re,2931:(t,e)=>t.clearDepth(e),2932:(t,e)=>t.depthFunc(e),2928:(t,e)=>t.depthRange(...e),2930:(t,e)=>t.depthMask(e),3024:Re,35723:V0,35725:(t,e)=>t.useProgram(e),36007:(t,e)=>t.bindRenderbuffer(36161,e),36389:(t,e)=>{var n;return(n=t.bindTransformFeedback)==null?void 0:n.call(t,36386,e)},34229:(t,e)=>t.bindVertexArray(e),36006:j0,36010:j0,34964:Fs,36662:Fs,36663:Fs,35053:Fs,35055:Fs,2886:(t,e)=>t.frontFace(e),33170:V0,2849:(t,e)=>t.lineWidth(e),32823:Re,32824:"polygonOffset",10752:"polygonOffset",35977:Re,32926:Re,32928:Re,32938:"sampleCoverage",32939:"sampleCoverage",3089:Re,3088:(t,e)=>t.scissor(...e),2960:Re,2961:(t,e)=>t.clearStencil(e),2968:(t,e)=>t.stencilMaskSeparate(1028,e),36005:(t,e)=>t.stencilMaskSeparate(1029,e),2962:"stencilFuncFront",2967:"stencilFuncFront",2963:"stencilFuncFront",34816:"stencilFuncBack",36003:"stencilFuncBack",36004:"stencilFuncBack",2964:"stencilOpFront",2965:"stencilOpFront",2966:"stencilOpFront",34817:"stencilOpBack",34818:"stencilOpBack",34819:"stencilOpBack",2978:(t,e)=>t.viewport(...e),34383:Re,10754:Re,12288:Re,12289:Re,12290:Re,12291:Re,12292:Re,12293:Re,12294:Re,12295:Re,3333:ct,3317:ct,37440:ct,37441:ct,37443:ct,3330:ct,3332:ct,3331:ct,3314:ct,32878:ct,3316:ct,3315:ct,32877:ct,framebuffer:(t,e)=>{const n=e&&"handle"in e?e.handle:e;return t.bindFramebuffer(36160,n)},blend:(t,e)=>e?t.enable(3042):t.disable(3042),blendColor:(t,e)=>t.blendColor(...e),blendEquation:(t,e)=>{const n=typeof e=="number"?[e,e]:e;t.blendEquationSeparate(...n)},blendFunc:(t,e)=>{const n=(e==null?void 0:e.length)===2?[...e,...e]:e;t.blendFuncSeparate(...n)},clearColor:(t,e)=>t.clearColor(...e),clearDepth:(t,e)=>t.clearDepth(e),clearStencil:(t,e)=>t.clearStencil(e),colorMask:(t,e)=>t.colorMask(...e),cull:(t,e)=>e?t.enable(2884):t.disable(2884),cullFace:(t,e)=>t.cullFace(e),depthTest:(t,e)=>e?t.enable(2929):t.disable(2929),depthFunc:(t,e)=>t.depthFunc(e),depthMask:(t,e)=>t.depthMask(e),depthRange:(t,e)=>t.depthRange(...e),dither:(t,e)=>e?t.enable(3024):t.disable(3024),derivativeHint:(t,e)=>{t.hint(35723,e)},frontFace:(t,e)=>t.frontFace(e),mipmapHint:(t,e)=>t.hint(33170,e),lineWidth:(t,e)=>t.lineWidth(e),polygonOffsetFill:(t,e)=>e?t.enable(32823):t.disable(32823),polygonOffset:(t,e)=>t.polygonOffset(...e),sampleCoverage:(t,e)=>t.sampleCoverage(...e),scissorTest:(t,e)=>e?t.enable(3089):t.disable(3089),scissor:(t,e)=>t.scissor(...e),stencilTest:(t,e)=>e?t.enable(2960):t.disable(2960),stencilMask:(t,e)=>{e=Hh(e)?e:[e,e];const[n,i]=e;t.stencilMaskSeparate(1028,n),t.stencilMaskSeparate(1029,i)},stencilFunc:(t,e)=>{e=Hh(e)&&e.length===3?[...e,...e]:e;const[n,i,r,s,o,a]=e;t.stencilFuncSeparate(1028,n,i,r),t.stencilFuncSeparate(1029,s,o,a)},stencilOp:(t,e)=>{e=Hh(e)&&e.length===3?[...e,...e]:e;const[n,i,r,s,o,a]=e;t.stencilOpSeparate(1028,n,i,r),t.stencilOpSeparate(1029,s,o,a)},viewport:(t,e)=>t.viewport(...e)};function Te(t,e,n){return e[t]!==void 0?e[t]:n[t]}const WO={blendEquation:(t,e,n)=>t.blendEquationSeparate(Te(32777,e,n),Te(34877,e,n)),blendFunc:(t,e,n)=>t.blendFuncSeparate(Te(32969,e,n),Te(32968,e,n),Te(32971,e,n),Te(32970,e,n)),polygonOffset:(t,e,n)=>t.polygonOffset(Te(32824,e,n),Te(10752,e,n)),sampleCoverage:(t,e,n)=>t.sampleCoverage(Te(32938,e,n),Te(32939,e,n)),stencilFuncFront:(t,e,n)=>t.stencilFuncSeparate(1028,Te(2962,e,n),Te(2967,e,n),Te(2963,e,n)),stencilFuncBack:(t,e,n)=>t.stencilFuncSeparate(1029,Te(34816,e,n),Te(36003,e,n),Te(36004,e,n)),stencilOpFront:(t,e,n)=>t.stencilOpSeparate(1028,Te(2964,e,n),Te(2965,e,n),Te(2966,e,n)),stencilOpBack:(t,e,n)=>t.stencilOpSeparate(1029,Te(34817,e,n),Te(34818,e,n),Te(34819,e,n))},W0={enable:(t,e)=>t({[e]:!0}),disable:(t,e)=>t({[e]:!1}),pixelStorei:(t,e,n)=>t({[e]:n}),hint:(t,e,n)=>t({[e]:n}),useProgram:(t,e)=>t({35725:e}),bindRenderbuffer:(t,e,n)=>t({36007:n}),bindTransformFeedback:(t,e,n)=>t({36389:n}),bindVertexArray:(t,e)=>t({34229:e}),bindFramebuffer:(t,e,n)=>{switch(e){case 36160:return t({36006:n,36010:n});case 36009:return t({36006:n});case 36008:return t({36010:n});default:return null}},bindBuffer:(t,e,n)=>{const i={34962:[34964],36662:[36662],36663:[36663],35051:[35053],35052:[35055]}[e];return i?t({[i]:n}):{valueChanged:!0}},blendColor:(t,e,n,i,r)=>t({32773:new Float32Array([e,n,i,r])}),blendEquation:(t,e)=>t({32777:e,34877:e}),blendEquationSeparate:(t,e,n)=>t({32777:e,34877:n}),blendFunc:(t,e,n)=>t({32969:e,32968:n,32971:e,32970:n}),blendFuncSeparate:(t,e,n,i,r)=>t({32969:e,32968:n,32971:i,32970:r}),clearColor:(t,e,n,i,r)=>t({3106:new Float32Array([e,n,i,r])}),clearDepth:(t,e)=>t({2931:e}),clearStencil:(t,e)=>t({2961:e}),colorMask:(t,e,n,i,r)=>t({3107:[e,n,i,r]}),cullFace:(t,e)=>t({2885:e}),depthFunc:(t,e)=>t({2932:e}),depthRange:(t,e,n)=>t({2928:new Float32Array([e,n])}),depthMask:(t,e)=>t({2930:e}),frontFace:(t,e)=>t({2886:e}),lineWidth:(t,e)=>t({2849:e}),polygonOffset:(t,e,n)=>t({32824:e,10752:n}),sampleCoverage:(t,e,n)=>t({32938:e,32939:n}),scissor:(t,e,n,i,r)=>t({3088:new Int32Array([e,n,i,r])}),stencilMask:(t,e)=>t({2968:e,36005:e}),stencilMaskSeparate:(t,e,n)=>t({[e===1028?2968:36005]:n}),stencilFunc:(t,e,n,i)=>t({2962:e,2967:n,2963:i,34816:e,36003:n,36004:i}),stencilFuncSeparate:(t,e,n,i,r)=>t({[e===1028?2962:34816]:n,[e===1028?2967:36003]:i,[e===1028?2963:36004]:r}),stencilOp:(t,e,n,i)=>t({2964:e,2965:n,2966:i,34817:e,34818:n,34819:i}),stencilOpSeparate:(t,e,n,i,r)=>t({[e===1028?2964:34817]:n,[e===1028?2965:34818]:i,[e===1028?2966:34819]:r}),viewport:(t,e,n,i,r)=>t({2978:[e,n,i,r]})},Yt=(t,e)=>t.isEnabled(e),H0={3042:Yt,2884:Yt,2929:Yt,3024:Yt,32823:Yt,32926:Yt,32928:Yt,3089:Yt,2960:Yt,35977:Yt},HO=new Set([34016,36388,36387,35983,35368,34965,35739,35738,3074,34853,34854,34855,34856,34857,34858,34859,34860,34861,34862,34863,34864,34865,34866,34867,34868,35097,32873,35869,32874,34068]);function gs(t,e){if(XO(e))return;const n={};for(const r in e){const s=Number(r),o=jO[r];o&&(typeof o=="string"?n[o]=!0:o(t,e[r],s))}const i=t.state&&t.state.cache;if(i)for(const r in n){const s=WO[r];s(t,e,i)}}function aE(t,e=Pg){if(typeof e=="number"){const r=e,s=H0[r];return s?s(t,r):t.getParameter(r)}const n=Array.isArray(e)?e:Object.keys(e),i={};for(const r of n){const s=H0[r];i[r]=s?s(t,Number(r)):t.getParameter(Number(r))}return i}function $O(t){gs(t,Pg)}function XO(t){for(const e in t)return!1;return!0}function YO(t,e){if(t===e)return!0;const n=Array.isArray(t)||ArrayBuffer.isView(t),i=Array.isArray(e)||ArrayBuffer.isView(e);if(n&&i&&t.length===e.length){for(let r=0;r<t.length;++r)if(t[r]!==e[r])return!1;return!0}return!1}class KO{constructor(e,{copyState:n=!1,log:i=()=>{}}={}){m(this,"gl");m(this,"program",null);m(this,"stateStack",[]);m(this,"enable",!0);m(this,"cache");m(this,"log");this.gl=e,this.cache=n?aE(e):Object.assign({},Pg),this.log=i,this._updateCache=this._updateCache.bind(this),Object.seal(this)}push(e={}){this.stateStack.push({})}pop(){le(this.stateStack.length>0);const e=this.stateStack[this.stateStack.length-1];gs(this.gl,e),this.stateStack.pop()}_updateCache(e){let n=!1,i;const r=this.stateStack.length>0?this.stateStack[this.stateStack.length-1]:null;for(const s in e){le(s!==void 0);const o=e[s],a=this.cache[s];YO(o,a)||(n=!0,i=a,r&&!(s in r)&&(r[s]=a),this.cache[s]=o)}return{valueChanged:n,oldValue:i}}}function Hi(t){return t.state}function lE(t,e){const{enable:n=!0,copyState:i}=e;if(le(i!==void 0),!t.state){t.state=new KO(t,{copyState:i}),ZO(t);for(const s in W0){const o=W0[s];qO(t,s,o)}$0(t,"getParameter"),$0(t,"isEnabled")}const r=Hi(t);return r.enable=n,t}function Nu(t){let e=Hi(t);e||(lE(t,{copyState:!1}),e=Hi(t)),e.push()}function Vo(t){const e=Hi(t);le(e),e.pop()}function $0(t,e){const n=t[e].bind(t);t[e]=function(r){if(r===void 0||HO.has(r))return n(r);const s=Hi(t);return r in s.cache||(s.cache[r]=n(r)),s.enable?s.cache[r]:n(r)},Object.defineProperty(t[e],"name",{value:`${e}-from-cache`,configurable:!1})}function qO(t,e,n){if(!t[e])return;const i=t[e].bind(t);t[e]=function(...s){const o=Hi(t),{valueChanged:a,oldValue:l}=n(o._updateCache,...s);return a&&i(...s),l},Object.defineProperty(t[e],"name",{value:`${e}-to-cache`,configurable:!1})}function ZO(t){const e=t.useProgram.bind(t);t.useProgram=function(i){const r=Hi(t);r.program!==i&&(e(i),r.program=i)}}const QO={powerPreference:"high-performance",onContextLost:()=>console.error("WebGL context lost"),onContextRestored:()=>console.info("WebGL context restored")};function JO(t,e){e={...QO,...e};let n=null;const i=s=>n=s.statusMessage||n;t.addEventListener("webglcontextcreationerror",i,!1);let r=null;if(r||(r=t.getContext("webgl2",e)),t.removeEventListener("webglcontextcreationerror",i,!1),!r)throw new Error(`Failed to create WebGL context: ${n||"Unknown error"}`);if(e.onContextLost){const{onContextLost:s}=e;t.addEventListener("webglcontextlost",o=>s(o),!1)}if(e.onContextRestored){const{onContextRestored:s}=e;t.addEventListener("webglcontextrestored",o=>s(o),!1)}return r}function li(t,e,n){return n[e]===void 0&&(n[e]=t.getExtension(e)||null),n[e]}function GO(t,e){const n=t.getParameter(7936),i=t.getParameter(7937);li(t,"WEBGL_debug_renderer_info",e);const r=e.WEBGL_debug_renderer_info,s=t.getParameter(r?r.UNMASKED_VENDOR_WEBGL:7936),o=t.getParameter(r?r.UNMASKED_RENDERER_WEBGL:7937),a=s||n,l=o||i,c=t.getParameter(7938),u=cE(a,l),h=eN(a,l),f=tN(a,l);return{type:"webgl",gpu:u,gpuType:f,gpuBackend:h,vendor:a,renderer:l,version:c,shadingLanguage:"glsl",shadingLanguageVersion:300}}function cE(t,e){return/NVIDIA/i.exec(t)||/NVIDIA/i.exec(e)?"nvidia":/INTEL/i.exec(t)||/INTEL/i.exec(e)?"intel":/Apple/i.exec(t)||/Apple/i.exec(e)?"apple":/AMD/i.exec(t)||/AMD/i.exec(e)||/ATI/i.exec(t)||/ATI/i.exec(e)?"amd":/SwiftShader/i.exec(t)||/SwiftShader/i.exec(e)?"software":"unknown"}function eN(t,e){return/Metal/i.exec(t)||/Metal/i.exec(e)?"metal":/ANGLE/i.exec(t)||/ANGLE/i.exec(e)?"opengl":"unknown"}function tN(t,e){if(/SwiftShader/i.exec(t)||/SwiftShader/i.exec(e))return"cpu";switch(cE(t,e)){case"intel":return"integrated";case"software":return"cpu";case"unknown":return"unknown";default:return"discrete"}}function uE(t){switch(t){case"uint8":return 5121;case"sint8":return 5120;case"unorm8":return 5121;case"snorm8":return 5120;case"uint16":return 5123;case"sint16":return 5122;case"unorm16":return 5123;case"snorm16":return 5122;case"uint32":return 5125;case"sint32":return 5124;case"float16":return 5131;case"float32":return 5126}throw new Error(String(t))}const We="texture-compression-bc",ie="texture-compression-astc",Kt="texture-compression-etc2",nN="texture-compression-etc1-webgl",Ja="texture-compression-pvrtc-webgl",$h="texture-compression-atc-webgl",Ds="float32-renderable-webgl",Xh="float16-renderable-webgl",iN="rgb9e5ufloat_renderable-webgl",Yh="snorm8-renderable-webgl",Bs="norm16-renderable-webgl",Kh="snorm16-renderable-webgl",Ga="float32-filterable",X0="float16-filterable-webgl",Zs="WEBGL_compressed_texture_s3tc",Qs="WEBGL_compressed_texture_s3tc_srgb",Pr="EXT_texture_compression_rgtc",Mr="EXT_texture_compression_bptc",rN="WEBGL_compressed_texture_etc",sN="WEBGL_compressed_texture_astc",oN="WEBGL_compressed_texture_etc1",aN="WEBGL_compressed_texture_pvrtc",lN="WEBGL_compressed_texture_atc",Y0="EXT_texture_norm16",K0="EXT_render_snorm",cN="EXT_color_buffer_float",Mg={"float32-renderable-webgl":["EXT_color_buffer_float"],"float16-renderable-webgl":["EXT_color_buffer_half_float"],"rgb9e5ufloat_renderable-webgl":["WEBGL_render_shared_exponent"],"snorm8-renderable-webgl":[K0],"norm16-renderable-webgl":[Y0],"snorm16-renderable-webgl":[Y0,K0],"float32-filterable":["OES_texture_float_linear"],"float16-filterable-webgl":["OES_texture_half_float_linear"],"texture-filterable-anisotropic-webgl":["EXT_texture_filter_anisotropic"],"texture-blend-float-webgl":["EXT_float_blend"],"texture-compression-bc":[Zs,Qs,Pr,Mr],"texture-compression-bc5-webgl":[Pr],"texture-compression-bc7-webgl":[Mr],"texture-compression-etc2":[rN],"texture-compression-astc":[sN],"texture-compression-etc1-webgl":[oN],"texture-compression-pvrtc-webgl":[aN],"texture-compression-atc-webgl":[lN]};function uN(t){return t in Mg}function hN(t,e,n){return(Mg[e]||[]).every(r=>li(t,r,n))}const ku={"rgb8unorm-unsized":{gl:6407,b:4,c:2,bpp:4,dataFormat:6407,types:[5121,33635]},"rgba8unorm-unsized":{gl:6408,b:4,c:2,bpp:4,dataFormat:6408,types:[5121,32819,32820]},r8unorm:{gl:33321,b:1,c:1,rb:!0},r8snorm:{gl:36756,b:1,c:1,render:Yh},r8uint:{gl:33330,b:1,c:1,rb:!0},r8sint:{gl:33329,b:1,c:1,rb:!0},rg8unorm:{gl:33323,b:2,c:2,rb:!0},rg8snorm:{gl:36757,b:2,c:2,render:Yh},rg8uint:{gl:33336,b:2,c:2,rb:!0},rg8sint:{gl:33335,b:2,c:2,rb:!0},r16uint:{gl:33332,b:2,c:1,rb:!0},r16sint:{gl:33331,b:2,c:1,rb:!0},r16float:{gl:33325,b:2,c:1,render:Xh,filter:"float16-filterable-webgl",rb:!0},"r16unorm-webgl":{gl:33322,b:2,c:1,f:Bs,rb:!0},"r16snorm-webgl":{gl:36760,b:2,c:1,f:Kh},"rgba4unorm-webgl":{gl:32854,b:2,c:4,wgpu:!1,rb:!0},"rgb565unorm-webgl":{gl:36194,b:2,c:4,wgpu:!1,rb:!0},"rgb5a1unorm-webgl":{gl:32855,b:2,c:4,wgpu:!1,rb:!0},"rgb8unorm-webgl":{gl:32849,b:3,c:3,wgpu:!1},"rgb8snorm-webgl":{gl:36758,b:3,c:3,wgpu:!1},rgba8unorm:{gl:32856,b:4,c:2,bpp:4},"rgba8unorm-srgb":{gl:35907,b:4,c:4,bpp:4},rgba8snorm:{gl:36759,b:4,c:4,render:Yh},rgba8uint:{gl:36220,b:4,c:4,bpp:4},rgba8sint:{gl:36238,b:4,c:4,bpp:4},bgra8unorm:{b:4,c:4},"bgra8unorm-srgb":{b:4,c:4},rg16uint:{gl:33338,b:4,c:1,bpp:4},rg16sint:{gl:33337,b:4,c:2,bpp:4},rg16float:{gl:33327,bpp:4,b:4,c:2,render:Xh,filter:X0,rb:!0},"rg16unorm-webgl":{gl:33324,b:2,c:2,render:Bs},"rg16snorm-webgl":{gl:36761,b:2,c:2,render:Kh},r32uint:{gl:33334,b:4,c:1,bpp:4,rb:!0},r32sint:{gl:33333,b:4,c:1,bpp:4,rb:!0},r32float:{gl:33326,bpp:4,b:4,c:1,render:Ds,filter:Ga},rgb9e5ufloat:{gl:35901,b:4,c:3,p:1,render:iN},rg11b10ufloat:{gl:35898,b:4,c:3,p:1,render:Ds,rb:!0},rgb10a2unorm:{gl:32857,b:4,c:4,p:1,rb:!0},"rgb10a2uint-webgl":{b:4,c:4,gl:36975,p:1,wgpu:!1,bpp:4,rb:!0},"rgb16unorm-webgl":{gl:32852,b:2,c:3,f:Bs},"rgb16snorm-webgl":{gl:36762,b:2,c:3,f:Bs},rg32uint:{gl:33340,b:8,c:2,rb:!0},rg32sint:{gl:33339,b:8,c:2,rb:!0},rg32float:{gl:33328,b:8,c:2,render:Ds,filter:Ga,rb:!0},rgba16uint:{gl:36214,b:8,c:4,rb:!0},rgba16sint:{gl:36232,b:8,c:4,rb:!0},rgba16float:{gl:34842,b:8,c:4,render:Xh,filter:X0},"rgba16unorm-webgl":{gl:32859,b:2,c:4,render:Bs,rb:!0},"rgba16snorm-webgl":{gl:36763,b:2,c:4,render:Kh},"rgb32float-webgl":{gl:34837,render:Ds,filter:Ga,gl2ext:cN,dataFormat:6407,types:[5126]},rgba32uint:{gl:36208,b:16,c:4,rb:!0},rgba32sint:{gl:36226,b:16,c:4,rb:!0},rgba32float:{gl:34836,b:16,c:4,render:Ds,filter:Ga,rb:!0},stencil8:{gl:36168,b:1,c:1,attachment:36128,rb:!0},depth16unorm:{gl:33189,b:2,c:1,attachment:36096,dataFormat:6402,types:[5123],rb:!0},depth24plus:{gl:33190,b:3,c:1,attachment:36096,dataFormat:6402,types:[5125]},depth32float:{gl:36012,b:4,c:1,attachment:36096,dataFormat:6402,types:[5126],rb:!0},"depth24plus-stencil8":{gl:35056,b:4,c:2,p:1,attachment:33306,rb:!0,depthTexture:!0,dataFormat:34041,types:[34042]},"depth24unorm-stencil8":{gl:35056,b:4,c:2,p:1,attachment:33306,dataFormat:34041,types:[34042],rb:!0},"depth32float-stencil8":{gl:36013,b:5,c:2,p:1,attachment:33306,dataFormat:34041,types:[36269],rb:!0},"bc1-rgb-unorm-webgl":{gl:33776,x:Zs,f:We},"bc1-rgb-unorm-srgb-webgl":{gl:35916,x:Qs,f:We},"bc1-rgba-unorm":{gl:33777,x:Zs,f:We},"bc1-rgba-unorm-srgb":{gl:35916,x:Qs,f:We},"bc2-rgba-unorm":{gl:33778,x:Zs,f:We},"bc2-rgba-unorm-srgb":{gl:35918,x:Qs,f:We},"bc3-rgba-unorm":{gl:33779,x:Zs,f:We},"bc3-rgba-unorm-srgb":{gl:35919,x:Qs,f:We},"bc4-r-unorm":{gl:36283,x:Pr,f:We},"bc4-r-snorm":{gl:36284,x:Pr,f:We},"bc5-rg-unorm":{gl:36285,x:Pr,f:We},"bc5-rg-snorm":{gl:36286,x:Pr,f:We},"bc6h-rgb-ufloat":{gl:36495,x:Mr,f:We},"bc6h-rgb-float":{gl:36494,x:Mr,f:We},"bc7-rgba-unorm":{gl:36492,x:Mr,f:We},"bc7-rgba-unorm-srgb":{gl:36493,x:Mr,f:We},"etc2-rgb8unorm":{gl:37492,f:Kt},"etc2-rgb8unorm-srgb":{gl:37494,f:Kt},"etc2-rgb8a1unorm":{gl:37496,f:Kt},"etc2-rgb8a1unorm-srgb":{gl:37497,f:Kt},"etc2-rgba8unorm":{gl:37493,f:Kt},"etc2-rgba8unorm-srgb":{gl:37495,f:Kt},"eac-r11unorm":{gl:37488,f:Kt},"eac-r11snorm":{gl:37489,f:Kt},"eac-rg11unorm":{gl:37490,f:Kt},"eac-rg11snorm":{gl:37491,f:Kt},"astc-4x4-unorm":{gl:37808,f:ie},"astc-4x4-unorm-srgb":{gl:37840,f:ie},"astc-5x4-unorm":{gl:37809,f:ie},"astc-5x4-unorm-srgb":{gl:37841,f:ie},"astc-5x5-unorm":{gl:37810,f:ie},"astc-5x5-unorm-srgb":{gl:37842,f:ie},"astc-6x5-unorm":{gl:37811,f:ie},"astc-6x5-unorm-srgb":{gl:37843,f:ie},"astc-6x6-unorm":{gl:37812,f:ie},"astc-6x6-unorm-srgb":{gl:37844,f:ie},"astc-8x5-unorm":{gl:37813,f:ie},"astc-8x5-unorm-srgb":{gl:37845,f:ie},"astc-8x6-unorm":{gl:37814,f:ie},"astc-8x6-unorm-srgb":{gl:37846,f:ie},"astc-8x8-unorm":{gl:37815,f:ie},"astc-8x8-unorm-srgb":{gl:37847,f:ie},"astc-10x5-unorm":{gl:37819,f:ie},"astc-10x5-unorm-srgb":{gl:37851,f:ie},"astc-10x6-unorm":{gl:37817,f:ie},"astc-10x6-unorm-srgb":{gl:37849,f:ie},"astc-10x8-unorm":{gl:37818,f:ie},"astc-10x8-unorm-srgb":{gl:37850,f:ie},"astc-10x10-unorm":{gl:37819,f:ie},"astc-10x10-unorm-srgb":{gl:37851,f:ie},"astc-12x10-unorm":{gl:37820,f:ie},"astc-12x10-unorm-srgb":{gl:37852,f:ie},"astc-12x12-unorm":{gl:37821,f:ie},"astc-12x12-unorm-srgb":{gl:37853,f:ie},"pvrtc-rgb4unorm-webgl":{gl:35840,f:Ja},"pvrtc-rgba4unorm-webgl":{gl:35842,f:Ja},"pvrtc-rbg2unorm-webgl":{gl:35841,f:Ja},"pvrtc-rgba2unorm-webgl":{gl:35843,f:Ja},"etc1-rbg-unorm-webgl":{gl:36196,f:nN},"atc-rgb-unorm-webgl":{gl:35986,f:$h},"atc-rgba-unorm-webgl":{gl:35986,f:$h},"atc-rgbai-unorm-webgl":{gl:34798,f:$h}},fN={6403:1,36244:1,33319:2,33320:2,6407:3,36248:3,6408:4,36249:4,6402:1,34041:1,6406:1,6409:1,6410:2},dN={5126:4,5125:4,5124:4,5123:2,5122:2,5131:2,5120:1,5121:1};function Ig(t,e,n){const i=ku[e];if(!i||i.gl===void 0)return!1;const r=i.x||i.gl2ext;return r?!!li(t,r,n):!0}function hE(t){const e=ku[t],n=e==null?void 0:e.gl;if(n===void 0)throw new Error(`Unsupported texture format ${t}`);return n}function pN(t,e,n){if(!Ig(t,e,n)||e.startsWith("depth")||e.startsWith("stencil"))return!1;try{if(uw(e).signed)return!1}catch{return!1}return e.endsWith("32float")?!!li(t,"OES_texture_float_linear, extensions",n):e.endsWith("16float")?!!li(t,"OES_texture_half_float_linear, extensions",n):!0}function gN(t,e,n){return!(!Ig(t,e,n)||typeof e=="number")}function Rc(t){var r;const e=ku[t],n=hE(t),i=uw(t);return{format:n,dataFormat:(e==null?void 0:e.dataFormat)||mN(i.format,i.integer,i.normalized,n),type:i.dataType?uE(i.dataType):((r=e==null?void 0:e.types)==null?void 0:r[0])||5121,compressed:i.compressed}}function _N(t){const e=ku[t];if(!(e!=null&&e.attachment))throw new Error(`${t} is not a depth stencil format`);return e.attachment}function q0(t){const e=Rc(t),n=fN[e.dataFormat]||4,i=dN[e.type]||1;return n*i}function mN(t,e,n,i){if(i===6408||i===6407)return i;switch(t){case"r":return e&&!n?36244:6403;case"rg":return e&&!n?33320:33319;case"rgb":return e&&!n?36248:6407;case"rgba":return e&&!n?36249:6408;default:return 6408}}const Z0={"depth-clip-control":"EXT_depth_clamp","timer-query-webgl":"EXT_disjoint_timer_query_webgl2","compilation-status-async-webgl":"KHR_parallel_shader_compile","polygon-mode-webgl":"WEBGL_polygon_mode","provoking-vertex-webgl":"WEBGL_provoking_vertex","shader-clip-cull-distance-webgl":"WEBGL_clip_cull_distance","shader-noperspective-interpolation-webgl":"NV_shader_noperspective_interpolation","shader-conservative-depth-webgl":"EXT_conservative_depth"};class yN extends SC{constructor(n,i,r){super([],r);m(this,"gl");m(this,"extensions");m(this,"testedFeatures",new Set);this.gl=n,this.extensions=i,li(n,"EXT_color_buffer_float",i)}*[Symbol.iterator](){const n=this.getFeatures();for(const i of n)this.has(i)&&(yield i);return[]}has(n){return this.disabledFeatures[n]?!1:(this.testedFeatures.has(n)||(this.testedFeatures.add(n),uN(n)&&hN(this.gl,n,this.extensions)&&this.features.add(n),this.getWebGLFeature(n)&&this.features.add(n)),this.features.has(n))}initializeFeatures(){const n=this.getFeatures().filter(i=>i!=="polygon-mode-webgl");for(const i of n)this.has(i)}getFeatures(){return[...Object.keys(Z0),...Object.keys(Mg)]}getWebGLFeature(n){const i=Z0[n];return typeof i=="string"?!!li(this.gl,i,this.extensions):!!i}}class vN extends EC{constructor(n){super();m(this,"gl");m(this,"limits",{});this.gl=n}get maxTextureDimension1D(){return 0}get maxTextureDimension2D(){return this.getParameter(3379)}get maxTextureDimension3D(){return this.getParameter(32883)}get maxTextureArrayLayers(){return this.getParameter(35071)}get maxBindGroups(){return 0}get maxDynamicUniformBuffersPerPipelineLayout(){return 0}get maxDynamicStorageBuffersPerPipelineLayout(){return 0}get maxSampledTexturesPerShaderStage(){return this.getParameter(35660)}get maxSamplersPerShaderStage(){return this.getParameter(35661)}get maxStorageBuffersPerShaderStage(){return 0}get maxStorageTexturesPerShaderStage(){return 0}get maxUniformBuffersPerShaderStage(){return this.getParameter(35375)}get maxUniformBufferBindingSize(){return this.getParameter(35376)}get maxStorageBufferBindingSize(){return 0}get minUniformBufferOffsetAlignment(){return this.getParameter(35380)}get minStorageBufferOffsetAlignment(){return 0}get maxVertexBuffers(){return 16}get maxVertexAttributes(){return this.getParameter(34921)}get maxVertexBufferArrayStride(){return 2048}get maxInterStageShaderComponents(){return this.getParameter(35659)}get maxComputeWorkgroupStorageSize(){return 0}get maxComputeInvocationsPerWorkgroup(){return 0}get maxComputeWorkgroupSizeX(){return 0}get maxComputeWorkgroupSizeY(){return 0}get maxComputeWorkgroupSizeZ(){return 0}get maxComputeWorkgroupsPerDimension(){return 0}getParameter(n){return this.limits[n]===void 0&&(this.limits[n]=this.gl.getParameter(n)),this.limits[n]}}function Yn(t,e,n){if(TN(e))return n(t);const{nocatch:i=!0}=e;Nu(t),gs(t,e);let r;if(i)r=n(t),Vo(t);else try{r=n(t)}finally{Vo(t)}return r}function TN(t){for(const e in t)return!1;return!0}function wN(t,e,n,i){if(gc(e))return i(t);const r=t;Nu(r.gl);try{return EN(t,e),gs(r.gl,n),i(t)}finally{Vo(r.gl)}}function EN(t,e){const n=t,{gl:i}=n;if(e.cullMode)switch(e.cullMode){case"none":i.disable(2884);break;case"front":i.enable(2884),i.cullFace(1028);break;case"back":i.enable(2884),i.cullFace(1029);break}if(e.frontFace&&i.frontFace(Fi("frontFace",e.frontFace,{ccw:2305,cw:2304})),e.unclippedDepth&&t.features.has("depth-clip-control")&&i.enable(34383),e.depthBias!==void 0&&(i.enable(32823),i.polygonOffset(e.depthBias,e.depthBiasSlopeScale||0)),e.provokingVertex&&t.features.has("provoking-vertex-webgl")){const s=n.getExtension("WEBGL_provoking_vertex").WEBGL_provoking_vertex,o=Fi("provokingVertex",e.provokingVertex,{first:36429,last:36430});s==null||s.provokingVertexWEBGL(o)}if((e.polygonMode||e.polygonOffsetLine)&&t.features.has("polygon-mode-webgl")){if(e.polygonMode){const s=n.getExtension("WEBGL_polygon_mode").WEBGL_polygon_mode,o=Fi("polygonMode",e.polygonMode,{fill:6914,line:6913});s==null||s.polygonModeWEBGL(1028,o),s==null||s.polygonModeWEBGL(1029,o)}e.polygonOffsetLine&&i.enable(10754)}if(t.features.has("shader-clip-cull-distance-webgl")&&(e.clipDistance0&&i.enable(12288),e.clipDistance1&&i.enable(12289),e.clipDistance2&&i.enable(12290),e.clipDistance3&&i.enable(12291),e.clipDistance4&&i.enable(12292),e.clipDistance5&&i.enable(12293),e.clipDistance6&&i.enable(12294),e.clipDistance7&&i.enable(12295)),e.depthWriteEnabled!==void 0&&i.depthMask(AN("depthWriteEnabled",e.depthWriteEnabled)),e.depthCompare&&(e.depthCompare!=="always"?i.enable(2929):i.disable(2929),i.depthFunc(Dd("depthCompare",e.depthCompare))),e.stencilWriteMask){const r=e.stencilWriteMask;i.stencilMaskSeparate(1028,r),i.stencilMaskSeparate(1029,r)}if(e.stencilReadMask&&U.warn("stencilReadMask not supported under WebGL"),e.stencilCompare){const r=e.stencilReadMask||4294967295,s=Dd("depthCompare",e.stencilCompare);e.stencilCompare!=="always"?i.enable(2960):i.disable(2960),i.stencilFuncSeparate(1028,s,0,r),i.stencilFuncSeparate(1029,s,0,r)}if(e.stencilPassOperation&&e.stencilFailOperation&&e.stencilDepthFailOperation){const r=qh("stencilPassOperation",e.stencilPassOperation),s=qh("stencilFailOperation",e.stencilFailOperation),o=qh("stencilDepthFailOperation",e.stencilDepthFailOperation);i.stencilOpSeparate(1028,s,o,r),i.stencilOpSeparate(1029,s,o,r)}if(e.blendColorOperation||e.blendAlphaOperation){i.enable(3042);const r=Q0("blendColorOperation",e.blendColorOperation||"add"),s=Q0("blendAlphaOperation",e.blendAlphaOperation||"add");i.blendEquationSeparate(r,s);const o=el("blendColorSrcFactor",e.blendColorSrcFactor||"one"),a=el("blendColorDstFactor",e.blendColorDstFactor||"zero"),l=el("blendAlphaSrcFactor",e.blendAlphaSrcFactor||"one"),c=el("blendAlphaDstFactor",e.blendAlphaDstFactor||"zero");i.blendFuncSeparate(o,a,l,c)}}function Dd(t,e){return Fi(t,e,{never:512,less:513,equal:514,"less-equal":515,greater:516,"not-equal":517,"greater-equal":518,always:519})}function qh(t,e){return Fi(t,e,{keep:7680,zero:0,replace:7681,invert:5386,"increment-clamp":7682,"decrement-clamp":7683,"increment-wrap":34055,"decrement-wrap":34056})}function Q0(t,e){return Fi(t,e,{add:32774,subtract:32778,"reverse-subtract":32779,min:32775,max:32776})}function el(t,e){return Fi(t,e,{one:1,zero:0,"src-color":768,"one-minus-src-color":769,"dst-color":774,"one-minus-dst-color":775,"src-alpha":770,"one-minus-src-alpha":771,"dst-alpha":772,"one-minus-dst-alpha":773,"src-alpha-saturated":776,"constant-color":32769,"one-minus-constant-color":32770,"constant-alpha":32771,"one-minus-constant-alpha":32772})}function SN(t,e){return`Illegal parameter ${e} for ${t}`}function Fi(t,e,n){if(!(e in n))throw new Error(SN(t,e));return n[e]}function AN(t,e){return e}function fE(t){const e={};return t.addressModeU&&(e[10242]=Zh(t.addressModeU)),t.addressModeV&&(e[10243]=Zh(t.addressModeV)),t.addressModeW&&(e[32882]=Zh(t.addressModeW)),t.magFilter&&(e[10240]=dE(t.magFilter)),(t.minFilter||t.mipmapFilter)&&(e[10241]=xN(t.minFilter||"linear",t.mipmapFilter)),t.lodMinClamp!==void 0&&(e[33082]=t.lodMinClamp),t.lodMaxClamp!==void 0&&(e[33083]=t.lodMaxClamp),t.type==="comparison-sampler"&&(e[34892]=34894),t.compare&&(e[34893]=Dd("compare",t.compare)),t.maxAnisotropy&&(e[34046]=t.maxAnisotropy),e}function Zh(t){switch(t){case"clamp-to-edge":return 33071;case"repeat":return 10497;case"mirror-repeat":return 33648}}function dE(t){switch(t){case"nearest":return 9728;case"linear":return 9729}}function xN(t,e){if(!e)return dE(t);switch(t){case"nearest":return e==="nearest"?9984:9986;case"linear":return e==="nearest"?9985:9987}}class ri extends de{constructor(n,i={}){super(n,i);m(this,"device");m(this,"gl");m(this,"handle");m(this,"glTarget");m(this,"glUsage");m(this,"glIndexType",5123);m(this,"byteLength");m(this,"bytesUsed");this.device=n,this.gl=this.device.gl;const r=typeof i=="object"?i.handle:void 0;this.handle=r||this.gl.createBuffer(),n.setSpectorMetadata(this.handle,{...this.props,data:typeof this.props.data}),this.glTarget=RN(this.props.usage),this.glUsage=bN(this.props.usage),this.glIndexType=this.props.indexType==="uint32"?5125:5123,i.data?this._initWithData(i.data,i.byteOffset,i.byteLength):this._initWithByteLength(i.byteLength||0)}_initWithData(n,i=0,r=n.byteLength+i){const s=this.glTarget;this.gl.bindBuffer(s,this.handle),this.gl.bufferData(s,r,this.glUsage),this.gl.bufferSubData(s,i,n),this.gl.bindBuffer(s,null),this.bytesUsed=r,this.byteLength=r,this._setDebugData(n,i,r),this.trackAllocatedMemory(r)}_initWithByteLength(n){le(n>=0);let i=n;n===0&&(i=new Float32Array(0));const r=this.glTarget;return this.gl.bindBuffer(r,this.handle),this.gl.bufferData(r,i,this.glUsage),this.gl.bindBuffer(r,null),this.bytesUsed=n,this.byteLength=n,this._setDebugData(null,0,n),this.trackAllocatedMemory(n),this}destroy(){!this.destroyed&&this.handle&&(this.removeStats(),this.trackDeallocatedMemory(),this.gl.deleteBuffer(this.handle),this.destroyed=!0,this.handle=null)}write(n,i=0){this.gl.bindBuffer(36663,this.handle),this.gl.bufferSubData(36663,i,n),this.gl.bindBuffer(36663,null),this._setDebugData(n,i,n.byteLength)}async readAsync(n=0,i){return this.readSyncWebGL(n,i)}readSyncWebGL(n=0,i){i=i??this.byteLength-n;const r=new Uint8Array(i),s=0;return this.gl.bindBuffer(36662,this.handle),this.gl.getBufferSubData(36662,n,r,s,i),this.gl.bindBuffer(36662,null),this._setDebugData(r,n,i),r}}function RN(t){return t&de.INDEX?34963:t&de.VERTEX?34962:t&de.UNIFORM?35345:34962}function bN(t){return t&de.INDEX||t&de.VERTEX?35044:t&de.UNIFORM?35048:35044}class Bd extends yc{constructor(n,i){super(n,i);m(this,"device");m(this,"handle");m(this,"parameters");this.device=n,this.parameters=fE(i),this.handle=this.handle||this.device.gl.createSampler(),this._setSamplerParameters(this.parameters)}destroy(){this.handle&&(this.device.gl.deleteSampler(this.handle),this.handle=void 0)}toString(){return`Sampler(${this.id},${JSON.stringify(this.props)})`}_setSamplerParameters(n){for(const[i,r]of Object.entries(n)){const s=Number(i);switch(s){case 33082:case 33083:this.device.gl.samplerParameterf(this.handle,s,r);break;default:this.device.gl.samplerParameteri(this.handle,s,r);break}}}}class Ir extends _c{constructor(n,i){super(n,{...Et.defaultProps,...i});m(this,"device");m(this,"gl");m(this,"handle");m(this,"texture");this.device=n,this.gl=this.device.gl,this.handle=null,this.texture=i.texture}}const CN={parameters:{},pixelStore:{},pixels:null,border:0,dataFormat:void 0,textureUnit:void 0,target:void 0},vo=class vo extends Et{constructor(n,i){var r;super(n,{...CN,format:"rgba8unorm",...i});m(this,"MAX_ATTRIBUTES");m(this,"device");m(this,"gl");m(this,"handle");m(this,"sampler");m(this,"view");m(this,"glFormat");m(this,"type");m(this,"dataFormat");m(this,"mipmaps");m(this,"target");m(this,"textureUnit");m(this,"loaded",!1);m(this,"_video");this.device=n,this.gl=this.device.gl,this.handle=this.props.handle||this.gl.createTexture(),this.device.setSpectorMetadata(this.handle,{...this.props,data:typeof this.props.data}),this.glFormat=6408,this.target=PN(this.props),this.loaded=!1,typeof((r=this.props)==null?void 0:r.data)=="string"&&Object.assign(this.props,{data:uP(this.props.data)}),this.initialize(this.props),Object.seal(this)}destroy(){this.handle&&(this.gl.deleteTexture(this.handle),this.removeStats(),this.trackDeallocatedMemory("Texture"),this.destroyed=!0)}toString(){return`Texture(${this.id},${this.width}x${this.height})`}createView(n){return new Ir(this.device,{...n,texture:this})}initialize(n={}){if(this.props.dimension==="cube")return this.initializeCube(n);let i=n.data;if(i instanceof Promise)return i.then(y=>this.initialize(Object.assign({},n,{pixels:y,data:y}))),this;const r=typeof HTMLVideoElement<"u"&&i instanceof HTMLVideoElement;if(r&&i.readyState<HTMLVideoElement.HAVE_METADATA)return this._video=null,i.addEventListener("loadeddata",()=>this.initialize(n)),this;const{parameters:s={}}=n,{pixels:o=null,pixelStore:a={},textureUnit:l=void 0,mipmaps:c=!0}=n;i||(i=o);let{width:u,height:h,dataFormat:f,type:d,compressed:p=!1}=n;const{depth:v=0}=n,A=hE(n.format);return{width:u,height:h,compressed:p,dataFormat:f,type:d}=this._deduceParameters({format:n.format,type:d,dataFormat:f,compressed:p,data:i,width:u,height:h}),this.width=u,this.height=h,this.glFormat=A,this.type=d,this.dataFormat=f,this.textureUnit=l,Number.isFinite(this.textureUnit)&&(this.gl.activeTexture(33984+this.textureUnit),this.gl.bindTexture(this.target,this.handle)),this.mipmaps=c,this.setImageData({data:i,width:u,height:h,depth:v,format:A,type:d,dataFormat:f,parameters:a,compressed:p}),this.setSampler(n.sampler),this._setSamplerParameters(s),this.view=this.createView({...this.props,mipLevelCount:1,arrayLayerCount:1}),c&&this.device.isTextureFormatFilterable(n.format)&&this.generateMipmap(),r&&(this._video={video:i,parameters:s,lastTime:i.readyState>=HTMLVideoElement.HAVE_CURRENT_DATA?i.currentTime:-1}),this}initializeCube(n){const{mipmaps:i=!0,parameters:r={}}=n;return this.setCubeMapImageData(n).then(()=>{this.loaded=!0,i&&this.generateMipmap(n),this.setSampler(n.sampler),this._setSamplerParameters(r)}),this}setSampler(n={}){let i;n instanceof Bd?(this.sampler=n,i=n.props):(this.sampler=new Bd(this.device,n),i=n);const r=fE(i);return this._setSamplerParameters(r),this}resize(n){const{height:i,width:r,mipmaps:s=!1}=n;return r!==this.width||i!==this.height?this.initialize({width:r,height:i,format:this.format,type:this.type,dataFormat:this.dataFormat,mipmaps:s}):this}update(){if(this._video){const{video:n,parameters:i,lastTime:r}=this._video;if(r===n.currentTime||n.readyState<HTMLVideoElement.HAVE_CURRENT_DATA)return;this.setSubImageData({data:n,parameters:i}),this.mipmaps&&this.generateMipmap(),this._video.lastTime=n.currentTime}}generateMipmap(n={}){return this.mipmaps=!0,this.gl.bindTexture(this.target,this.handle),Yn(this.gl,n,()=>{this.gl.generateMipmap(this.target)}),this.gl.bindTexture(this.target,null),this}setImageData(n){if(this.props.dimension==="3d"||this.props.dimension==="2d-array")return this.setImageData3D(n);this.trackDeallocatedMemory("Texture");const{target:i=this.target,pixels:r=null,level:s=0,glFormat:o=this.glFormat,offset:a=0,parameters:l={}}=n;let{data:c=null,type:u=this.type,width:h=this.width,height:f=this.height,dataFormat:d=this.dataFormat,compressed:p=!1}=n;c||(c=r),{type:u,dataFormat:d,compressed:p,width:h,height:f}=this._deduceParameters({format:this.props.format,type:u,dataFormat:d,compressed:p,data:c,width:h,height:f});const{gl:v}=this;v.bindTexture(this.target,this.handle);let A=null;if({data:c,dataType:A}=this._getDataType({data:c,compressed:p}),Yn(this.gl,l,()=>{switch(A){case"null":v.texImage2D(i,s,o,h,f,0,d,u,c);break;case"typed-array":v.texImage2D(i,s,o,h,f,0,d,u,c,a);break;case"buffer":this.device.gl.bindBuffer(35052,c.handle||c),this.device.gl.texImage2D(i,s,o,h,f,0,d,u,a),this.device.gl.bindBuffer(35052,null);break;case"browser-object":v.texImage2D(i,s,o,h,f,0,d,u,c);break;case"compressed":for(const[y,g]of c.entries())v.compressedTexImage2D(i,y,g.format,g.width,g.height,0,g.data);break;default:le(!1,"Unknown image data type")}}),c&&c.byteLength)this.trackAllocatedMemory(c.byteLength,"Texture");else{const y=q0(this.props.format);this.trackAllocatedMemory(this.width*this.height*y,"Texture")}return this.loaded=!0,this}setSubImageData({target:n=this.target,pixels:i=null,data:r=null,x:s=0,y:o=0,width:a=this.width,height:l=this.height,level:c=0,glFormat:u=this.glFormat,type:h=this.type,dataFormat:f=this.dataFormat,compressed:d=!1,offset:p=0,parameters:v={}}){if({type:h,dataFormat:f,compressed:d,width:a,height:l}=this._deduceParameters({format:this.props.format,type:h,dataFormat:f,compressed:d,data:r,width:a,height:l}),le(this.depth===1,"texSubImage not supported for 3D textures"),r||(r=i),r&&r.data){const A=r;r=A.data,a=A.shape[0],l=A.shape[1]}r instanceof ri&&(r=r.handle),this.gl.bindTexture(this.target,this.handle),Yn(this.gl,v,()=>{d?this.gl.compressedTexSubImage2D(n,c,s,o,a,l,u,r):r===null?this.gl.texSubImage2D(n,c,s,o,a,l,f,h,null):ArrayBuffer.isView(r)?this.gl.texSubImage2D(n,c,s,o,a,l,f,h,r,p):typeof WebGLBuffer<"u"&&r instanceof WebGLBuffer?(this.device.gl.bindBuffer(35052,r),this.device.gl.texSubImage2D(n,c,s,o,a,l,f,h,p),this.device.gl.bindBuffer(35052,null)):this.device.gl.texSubImage2D(n,c,s,o,a,l,f,h,r)}),this.gl.bindTexture(this.target,null)}copyFramebuffer(n={}){return U.error("Texture.copyFramebuffer({...}) is no logner supported, use copyToTexture(source, target, opts})")(),null}getActiveUnit(){return this.gl.getParameter(34016)-33984}bind(n=this.textureUnit){const{gl:i}=this;return n!==void 0&&(this.textureUnit=n,i.activeTexture(33984+n)),i.bindTexture(this.target,this.handle),n}unbind(n=this.textureUnit){const{gl:i}=this;return n!==void 0&&(this.textureUnit=n,i.activeTexture(33984+n)),i.bindTexture(this.target,null),n}_getDataType({data:n,compressed:i=!1}){return i?{data:n,dataType:"compressed"}:n===null?{data:n,dataType:"null"}:ArrayBuffer.isView(n)?{data:n,dataType:"typed-array"}:n instanceof ri?{data:n.handle,dataType:"buffer"}:typeof WebGLBuffer<"u"&&n instanceof WebGLBuffer?{data:n,dataType:"buffer"}:{data:n,dataType:"browser-object"}}_deduceParameters(n){const{format:i,data:r}=n;let{width:s,height:o,dataFormat:a,type:l,compressed:c}=n;const u=Rc(i);return a=a||u.dataFormat,l=l||u.type,c=c||u.compressed,{width:s,height:o}=this._deduceImageSize(r,s,o),{dataFormat:a,type:l,compressed:c,width:s,height:o,format:i,data:r}}_deduceImageSize(n,i,r){let s;return typeof ImageData<"u"&&n instanceof ImageData?s={width:n.width,height:n.height}:typeof HTMLImageElement<"u"&&n instanceof HTMLImageElement?s={width:n.naturalWidth,height:n.naturalHeight}:typeof HTMLCanvasElement<"u"&&n instanceof HTMLCanvasElement?s={width:n.width,height:n.height}:typeof ImageBitmap<"u"&&n instanceof ImageBitmap?s={width:n.width,height:n.height}:typeof HTMLVideoElement<"u"&&n instanceof HTMLVideoElement?s={width:n.videoWidth,height:n.videoHeight}:n?s={width:i,height:r}:s={width:i>=0?i:1,height:r>=0?r:1},le(s,"Could not deduced texture size"),le(i===void 0||s.width===i,"Deduced texture width does not match supplied width"),le(r===void 0||s.height===r,"Deduced texture height does not match supplied height"),s}async setCubeMapImageData(n){const{gl:i}=this,{width:r,height:s,pixels:o,data:a,format:l=6408,type:c=5121}=n,u=o||a,h=await Promise.all(vo.FACES.map(f=>{const d=u[f];return Promise.all(Array.isArray(d)?d:[d])}));this.bind(),vo.FACES.forEach((f,d)=>{h[d].length>1&&this.props.mipmaps!==!1&&U.warn(`${this.id} has mipmap and multiple LODs.`)(),h[d].forEach((p,v)=>{r&&s?i.texImage2D(f,v,l,r,s,0,l,c,p):i.texImage2D(f,v,l,l,c,p)})}),this.unbind()}setImageDataForFace(n){const{face:i,width:r,height:s,pixels:o,data:a,format:l=6408,type:c=5121}=n,{gl:u}=this,h=o||a;return this.bind(),h instanceof Promise?h.then(f=>this.setImageDataForFace(Object.assign({},n,{face:i,data:f,pixels:f}))):this.width||this.height?u.texImage2D(i,0,l,r,s,0,l,c,h):u.texImage2D(i,0,l,l,c,h),this}setImageData3D(n){const{level:i=0,dataFormat:r,format:s,type:o,width:a,height:l,depth:c=1,offset:u=0,data:h,parameters:f={}}=n;this.trackDeallocatedMemory("Texture"),this.gl.bindTexture(this.target,this.handle);const d=Rc(s);if(Yn(this.gl,f,()=>{ArrayBuffer.isView(h)&&this.gl.texImage3D(this.target,i,d.format,a,l,c,0,d.dataFormat,d.type,h),h instanceof ri&&(this.gl.bindBuffer(35052,h.handle),this.gl.texImage3D(this.target,i,r,a,l,c,0,s,o,u))}),h&&h.byteLength)this.trackAllocatedMemory(h.byteLength,"Texture");else{const p=q0(this.props.format);this.trackAllocatedMemory(this.width*this.height*this.depth*p,"Texture")}return this.loaded=!0,this}_setSamplerParameters(n){if(!gc(n)){MN(n),this.gl.bindTexture(this.target,this.handle);for(const[i,r]of Object.entries(n)){const s=Number(i),o=r;switch(s){case 33082:case 33083:this.gl.texParameterf(this.target,s,o);break;default:this.gl.texParameteri(this.target,s,o);break}}this.gl.bindTexture(this.target,null)}}};m(vo,"FACES",[34069,34070,34071,34072,34073,34074]);let tn=vo;function PN(t){switch(t.dimension){case"2d":return 3553;case"cube":return 34067;case"2d-array":return 35866;case"3d":return 32879;case"1d":case"cube-array":default:throw new Error(t.dimension)}}function MN(t){U.log(1,"texture sampler parameters",t)()}class fo extends vc{constructor(n,i){super(n,i);m(this,"device");m(this,"gl");m(this,"handle");const r=i.handle===null;if(this.device=n,this.gl=n.gl,this.handle=this.props.handle||r?this.props.handle:this.gl.createFramebuffer(),!r){n.setSpectorMetadata(this.handle,{id:this.props.id,props:this.props}),this.autoCreateAttachmentTextures();const s=this.gl.bindFramebuffer(36160,this.handle);for(let o=0;o<this.colorAttachments.length;++o){const a=this.colorAttachments[o],l=36064+o;a&&this._attachOne(l,a)}if(this.depthStencilAttachment&&this._attachOne(_N(this.depthStencilAttachment.props.format),this.depthStencilAttachment),i.check!==!1){const o=this.gl.checkFramebufferStatus(36160);if(o!==36053)throw new Error(`Framebuffer ${ON(o)}`)}this.gl.bindFramebuffer(36160,s)}}get texture(){return this.colorAttachments[0]}destroy(){super.destroy(),!this.destroyed&&this.handle!==null&&this.gl.deleteFramebuffer(this.handle)}createDepthStencilTexture(n){return new tn(this.device,{id:`${this.id}-depth-stencil`,format:n,width:this.width,height:this.height,mipmaps:!1})}resizeAttachments(n,i){if(this.handle===null)return this.width=this.gl.drawingBufferWidth,this.height=this.gl.drawingBufferHeight,this;n===void 0&&(n=this.gl.drawingBufferWidth),i===void 0&&(i=this.gl.drawingBufferHeight);for(const r of this.colorAttachments)r.texture.resize({width:n,height:i});return this.depthStencilAttachment&&this.depthStencilAttachment.texture.resize({width:n,height:i}),this}_attachOne(n,i){if(Array.isArray(i)){const[r,s=0,o=0]=i;return this._attachTexture(n,r,s,o),r}if(i instanceof tn)return this._attachTexture(n,i,0,0),i;if(i instanceof Ir){const r=i;return this._attachTexture(n,r.texture,r.props.baseMipLevel,r.props.baseArrayLayer),i.texture}throw new Error("attach")}_attachTexture(n,i,r,s){const{gl:o}=this.device;switch(o.bindTexture(i.target,i.handle),i.target){case 35866:case 32879:o.framebufferTextureLayer(36160,n,i.target,s,r);break;case 34067:const a=IN(r);o.framebufferTexture2D(36160,n,a,i.handle,s);break;case 3553:o.framebufferTexture2D(36160,n,3553,i.handle,s);break;default:le(!1,"Illegal texture type")}o.bindTexture(i.target,null)}}function IN(t){return t<34069?t+34069:t}function ON(t){switch(t){case 36053:return"success";case 36054:return"Mismatched attachments";case 36055:return"No attachments";case 36057:return"Height/width mismatch";case 36061:return"Unsupported or split attachments";case 36182:return"Samples mismatch";default:return`${t}`}}class NN extends vg{constructor(n,i){super(i);m(this,"device");m(this,"presentationSize");m(this,"_framebuffer",null);this.device=n,this.presentationSize=[-1,-1],this._setAutoCreatedCanvasId(`${this.device.id}-canvas`),this.update()}getCurrentFramebuffer(){return this.update(),this._framebuffer=this._framebuffer||new fo(this.device,{handle:null}),this._framebuffer}update(){const n=this.getPixelSize();(n[0]!==this.presentationSize[0]||n[1]!==this.presentationSize[1])&&(this.presentationSize=n,this.resize())}resize(n){if(this.device.gl&&this.canvas){const i=this.getDevicePixelRatio(n==null?void 0:n.useDevicePixels);this.setDevicePixelRatio(i,n);return}}commit(){}}const kN={spector:U.get("spector")||U.get("inspect")},FN="https://spectorcdn.babylonjs.com/spector.bundle.js",DN=1;let re=null,J0=!1;async function BN(t){if(!globalThis.SPECTOR)try{await vw(FN)}catch(e){U.warn(String(e))}}function UN(t){if(t={...kN,...t},!(t!=null&&t.spector)||(!re&&globalThis.SPECTOR&&(U.probe(DN,"SPECTOR found and initialized")(),re=new globalThis.SPECTOR.Spector,globalThis.luma&&(globalThis.luma.spector=re)),!re))return null;if(J0||(J0=!0,re.spyCanvases(),re==null||re.onCaptureStarted.add(e=>U.info("Spector capture started:",e)()),re==null||re.onCapture.add(e=>{U.info("Spector capture complete:",e)(),re==null||re.getResultUI(),re==null||re.resultView.display(),re==null||re.resultView.addCapture(e)})),t!=null&&t.canvas){if(typeof t.spector=="string"&&t.spector!==t.canvas.id)return re;re==null||re.startCapture(t==null?void 0:t.canvas,500),new Promise(e=>setTimeout(e,2e3)).then(e=>{U.info("Spector capture stopped after 2 seconds")(),re==null||re.stopCapture()})}return re}const LN="https://unpkg.com/webgl-debug@2.0.1/index.js";function pE(t){return t.luma=t.luma||{},t.luma}async function zN(){fi()&&!globalThis.WebGLDebugUtils&&(globalThis.global=globalThis.global||globalThis,globalThis.global.module={},await vw(LN))}function VN(t,e={}){return t?e.debug?WN(t,e):jN(t):null}function jN(t){const e=pE(t);return e.realContext?e.realContext:t}function WN(t,e){if(!globalThis.WebGLDebugUtils)return U.warn("webgl-debug not loaded")(),t;const n=pE(t);if(n.debugContext)return n.debugContext;globalThis.WebGLDebugUtils.init({...Cr,...t});const i=globalThis.WebGLDebugUtils.makeDebugContext(t,HN.bind(null,e),$N.bind(null,e));for(const o in Cr)!(o in i)&&typeof Cr[o]=="number"&&(i[o]=Cr[o]);class r{}Object.setPrototypeOf(i,Object.getPrototypeOf(t)),Object.setPrototypeOf(r,i);const s=Object.create(r);return n.realContext=t,n.debugContext=s,s.debug=!0,s}function Qh(t,e){e=Array.from(e).map(i=>i===void 0?"undefined":i);let n=globalThis.WebGLDebugUtils.glFunctionArgsToString(t,e);return n=`${n.slice(0,100)}${n.length>100?"...":""}`,`gl.${t}(${n})`}function HN(t,e,n,i){i=Array.from(i).map(a=>a===void 0?"undefined":a);const r=globalThis.WebGLDebugUtils.glEnumToString(e),s=globalThis.WebGLDebugUtils.glFunctionArgsToString(n,i),o=`${r} in gl.${n}(${s})`;U.error(o)();debugger;if(t.throwOnError)throw new Error(o)}function $N(t,e,n){let i="";if(U.level>=1&&(i=Qh(e,n),U.log(1,i)()),t.break&&t.break.length>0&&(i=i||Qh(e,n),t.break.every(s=>i.indexOf(s)!==-1)))debugger;for(const r of n)if(r===void 0){if(i=i||Qh(e,n),t.throwOnError)throw new Error(`Undefined argument: ${i}`);U.error(`Undefined argument: ${i}`)();debugger}}function XN(t){const e=t.split(/\r?\n/),n=[];for(const i of e){if(i.length<=1)continue;const r=i.split(":");if(r.length===2){const[h,f]=r;n.push({message:f.trim(),type:G0(h),lineNum:0,linePos:0});continue}const[s,o,a,...l]=r;let c=parseInt(a,10);isNaN(c)&&(c=0);let u=parseInt(o,10);isNaN(u)&&(u=0),n.push({message:l.join(":").trim(),type:G0(s),lineNum:c,linePos:u})}return n}function G0(t){const e=["warning","error","info"],n=t.toLowerCase();return e.includes(n)?n:"info"}class YN extends mc{constructor(n,i){super(n,i);m(this,"device");m(this,"handle");switch(this.device=n,this.props.stage){case"vertex":this.handle=this.props.handle||this.device.gl.createShader(35633);break;case"fragment":this.handle=this.props.handle||this.device.gl.createShader(35632);break;default:throw new Error(this.props.stage)}this._compile(this.source)}destroy(){this.handle&&(this.removeStats(),this.device.gl.deleteShader(this.handle),this.destroyed=!0)}async getCompilationInfo(){return await this._waitForCompilationComplete(),this.getCompilationInfoSync()}getCompilationInfoSync(){const n=this.device.gl.getShaderInfoLog(this.handle);return XN(n)}getTranslatedSource(){const i=this.device.getExtension("WEBGL_debug_shaders").WEBGL_debug_shaders;return i==null?void 0:i.getTranslatedShaderSource(this.handle)}async _compile(n){n=(s=>s.startsWith("#version ")?s:`#version 100
${s}`)(n);const{gl:r}=this.device;if(r.shaderSource(this.handle,n),r.compileShader(this.handle),U.level===0){this.compilationStatus="pending";return}if(!this.device.features.has("compilation-status-async-webgl")){if(this._getCompilationStatus(),this.debugShader(),this.compilationStatus==="error")throw new Error(`GLSL compilation errors in ${this.props.stage} shader ${this.props.id}`);return}U.once(1,"Shader compilation is asynchronous")(),await this._waitForCompilationComplete(),U.info(2,`Shader ${this.id} - async compilation complete: ${this.compilationStatus}`)(),this._getCompilationStatus(),this.debugShader()}async _waitForCompilationComplete(){const n=async s=>await new Promise(o=>setTimeout(o,s));if(!this.device.features.has("compilation-status-async-webgl")){await n(10);return}const{gl:r}=this.device;for(;;){if(r.getShaderParameter(this.handle,37297))return;await n(10)}}_getCompilationStatus(){this.compilationStatus=this.device.gl.getShaderParameter(this.handle,35713)?"success":"error"}}const KN=256,qN=1024,ZN=16384,Jh=6144,QN=[1,2,4,8];class JN extends yd{constructor(n,i){super(n,i);m(this,"device");m(this,"glParameters");this.device=n,Nu(this.device.gl),this.setParameters(this.props.parameters),this.clear()}end(){Vo(this.device.gl)}pushDebugGroup(n){}popDebugGroup(){}insertDebugMarker(n){}setParameters(n={}){const i={...this.glParameters};this.props.framebuffer&&(i.framebuffer=this.props.framebuffer),this.props.depthReadOnly&&(i.depthMask=!this.props.depthReadOnly),i.stencilMask=this.props.stencilReadOnly?0:1,i[35977]=this.props.discard,n.viewport&&(n.viewport.length>=6?(i.viewport=n.viewport.slice(0,4),i.depthRange=[n.viewport[4],n.viewport[5]]):i.viewport=n.viewport),n.scissorRect&&(i.scissorTest=!0,i.scissor=n.scissorRect),n.blendConstant&&(i.blendColor=n.blendConstant),n.stencilReference&&(console.warn("RenderPassParameters.stencilReference not yet implemented in WebGL"),n[2967]=n.stencilReference),n.colorMask&&(i.colorMask=QN.map(r=>!!(r&n.colorMask))),this.glParameters=i,gs(this.device.gl,i)}beginOcclusionQuery(n){const i=this.props.occlusionQuerySet;i==null||i.beginOcclusionQuery()}endOcclusionQuery(){const n=this.props.occlusionQuerySet;n==null||n.endOcclusionQuery()}clear(){const n={...this.glParameters};let i=0;this.props.clearColor!==!1&&(i|=ZN,n.clearColor=this.props.clearColor),this.props.clearDepth!==!1&&(i|=KN,n.clearDepth=this.props.clearDepth),this.props.clearStencil!==!1&&(i|=qN,n.clearStencil=this.props.clearStencil),i!==0&&Yn(this.device.gl,n,()=>{this.device.gl.clear(i)})}clearColorBuffer(n=0,i=[0,0,0,0]){Yn(this.device.gl,{framebuffer:this.props.framebuffer},()=>{switch(i.constructor){case Int32Array:this.device.gl.clearBufferiv(Jh,n,i);break;case Uint32Array:this.device.gl.clearBufferuiv(Jh,n,i);break;case Float32Array:default:this.device.gl.clearBufferfv(Jh,n,i);break}})}}const GN="Failed to deduce GL constant from typed array";function ek(t){switch(ArrayBuffer.isView(t)?t.constructor:t){case Float32Array:return 5126;case Uint16Array:return 5123;case Uint32Array:return 5125;case Uint8Array:return 5121;case Uint8ClampedArray:return 5121;case Int8Array:return 5120;case Int16Array:return 5122;case Int32Array:return 5124;default:throw new Error(GN)}}function Ud(t,e){const{clamped:n=!0}=e||{};switch(t){case 5126:return Float32Array;case 5123:case 33635:case 32819:case 32820:return Uint16Array;case 5125:return Uint32Array;case 5121:return n?Uint8ClampedArray:Uint8Array;case 5120:return Int8Array;case 5122:return Int16Array;case 5124:return Int32Array;default:throw new Error("Failed to deduce typed array type from GL constant")}}const tk={offset:0,stride:0,type:5126,size:1,divisor:0,normalized:!1,integer:!1},nk={deprecatedProps:{instanced:"divisor",isInstanced:"divisor"}};class po{constructor(...e){m(this,"offset");m(this,"stride");m(this,"type");m(this,"size");m(this,"divisor");m(this,"normalized");m(this,"integer");m(this,"buffer");m(this,"index");e.forEach(n=>this._assign(n)),Object.freeze(this)}static getBytesPerElement(e){return Ud(e.type||5126).BYTES_PER_ELEMENT}static getBytesPerVertex(e){return le(e.size),Ud(e.type||5126).BYTES_PER_ELEMENT*e.size}static resolve(...e){return new po(tk,...e)}toString(){return JSON.stringify(this)}get BYTES_PER_ELEMENT(){return po.getBytesPerElement(this)}get BYTES_PER_VERTEX(){return po.getBytesPerVertex(this)}_assign(e={}){return e=lP("Accessor",e,nk),e.type!==void 0&&(this.type=e.type,(e.type===5124||e.type===5125)&&(this.integer=!0)),e.size!==void 0&&(this.size=e.size),e.offset!==void 0&&(this.offset=e.offset),e.stride!==void 0&&(this.stride=e.stride),e.normalize!==void 0&&(this.normalized=e.normalize),e.normalized!==void 0&&(this.normalized=e.normalized),e.integer!==void 0&&(this.integer=e.integer),e.divisor!==void 0&&(this.divisor=e.divisor),e.buffer!==void 0&&(this.buffer=e.buffer),e.index!==void 0&&(typeof e.index=="boolean"?this.index=e.index?1:0:this.index=e.index),e.instanced!==void 0&&(this.divisor=e.instanced?1:0),e.isInstanced!==void 0&&(this.divisor=e.isInstanced?1:0),this.offset===void 0&&delete this.offset,this.stride===void 0&&delete this.stride,this.type===void 0&&delete this.type,this.size===void 0&&delete this.size,this.divisor===void 0&&delete this.divisor,this.normalized===void 0&&delete this.normalized,this.integer===void 0&&delete this.integer,this.buffer===void 0&&delete this.buffer,this.index===void 0&&delete this.index,this}}function ik(t){return rk.includes(t)}const rk=[35678,35680,35679,35682,36289,36292,36293,36298,36299,36300,36303,36306,36307,36308,36311],gE={5126:[5126,1,"float","f32","float32"],35664:[5126,2,"vec2","vec2<f32>","float32x2"],35665:[5126,3,"vec3","vec3<f32>","float32x3"],35666:[5126,4,"vec4","vec4<f32>","float32x4"],5124:[5124,1,"int","i32","sint32"],35667:[5124,2,"ivec2","vec2<i32>","sint32x2"],35668:[5124,3,"ivec3","vec3<i32>","sint32x3"],35669:[5124,4,"ivec4","vec4<i32>","sint32x4"],5125:[5125,1,"uint","u32","uint32"],36294:[5125,2,"uvec2","vec2<u32>","uint32x2"],36295:[5125,3,"uvec3","vec3<u32>","uint32x3"],36296:[5125,4,"uvec4","vec4<u32>","uint32x4"],35670:[5126,1,"bool","f32","float32"],35671:[5126,2,"bvec2","vec2<f32>","float32x2"],35672:[5126,3,"bvec3","vec3<f32>","float32x3"],35673:[5126,4,"bvec4","vec4<f32>","float32x4"],35674:[5126,8,"mat2","mat2x2<f32>"],35685:[5126,8,"mat2x3","mat2x3<f32>"],35686:[5126,8,"mat2x4","mat2x4<f32>"],35687:[5126,12,"mat3x2","mat3x2<f32>"],35675:[5126,12,"mat3","mat3x3<f32>"],35688:[5126,12,"mat3x4","mat3x4<f32>"],35689:[5126,16,"mat4x2","mat4x2<f32>"],35690:[5126,16,"mat4x3","mat4x3<f32>"],35676:[5126,16,"mat4","mat4x4<f32>"]};function _E(t){const e=gE[t];if(!e)throw new Error("uniform");const[n,i,,r]=e;return{format:r,components:i,glType:n}}function sk(t){const e=gE[t];if(!e)throw new Error("attribute");const[,n,,i,r]=e;return{attributeType:i,vertexFormat:r,components:n}}function ok(t,e){const n={attributes:[],bindings:[]};n.attributes=ak(t,e);const i=uk(t,e);for(const a of i){const l=a.uniforms.map(c=>({name:c.name,format:c.format,byteOffset:c.byteOffset,byteStride:c.byteStride,arrayLength:c.arrayLength}));n.bindings.push({type:"uniform",name:a.name,location:a.location,visibility:(a.vertex?1:0)&(a.fragment?2:0),minBindingSize:a.byteLength,uniforms:l})}const r=ck(t,e);let s=0;for(const a of r)if(ik(a.type)){const{viewDimension:l,sampleType:c}=fk(a.type);n.bindings.push({type:"texture",name:a.name,location:s,viewDimension:l,sampleType:c}),a.textureUnit=s,s+=1}r.length&&(n.uniforms=r);const o=lk(t,e);return o!=null&&o.length&&(n.varyings=o),n}function ak(t,e){const n=[],i=t.getProgramParameter(e,35721);for(let r=0;r<i;r++){const s=t.getActiveAttrib(e,r);if(!s)throw new Error("activeInfo");const{name:o,type:a}=s,l=t.getAttribLocation(e,o);if(l>=0){const{attributeType:c}=sk(a),u=/instance/i.test(o)?"instance":"vertex";n.push({name:o,location:l,stepMode:u,type:c})}}return n.sort((r,s)=>r.location-s.location),n}function lk(t,e){const n=[],i=t.getProgramParameter(e,35971);for(let r=0;r<i;r++){const s=t.getTransformFeedbackVarying(e,r);if(!s)throw new Error("activeInfo");const{name:o,type:a,size:l}=s,{glType:c,components:u}=_E(a),h=new po({type:c,size:l*u}),f={location:r,name:o,accessor:h};n.push(f)}return n.sort((r,s)=>r.location-s.location),n}function ck(t,e){const n=[],i=t.getProgramParameter(e,35718);for(let r=0;r<i;r++){const s=t.getActiveUniform(e,r);if(!s)throw new Error("activeInfo");const{name:o,size:a,type:l}=s,{name:c,isArray:u}=dk(o);let h=t.getUniformLocation(e,c);const f={location:h,name:c,size:a,type:l,isArray:u};if(n.push(f),f.size>1)for(let d=0;d<f.size;d++){const p=`${c}[${d}]`;h=t.getUniformLocation(e,p);const v={...f,name:p,location:h};n.push(v)}}return n}function uk(t,e){const n=(s,o)=>t.getActiveUniformBlockParameter(e,s,o),i=[],r=t.getProgramParameter(e,35382);for(let s=0;s<r;s++){const o={name:t.getActiveUniformBlockName(e,s)||"",location:n(s,35391),byteLength:n(s,35392),vertex:n(s,35396),fragment:n(s,35398),uniformCount:n(s,35394),uniforms:[]},a=n(s,35395)||[],l=t.getActiveUniforms(e,a,35383),c=t.getActiveUniforms(e,a,35384),u=t.getActiveUniforms(e,a,35387),h=t.getActiveUniforms(e,a,35388);for(let f=0;f<o.uniformCount;++f){const d=t.getActiveUniform(e,a[f]);if(!d)throw new Error("activeInfo");o.uniforms.push({name:d.name,format:_E(l[f]).format,type:l[f],arrayLength:c[f],byteOffset:u[f],byteStride:h[f]})}i.push(o)}return i.sort((s,o)=>s.location-o.location),i}const hk={35678:["2d","float"],35680:["cube","float"],35679:["3d","float"],35682:["3d","depth"],36289:["2d-array","float"],36292:["2d-array","depth"],36293:["cube","float"],36298:["2d","sint"],36299:["3d","sint"],36300:["cube","sint"],36303:["2d-array","uint"],36306:["2d","uint"],36307:["3d","uint"],36308:["cube","uint"],36311:["2d-array","uint"]};function fk(t){const e=hk[t];if(!e)throw new Error("sampler");const[n,i]=e;return{viewDimension:n,sampleType:i}}function dk(t){if(t[t.length-1]!=="]")return{name:t,length:1,isArray:!1};const n=/([^[]*)(\[[0-9]+\])?/.exec(t);if(!n||n.length<2)throw new Error(`Failed to parse GLSL uniform name ${t}`);return{name:n[1],length:n[2]?1:0,isArray:!!n[2]}}function pk(t,e,n,i){const r=t;let s=i;s===!0&&(s=1),s===!1&&(s=0);const o=typeof s=="number"?[s]:s;switch(n){case 35678:case 35680:case 35679:case 35682:case 36289:case 36292:case 36293:case 36298:case 36299:case 36300:case 36303:case 36306:case 36307:case 36308:case 36311:if(typeof i!="number")throw new Error("samplers must be set to integers");return t.uniform1i(e,i);case 5126:return t.uniform1fv(e,o);case 35664:return t.uniform2fv(e,o);case 35665:return t.uniform3fv(e,o);case 35666:return t.uniform4fv(e,o);case 5124:return t.uniform1iv(e,o);case 35667:return t.uniform2iv(e,o);case 35668:return t.uniform3iv(e,o);case 35669:return t.uniform4iv(e,o);case 35670:return t.uniform1iv(e,o);case 35671:return t.uniform2iv(e,o);case 35672:return t.uniform3iv(e,o);case 35673:return t.uniform4iv(e,o);case 5125:return r.uniform1uiv(e,o,1);case 36294:return r.uniform2uiv(e,o,2);case 36295:return r.uniform3uiv(e,o,3);case 36296:return r.uniform4uiv(e,o,4);case 35674:return t.uniformMatrix2fv(e,!1,o);case 35675:return t.uniformMatrix3fv(e,!1,o);case 35676:return t.uniformMatrix4fv(e,!1,o);case 35685:return r.uniformMatrix2x3fv(e,!1,o);case 35686:return r.uniformMatrix2x4fv(e,!1,o);case 35687:return r.uniformMatrix3x2fv(e,!1,o);case 35688:return r.uniformMatrix3x4fv(e,!1,o);case 35689:return r.uniformMatrix4x2fv(e,!1,o);case 35690:return r.uniformMatrix4x3fv(e,!1,o)}throw new Error("Illegal uniform")}function gk(t){switch(t){case"point-list":return 0;case"line-list":return 1;case"line-strip":return 3;case"line-loop-webgl":return 2;case"triangle-list":return 4;case"triangle-strip":return 5;case"triangle-fan-webgl":return 6;default:throw new Error(t)}}function _k(t){switch(t){case"point-list":return 0;case"line-list":return 1;case"line-strip":return 1;case"line-loop-webgl":return 1;case"triangle-list":return 4;case"triangle-strip":return 4;case"triangle-fan-webgl":return 4;default:throw new Error(t)}}const ey=4;class mk extends ts{constructor(n,i){super(n,i);m(this,"device");m(this,"handle");m(this,"vs");m(this,"fs");m(this,"introspectedLayout");m(this,"uniforms",{});m(this,"bindings",{});m(this,"varyings",null);m(this,"_uniformCount",0);m(this,"_uniformSetters",{});this.device=n,this.handle=this.props.handle||this.device.gl.createProgram(),this.device.setSpectorMetadata(this.handle,{id:this.props.id}),this.vs=i.vs,this.fs=i.fs;const{varyings:r,bufferMode:s=35981}=i;switch(r&&r.length>0&&(this.varyings=r,this.device.gl.transformFeedbackVaryings(this.handle,r,s)),this._linkShaders(),U.time(1,`RenderPipeline ${this.id} - shaderLayout introspection`)(),this.introspectedLayout=ok(this.device.gl,this.handle),U.timeEnd(1,`RenderPipeline ${this.id} - shaderLayout introspection`)(),this.shaderLayout=qC(this.introspectedLayout,i.shaderLayout),this.props.topology){case"triangle-fan-webgl":case"line-loop-webgl":U.warn(`Primitive topology ${this.props.topology} is deprecated and will be removed in v9.1`);break}}destroy(){this.handle&&(this.device.gl.deleteProgram(this.handle),this.destroyed=!0)}setBindings(n,i){for(const[r,s]of Object.entries(n)){const o=this.shaderLayout.bindings.find(a=>a.name===r)||this.shaderLayout.bindings.find(a=>a.name===`${r}Uniforms`);if(!o){const a=this.shaderLayout.bindings.map(l=>`"${l.name}"`).join(", ");i!=null&&i.disableWarnings||U.warn(`Unknown binding "${r}" in render pipeline "${this.id}", expected one of ${a}`)();continue}switch(s||U.warn(`Unsetting binding "${r}" in render pipeline "${this.id}"`)(),o.type){case"uniform":if(!(s instanceof ri)&&!(s.buffer instanceof ri))throw new Error("buffer value");break;case"texture":if(!(s instanceof Ir||s instanceof tn||s instanceof fo))throw new Error("texture value");break;case"sampler":U.warn(`Ignoring sampler ${r}`)();break;default:throw new Error(o.type)}this.bindings[r]=s}}draw(n){var A;const{renderPass:i,parameters:r=this.props.parameters,topology:s=this.props.topology,vertexArray:o,vertexCount:a,instanceCount:l,firstVertex:c=0,transformFeedback:u}=n,h=gk(s),f=!!o.indexBuffer,d=(A=o.indexBuffer)==null?void 0:A.glIndexType,p=Number(l)>0;if(this.linkStatus!=="success")return U.info(2,`RenderPipeline:${this.id}.draw() aborted - waiting for shader linking`)(),!1;if(!this._areTexturesRenderable()||a===0)return U.info(2,`RenderPipeline:${this.id}.draw() aborted - textures not yet loaded`)(),!1;if(a===0)return U.info(2,`RenderPipeline:${this.id}.draw() aborted - no vertices to draw`)(),!0;this.device.gl.useProgram(this.handle),o.bindBeforeRender(i),u&&u.begin(this.props.topology),this._applyBindings(),this._applyUniforms();const v=i;return wN(this.device,r,v.glParameters,()=>{f&&p?this.device.gl.drawElementsInstanced(h,a||0,d,c,l||0):f?this.device.gl.drawElements(h,a||0,d,c):p?this.device.gl.drawArraysInstanced(h,c,a||0,l||0):this.device.gl.drawArrays(h,c,a||0),u&&u.end()}),o.unbindAfterRender(i),!0}setUniformsWebGL(n){const{bindings:i}=yw(n);Object.keys(i).forEach(r=>{U.warn(`Unsupported value "${JSON.stringify(i[r])}" used in setUniforms() for key ${r}. Use setBindings() instead?`)()}),Object.assign(this.uniforms,n)}async _linkShaders(){const{gl:n}=this.device;if(n.attachShader(this.handle,this.vs.handle),n.attachShader(this.handle,this.fs.handle),U.time(ey,`linkProgram for ${this.id}`)(),n.linkProgram(this.handle),U.timeEnd(ey,`linkProgram for ${this.id}`)(),U.level,!this.device.features.has("compilation-status-async-webgl")){const r=this._getLinkStatus();this._reportLinkStatus(r);return}U.once(1,"RenderPipeline linking is asynchronous")(),await this._waitForLinkComplete(),U.info(2,`RenderPipeline ${this.id} - async linking complete: ${this.linkStatus}`)();const i=this._getLinkStatus();this._reportLinkStatus(i)}_reportLinkStatus(n){var i;switch(n){case"success":return;default:throw this.vs.compilationStatus==="error"?(this.vs.debugShader(),new Error(`Error during compilation of shader ${this.vs.id}`)):((i=this.fs)==null?void 0:i.compilationStatus)==="error"?(this.vs.debugShader(),new Error(`Error during compilation of shader ${this.fs.id}`)):new Error(`Error during ${n}: ${this.device.gl.getProgramInfoLog(this.handle)}`)}}_getLinkStatus(){const{gl:n}=this.device;return n.getProgramParameter(this.handle,35714)?(n.validateProgram(this.handle),n.getProgramParameter(this.handle,35715)?(this.linkStatus="success","success"):(this.linkStatus="error","validation")):(this.linkStatus="error","linking")}async _waitForLinkComplete(){const n=async s=>await new Promise(o=>setTimeout(o,s));if(!this.device.features.has("compilation-status-async-webgl")){await n(10);return}const{gl:r}=this.device;for(;;){if(r.getProgramParameter(this.handle,37297))return;await n(10)}}_areTexturesRenderable(){let n=!0;for(const[,i]of Object.entries(this.bindings))i instanceof tn&&(i.update(),n=n&&i.loaded);return n}_applyBindings(){if(this.linkStatus!=="success")return;const{gl:n}=this.device;n.useProgram(this.handle);let i=0,r=0;for(const s of this.shaderLayout.bindings){const o=this.bindings[s.name]||this.bindings[s.name.replace(/Uniforms$/,"")];if(!o)throw new Error(`No value for binding ${s.name} in ${this.id}`);switch(s.type){case"uniform":const{name:a}=s,l=n.getUniformBlockIndex(this.handle,a);if(l===4294967295)throw new Error(`Invalid uniform block name ${a}`);n.uniformBlockBinding(this.handle,r,l),o instanceof ri?n.bindBufferBase(35345,r,o.handle):n.bindBufferRange(35345,r,o.buffer.handle,o.offset||0,o.size||o.buffer.byteLength-o.offset),r+=1;break;case"texture":if(!(o instanceof Ir||o instanceof tn||o instanceof fo))throw new Error("texture");let c;if(o instanceof Ir)c=o.texture;else if(o instanceof tn)c=o;else if(o instanceof fo&&o.colorAttachments[0]instanceof Ir)U.warn("Passing framebuffer in texture binding may be deprecated. Use fbo.colorAttachments[0] instead")(),c=o.colorAttachments[0].texture;else throw new Error("No texture");n.activeTexture(33984+i),n.bindTexture(c.target,c.handle),i+=1;break;case"sampler":break;case"storage":case"read-only-storage":throw new Error(`binding type '${s.type}' not supported in WebGL`)}}}_applyUniforms(){for(const n of this.shaderLayout.uniforms||[]){const{name:i,location:r,type:s,textureUnit:o}=n,a=this.uniforms[i]??o;a!==void 0&&pk(this.device.gl,r,s,a)}}}class yk extends Td{constructor(n){super(n,{});m(this,"device");m(this,"commands",[]);this.device=n}submitCommands(n=this.commands){for(const i of n)switch(i.name){case"copy-buffer-to-buffer":vk(this.device,i.options);break;case"copy-buffer-to-texture":Tk(this.device,i.options);break;case"copy-texture-to-buffer":wk(this.device,i.options);break;case"copy-texture-to-texture":Ek(this.device,i.options);break}}}function vk(t,e){const n=e.source,i=e.destination;t.gl.bindBuffer(36662,n.handle),t.gl.bindBuffer(36663,i.handle),t.gl.copyBufferSubData(36662,36663,e.sourceOffset??0,e.destinationOffset??0,e.size),t.gl.bindBuffer(36662,null),t.gl.bindBuffer(36663,null)}function Tk(t,e){throw new Error("Not implemented")}function wk(t,e){const{source:n,mipLevel:i=0,aspect:r="all",width:s=e.source.width,height:o=e.source.height,depthOrArrayLayers:a=0,origin:l=[0,0],destination:c,byteOffset:u=0,bytesPerRow:h,rowsPerImage:f}=e;if(r!=="all")throw new Error("not supported");if(i!==0||a!==0||h||f)throw new Error("not implemented");const{framebuffer:d,destroyFramebuffer:p}=mE(n);let v;try{const A=c,y=s||d.width,g=o||d.height,_=Rc(d.texture.props.format),E=_.dataFormat,R=_.type;t.gl.bindBuffer(35051,A.handle),v=t.gl.bindFramebuffer(36160,d.handle),t.gl.readPixels(l[0],l[1],y,g,E,R,u)}finally{t.gl.bindBuffer(35051,null),v!==void 0&&t.gl.bindFramebuffer(36160,v),p&&d.destroy()}}function Ek(t,e){const{source:n,destinationMipLevel:i=0,origin:r=[0,0],destinationOrigin:s=[0,0],destination:o}=e;let{width:a=e.destination.width,height:l=e.destination.height}=e;const{framebuffer:c,destroyFramebuffer:u}=mE(n),[h,f]=r,[d,p,v]=s,A=t.gl.bindFramebuffer(36160,c.handle);let y=null,g;if(o instanceof tn)y=o,a=Number.isFinite(a)?a:y.width,l=Number.isFinite(l)?l:y.height,y.bind(0),g=y.target;else throw new Error("invalid destination");switch(g){case 3553:case 34067:t.gl.copyTexSubImage2D(g,i,d,p,h,f,a,l);break;case 35866:case 32879:t.gl.copyTexSubImage3D(g,i,d,p,v,h,f,a,l);break}y&&y.unbind(),t.gl.bindFramebuffer(36160,A),u&&c.destroy()}function mE(t){if(t instanceof Et){const{width:e,height:n,id:i}=t;return{framebuffer:t.device.createFramebuffer({id:`framebuffer-for-${i}`,width:e,height:n,colorAttachments:[t]}),destroyFramebuffer:!0}}return{framebuffer:t,destroyFramebuffer:!1}}class Sk extends vd{constructor(n,i){super(n,i);m(this,"device");m(this,"commandBuffer");this.device=n,this.commandBuffer=new yk(n)}destroy(){}finish(){this.commandBuffer.submitCommands()}copyBufferToBuffer(n){this.commandBuffer.commands.push({name:"copy-buffer-to-buffer",options:n})}copyBufferToTexture(n){this.commandBuffer.commands.push({name:"copy-buffer-to-texture",options:n})}copyTextureToBuffer(n){this.commandBuffer.commands.push({name:"copy-texture-to-buffer",options:n})}copyTextureToTexture(n){this.commandBuffer.commands.push({name:"copy-texture-to-texture",options:n})}pushDebugGroup(n){}popDebugGroup(){}insertDebugMarker(n){}resolveQuerySet(n,i,r){}}class Og extends wd{constructor(n,i){super(n,i);m(this,"device");m(this,"handle");m(this,"buffer",null);m(this,"bufferValue",null);this.device=n,this.handle=this.device.gl.createVertexArray()}get[Symbol.toStringTag](){return"VertexArray"}static isConstantAttributeZeroSupported(n){return lR()==="Chrome"}destroy(){var n;super.destroy(),this.buffer&&((n=this.buffer)==null||n.destroy()),this.handle&&(this.device.gl.deleteVertexArray(this.handle),this.handle=void 0)}setIndexBuffer(n){const i=n;if(i&&i.glTarget!==34963)throw new Error("Use .setBuffer()");this.device.gl.bindVertexArray(this.handle),this.device.gl.bindBuffer(34963,i?i.handle:null),this.indexBuffer=i,this.device.gl.bindVertexArray(null)}setBuffer(n,i){const r=i;if(r.glTarget===34963)throw new Error("Use .setIndexBuffer()");const{size:s,type:o,stride:a,offset:l,normalized:c,integer:u,divisor:h}=this._getAccessor(n);this.device.gl.bindVertexArray(this.handle),this.device.gl.bindBuffer(34962,r.handle),u?this.device.gl.vertexAttribIPointer(n,s,o,a,l):this.device.gl.vertexAttribPointer(n,s,o,c,a,l),this.device.gl.enableVertexAttribArray(n),this.device.gl.vertexAttribDivisor(n,h||0),this.attributes[n]=r,this.device.gl.bindVertexArray(null)}setConstantWebGL(n,i){this._enable(n,!1),this.attributes[n]=i}bindBeforeRender(){this.device.gl.bindVertexArray(this.handle),this._applyConstantAttributes()}unbindAfterRender(){this.device.gl.bindVertexArray(null)}_applyConstantAttributes(){for(let n=0;n<this.maxVertexAttributes;++n){const i=this.attributes[n];ArrayBuffer.isView(i)&&this.device.setConstantAttributeWebGL(n,i)}}_getAccessor(n){const i=this.attributeInfos[n];if(!i)throw new Error(`Unknown attribute location ${n}`);const r=uE(i.bufferDataType);return{size:i.bufferComponents,type:r,stride:i.byteStride,offset:i.byteOffset,normalized:i.normalized,integer:i.integer,divisor:i.stepMode==="instance"?1:0}}_enable(n,i=!0){const s=Og.isConstantAttributeZeroSupported(this.device)||n!==0;(i||s)&&(n=Number(n),this.device.gl.bindVertexArray(this.handle),i?this.device.gl.enableVertexAttribArray(n):this.device.gl.disableVertexAttribArray(n),this.device.gl.bindVertexArray(null))}getConstantBuffer(n,i){const r=Ak(i),s=r.byteLength*n,o=r.length*n;if(this.buffer&&s!==this.buffer.byteLength)throw new Error(`Buffer size is immutable, byte length ${s} !== ${this.buffer.byteLength}.`);let a=!this.buffer;if(this.buffer=this.buffer||this.device.createBuffer({byteLength:s}),a=a||!xk(r,this.bufferValue),a){const l=GC(i.constructor,o);eP({target:l,source:r,start:0,count:o}),this.buffer.write(l),this.bufferValue=i}return this.buffer}}function Ak(t){return Array.isArray(t)?new Float32Array(t):t}function xk(t,e){if(!t||!e||t.length!==e.length||t.constructor!==e.constructor)return!1;for(let n=0;n<t.length;++n)if(t[n]!==e[n])return!1;return!0}class Rk extends Ed{constructor(n,i){super(n,i);m(this,"device");m(this,"gl");m(this,"handle");m(this,"layout");m(this,"buffers",{});m(this,"unusedBuffers",{});m(this,"bindOnUse",!0);m(this,"_bound",!1);this.device=n,this.gl=n.gl,this.handle=this.props.handle||this.gl.createTransformFeedback(),this.layout=this.props.layout,i.buffers&&this.setBuffers(i.buffers),Object.seal(this)}destroy(){this.gl.deleteTransformFeedback(this.handle),super.destroy()}begin(n="point-list"){this.gl.bindTransformFeedback(36386,this.handle),this.bindOnUse&&this._bindBuffers(),this.gl.beginTransformFeedback(_k(n))}end(){this.gl.endTransformFeedback(),this.bindOnUse||this._unbindBuffers(),this.gl.bindTransformFeedback(36386,null)}setBuffers(n){this.buffers={},this.unusedBuffers={},this.bind(()=>{for(const i in n)this.setBuffer(i,n[i])})}setBuffer(n,i){const r=this._getVaryingIndex(n),{buffer:s,byteLength:o,byteOffset:a}=this._getBufferRange(i);if(r<0){this.unusedBuffers[n]=s,U.warn(`${this.id} unusedBuffers varying buffer ${n}`)();return}this.buffers[r]={buffer:s,byteLength:o,byteOffset:a},this.bindOnUse||this._bindBuffer(r,s,a,o)}getBuffer(n){if(ty(n))return this.buffers[n]||null;const i=this._getVaryingIndex(n);return i>=0?this.buffers[i]:null}bind(n=this.handle){if(typeof n!="function")return this.gl.bindTransformFeedback(36386,n),this;let i;return this._bound?i=n():(this.gl.bindTransformFeedback(36386,this.handle),this._bound=!0,i=n(),this._bound=!1,this.gl.bindTransformFeedback(36386,null)),i}unbind(){this.bind(null)}_getBufferRange(n){if(n instanceof ri)return{buffer:n,byteOffset:0,byteLength:n.byteLength};const{buffer:i,byteOffset:r=0,byteLength:s=n.buffer.byteLength}=n;return{buffer:i,byteOffset:r,byteLength:s}}_getVaryingIndex(n){if(ty(n))return Number(n);for(const i of this.layout.varyings)if(n===i.name)return i.location;return-1}_bindBuffers(){for(const n in this.buffers){const{buffer:i,byteLength:r,byteOffset:s}=this._getBufferRange(this.buffers[n]);this._bindBuffer(Number(n),i,s,r)}}_unbindBuffers(){for(const n in this.buffers)this.gl.bindBufferBase(35982,Number(n),null)}_bindBuffer(n,i,r=0,s){const o=i&&i.handle;!o||s===void 0?this.gl.bindBufferBase(35982,n,o):this.gl.bindBufferRange(35982,n,o,r,s)}}function ty(t){return typeof t=="number"?Number.isInteger(t):/^\d+$/.test(t)}class bk extends Sd{constructor(n,i){super(n,i);m(this,"device");m(this,"handle");m(this,"target",null);m(this,"_queryPending",!1);m(this,"_pollingPromise",null);if(this.device=n,i.count>1)throw new Error("WebGL QuerySet can only have one value");this.handle=this.device.gl.createQuery(),Object.seal(this)}get[Symbol.toStringTag](){return"Query"}destroy(){this.device.gl.deleteQuery(this.handle)}beginTimestampQuery(){return this._begin(35007)}endTimestampQuery(){this._end()}beginOcclusionQuery(n){return this._begin(n!=null&&n.conservative?36202:35887)}endOcclusionQuery(){this._end()}beginTransformFeedbackQuery(){return this._begin(35976)}endTransformFeedbackQuery(){this._end()}async resolveQuery(){return[await this.pollQuery()]}_begin(n){this._queryPending||(this.target=n,this.device.gl.beginQuery(this.target,this.handle))}_end(){this._queryPending||this.target&&(this.device.gl.endQuery(this.target),this.target=null,this._queryPending=!0)}isResultAvailable(){if(!this._queryPending)return!1;const n=this.device.gl.getQueryParameter(this.handle,34919);return n&&(this._queryPending=!1),n}isTimerDisjoint(){return this.device.gl.getParameter(36795)}getResult(){return this.device.gl.getQueryParameter(this.handle,34918)}getTimerMilliseconds(){return this.getResult()/1e6}pollQuery(n=Number.POSITIVE_INFINITY){if(this._pollingPromise)return this._pollingPromise;let i=0;return this._pollingPromise=new Promise((r,s)=>{const o=()=>{this.isResultAvailable()?(r(this.getResult()),this._pollingPromise=null):i++>n?(s("Timed out"),this._pollingPromise=null):requestAnimationFrame(o)};requestAnimationFrame(o)}),this._pollingPromise}}function yE(t){switch(t){case 6406:case 33326:case 6403:return 1;case 33328:case 33319:return 2;case 6407:case 34837:return 3;case 6408:case 34836:return 4;default:return le(!1),0}}function Ck(t){switch(t){case 5121:return 1;case 33635:case 32819:case 32820:return 2;case 5126:return 4;default:return le(!1),0}}function Pk(t,e){var A,y;const{sourceX:n=0,sourceY:i=0,sourceFormat:r=6408,sourceAttachment:s=36064}=e||{};let{target:o=null,sourceWidth:a,sourceHeight:l,sourceType:c}=e||{};const{framebuffer:u,deleteFramebuffer:h}=vE(t);le(u);const{gl:f,handle:d}=u;a=a||u.width,l=l||u.height;const p=s-36064;c=c||((y=(A=u.colorAttachments[p])==null?void 0:A.texture)==null?void 0:y.type)||5121,o=Ok(o,c,r,a,l),c=c||ek(o);const v=f.bindFramebuffer(36160,d);return f.readPixels(n,i,a,l,r,c,o),f.bindFramebuffer(36160,v||null),h&&u.destroy(),o}function Mk(t,e){const{target:n,sourceX:i=0,sourceY:r=0,sourceFormat:s=6408,targetByteOffset:o=0}=e||{};let{sourceWidth:a,sourceHeight:l,sourceType:c}=e||{};const{framebuffer:u,deleteFramebuffer:h}=vE(t);le(u),a=a||u.width,l=l||u.height;const f=u;c=c||5121;let d=n;if(!d){const v=yE(s),A=Ck(c),y=o+a*l*v*A;d=f.device.createBuffer({byteLength:y})}const p=t.device.createCommandEncoder();return p.copyTextureToBuffer({source:t,width:a,height:l,origin:[i,r],destination:d,byteOffset:o}),p.destroy(),h&&u.destroy(),d}function vE(t){return t instanceof vc?{framebuffer:t,deleteFramebuffer:!1}:{framebuffer:Ik(t),deleteFramebuffer:!0}}function Ik(t,e){const{device:n,width:i,height:r,id:s}=t;return n.createFramebuffer({...e,id:`framebuffer-for-${s}`,width:i,height:r,colorAttachments:[t]})}function Ok(t,e,n,i,r){if(t)return t;e=e||5121;const s=Ud(e,{clamped:!1}),o=yE(n);return new s(i*r*o)}const Nk=256,kk=1024,Fk=16384,Dk="clear: bad arguments";function Bk(t,e){const{framebuffer:n=null,color:i=null,depth:r=null,stencil:s=null}=e||{},o={};n&&(o.framebuffer=n);let a=0;i&&(a|=Fk,i!==!0&&(o.clearColor=i)),r&&(a|=Nk,r!==!0&&(o.clearDepth=r)),s&&(a|=kk,r!==!0&&(o.clearStencil=r)),le(a!==0,Dk);const l=t.gl;Yn(l,o,()=>{l.clear(a)})}const Us=1,Ei=class Ei extends Oi{constructor(n){var l,c;super({...n,id:n.id||Qi("webgl-device")});m(this,"type","webgl");m(this,"handle");m(this,"features");m(this,"limits");m(this,"info");m(this,"canvasContext");m(this,"lost");m(this,"_resolveContextLost");m(this,"renderPass",null);m(this,"gl");m(this,"debug",!1);m(this,"_canvasSizeInfo",{clientWidth:0,clientHeight:0,devicePixelRatio:1});m(this,"_extensions",{});m(this,"_polyfilled",!1);m(this,"spectorJS");m(this,"_constants");const i=(l=n.gl)==null?void 0:l.device;if(i)throw new Error(`WebGL context already attached to device ${i.id}`);const r=((c=n.gl)==null?void 0:c.canvas)||n.canvas;this.canvasContext=new NN(this,{...n,canvas:r}),this.lost=new Promise(u=>{this._resolveContextLost=u});let s=n.gl||null;if(s||(s=JO(this.canvasContext.canvas,{...n,onContextLost:u=>{var h;return(h=this._resolveContextLost)==null?void 0:h.call(this,{reason:"destroyed",message:"Entered sleep mode, or too many apps or browser tabs are using the GPU."})}})),!s)throw new Error("WebGL context creation failed");this.handle=s,this.gl=s,this.gl.device=this,this.gl._version=2,this.info=GO(this.gl,this._extensions),this.limits=new vN(this.gl),this.features=new yN(this.gl,this._extensions,this.props.disabledFeatures),this.props.initalizeFeatures&&this.features.initializeFeatures(),this.canvasContext.resize();const{enable:o=!0,copyState:a=!1}=n;lE(this.gl,{enable:o,copyState:a,log:(...u)=>U.log(1,...u)()}),n.debug&&(this.gl=VN(this.gl,{...n,throwOnError:!0}),this.debug=!0,U.level=Math.max(U.level,1),U.warn("WebGL debug mode activated. Performance reduced.")()),n.spector&&(this.spectorJS=UN({...this.props,canvas:this.handle.canvas}))}static isSupported(){return typeof WebGL2RenderingContext<"u"}static attach(n){if(n instanceof Ei)return n;if((n==null?void 0:n.device)instanceof Oi)return n.device;if(!Uk(n))throw new Error("Invalid WebGL2RenderingContext");return new Ei({gl:n})}static async create(n={}){var a;U.groupCollapsed(Us,"WebGLDevice created")();const i=[];n.debug&&i.push(zN()),n.spector&&i.push(BN()),typeof n.canvas=="string"&&i.push(vg.pageLoaded);const r=await Promise.allSettled(i);for(const l of r)l.status==="rejected"&&U.error(`Failed to initialize debug libraries ${l.reason}`)();if(U.probe(Us+1,"DOM is loaded")(),(a=n.gl)!=null&&a.device)return U.warn("reattaching existing device")(),Ei.attach(n.gl);const s=new Ei(n),o=`Created ${s.type}${s.debug?" debug":""} context: ${s.info.vendor}, ${s.info.renderer} for canvas: ${s.canvasContext.id}`;return U.probe(Us,o)(),U.table(Us,s.info)(),U.groupEnd(Us)(),s}destroy(){}get isLost(){return this.gl.isContextLost()}getSize(){return[this.gl.drawingBufferWidth,this.gl.drawingBufferHeight]}isTextureFormatSupported(n){return Ig(this.gl,n,this._extensions)}isTextureFormatFilterable(n){return pN(this.gl,n,this._extensions)}isTextureFormatRenderable(n){return gN(this.gl,n,this._extensions)}createCanvasContext(n){throw new Error("WebGL only supports a single canvas")}createBuffer(n){const i=this._getBufferProps(n);return new ri(this,i)}_createTexture(n){return new tn(this,n)}createExternalTexture(n){throw new Error("createExternalTexture() not implemented")}createSampler(n){return new Bd(this,n)}createShader(n){return new YN(this,n)}createFramebuffer(n){return new fo(this,n)}createVertexArray(n){return new Og(this,n)}createTransformFeedback(n){return new Rk(this,n)}createQuerySet(n){return new bk(this,n)}createRenderPipeline(n){return new mk(this,n)}beginRenderPass(n){return new JN(this,n)}createComputePipeline(n){throw new Error("ComputePipeline not supported in WebGL")}beginComputePass(n){throw new Error("ComputePass not supported in WebGL")}createCommandEncoder(n){return new Sk(this,n)}submit(){var n;(n=this.renderPass)==null||n.end(),this.renderPass=null}readPixelsToArrayWebGL(n,i){return Pk(n,i)}readPixelsToBufferWebGL(n,i){return Mk(n,i)}setParametersWebGL(n){gs(this.gl,n)}getParametersWebGL(n){return aE(this.gl,n)}withParametersWebGL(n,i){return Yn(this.gl,n,i)}clearWebGL(n){Bk(this,n)}resetWebGL(){U.warn("WebGLDevice.resetWebGL is deprecated, use only for debugging")(),$O(this.gl)}loseDevice(){var s;let n=!1;const r=this.getExtension("WEBGL_lose_context").WEBGL_lose_context;return r&&(n=!0,r.loseContext()),(s=this._resolveContextLost)==null||s.call(this,{reason:"destroyed",message:"Application triggered context loss"}),n}pushState(){Nu(this.gl)}popState(){Vo(this.gl)}setSpectorMetadata(n,i){n.__SPECTOR_Metadata=i}getGLKey(n,i){i=i||this.gl2||this.gl;const r=Number(n);for(const s in i)if(i[s]===r)return`GL.${s}`;return String(n)}setConstantAttributeWebGL(n,i){const r=this.limits.maxVertexAttributes;this._constants=this._constants||new Array(r).fill(null);const s=this._constants[n];switch(s&&jk(s,i)&&U.info(1,`setConstantAttributeWebGL(${n}) could have been skipped, value unchanged`)(),this._constants[n]=i,i.constructor){case Float32Array:Lk(this,n,i);break;case Int32Array:zk(this,n,i);break;case Uint32Array:Vk(this,n,i);break;default:le(!1)}}getExtension(n){return li(this.gl,n,this._extensions),this._extensions}};m(Ei,"type","webgl");let go=Ei;function Uk(t){return typeof WebGL2RenderingContext<"u"&&t instanceof WebGL2RenderingContext?!0:!!(t&&Number.isFinite(t._version))}function Lk(t,e,n){switch(n.length){case 1:t.gl.vertexAttrib1fv(e,n);break;case 2:t.gl.vertexAttrib2fv(e,n);break;case 3:t.gl.vertexAttrib3fv(e,n);break;case 4:t.gl.vertexAttrib4fv(e,n);break;default:le(!1)}}function zk(t,e,n){t.gl.vertexAttribI4iv(e,n)}function Vk(t,e,n){t.gl.vertexAttribI4uiv(e,n)}function jk(t,e){if(!t||!e||t.length!==e.length||t.constructor!==e.constructor)return!1;for(let n=0;n<t.length;++n)if(t[n]!==e[n])return!1;return!0}var TE={exports:{}};/*! Hammer.JS - v2.0.7 - 2016-04-22
 * http://hammerjs.github.io/
 *
 * Copyright (c) 2016 Jorik Tangelder;
 * Licensed under the MIT license */(function(t){(function(e,n,i,r){var s=["","webkit","Moz","MS","ms","o"],o=n.createElement("div"),a="function",l=Math.round,c=Math.abs,u=Date.now;function h(T,w,x){return setTimeout(_(T,x),w)}function f(T,w,x){return Array.isArray(T)?(d(T,x[w],x),!0):!1}function d(T,w,x){var M;if(T)if(T.forEach)T.forEach(w,x);else if(T.length!==r)for(M=0;M<T.length;)w.call(x,T[M],M,T),M++;else for(M in T)T.hasOwnProperty(M)&&w.call(x,T[M],M,T)}function p(T,w,x){var M="DEPRECATED METHOD: "+w+`
`+x+` AT 
`;return function(){var F=new Error("get-stack-trace"),z=F&&F.stack?F.stack.replace(/^[^\(]+?[\n$]/gm,"").replace(/^\s+at\s+/gm,"").replace(/^Object.<anonymous>\s*\(/gm,"{anonymous}()@"):"Unknown Stack Trace",Z=e.console&&(e.console.warn||e.console.log);return Z&&Z.call(e.console,M,z),T.apply(this,arguments)}}var v;typeof Object.assign!="function"?v=function(w){if(w===r||w===null)throw new TypeError("Cannot convert undefined or null to object");for(var x=Object(w),M=1;M<arguments.length;M++){var F=arguments[M];if(F!==r&&F!==null)for(var z in F)F.hasOwnProperty(z)&&(x[z]=F[z])}return x}:v=Object.assign;var A=p(function(w,x,M){for(var F=Object.keys(x),z=0;z<F.length;)(!M||M&&w[F[z]]===r)&&(w[F[z]]=x[F[z]]),z++;return w},"extend","Use `assign`."),y=p(function(w,x){return A(w,x,!0)},"merge","Use `assign`.");function g(T,w,x){var M=w.prototype,F;F=T.prototype=Object.create(M),F.constructor=T,F._super=M,x&&v(F,x)}function _(T,w){return function(){return T.apply(w,arguments)}}function E(T,w){return typeof T==a?T.apply(w&&w[0]||r,w):T}function R(T,w){return T===r?w:T}function P(T,w,x){d(D(w),function(M){T.addEventListener(M,x,!1)})}function I(T,w,x){d(D(w),function(M){T.removeEventListener(M,x,!1)})}function O(T,w){for(;T;){if(T==w)return!0;T=T.parentNode}return!1}function k(T,w){return T.indexOf(w)>-1}function D(T){return T.trim().split(/\s+/g)}function H(T,w,x){if(T.indexOf&&!x)return T.indexOf(w);for(var M=0;M<T.length;){if(x&&T[M][x]==w||!x&&T[M]===w)return M;M++}return-1}function X(T){return Array.prototype.slice.call(T,0)}function $(T,w,x){for(var M=[],F=[],z=0;z<T.length;){var Z=w?T[z][w]:T[z];H(F,Z)<0&&M.push(T[z]),F[z]=Z,z++}return x&&(w?M=M.sort(function(ke,Ke){return ke[w]>Ke[w]}):M=M.sort()),M}function q(T,w){for(var x,M,F=w[0].toUpperCase()+w.slice(1),z=0;z<s.length;){if(x=s[z],M=x?x+F:w,M in T)return M;z++}return r}var nt=1;function _s(){return nt++}function tr(T){var w=T.ownerDocument||T;return w.defaultView||w.parentWindow||e}var j=/mobile|tablet|ip(ad|hone|od)|android/i,Y="ontouchstart"in e,K=q(e,"PointerEvent")!==r,pe=Y&&j.test(navigator.userAgent),he="touch",nr="pen",bt="mouse",ms="kinect",on=25,Ae=1,di=2,xe=4,it=8,fa=1,ys=2,vs=4,Ts=8,ws=16,jt=ys|vs,pi=Ts|ws,Yg=jt|pi,Kg=["x","y"],da=["clientX","clientY"];function _t(T,w){var x=this;this.manager=T,this.callback=w,this.element=T.element,this.target=T.options.inputTarget,this.domHandler=function(M){E(T.options.enable,[T])&&x.handler(M)},this.init()}_t.prototype={handler:function(){},init:function(){this.evEl&&P(this.element,this.evEl,this.domHandler),this.evTarget&&P(this.target,this.evTarget,this.domHandler),this.evWin&&P(tr(this.element),this.evWin,this.domHandler)},destroy:function(){this.evEl&&I(this.element,this.evEl,this.domHandler),this.evTarget&&I(this.target,this.evTarget,this.domHandler),this.evWin&&I(tr(this.element),this.evWin,this.domHandler)}};function dS(T){var w,x=T.options.inputClass;return x?w=x:K?w=Hu:pe?w=_a:Y?w=$u:w=ga,new w(T,pS)}function pS(T,w,x){var M=x.pointers.length,F=x.changedPointers.length,z=w&Ae&&M-F===0,Z=w&(xe|it)&&M-F===0;x.isFirst=!!z,x.isFinal=!!Z,z&&(T.session={}),x.eventType=w,gS(T,x),T.emit("hammer.input",x),T.recognize(x),T.session.prevInput=x}function gS(T,w){var x=T.session,M=w.pointers,F=M.length;x.firstInput||(x.firstInput=qg(w)),F>1&&!x.firstMultiple?x.firstMultiple=qg(w):F===1&&(x.firstMultiple=!1);var z=x.firstInput,Z=x.firstMultiple,Me=Z?Z.center:z.center,ke=w.center=Zg(M);w.timeStamp=u(),w.deltaTime=w.timeStamp-z.timeStamp,w.angle=Wu(Me,ke),w.distance=pa(Me,ke),_S(x,w),w.offsetDirection=Jg(w.deltaX,w.deltaY);var Ke=Qg(w.deltaTime,w.deltaX,w.deltaY);w.overallVelocityX=Ke.x,w.overallVelocityY=Ke.y,w.overallVelocity=c(Ke.x)>c(Ke.y)?Ke.x:Ke.y,w.scale=Z?vS(Z.pointers,M):1,w.rotation=Z?yS(Z.pointers,M):0,w.maxPointers=x.prevInput?w.pointers.length>x.prevInput.maxPointers?w.pointers.length:x.prevInput.maxPointers:w.pointers.length,mS(x,w);var Ht=T.element;O(w.srcEvent.target,Ht)&&(Ht=w.srcEvent.target),w.target=Ht}function _S(T,w){var x=w.center,M=T.offsetDelta||{},F=T.prevDelta||{},z=T.prevInput||{};(w.eventType===Ae||z.eventType===xe)&&(F=T.prevDelta={x:z.deltaX||0,y:z.deltaY||0},M=T.offsetDelta={x:x.x,y:x.y}),w.deltaX=F.x+(x.x-M.x),w.deltaY=F.y+(x.y-M.y)}function mS(T,w){var x=T.lastInterval||w,M=w.timeStamp-x.timeStamp,F,z,Z,Me;if(w.eventType!=it&&(M>on||x.velocity===r)){var ke=w.deltaX-x.deltaX,Ke=w.deltaY-x.deltaY,Ht=Qg(M,ke,Ke);z=Ht.x,Z=Ht.y,F=c(Ht.x)>c(Ht.y)?Ht.x:Ht.y,Me=Jg(ke,Ke),T.lastInterval=w}else F=x.velocity,z=x.velocityX,Z=x.velocityY,Me=x.direction;w.velocity=F,w.velocityX=z,w.velocityY=Z,w.direction=Me}function qg(T){for(var w=[],x=0;x<T.pointers.length;)w[x]={clientX:l(T.pointers[x].clientX),clientY:l(T.pointers[x].clientY)},x++;return{timeStamp:u(),pointers:w,center:Zg(w),deltaX:T.deltaX,deltaY:T.deltaY}}function Zg(T){var w=T.length;if(w===1)return{x:l(T[0].clientX),y:l(T[0].clientY)};for(var x=0,M=0,F=0;F<w;)x+=T[F].clientX,M+=T[F].clientY,F++;return{x:l(x/w),y:l(M/w)}}function Qg(T,w,x){return{x:w/T||0,y:x/T||0}}function Jg(T,w){return T===w?fa:c(T)>=c(w)?T<0?ys:vs:w<0?Ts:ws}function pa(T,w,x){x||(x=Kg);var M=w[x[0]]-T[x[0]],F=w[x[1]]-T[x[1]];return Math.sqrt(M*M+F*F)}function Wu(T,w,x){x||(x=Kg);var M=w[x[0]]-T[x[0]],F=w[x[1]]-T[x[1]];return Math.atan2(F,M)*180/Math.PI}function yS(T,w){return Wu(w[1],w[0],da)+Wu(T[1],T[0],da)}function vS(T,w){return pa(w[0],w[1],da)/pa(T[0],T[1],da)}var TS={mousedown:Ae,mousemove:di,mouseup:xe},wS="mousedown",ES="mousemove mouseup";function ga(){this.evEl=wS,this.evWin=ES,this.pressed=!1,_t.apply(this,arguments)}g(ga,_t,{handler:function(w){var x=TS[w.type];x&Ae&&w.button===0&&(this.pressed=!0),x&di&&w.which!==1&&(x=xe),this.pressed&&(x&xe&&(this.pressed=!1),this.callback(this.manager,x,{pointers:[w],changedPointers:[w],pointerType:bt,srcEvent:w}))}});var SS={pointerdown:Ae,pointermove:di,pointerup:xe,pointercancel:it,pointerout:it},AS={2:he,3:nr,4:bt,5:ms},Gg="pointerdown",e_="pointermove pointerup pointercancel";e.MSPointerEvent&&!e.PointerEvent&&(Gg="MSPointerDown",e_="MSPointerMove MSPointerUp MSPointerCancel");function Hu(){this.evEl=Gg,this.evWin=e_,_t.apply(this,arguments),this.store=this.manager.session.pointerEvents=[]}g(Hu,_t,{handler:function(w){var x=this.store,M=!1,F=w.type.toLowerCase().replace("ms",""),z=SS[F],Z=AS[w.pointerType]||w.pointerType,Me=Z==he,ke=H(x,w.pointerId,"pointerId");z&Ae&&(w.button===0||Me)?ke<0&&(x.push(w),ke=x.length-1):z&(xe|it)&&(M=!0),!(ke<0)&&(x[ke]=w,this.callback(this.manager,z,{pointers:x,changedPointers:[w],pointerType:Z,srcEvent:w}),M&&x.splice(ke,1))}});var xS={touchstart:Ae,touchmove:di,touchend:xe,touchcancel:it},RS="touchstart",bS="touchstart touchmove touchend touchcancel";function t_(){this.evTarget=RS,this.evWin=bS,this.started=!1,_t.apply(this,arguments)}g(t_,_t,{handler:function(w){var x=xS[w.type];if(x===Ae&&(this.started=!0),!!this.started){var M=CS.call(this,w,x);x&(xe|it)&&M[0].length-M[1].length===0&&(this.started=!1),this.callback(this.manager,x,{pointers:M[0],changedPointers:M[1],pointerType:he,srcEvent:w})}}});function CS(T,w){var x=X(T.touches),M=X(T.changedTouches);return w&(xe|it)&&(x=$(x.concat(M),"identifier",!0)),[x,M]}var PS={touchstart:Ae,touchmove:di,touchend:xe,touchcancel:it},MS="touchstart touchmove touchend touchcancel";function _a(){this.evTarget=MS,this.targetIds={},_t.apply(this,arguments)}g(_a,_t,{handler:function(w){var x=PS[w.type],M=IS.call(this,w,x);M&&this.callback(this.manager,x,{pointers:M[0],changedPointers:M[1],pointerType:he,srcEvent:w})}});function IS(T,w){var x=X(T.touches),M=this.targetIds;if(w&(Ae|di)&&x.length===1)return M[x[0].identifier]=!0,[x,x];var F,z,Z=X(T.changedTouches),Me=[],ke=this.target;if(z=x.filter(function(Ke){return O(Ke.target,ke)}),w===Ae)for(F=0;F<z.length;)M[z[F].identifier]=!0,F++;for(F=0;F<Z.length;)M[Z[F].identifier]&&Me.push(Z[F]),w&(xe|it)&&delete M[Z[F].identifier],F++;if(Me.length)return[$(z.concat(Me),"identifier",!0),Me]}var OS=2500,n_=25;function $u(){_t.apply(this,arguments);var T=_(this.handler,this);this.touch=new _a(this.manager,T),this.mouse=new ga(this.manager,T),this.primaryTouch=null,this.lastTouches=[]}g($u,_t,{handler:function(w,x,M){var F=M.pointerType==he,z=M.pointerType==bt;if(!(z&&M.sourceCapabilities&&M.sourceCapabilities.firesTouchEvents)){if(F)NS.call(this,x,M);else if(z&&kS.call(this,M))return;this.callback(w,x,M)}},destroy:function(){this.touch.destroy(),this.mouse.destroy()}});function NS(T,w){T&Ae?(this.primaryTouch=w.changedPointers[0].identifier,i_.call(this,w)):T&(xe|it)&&i_.call(this,w)}function i_(T){var w=T.changedPointers[0];if(w.identifier===this.primaryTouch){var x={x:w.clientX,y:w.clientY};this.lastTouches.push(x);var M=this.lastTouches,F=function(){var z=M.indexOf(x);z>-1&&M.splice(z,1)};setTimeout(F,OS)}}function kS(T){for(var w=T.srcEvent.clientX,x=T.srcEvent.clientY,M=0;M<this.lastTouches.length;M++){var F=this.lastTouches[M],z=Math.abs(w-F.x),Z=Math.abs(x-F.y);if(z<=n_&&Z<=n_)return!0}return!1}var r_=q(o.style,"touchAction"),s_=r_!==r,o_="compute",a_="auto",Xu="manipulation",gi="none",Es="pan-x",Ss="pan-y",ma=DS();function Yu(T,w){this.manager=T,this.set(w)}Yu.prototype={set:function(T){T==o_&&(T=this.compute()),s_&&this.manager.element.style&&ma[T]&&(this.manager.element.style[r_]=T),this.actions=T.toLowerCase().trim()},update:function(){this.set(this.manager.options.touchAction)},compute:function(){var T=[];return d(this.manager.recognizers,function(w){E(w.options.enable,[w])&&(T=T.concat(w.getTouchAction()))}),FS(T.join(" "))},preventDefaults:function(T){var w=T.srcEvent,x=T.offsetDirection;if(this.manager.session.prevented){w.preventDefault();return}var M=this.actions,F=k(M,gi)&&!ma[gi],z=k(M,Ss)&&!ma[Ss],Z=k(M,Es)&&!ma[Es];if(F){var Me=T.pointers.length===1,ke=T.distance<2,Ke=T.deltaTime<250;if(Me&&ke&&Ke)return}if(!(Z&&z)&&(F||z&&x&jt||Z&&x&pi))return this.preventSrc(w)},preventSrc:function(T){this.manager.session.prevented=!0,T.preventDefault()}};function FS(T){if(k(T,gi))return gi;var w=k(T,Es),x=k(T,Ss);return w&&x?gi:w||x?w?Es:Ss:k(T,Xu)?Xu:a_}function DS(){if(!s_)return!1;var T={},w=e.CSS&&e.CSS.supports;return["auto","manipulation","pan-y","pan-x","pan-x pan-y","none"].forEach(function(x){T[x]=w?e.CSS.supports("touch-action",x):!0}),T}var ya=1,mt=2,ir=4,Mn=8,an=Mn,As=16,Wt=32;function ln(T){this.options=v({},this.defaults,T||{}),this.id=_s(),this.manager=null,this.options.enable=R(this.options.enable,!0),this.state=ya,this.simultaneous={},this.requireFail=[]}ln.prototype={defaults:{},set:function(T){return v(this.options,T),this.manager&&this.manager.touchAction.update(),this},recognizeWith:function(T){if(f(T,"recognizeWith",this))return this;var w=this.simultaneous;return T=va(T,this),w[T.id]||(w[T.id]=T,T.recognizeWith(this)),this},dropRecognizeWith:function(T){return f(T,"dropRecognizeWith",this)?this:(T=va(T,this),delete this.simultaneous[T.id],this)},requireFailure:function(T){if(f(T,"requireFailure",this))return this;var w=this.requireFail;return T=va(T,this),H(w,T)===-1&&(w.push(T),T.requireFailure(this)),this},dropRequireFailure:function(T){if(f(T,"dropRequireFailure",this))return this;T=va(T,this);var w=H(this.requireFail,T);return w>-1&&this.requireFail.splice(w,1),this},hasRequireFailures:function(){return this.requireFail.length>0},canRecognizeWith:function(T){return!!this.simultaneous[T.id]},emit:function(T){var w=this,x=this.state;function M(F){w.manager.emit(F,T)}x<Mn&&M(w.options.event+l_(x)),M(w.options.event),T.additionalEvent&&M(T.additionalEvent),x>=Mn&&M(w.options.event+l_(x))},tryEmit:function(T){if(this.canEmit())return this.emit(T);this.state=Wt},canEmit:function(){for(var T=0;T<this.requireFail.length;){if(!(this.requireFail[T].state&(Wt|ya)))return!1;T++}return!0},recognize:function(T){var w=v({},T);if(!E(this.options.enable,[this,w])){this.reset(),this.state=Wt;return}this.state&(an|As|Wt)&&(this.state=ya),this.state=this.process(w),this.state&(mt|ir|Mn|As)&&this.tryEmit(w)},process:function(T){},getTouchAction:function(){},reset:function(){}};function l_(T){return T&As?"cancel":T&Mn?"end":T&ir?"move":T&mt?"start":""}function c_(T){return T==ws?"down":T==Ts?"up":T==ys?"left":T==vs?"right":""}function va(T,w){var x=w.manager;return x?x.get(T):T}function Ct(){ln.apply(this,arguments)}g(Ct,ln,{defaults:{pointers:1},attrTest:function(T){var w=this.options.pointers;return w===0||T.pointers.length===w},process:function(T){var w=this.state,x=T.eventType,M=w&(mt|ir),F=this.attrTest(T);return M&&(x&it||!F)?w|As:M||F?x&xe?w|Mn:w&mt?w|ir:mt:Wt}});function Ta(){Ct.apply(this,arguments),this.pX=null,this.pY=null}g(Ta,Ct,{defaults:{event:"pan",threshold:10,pointers:1,direction:Yg},getTouchAction:function(){var T=this.options.direction,w=[];return T&jt&&w.push(Ss),T&pi&&w.push(Es),w},directionTest:function(T){var w=this.options,x=!0,M=T.distance,F=T.direction,z=T.deltaX,Z=T.deltaY;return F&w.direction||(w.direction&jt?(F=z===0?fa:z<0?ys:vs,x=z!=this.pX,M=Math.abs(T.deltaX)):(F=Z===0?fa:Z<0?Ts:ws,x=Z!=this.pY,M=Math.abs(T.deltaY))),T.direction=F,x&&M>w.threshold&&F&w.direction},attrTest:function(T){return Ct.prototype.attrTest.call(this,T)&&(this.state&mt||!(this.state&mt)&&this.directionTest(T))},emit:function(T){this.pX=T.deltaX,this.pY=T.deltaY;var w=c_(T.direction);w&&(T.additionalEvent=this.options.event+w),this._super.emit.call(this,T)}});function Ku(){Ct.apply(this,arguments)}g(Ku,Ct,{defaults:{event:"pinch",threshold:0,pointers:2},getTouchAction:function(){return[gi]},attrTest:function(T){return this._super.attrTest.call(this,T)&&(Math.abs(T.scale-1)>this.options.threshold||this.state&mt)},emit:function(T){if(T.scale!==1){var w=T.scale<1?"in":"out";T.additionalEvent=this.options.event+w}this._super.emit.call(this,T)}});function qu(){ln.apply(this,arguments),this._timer=null,this._input=null}g(qu,ln,{defaults:{event:"press",pointers:1,time:251,threshold:9},getTouchAction:function(){return[a_]},process:function(T){var w=this.options,x=T.pointers.length===w.pointers,M=T.distance<w.threshold,F=T.deltaTime>w.time;if(this._input=T,!M||!x||T.eventType&(xe|it)&&!F)this.reset();else if(T.eventType&Ae)this.reset(),this._timer=h(function(){this.state=an,this.tryEmit()},w.time,this);else if(T.eventType&xe)return an;return Wt},reset:function(){clearTimeout(this._timer)},emit:function(T){this.state===an&&(T&&T.eventType&xe?this.manager.emit(this.options.event+"up",T):(this._input.timeStamp=u(),this.manager.emit(this.options.event,this._input)))}});function Zu(){Ct.apply(this,arguments)}g(Zu,Ct,{defaults:{event:"rotate",threshold:0,pointers:2},getTouchAction:function(){return[gi]},attrTest:function(T){return this._super.attrTest.call(this,T)&&(Math.abs(T.rotation)>this.options.threshold||this.state&mt)}});function Qu(){Ct.apply(this,arguments)}g(Qu,Ct,{defaults:{event:"swipe",threshold:10,velocity:.3,direction:jt|pi,pointers:1},getTouchAction:function(){return Ta.prototype.getTouchAction.call(this)},attrTest:function(T){var w=this.options.direction,x;return w&(jt|pi)?x=T.overallVelocity:w&jt?x=T.overallVelocityX:w&pi&&(x=T.overallVelocityY),this._super.attrTest.call(this,T)&&w&T.offsetDirection&&T.distance>this.options.threshold&&T.maxPointers==this.options.pointers&&c(x)>this.options.velocity&&T.eventType&xe},emit:function(T){var w=c_(T.offsetDirection);w&&this.manager.emit(this.options.event+w,T),this.manager.emit(this.options.event,T)}});function wa(){ln.apply(this,arguments),this.pTime=!1,this.pCenter=!1,this._timer=null,this._input=null,this.count=0}g(wa,ln,{defaults:{event:"tap",pointers:1,taps:1,interval:300,time:250,threshold:9,posThreshold:10},getTouchAction:function(){return[Xu]},process:function(T){var w=this.options,x=T.pointers.length===w.pointers,M=T.distance<w.threshold,F=T.deltaTime<w.time;if(this.reset(),T.eventType&Ae&&this.count===0)return this.failTimeout();if(M&&F&&x){if(T.eventType!=xe)return this.failTimeout();var z=this.pTime?T.timeStamp-this.pTime<w.interval:!0,Z=!this.pCenter||pa(this.pCenter,T.center)<w.posThreshold;this.pTime=T.timeStamp,this.pCenter=T.center,!Z||!z?this.count=1:this.count+=1,this._input=T;var Me=this.count%w.taps;if(Me===0)return this.hasRequireFailures()?(this._timer=h(function(){this.state=an,this.tryEmit()},w.interval,this),mt):an}return Wt},failTimeout:function(){return this._timer=h(function(){this.state=Wt},this.options.interval,this),Wt},reset:function(){clearTimeout(this._timer)},emit:function(){this.state==an&&(this._input.tapCount=this.count,this.manager.emit(this.options.event,this._input))}});function cn(T,w){return w=w||{},w.recognizers=R(w.recognizers,cn.defaults.preset),new Ju(T,w)}cn.VERSION="2.0.7",cn.defaults={domEvents:!1,touchAction:o_,enable:!0,inputTarget:null,inputClass:null,preset:[[Zu,{enable:!1}],[Ku,{enable:!1},["rotate"]],[Qu,{direction:jt}],[Ta,{direction:jt},["swipe"]],[wa],[wa,{event:"doubletap",taps:2},["tap"]],[qu]],cssProps:{userSelect:"none",touchSelect:"none",touchCallout:"none",contentZooming:"none",userDrag:"none",tapHighlightColor:"rgba(0,0,0,0)"}};var BS=1,u_=2;function Ju(T,w){this.options=v({},cn.defaults,w||{}),this.options.inputTarget=this.options.inputTarget||T,this.handlers={},this.session={},this.recognizers=[],this.oldCssProps={},this.element=T,this.input=dS(this),this.touchAction=new Yu(this,this.options.touchAction),h_(this,!0),d(this.options.recognizers,function(x){var M=this.add(new x[0](x[1]));x[2]&&M.recognizeWith(x[2]),x[3]&&M.requireFailure(x[3])},this)}Ju.prototype={set:function(T){return v(this.options,T),T.touchAction&&this.touchAction.update(),T.inputTarget&&(this.input.destroy(),this.input.target=T.inputTarget,this.input.init()),this},stop:function(T){this.session.stopped=T?u_:BS},recognize:function(T){var w=this.session;if(!w.stopped){this.touchAction.preventDefaults(T);var x,M=this.recognizers,F=w.curRecognizer;(!F||F&&F.state&an)&&(F=w.curRecognizer=null);for(var z=0;z<M.length;)x=M[z],w.stopped!==u_&&(!F||x==F||x.canRecognizeWith(F))?x.recognize(T):x.reset(),!F&&x.state&(mt|ir|Mn)&&(F=w.curRecognizer=x),z++}},get:function(T){if(T instanceof ln)return T;for(var w=this.recognizers,x=0;x<w.length;x++)if(w[x].options.event==T)return w[x];return null},add:function(T){if(f(T,"add",this))return this;var w=this.get(T.options.event);return w&&this.remove(w),this.recognizers.push(T),T.manager=this,this.touchAction.update(),T},remove:function(T){if(f(T,"remove",this))return this;if(T=this.get(T),T){var w=this.recognizers,x=H(w,T);x!==-1&&(w.splice(x,1),this.touchAction.update())}return this},on:function(T,w){if(T!==r&&w!==r){var x=this.handlers;return d(D(T),function(M){x[M]=x[M]||[],x[M].push(w)}),this}},off:function(T,w){if(T!==r){var x=this.handlers;return d(D(T),function(M){w?x[M]&&x[M].splice(H(x[M],w),1):delete x[M]}),this}},emit:function(T,w){this.options.domEvents&&US(T,w);var x=this.handlers[T]&&this.handlers[T].slice();if(!(!x||!x.length)){w.type=T,w.preventDefault=function(){w.srcEvent.preventDefault()};for(var M=0;M<x.length;)x[M](w),M++}},destroy:function(){this.element&&h_(this,!1),this.handlers={},this.session={},this.input.destroy(),this.element=null}};function h_(T,w){var x=T.element;if(x.style){var M;d(T.options.cssProps,function(F,z){M=q(x.style,z),w?(T.oldCssProps[M]=x.style[M],x.style[M]=F):x.style[M]=T.oldCssProps[M]||""}),w||(T.oldCssProps={})}}function US(T,w){var x=n.createEvent("Event");x.initEvent(T,!0,!0),x.gesture=w,w.target.dispatchEvent(x)}v(cn,{INPUT_START:Ae,INPUT_MOVE:di,INPUT_END:xe,INPUT_CANCEL:it,STATE_POSSIBLE:ya,STATE_BEGAN:mt,STATE_CHANGED:ir,STATE_ENDED:Mn,STATE_RECOGNIZED:an,STATE_CANCELLED:As,STATE_FAILED:Wt,DIRECTION_NONE:fa,DIRECTION_LEFT:ys,DIRECTION_RIGHT:vs,DIRECTION_UP:Ts,DIRECTION_DOWN:ws,DIRECTION_HORIZONTAL:jt,DIRECTION_VERTICAL:pi,DIRECTION_ALL:Yg,Manager:Ju,Input:_t,TouchAction:Yu,TouchInput:_a,MouseInput:ga,PointerEventInput:Hu,TouchMouseInput:$u,SingleTouchInput:t_,Recognizer:ln,AttrRecognizer:Ct,Tap:wa,Pan:Ta,Swipe:Qu,Pinch:Ku,Rotate:Zu,Press:qu,on:P,off:I,each:d,merge:y,extend:A,assign:v,inherit:g,bindFn:_,prefixed:q});var LS=typeof e<"u"?e:typeof self<"u"?self:{};LS.Hammer=cn,typeof r=="function"&&r.amd?r(function(){return cn}):t.exports?t.exports=cn:e[i]=cn})(window,document,"Hammer")})(TE);var ua=TE.exports;const Wk=hu(ua),qt=jS({__proto__:null,default:Wk},[ua]),wE=1,EE=2,Ld=4,Hk={mousedown:wE,mousemove:EE,mouseup:Ld};function $k(t,e){for(let n=0;n<t.length;n++)if(e(t[n]))return!0;return!1}function Xk(t){const e=t.prototype.handler;t.prototype.handler=function(i){const r=this.store;i.button>0&&i.type==="pointerdown"&&($k(r,s=>s.pointerId===i.pointerId)||r.push(i)),e.call(this,i)}}function Yk(t){t.prototype.handler=function(n){let i=Hk[n.type];i&wE&&n.button>=0&&(this.pressed=!0),i&EE&&n.which===0&&(i=Ld),this.pressed&&(i&Ld&&(this.pressed=!1),this.callback(this.manager,i,{pointers:[n],changedPointers:[n],pointerType:"mouse",srcEvent:n}))}}Xk(ua.PointerEventInput);Yk(ua.MouseInput);const Kk=ua.Manager;class Fu{constructor(e,n,i){this.element=e,this.callback=n,this.options={enable:!0,...i}}}const qk=qt?[[qt.Pan,{event:"tripan",pointers:3,threshold:0,enable:!1}],[qt.Rotate,{enable:!1}],[qt.Pinch,{enable:!1}],[qt.Swipe,{enable:!1}],[qt.Pan,{threshold:0,enable:!1}],[qt.Press,{enable:!1}],[qt.Tap,{event:"doubletap",taps:2,enable:!1}],[qt.Tap,{event:"anytap",enable:!1}],[qt.Tap,{enable:!1}]]:null,ny={tripan:["rotate","pinch","pan"],rotate:["pinch"],pinch:["pan"],pan:["press","doubletap","anytap","tap"],doubletap:["anytap"],anytap:["tap"]},Zk={doubletap:["tap"]},Qk={pointerdown:"pointerdown",pointermove:"pointermove",pointerup:"pointerup",touchstart:"pointerdown",touchmove:"pointermove",touchend:"pointerup",mousedown:"pointerdown",mousemove:"pointermove",mouseup:"pointerup"},Ng={KEY_EVENTS:["keydown","keyup"],MOUSE_EVENTS:["mousedown","mousemove","mouseup","mouseover","mouseout","mouseleave"],WHEEL_EVENTS:["wheel","mousewheel"]},Jk={tap:"tap",anytap:"anytap",doubletap:"doubletap",press:"press",pinch:"pinch",pinchin:"pinch",pinchout:"pinch",pinchstart:"pinch",pinchmove:"pinch",pinchend:"pinch",pinchcancel:"pinch",rotate:"rotate",rotatestart:"rotate",rotatemove:"rotate",rotateend:"rotate",rotatecancel:"rotate",tripan:"tripan",tripanstart:"tripan",tripanmove:"tripan",tripanup:"tripan",tripandown:"tripan",tripanleft:"tripan",tripanright:"tripan",tripanend:"tripan",tripancancel:"tripan",pan:"pan",panstart:"pan",panmove:"pan",panup:"pan",pandown:"pan",panleft:"pan",panright:"pan",panend:"pan",pancancel:"pan",swipe:"swipe",swipeleft:"swipe",swiperight:"swipe",swipeup:"swipe",swipedown:"swipe"},iy={click:"tap",anyclick:"anytap",dblclick:"doubletap",mousedown:"pointerdown",mousemove:"pointermove",mouseup:"pointerup",mouseover:"pointerover",mouseout:"pointerout",mouseleave:"pointerleave"},Gk=typeof navigator<"u"&&navigator.userAgent?navigator.userAgent.toLowerCase():"",Or=typeof window<"u"?window:global;let zd=!1;try{const t={get passive(){return zd=!0,!0}};Or.addEventListener("test",null,t),Or.removeEventListener("test",null)}catch{zd=!1}const eF=Gk.indexOf("firefox")!==-1,{WHEEL_EVENTS:tF}=Ng,ry="wheel",sy=4.000244140625,nF=40,iF=.25;class rF extends Fu{constructor(e,n,i){super(e,n,i),this.handleEvent=r=>{if(!this.options.enable)return;let s=r.deltaY;Or.WheelEvent&&(eF&&r.deltaMode===Or.WheelEvent.DOM_DELTA_PIXEL&&(s/=Or.devicePixelRatio),r.deltaMode===Or.WheelEvent.DOM_DELTA_LINE&&(s*=nF)),s!==0&&s%sy===0&&(s=Math.floor(s/sy)),r.shiftKey&&s&&(s=s*iF),this.callback({type:ry,center:{x:r.clientX,y:r.clientY},delta:-s,srcEvent:r,pointerType:"mouse",target:r.target})},this.events=(this.options.events||[]).concat(tF),this.events.forEach(r=>e.addEventListener(r,this.handleEvent,zd?{passive:!1}:!1))}destroy(){this.events.forEach(e=>this.element.removeEventListener(e,this.handleEvent))}enableEventType(e,n){e===ry&&(this.options.enable=n)}}const{MOUSE_EVENTS:sF}=Ng,oy="pointermove",ay="pointerover",ly="pointerout",cy="pointerenter",uy="pointerleave";class oF extends Fu{constructor(e,n,i){super(e,n,i),this.handleEvent=s=>{this.handleOverEvent(s),this.handleOutEvent(s),this.handleEnterEvent(s),this.handleLeaveEvent(s),this.handleMoveEvent(s)},this.pressed=!1;const{enable:r}=this.options;this.enableMoveEvent=r,this.enableLeaveEvent=r,this.enableEnterEvent=r,this.enableOutEvent=r,this.enableOverEvent=r,this.events=(this.options.events||[]).concat(sF),this.events.forEach(s=>e.addEventListener(s,this.handleEvent))}destroy(){this.events.forEach(e=>this.element.removeEventListener(e,this.handleEvent))}enableEventType(e,n){e===oy&&(this.enableMoveEvent=n),e===ay&&(this.enableOverEvent=n),e===ly&&(this.enableOutEvent=n),e===cy&&(this.enableEnterEvent=n),e===uy&&(this.enableLeaveEvent=n)}handleOverEvent(e){this.enableOverEvent&&e.type==="mouseover"&&this._emit(ay,e)}handleOutEvent(e){this.enableOutEvent&&e.type==="mouseout"&&this._emit(ly,e)}handleEnterEvent(e){this.enableEnterEvent&&e.type==="mouseenter"&&this._emit(cy,e)}handleLeaveEvent(e){this.enableLeaveEvent&&e.type==="mouseleave"&&this._emit(uy,e)}handleMoveEvent(e){if(this.enableMoveEvent)switch(e.type){case"mousedown":e.button>=0&&(this.pressed=!0);break;case"mousemove":e.which===0&&(this.pressed=!1),this.pressed||this._emit(oy,e);break;case"mouseup":this.pressed=!1;break}}_emit(e,n){this.callback({type:e,center:{x:n.clientX,y:n.clientY},srcEvent:n,pointerType:"mouse",target:n.target})}}const{KEY_EVENTS:aF}=Ng,hy="keydown",fy="keyup";class lF extends Fu{constructor(e,n,i){super(e,n,i),this.handleEvent=r=>{const s=r.target||r.srcElement;s.tagName==="INPUT"&&s.type==="text"||s.tagName==="TEXTAREA"||(this.enableDownEvent&&r.type==="keydown"&&this.callback({type:hy,srcEvent:r,key:r.key,target:r.target}),this.enableUpEvent&&r.type==="keyup"&&this.callback({type:fy,srcEvent:r,key:r.key,target:r.target}))},this.enableDownEvent=this.options.enable,this.enableUpEvent=this.options.enable,this.events=(this.options.events||[]).concat(aF),e.tabIndex=this.options.tabIndex||0,e.style.outline="none",this.events.forEach(r=>e.addEventListener(r,this.handleEvent))}destroy(){this.events.forEach(e=>this.element.removeEventListener(e,this.handleEvent))}enableEventType(e,n){e===hy&&(this.enableDownEvent=n),e===fy&&(this.enableUpEvent=n)}}const dy="contextmenu";class cF extends Fu{constructor(e,n,i){super(e,n,i),this.handleEvent=r=>{this.options.enable&&this.callback({type:dy,center:{x:r.clientX,y:r.clientY},srcEvent:r,pointerType:"mouse",target:r.target})},e.addEventListener("contextmenu",this.handleEvent)}destroy(){this.element.removeEventListener("contextmenu",this.handleEvent)}enableEventType(e,n){e===dy&&(this.options.enable=n)}}const Vd=1,bc=2,jd=4,uF={pointerdown:Vd,pointermove:bc,pointerup:jd,mousedown:Vd,mousemove:bc,mouseup:jd},hF=1,fF=2,dF=3,pF=0,gF=1,_F=2,mF=1,yF=2,vF=4;function TF(t){const e=uF[t.srcEvent.type];if(!e)return null;const{buttons:n,button:i,which:r}=t.srcEvent;let s=!1,o=!1,a=!1;return e===jd||e===bc&&!Number.isFinite(n)?(s=r===hF,o=r===fF,a=r===dF):e===bc?(s=!!(n&mF),o=!!(n&vF),a=!!(n&yF)):e===Vd&&(s=i===pF,o=i===gF,a=i===_F),{leftButton:s,middleButton:o,rightButton:a}}function wF(t,e){const n=t.center;if(!n)return null;const i=e.getBoundingClientRect(),r=i.width/e.offsetWidth||1,s=i.height/e.offsetHeight||1,o={x:(n.x-i.left-e.clientLeft)/r,y:(n.y-i.top-e.clientTop)/s};return{center:n,offsetCenter:o}}const Gh={srcElement:"root",priority:0};class EF{constructor(e){this.handleEvent=n=>{if(this.isEmpty())return;const i=this._normalizeEvent(n);let r=n.srcEvent.target;for(;r&&r!==i.rootElement;){if(this._emit(i,r),i.handled)return;r=r.parentNode}this._emit(i,"root")},this.eventManager=e,this.handlers=[],this.handlersByElement=new Map,this._active=!1}isEmpty(){return!this._active}add(e,n,i,r=!1,s=!1){const{handlers:o,handlersByElement:a}=this;let l=Gh;typeof i=="string"||i&&i.addEventListener?l={...Gh,srcElement:i}:i&&(l={...Gh,...i});let c=a.get(l.srcElement);c||(c=[],a.set(l.srcElement,c));const u={type:e,handler:n,srcElement:l.srcElement,priority:l.priority};r&&(u.once=!0),s&&(u.passive=!0),o.push(u),this._active=this._active||!u.passive;let h=c.length-1;for(;h>=0&&!(c[h].priority>=u.priority);)h--;c.splice(h+1,0,u)}remove(e,n){const{handlers:i,handlersByElement:r}=this;for(let s=i.length-1;s>=0;s--){const o=i[s];if(o.type===e&&o.handler===n){i.splice(s,1);const a=r.get(o.srcElement);a.splice(a.indexOf(o),1),a.length===0&&r.delete(o.srcElement)}}this._active=i.some(s=>!s.passive)}_emit(e,n){const i=this.handlersByElement.get(n);if(i){let r=!1;const s=()=>{e.handled=!0},o=()=>{e.handled=!0,r=!0},a=[];for(let l=0;l<i.length;l++){const{type:c,handler:u,once:h}=i[l];if(u({...e,type:c,stopPropagation:s,stopImmediatePropagation:o}),h&&a.push(i[l]),r)break}for(let l=0;l<a.length;l++){const{type:c,handler:u}=a[l];this.remove(c,u)}}}_normalizeEvent(e){const n=this.eventManager.getElement();return{...e,...TF(e),...wF(e,n),preventDefault:()=>{e.srcEvent.preventDefault()},stopImmediatePropagation:null,stopPropagation:null,handled:!1,rootElement:n}}}const SF={events:null,recognizers:null,recognizerOptions:{},Manager:Kk,touchAction:"none",tabIndex:0};class AF{constructor(e=null,n){this._onBasicInput=r=>{const{srcEvent:s}=r,o=Qk[s.type];o&&this.manager.emit(o,r)},this._onOtherEvent=r=>{this.manager.emit(r.type,r)},this.options={...SF,...n},this.events=new Map,this.setElement(e);const{events:i}=this.options;i&&this.on(i)}getElement(){return this.element}setElement(e){if(this.element&&this.destroy(),this.element=e,!e)return;const{options:n}=this,i=n.Manager;this.manager=new i(e,{touchAction:n.touchAction,recognizers:n.recognizers||qk}).on("hammer.input",this._onBasicInput),n.recognizers||Object.keys(ny).forEach(r=>{const s=this.manager.get(r);s&&ny[r].forEach(o=>{s.recognizeWith(o)})});for(const r in n.recognizerOptions){const s=this.manager.get(r);if(s){const o=n.recognizerOptions[r];delete o.enable,s.set(o)}}this.wheelInput=new rF(e,this._onOtherEvent,{enable:!1}),this.moveInput=new oF(e,this._onOtherEvent,{enable:!1}),this.keyInput=new lF(e,this._onOtherEvent,{enable:!1,tabIndex:n.tabIndex}),this.contextmenuInput=new cF(e,this._onOtherEvent,{enable:!1});for(const[r,s]of this.events)s.isEmpty()||(this._toggleRecognizer(s.recognizerName,!0),this.manager.on(r,s.handleEvent))}destroy(){this.element&&(this.wheelInput.destroy(),this.moveInput.destroy(),this.keyInput.destroy(),this.contextmenuInput.destroy(),this.manager.destroy(),this.wheelInput=null,this.moveInput=null,this.keyInput=null,this.contextmenuInput=null,this.manager=null,this.element=null)}on(e,n,i){this._addEventHandler(e,n,i,!1)}once(e,n,i){this._addEventHandler(e,n,i,!0)}watch(e,n,i){this._addEventHandler(e,n,i,!1,!0)}off(e,n){this._removeEventHandler(e,n)}_toggleRecognizer(e,n){const{manager:i}=this;if(!i)return;const r=i.get(e);if(r&&r.options.enable!==n){r.set({enable:n});const s=Zk[e];s&&!this.options.recognizers&&s.forEach(o=>{const a=i.get(o);n?(a.requireFailure(e),r.dropRequireFailure(o)):a.dropRequireFailure(e)})}this.wheelInput.enableEventType(e,n),this.moveInput.enableEventType(e,n),this.keyInput.enableEventType(e,n),this.contextmenuInput.enableEventType(e,n)}_addEventHandler(e,n,i,r,s){if(typeof e!="string"){i=n;for(const u in e)this._addEventHandler(u,e[u],i,r,s);return}const{manager:o,events:a}=this,l=iy[e]||e;let c=a.get(l);c||(c=new EF(this),a.set(l,c),c.recognizerName=Jk[l]||l,o&&o.on(l,c.handleEvent)),c.add(e,n,i,r,s),c.isEmpty()||this._toggleRecognizer(c.recognizerName,!0)}_removeEventHandler(e,n){if(typeof e!="string"){for(const o in e)this._removeEventHandler(o,e[o]);return}const{events:i}=this,r=iy[e]||e,s=i.get(r);if(s&&(s.remove(e,n),s.isEmpty())){const{recognizerName:o}=s;let a=!1;for(const l of i.values())if(l.recognizerName===o&&!l.isEmpty()){a=!0;break}a||this._toggleRecognizer(o,!1)}}}function Fn(){}const xF=({isDragging:t})=>t?"grabbing":"grab",py={id:"",width:"100%",height:"100%",style:null,viewState:null,initialViewState:null,pickingRadius:0,layerFilter:null,parameters:{},parent:null,device:null,deviceProps:{type:"webgl"},gl:null,glOptions:{},canvas:null,layers:[],effects:[],views:null,controller:null,useDevicePixels:!0,touchAction:"none",eventRecognizerOptions:{},_framebuffer:null,_animate:!1,_pickable:!0,_typedArrayManagerProps:{},_customRender:null,widgets:[],onDeviceInitialized:Fn,onWebGLInitialized:Fn,onResize:Fn,onViewStateChange:Fn,onInteractionStateChange:Fn,onBeforeRender:Fn,onAfterRender:Fn,onLoad:Fn,onError:t=>Q.error(t.message,t.cause)(),onHover:null,onClick:null,onDragStart:null,onDrag:null,onDragEnd:null,_onMetrics:null,getCursor:xF,getTooltip:null,debug:!1,drawPickingColors:!1},Gc=class Gc{constructor(e){this.width=0,this.height=0,this.userData={},this.device=null,this.canvas=null,this.viewManager=null,this.layerManager=null,this.effectManager=null,this.deckRenderer=null,this.deckPicker=null,this.eventManager=null,this.widgetManager=null,this.tooltip=null,this.animationLoop=null,this.cursorState={isHovering:!1,isDragging:!1},this.stats=new ra({id:"deck.gl"}),this.metrics={fps:0,setPropsTime:0,updateAttributesTime:0,framesRedrawn:0,pickTime:0,pickCount:0,gpuTime:0,gpuTimePerFrame:0,cpuTime:0,cpuTimePerFrame:0,bufferMemory:0,textureMemory:0,renderbufferMemory:0,gpuMemory:0},this._metricsCounter=0,this._needsRedraw="Initial render",this._pickRequest={mode:"hover",x:-1,y:-1,radius:0,event:null},this._lastPointerDownInfo=null,this._onPointerMove=i=>{const{_pickRequest:r}=this;if(i.type==="pointerleave")r.x=-1,r.y=-1,r.radius=0;else{if(i.leftButton||i.rightButton)return;{const s=i.offsetCenter;if(!s)return;r.x=s.x,r.y=s.y,r.radius=this.props.pickingRadius}}this.layerManager&&(this.layerManager.context.mousePosition={x:r.x,y:r.y}),r.event=i},this._onEvent=i=>{const r=Cd[i.type],s=i.offsetCenter;if(!r||!s||!this.layerManager)return;const o=this.layerManager.getLayers(),a=this.deckPicker.getLastPickedObject({x:s.x,y:s.y,layers:o,viewports:this.getViewports(s)},this._lastPointerDownInfo),{layer:l}=a,c=l&&(l[r.handler]||l.props[r.handler]),u=this.props[r.handler];let h=!1;c&&(h=c.call(l,a,i)),h||(u==null||u(a,i),this.widgetManager.onEvent(a,i))},this._onPointerDown=i=>{const r=i.offsetCenter,s=this._pick("pickObject","pickObject Time",{x:r.x,y:r.y,radius:this.props.pickingRadius});this._lastPointerDownInfo=s.result[0]||s.emptyInfo},this.props={...py,...e},e=this.props,e.viewState&&e.initialViewState&&Q.warn("View state tracking is disabled. Use either `initialViewState` for auto update or `viewState` for manual update.")(),this.viewState=this.props.initialViewState,e.device?this.device=e.device:e.gl&&(e.gl instanceof WebGLRenderingContext&&Q.error("WebGL1 context not supported.")(),this.device=go.attach(e.gl));let n=this.device;n||(Ni.registerDevices([go]),n=Ni.createDevice({...e.deviceProps,canvas:this._createCanvas(e)}),n.then(i=>{this.device=i})),this.animationLoop=this._createAnimationLoop(n,e),this.setProps(e),e._typedArrayManagerProps&&os.setOptions(e._typedArrayManagerProps),this.animationLoop.start()}finalize(){var e,n,i,r,s,o,a,l,c,u;(e=this.animationLoop)==null||e.stop(),(n=this.animationLoop)==null||n.destroy(),this.animationLoop=null,this._lastPointerDownInfo=null,(i=this.layerManager)==null||i.finalize(),this.layerManager=null,(r=this.viewManager)==null||r.finalize(),this.viewManager=null,(s=this.effectManager)==null||s.finalize(),this.effectManager=null,(o=this.deckRenderer)==null||o.finalize(),this.deckRenderer=null,(a=this.deckPicker)==null||a.finalize(),this.deckPicker=null,(l=this.eventManager)==null||l.destroy(),this.eventManager=null,(c=this.widgetManager)==null||c.finalize(),this.widgetManager=null,!this.props.canvas&&!this.props.device&&this.canvas&&((u=this.canvas.parentElement)==null||u.removeChild(this.canvas),this.canvas=null)}setProps(e){var i;this.stats.get("setProps Time").timeStart(),"onLayerHover"in e&&Q.removed("onLayerHover","onHover")(),"onLayerClick"in e&&Q.removed("onLayerClick","onClick")(),e.initialViewState&&!Ft(this.props.initialViewState,e.initialViewState,3)&&(this.viewState=e.initialViewState),Object.assign(this.props,e),this._setCanvasSize(this.props);const n=Object.create(this.props);Object.assign(n,{views:this._getViews(),width:this.width,height:this.height,viewState:this._getViewState()}),(i=this.animationLoop)==null||i.setProps(n),this.layerManager&&(this.viewManager.setProps(n),this.layerManager.activateViewport(this.getViewports()[0]),this.layerManager.setProps(n),this.effectManager.setProps(n),this.deckRenderer.setProps(n),this.deckPicker.setProps(n),this.widgetManager.setProps(n)),this.stats.get("setProps Time").timeEnd()}needsRedraw(e={clearRedrawFlags:!1}){if(!this.layerManager)return!1;if(this.props._animate)return"Deck._animate";let n=this._needsRedraw;e.clearRedrawFlags&&(this._needsRedraw=!1);const i=this.viewManager.needsRedraw(e),r=this.layerManager.needsRedraw(e),s=this.effectManager.needsRedraw(e),o=this.deckRenderer.needsRedraw(e);return n=n||i||r||s||o,n}redraw(e){if(!this.layerManager)return;let n=this.needsRedraw({clearRedrawFlags:!0});n=e||n,n&&(this.stats.get("Redraw Count").incrementCount(),this.props._customRender?this.props._customRender(n):this._drawLayers(n))}get isInitialized(){return this.viewManager!==null}getViews(){return Be(this.viewManager),this.viewManager.views}getViewports(e){return Be(this.viewManager),this.viewManager.getViewports(e)}getCanvas(){return this.canvas}pickObject(e){const n=this._pick("pickObject","pickObject Time",e).result;return n.length?n[0]:null}pickMultipleObjects(e){return e.depth=e.depth||10,this._pick("pickObject","pickMultipleObjects Time",e).result}pickObjects(e){return this._pick("pickObjects","pickObjects Time",e)}_addResources(e,n=!1){for(const i in e)this.layerManager.resourceManager.add({resourceId:i,data:e[i],forceUpdate:n})}_removeResources(e){for(const n of e)this.layerManager.resourceManager.remove(n)}_addDefaultEffect(e){this.effectManager.addDefaultEffect(e)}_addDefaultShaderModule(e){this.layerManager.addDefaultShaderModule(e)}_removeDefaultShaderModule(e){var n;(n=this.layerManager)==null||n.removeDefaultShaderModule(e)}_pick(e,n,i){Be(this.deckPicker);const{stats:r}=this;r.get("Pick Count").incrementCount(),r.get(n).timeStart();const s=this.deckPicker[e]({layers:this.layerManager.getLayers(i),views:this.viewManager.getViews(),viewports:this.getViewports(i),onViewportActive:this.layerManager.activateViewport,effects:this.effectManager.getEffects(),...i});return r.get(n).timeEnd(),s}_createCanvas(e){let n=e.canvas;return typeof n=="string"&&(n=document.getElementById(n),Be(n)),n||(n=document.createElement("canvas"),n.id=e.id||"deckgl-overlay",(e.parent||document.body).appendChild(n)),Object.assign(n.style,e.style),n}_setCanvasSize(e){var r;if(!this.canvas)return;const{width:n,height:i}=e;if(n||n===0){const s=Number.isFinite(n)?`${n}px`:n;this.canvas.style.width=s}if(i||i===0){const s=Number.isFinite(i)?`${i}px`:i;this.canvas.style.position=((r=e.style)==null?void 0:r.position)||"absolute",this.canvas.style.height=s}}_updateCanvasSize(){var r,s;const{canvas:e}=this;if(!e)return;const n=e.clientWidth??e.width,i=e.clientHeight??e.height;(n!==this.width||i!==this.height)&&(this.width=n,this.height=i,(r=this.viewManager)==null||r.setProps({width:n,height:i}),(s=this.layerManager)==null||s.activateViewport(this.getViewports()[0]),this.props.onResize({width:n,height:i}))}_createAnimationLoop(e,n){const{gl:i,onError:r,useDevicePixels:s}=n;return new YI({device:e,useDevicePixels:s,autoResizeDrawingBuffer:!i,autoResizeViewport:!1,onInitialize:o=>this._setDevice(o.device),onRender:this._onRenderFrame.bind(this),onError:r})}_getViewState(){return this.props.viewState||this.viewState||{}}_getViews(){const{views:e}=this.props,n=Array.isArray(e)?e:e?[e]:[new Fd({id:"default-view"})];return n.length&&this.props.controller&&(n[0].props.controller=this.props.controller),n}_onContextLost(){const{onError:e}=this.props;this.animationLoop&&e&&e(new Error("WebGL context is lost"))}_pickAndCallback(){var n,i,r;const{_pickRequest:e}=this;if(e.event){const{result:s,emptyInfo:o}=this._pick("pickObject","pickObject Time",e);this.cursorState.isHovering=s.length>0;let a=o,l=!1;for(const c of s)a=c,l=((n=c.layer)==null?void 0:n.onHover(c,e.event))||l;l||((r=(i=this.props).onHover)==null||r.call(i,a,e.event),this.widgetManager.onHover(a,e.event)),e.event=null}}_updateCursor(){const e=this.props.parent||this.canvas;e&&(e.style.cursor=this.props.getCursor(this.cursorState))}_setDevice(e){var r,s;if(this.device=e,!this.animationLoop)return;this.canvas||(this.canvas=(r=this.device.canvasContext)==null?void 0:r.canvas),this.device.setParametersWebGL({blend:!0,blendFunc:[770,771,1,771],polygonOffsetFill:!0,depthTest:!0,depthFunc:515}),this.props.onDeviceInitialized(this.device),this.device instanceof go&&this.props.onWebGLInitialized(this.device.gl);const n=new tE;n.play(),this.animationLoop.attachTimeline(n),this.eventManager=new AF(this.props.parent||this.canvas,{touchAction:this.props.touchAction,recognizerOptions:this.props.eventRecognizerOptions,events:{pointerdown:this._onPointerDown,pointermove:this._onPointerMove,pointerleave:this._onPointerMove}});for(const o in Cd)this.eventManager.on(o,this._onEvent);this.viewManager=new hO({timeline:n,eventManager:this.eventManager,onViewStateChange:this._onViewStateChange.bind(this),onInteractionStateChange:this._onInteractionStateChange.bind(this),views:this._getViews(),viewState:this._getViewState(),width:this.width,height:this.height});const i=this.viewManager.getViewports()[0];this.layerManager=new uO(this.device,{deck:this,stats:this.stats,viewport:i,timeline:n}),this.effectManager=new bO({deck:this,device:this.device}),this.deckRenderer=new MO(this.device),this.deckPicker=new DO(this.device),this.widgetManager=new LO({deck:this,parentElement:(s=this.canvas)==null?void 0:s.parentElement}),this.widgetManager.addDefault(new VO),this.setProps(this.props),this._updateCanvasSize(),this.props.onLoad()}_drawLayers(e,n){var o;const{device:i,gl:r}=this.layerManager.context;this.props.onBeforeRender({device:i,gl:r});const s={target:this.props._framebuffer,layers:this.layerManager.getLayers(),viewports:this.viewManager.getViewports(),onViewportActive:this.layerManager.activateViewport,views:this.viewManager.getViews(),pass:"screen",effects:this.effectManager.getEffects(),...n};(o=this.deckRenderer)==null||o.renderLayers(s),s.pass==="screen"&&this.widgetManager.onRedraw({viewports:s.viewports,layers:s.layers}),this.props.onAfterRender({device:i,gl:r})}_onRenderFrame(){this._getFrameStats(),this._metricsCounter++%60===0&&(this._getMetrics(),this.stats.reset(),Q.table(4,this.metrics)(),this.props._onMetrics&&this.props._onMetrics(this.metrics)),this._updateCanvasSize(),this._updateCursor(),this.layerManager.updateLayers(),this._pickAndCallback(),this.redraw(),this.viewManager&&this.viewManager.updateViewStates()}_onViewStateChange(e){const n=this.props.onViewStateChange(e)||e.viewState;this.viewState&&(this.viewState={...this.viewState,[e.viewId]:n},this.props.viewState||this.viewManager&&this.viewManager.setProps({viewState:this.viewState}))}_onInteractionStateChange(e){this.cursorState.isDragging=e.isDragging||!1,this.props.onInteractionStateChange(e)}_getFrameStats(){const{stats:e}=this;e.get("frameRate").timeEnd(),e.get("frameRate").timeStart();const n=this.animationLoop.stats;e.get("GPU Time").addTime(n.get("GPU Time").lastTiming),e.get("CPU Time").addTime(n.get("CPU Time").lastTiming)}_getMetrics(){const{metrics:e,stats:n}=this;e.fps=n.get("frameRate").getHz(),e.setPropsTime=n.get("setProps Time").time,e.updateAttributesTime=n.get("Update Attributes").time,e.framesRedrawn=n.get("Redraw Count").count,e.pickTime=n.get("pickObject Time").time+n.get("pickMultipleObjects Time").time+n.get("pickObjects Time").time,e.pickCount=n.get("Pick Count").count,e.gpuTime=n.get("GPU Time").time,e.cpuTime=n.get("CPU Time").time,e.gpuTimePerFrame=n.get("GPU Time").getAverageTime(),e.cpuTimePerFrame=n.get("CPU Time").getAverageTime();const i=Ni.stats.get("Memory Usage");e.bufferMemory=i.get("Buffer Memory").count,e.textureMemory=i.get("Texture Memory").count,e.renderbufferMemory=i.get("Renderbuffer Memory").count,e.gpuMemory=i.get("GPU Memory").count}};Gc.defaultProps=py,Gc.VERSION=Fb;let Cc=Gc;function RF(t){switch(t){case"float64":return Float64Array;case"uint8":case"unorm8":return Uint8ClampedArray;default:return mw(t)}}const bF=_w;function tl(t,e){return{attribute:t,format:e.size>1?`${e.type}x${e.size}`:e.type,byteOffset:e.offset||0}}function Ci(t){return t.stride||t.size*t.bytesPerElement}function CF(t,e){return t.type===e.type&&t.size===e.size&&Ci(t)===Ci(e)&&(t.offset||0)===(e.offset||0)}function Wd(t,e){e.offset&&Q.removed("shaderAttribute.offset","vertexOffset, elementOffset")();const n=Ci(t),i=e.vertexOffset!==void 0?e.vertexOffset:t.vertexOffset||0,r=e.elementOffset||0,s=i*n+r*t.bytesPerElement+(t.offset||0);return{...e,offset:s,stride:n}}function PF(t,e){const n=Wd(t,e);return{high:n,low:{...n,offset:n.offset+t.size*4}}}class MF{constructor(e,n,i){this._buffer=null,this.device=e,this.id=n.id||"",this.size=n.size||1;const r=n.logicalType||n.type,s=r==="float64";let{defaultValue:o}=n;o=Number.isFinite(o)?[o]:o||new Array(this.size).fill(0);let a;s?a="float32":!r&&n.isIndexed?a="uint32":a=r||"float32";let l=RF(r||a);this.doublePrecision=s,s&&n.fp64===!1&&(l=Float32Array),this.value=null,this.settings={...n,defaultType:l,defaultValue:o,logicalType:r,type:a,normalized:a.includes("norm"),size:this.size,bytesPerElement:l.BYTES_PER_ELEMENT},this.state={...i,externalBuffer:null,bufferAccessor:this.settings,allocatedValue:null,numInstances:0,bounds:null,constant:!1}}get isConstant(){return this.state.constant}get buffer(){return this._buffer}get byteOffset(){const e=this.getAccessor();return e.vertexOffset?e.vertexOffset*Ci(e):0}get numInstances(){return this.state.numInstances}set numInstances(e){this.state.numInstances=e}delete(){this._buffer&&(this._buffer.delete(),this._buffer=null),os.release(this.state.allocatedValue)}getBuffer(){return this.state.constant?null:this.state.externalBuffer||this._buffer}getValue(e=this.id,n=null){const i={};if(this.state.constant){const r=this.value;if(n){const s=Wd(this.getAccessor(),n),o=s.offset/r.BYTES_PER_ELEMENT,a=s.size||this.size;i[e]=r.subarray(o,o+a)}else i[e]=r}else i[e]=this.getBuffer();return this.doublePrecision&&(this.value instanceof Float64Array?i[`${e}64Low`]=i[e]:i[`${e}64Low`]=new Float32Array(this.size)),i}getBufferLayout(e=this.id,n=null){const i=this.getAccessor(),r=[],s={name:this.id,byteStride:Ci(i),attributes:r};if(this.doublePrecision){const o=PF(i,n||{});r.push(tl(e,{...i,...o.high}),tl(`${e}64Low`,{...i,...o.low}))}else if(n){const o=Wd(i,n);r.push(tl(e,{...i,...o}))}else r.push(tl(e,i));return s}setAccessor(e){this.state.bufferAccessor=e}getAccessor(){return this.state.bufferAccessor}getBounds(){if(this.state.bounds)return this.state.bounds;let e=null;if(this.state.constant&&this.value){const n=Array.from(this.value);e=[n,n]}else{const{value:n,numInstances:i,size:r}=this,s=i*r;if(n&&s&&n.length>=s){const o=new Array(r).fill(1/0),a=new Array(r).fill(-1/0);for(let l=0;l<s;)for(let c=0;c<r;c++){const u=n[l++];u<o[c]&&(o[c]=u),u>a[c]&&(a[c]=u)}e=[o,a]}}return this.state.bounds=e,e}setData(e){const{state:n}=this;let i;ArrayBuffer.isView(e)?i={value:e}:e instanceof de?i={buffer:e}:i=e;const r={...this.settings,...i};if(ArrayBuffer.isView(i.value)){if(!i.type)if(this.doublePrecision&&i.value instanceof Float64Array)r.type="float32";else{const o=bF(i.value);r.type=r.normalized?o.replace("int","norm"):o}r.bytesPerElement=i.value.BYTES_PER_ELEMENT,r.stride=Ci(r)}if(n.bounds=null,i.constant){let s=i.value;if(s=this._normalizeValue(s,[],0),this.settings.normalized&&(s=this.normalizeConstant(s)),!(!n.constant||!this._areValuesEqual(s,this.value)))return!1;n.externalBuffer=null,n.constant=!0,this.value=ArrayBuffer.isView(s)?s:new Float32Array(s)}else if(i.buffer){const s=i.buffer;n.externalBuffer=s,n.constant=!1,this.value=i.value||null}else if(i.value){this._checkExternalBuffer(i);let s=i.value;n.externalBuffer=null,n.constant=!1,this.value=s;let{buffer:o}=this;const a=Ci(r),l=(r.vertexOffset||0)*a;if(this.doublePrecision&&s instanceof Float64Array&&(s=zh(s,r)),this.settings.isIndexed){const u=this.settings.defaultType;s.constructor!==u&&(s=new u(s))}const c=s.byteLength+l+a*2;(!o||o.byteLength<c)&&(o=this._createBuffer(c)),o.write(s,l)}return this.setAccessor(r),!0}updateSubBuffer(e={}){this.state.bounds=null;const n=this.value,{startOffset:i=0,endOffset:r}=e;this.buffer.write(this.doublePrecision&&n instanceof Float64Array?zh(n,{size:this.size,startIndex:i,endIndex:r}):n.subarray(i,r),i*n.BYTES_PER_ELEMENT+this.byteOffset)}allocate(e,n=!1){const{state:i}=this,r=i.allocatedValue,s=os.allocate(r,e+1,{size:this.size,type:this.settings.defaultType,copy:n});this.value=s;const{byteOffset:o}=this;let{buffer:a}=this;return(!a||a.byteLength<s.byteLength+o)&&(a=this._createBuffer(s.byteLength+o),n&&r&&a.write(r instanceof Float64Array?zh(r,this):r,o)),i.allocatedValue=s,i.constant=!1,i.externalBuffer=null,this.setAccessor(this.settings),!0}_checkExternalBuffer(e){const{value:n}=e;if(!ArrayBuffer.isView(n))throw new Error(`Attribute ${this.id} value is not TypedArray`);const i=this.settings.defaultType;let r=!1;if(this.doublePrecision&&(r=n.BYTES_PER_ELEMENT<4),r)throw new Error(`Attribute ${this.id} does not support ${n.constructor.name}`);!(n instanceof i)&&this.settings.normalized&&!("normalized"in e)&&Q.warn(`Attribute ${this.id} is normalized`)()}normalizeConstant(e){switch(this.settings.type){case"snorm8":return new Float32Array(e).map(n=>(n+128)/255*2-1);case"snorm16":return new Float32Array(e).map(n=>(n+32768)/65535*2-1);case"unorm8":return new Float32Array(e).map(n=>n/255);case"unorm16":return new Float32Array(e).map(n=>n/65535);default:return e}}_normalizeValue(e,n,i){const{defaultValue:r,size:s}=this.settings;if(Number.isFinite(e))return n[i]=e,n;if(!e){let o=s;for(;--o>=0;)n[i+o]=r[o];return n}switch(s){case 4:n[i+3]=Number.isFinite(e[3])?e[3]:r[3];case 3:n[i+2]=Number.isFinite(e[2])?e[2]:r[2];case 2:n[i+1]=Number.isFinite(e[1])?e[1]:r[1];case 1:n[i+0]=Number.isFinite(e[0])?e[0]:r[0];break;default:let o=s;for(;--o>=0;)n[i+o]=Number.isFinite(e[o])?e[o]:r[o]}return n}_areValuesEqual(e,n){if(!e||!n)return!1;const{size:i}=this;for(let r=0;r<i;r++)if(e[r]!==n[r])return!1;return!0}_createBuffer(e){var r;this._buffer&&this._buffer.destroy();const{isIndexed:n,type:i}=this.settings;return this._buffer=this.device.createBuffer({...(r=this._buffer)==null?void 0:r.props,id:this.id,usage:n?de.INDEX:de.VERTEX,indexType:n?i:void 0,byteLength:e}),this._buffer}}const gy=[],_y=[];function Du(t,e=0,n=1/0){let i=gy;const r={index:-1,data:t,target:[]};return t?typeof t[Symbol.iterator]=="function"?i=t:t.length>0&&(_y.length=t.length,i=_y):i=gy,(e>0||Number.isFinite(n))&&(i=(Array.isArray(i)?i:Array.from(i)).slice(e,n),r.index=e-1),{iterable:i,objectInfo:r}}function SE(t){return t&&t[Symbol.asyncIterator]}function AE(t,e){const{size:n,stride:i,offset:r,startIndices:s,nested:o}=e,a=t.BYTES_PER_ELEMENT,l=i?i/a:n,c=r?r/a:0,u=Math.floor((t.length-c)/l);return(h,{index:f,target:d})=>{if(!s){const y=f*l+c;for(let g=0;g<n;g++)d[g]=t[y+g];return d}const p=s[f],v=s[f+1]||u;let A;if(o){A=new Array(v-p);for(let y=p;y<v;y++){const g=y*l+c;d=new Array(n);for(let _=0;_<n;_++)d[_]=t[g+_];A[y-p]=d}}else if(l===n)A=t.subarray(p*n+c,v*n+c);else{A=new t.constructor((v-p)*n);let y=0;for(let g=p;g<v;g++){const _=g*l+c;for(let E=0;E<n;E++)A[y++]=t[_+E]}}return A}}const IF=[],Nl=[[0,1/0]];function OF(t,e){if(t===Nl||(e[0]<0&&(e[0]=0),e[0]>=e[1]))return t;const n=[],i=t.length;let r=0;for(let s=0;s<i;s++){const o=t[s];o[1]<e[0]?(n.push(o),r=s+1):o[0]>e[1]?n.push(o):e=[Math.min(o[0],e[0]),Math.max(o[1],e[1])]}return n.splice(r,0,e),n}const NF={interpolation:{duration:0,easing:t=>t},spring:{stiffness:.05,damping:.5}};function xE(t,e){if(!t)return null;Number.isFinite(t)&&(t={type:"interpolation",duration:t});const n=t.type||"interpolation";return{...NF[n],...e,...t,type:n}}class RE extends MF{constructor(e,n){super(e,n,{startIndices:null,lastExternalBuffer:null,binaryValue:null,binaryAccessor:null,needsUpdate:!0,needsRedraw:!1,layoutChanged:!1,updateRanges:Nl}),this.constant=!1,this.settings.update=n.update||(n.accessor?this._autoUpdater:void 0),Object.seal(this.settings),Object.seal(this.state),this._validateAttributeUpdaters()}get startIndices(){return this.state.startIndices}set startIndices(e){this.state.startIndices=e}needsUpdate(){return this.state.needsUpdate}needsRedraw({clearChangedFlags:e=!1}={}){const n=this.state.needsRedraw;return this.state.needsRedraw=n&&!e,n}layoutChanged(){return this.state.layoutChanged}setAccessor(e){var n;(n=this.state).layoutChanged||(n.layoutChanged=!CF(e,this.getAccessor())),super.setAccessor(e)}getUpdateTriggers(){const{accessor:e}=this.settings;return[this.id].concat(typeof e!="function"&&e||[])}supportsTransition(){return!!this.settings.transition}getTransitionSetting(e){if(!e||!this.supportsTransition())return null;const{accessor:n}=this.settings,i=this.settings.transition,r=Array.isArray(n)?e[n.find(s=>e[s])]:e[n];return xE(r,i)}setNeedsUpdate(e=this.id,n){if(this.state.needsUpdate=this.state.needsUpdate||e,this.setNeedsRedraw(e),n){const{startRow:i=0,endRow:r=1/0}=n;this.state.updateRanges=OF(this.state.updateRanges,[i,r])}else this.state.updateRanges=Nl}clearNeedsUpdate(){this.state.needsUpdate=!1,this.state.updateRanges=IF}setNeedsRedraw(e=this.id){this.state.needsRedraw=this.state.needsRedraw||e}allocate(e){const{state:n,settings:i}=this;return i.noAlloc?!1:i.update?(super.allocate(e,n.updateRanges!==Nl),!0):!1}updateBuffer({numInstances:e,data:n,props:i,context:r}){if(!this.needsUpdate())return!1;const{state:{updateRanges:s},settings:{update:o,noAlloc:a}}=this;let l=!0;if(o){for(const[c,u]of s)o.call(r,this,{data:n,startRow:c,endRow:u,props:i,numInstances:e});if(this.value)if(this.constant||!this.buffer||this.buffer.byteLength<this.value.byteLength+this.byteOffset)this.setData({value:this.value,constant:this.constant}),this.constant=!1;else for(const[c,u]of s){const h=Number.isFinite(c)?this.getVertexOffset(c):0,f=Number.isFinite(u)?this.getVertexOffset(u):a||!Number.isFinite(e)?this.value.length:e*this.size;super.updateSubBuffer({startOffset:h,endOffset:f})}this._checkAttributeArray()}else l=!1;return this.clearNeedsUpdate(),this.setNeedsRedraw(),l}setConstantValue(e){return e===void 0||typeof e=="function"?!1:(this.setData({constant:!0,value:e})&&this.setNeedsRedraw(),this.clearNeedsUpdate(),!0)}setExternalBuffer(e){const{state:n}=this;return e?(this.clearNeedsUpdate(),n.lastExternalBuffer===e||(n.lastExternalBuffer=e,this.setNeedsRedraw(),this.setData(e)),!0):(n.lastExternalBuffer=null,!1)}setBinaryValue(e,n=null){const{state:i,settings:r}=this;if(!e)return i.binaryValue=null,i.binaryAccessor=null,!1;if(r.noAlloc)return!1;if(i.binaryValue===e)return this.clearNeedsUpdate(),!0;if(i.binaryValue=e,this.setNeedsRedraw(),r.transform||n!==this.startIndices){ArrayBuffer.isView(e)&&(e={value:e});const o=e;Be(ArrayBuffer.isView(o.value),`invalid ${r.accessor}`);const a=!!o.size&&o.size!==this.size;return i.binaryAccessor=AE(o.value,{size:o.size||this.size,stride:o.stride,offset:o.offset,startIndices:n,nested:a}),!1}return this.clearNeedsUpdate(),this.setData(e),!0}getVertexOffset(e){const{startIndices:n}=this;return(n?e<n.length?n[e]:this.numInstances:e)*this.size}getValue(){const e=this.settings.shaderAttributes,n=super.getValue();if(!e)return n;for(const i in e)Object.assign(n,super.getValue(i,e[i]));return n}getBufferLayout(){this.state.layoutChanged=!1;const e=this.settings.shaderAttributes,n=super.getBufferLayout();if(!e)return n;for(const i in e){const r=super.getBufferLayout(i,e[i]);n.attributes.push(...r.attributes)}return n}_autoUpdater(e,{data:n,startRow:i,endRow:r,props:s,numInstances:o}){if(e.constant)return;const{settings:a,state:l,value:c,size:u,startIndices:h}=e,{accessor:f,transform:d}=a,p=l.binaryAccessor||(typeof f=="function"?f:s[f]);Be(typeof p=="function",`accessor "${f}" is not a function`);let v=e.getVertexOffset(i);const{iterable:A,objectInfo:y}=Du(n,i,r);for(const g of A){y.index++;let _=p(g,y);if(d&&(_=d.call(this,_)),h){const E=(y.index<h.length-1?h[y.index+1]:o)-h[y.index];if(_&&Array.isArray(_[0])){let R=v;for(const P of _)e._normalizeValue(P,c,R),R+=u}else _&&_.length>u?c.set(_,v):(e._normalizeValue(_,y.target,0),sO({target:c,source:y.target,start:v,count:E}));v+=E*u}else e._normalizeValue(_,c,v),v+=u}}_validateAttributeUpdaters(){const{settings:e}=this;if(!(e.noAlloc||typeof e.update=="function"))throw new Error(`Attribute ${this.id} missing update or accessor`)}_checkAttributeArray(){const{value:e}=this,n=Math.min(4,this.size);if(e&&e.length>=n){let i=!0;switch(n){case 4:i=i&&Number.isFinite(e[3]);case 3:i=i&&Number.isFinite(e[2]);case 2:i=i&&Number.isFinite(e[1]);case 1:i=i&&Number.isFinite(e[0]);break;default:i=!1}if(!i)throw new Error(`Illegal attribute generated for ${this.id}`)}}}function ef(t){const{source:e,target:n,start:i=0,size:r,getData:s}=t,o=t.end||n.length,a=e.length,l=o-i;if(a>l){n.set(e.subarray(0,l),i);return}if(n.set(e,i),!s)return;let c=a;for(;c<l;){const u=s(c,e);for(let h=0;h<r;h++)n[i+c]=u[h]||0,c++}}function kF({source:t,target:e,size:n,getData:i,sourceStartIndices:r,targetStartIndices:s}){if(!r||!s)return ef({source:t,target:e,size:n,getData:i}),e;let o=0,a=0;const l=i&&((u,h)=>i(u+a,h)),c=Math.min(r.length,s.length);for(let u=1;u<c;u++){const h=r[u]*n,f=s[u]*n;ef({source:t.subarray(o,h),target:e,start:a,end:f,size:n,getData:l}),o=h,a=f}return a<e.length&&ef({source:[],target:e,start:a,size:n,getData:l}),e}function FF(t){const{device:e,settings:n,value:i}=t,r=new RE(e,n);return r.setData({value:i instanceof Float64Array?new Float64Array(0):new Float32Array(0),normalized:n.normalized}),r}function bE(t){switch(t){case 1:return"float";case 2:return"vec2";case 3:return"vec3";case 4:return"vec4";default:throw new Error(`No defined attribute type for size "${t}"`)}}function CE(t){switch(t){case 1:return"float32";case 2:return"float32x2";case 3:return"float32x3";case 4:return"float32x4";default:throw new Error("invalid type size")}}function PE(t){t.push(t.shift())}function DF(t,e){const{doublePrecision:n,settings:i,value:r,size:s}=t,o=n&&r instanceof Float64Array?2:1;let a=0;const{shaderAttributes:l}=t.settings;if(l)for(const c of Object.values(l))a=Math.max(a,c.vertexOffset??0);return(i.noAlloc?r.length:(e+a)*s)*o}function ME({device:t,source:e,target:n}){return(!n||n.byteLength<e.byteLength)&&(n==null||n.destroy(),n=t.createBuffer({byteLength:e.byteLength,usage:e.usage})),n}function IE({device:t,buffer:e,attribute:n,fromLength:i,toLength:r,fromStartIndices:s,getData:o=a=>a}){const a=n.doublePrecision&&n.value instanceof Float64Array?2:1,l=n.size*a,c=n.byteOffset,u=n.settings.bytesPerElement<4?c/n.settings.bytesPerElement*4:c,h=n.startIndices,f=s&&h,d=n.isConstant;if(!f&&e&&i>=r)return e;const p=n.value instanceof Float64Array?Float32Array:n.value.constructor,v=d?n.value:new p(n.getBuffer().readSyncWebGL(c,r*p.BYTES_PER_ELEMENT).buffer);if(n.settings.normalized&&!d){const _=o;o=(E,R)=>n.normalizeConstant(_(E,R))}const A=d?(_,E)=>o(v,E):(_,E)=>o(v.subarray(_+c,_+c+l),E),y=e?new Float32Array(e.readSyncWebGL(u,i*4).buffer):new Float32Array(0),g=new Float32Array(r);return kF({source:y,target:g,sourceStartIndices:s,targetStartIndices:h,size:l,getData:A}),(!e||e.byteLength<g.byteLength+u)&&(e==null||e.destroy(),e=t.createBuffer({byteLength:g.byteLength+u,usage:35050})),e.write(g,u),e}class OE{constructor({device:e,attribute:n,timeline:i}){this.buffers=[],this.currentLength=0,this.device=e,this.transition=new Ou(i),this.attribute=n,this.attributeInTransition=FF(n),this.currentStartIndices=n.startIndices}get inProgress(){return this.transition.inProgress}start(e,n,i=1/0){this.settings=e,this.currentStartIndices=this.attribute.startIndices,this.currentLength=DF(this.attribute,n),this.transition.start({...e,duration:i})}update(){const e=this.transition.update();return e&&this.onUpdate(),e}setBuffer(e){this.attributeInTransition.setData({buffer:e,normalized:this.attribute.settings.normalized,value:this.attributeInTransition.value})}cancel(){this.transition.cancel()}delete(){this.cancel();for(const e of this.buffers)e.destroy();this.buffers.length=0}}class BF extends OE{constructor({device:e,attribute:n,timeline:i}){super({device:e,attribute:n,timeline:i}),this.type="interpolation",this.transform=LF(e,n)}start(e,n){const i=this.currentLength,r=this.currentStartIndices;if(super.start(e,n,e.duration),e.duration<=0){this.transition.cancel();return}const{buffers:s,attribute:o}=this;PE(s),s[0]=IE({device:this.device,buffer:s[0],attribute:o,fromLength:i,toLength:this.currentLength,fromStartIndices:r,getData:e.enter}),s[1]=ME({device:this.device,source:s[0],target:s[1]}),this.setBuffer(s[1]);const{transform:a}=this,l=a.model;l.setVertexCount(Math.floor(this.currentLength/o.size)),o.isConstant?(l.setAttributes({aFrom:s[0]}),l.setConstantAttributes({aTo:o.value})):l.setAttributes({aFrom:s[0],aTo:o.getBuffer()}),a.transformFeedback.setBuffers({vCurrent:s[1]})}onUpdate(){const{duration:e,easing:n}=this.settings,{time:i}=this.transition;let r=i/e;n&&(r=n(r));const{model:s}=this.transform;s.setUniforms({time:r}),s.device.gl.bindBuffer(34962,null),this.transform.run({discard:!0})}delete(){super.delete(),this.transform.destroy()}}const UF=`#version 300 es
#define SHADER_NAME interpolation-transition-vertex-shader

uniform float time;
in ATTRIBUTE_TYPE aFrom;
in ATTRIBUTE_TYPE aTo;
out ATTRIBUTE_TYPE vCurrent;

void main(void) {
  vCurrent = mix(aFrom, aTo, time);
  gl_Position = vec4(0.0);
}
`;function LF(t,e){const n=bE(e.size);return new Mu(t,{vs:UF,bufferLayout:[{name:"aFrom",format:CE(e.size)},{name:"aTo",format:e.getBufferLayout().attributes[0].format}],defines:{ATTRIBUTE_TYPE:n},varyings:["vCurrent"]})}class zF extends OE{constructor({device:e,attribute:n,timeline:i}){super({device:e,attribute:n,timeline:i}),this.type="spring",this.texture=HF(e),this.framebuffer=$F(e,this.texture),this.transform=WF(e,n)}start(e,n){const i=this.currentLength,r=this.currentStartIndices;super.start(e,n);const{buffers:s,attribute:o}=this;for(let l=0;l<2;l++)s[l]=IE({device:this.device,buffer:s[l],attribute:o,fromLength:i,toLength:this.currentLength,fromStartIndices:r,getData:e.enter});s[2]=ME({device:this.device,source:s[0],target:s[2]}),this.setBuffer(s[1]);const{model:a}=this.transform;a.setVertexCount(Math.floor(this.currentLength/o.size)),o.isConstant?a.setConstantAttributes({aTo:o.value}):a.setAttributes({aTo:o.getBuffer()})}onUpdate(){const{buffers:e,transform:n,framebuffer:i,transition:r}=this,s=this.settings;n.model.setAttributes({aPrev:e[0],aCur:e[1]}),n.transformFeedback.setBuffers({vNext:e[2]}),n.model.setUniforms({stiffness:s.stiffness,damping:s.damping}),n.run({framebuffer:i,discard:!1,parameters:{viewport:[0,0,1,1]},clearColor:[0,0,0,0]}),PE(e),this.setBuffer(e[1]),this.device.readPixelsToArrayWebGL(i)[0]>0||r.end()}delete(){super.delete(),this.transform.destroy(),this.texture.destroy(),this.framebuffer.destroy()}}const VF=`#version 300 es
#define SHADER_NAME spring-transition-vertex-shader

#define EPSILON 0.00001

uniform float stiffness;
uniform float damping;
in ATTRIBUTE_TYPE aPrev;
in ATTRIBUTE_TYPE aCur;
in ATTRIBUTE_TYPE aTo;
out ATTRIBUTE_TYPE vNext;
out float vIsTransitioningFlag;

ATTRIBUTE_TYPE getNextValue(ATTRIBUTE_TYPE cur, ATTRIBUTE_TYPE prev, ATTRIBUTE_TYPE dest) {
  ATTRIBUTE_TYPE velocity = cur - prev;
  ATTRIBUTE_TYPE delta = dest - cur;
  ATTRIBUTE_TYPE spring = delta * stiffness;
  ATTRIBUTE_TYPE damper = velocity * -1.0 * damping;
  return spring + damper + velocity + cur;
}

void main(void) {
  bool isTransitioning = length(aCur - aPrev) > EPSILON || length(aTo - aCur) > EPSILON;
  vIsTransitioningFlag = isTransitioning ? 1.0 : 0.0;

  vNext = getNextValue(aCur, aPrev, aTo);
  gl_Position = vec4(0, 0, 0, 1);
  gl_PointSize = 100.0;
}
`,jF=`#version 300 es
#define SHADER_NAME spring-transition-is-transitioning-fragment-shader

in float vIsTransitioningFlag;

out vec4 fragColor;

void main(void) {
  if (vIsTransitioningFlag == 0.0) {
    discard;
  }
  fragColor = vec4(1.0);
}`;function WF(t,e){const n=bE(e.size),i=CE(e.size);return new Mu(t,{vs:VF,fs:jF,bufferLayout:[{name:"aPrev",format:i},{name:"aCur",format:i},{name:"aTo",format:e.getBufferLayout().attributes[0].format}],varyings:["vNext"],defines:{ATTRIBUTE_TYPE:n},parameters:{depthCompare:"always",blendColorOperation:"max",blendColorSrcFactor:"one",blendColorDstFactor:"one",blendAlphaOperation:"max",blendAlphaSrcFactor:"one",blendAlphaDstFactor:"one"}})}function HF(t){return t.createTexture({data:new Uint8Array(4),format:"rgba8unorm",mipmaps:!1,width:1,height:1})}function $F(t,e){return t.createFramebuffer({id:"spring-transition-is-transitioning-framebuffer",width:1,height:1,colorAttachments:[e]})}const XF={interpolation:BF,spring:zF};class YF{constructor(e,{id:n,timeline:i}){if(!e)throw new Error("AttributeTransitionManager is constructed without device");this.id=n,this.device=e,this.timeline=i,this.transitions={},this.needsRedraw=!1,this.numInstances=1}finalize(){for(const e in this.transitions)this._removeTransition(e)}update({attributes:e,transitions:n,numInstances:i}){this.numInstances=i||1;for(const r in e){const s=e[r],o=s.getTransitionSetting(n);o&&this._updateAttribute(r,s,o)}for(const r in this.transitions){const s=e[r];(!s||!s.getTransitionSetting(n))&&this._removeTransition(r)}}hasAttribute(e){const n=this.transitions[e];return n&&n.inProgress}getAttributes(){const e={};for(const n in this.transitions){const i=this.transitions[n];i.inProgress&&(e[n]=i.attributeInTransition)}return e}run(){if(this.numInstances===0)return!1;for(const n in this.transitions)this.transitions[n].update()&&(this.needsRedraw=!0);const e=this.needsRedraw;return this.needsRedraw=!1,e}_removeTransition(e){this.transitions[e].delete(),delete this.transitions[e]}_updateAttribute(e,n,i){const r=this.transitions[e];let s=!r||r.type!==i.type;if(s){r&&this._removeTransition(e);const o=XF[i.type];o?this.transitions[e]=new o({attribute:n,timeline:this.timeline,device:this.device}):(Q.error(`unsupported transition type '${i.type}'`)(),s=!1)}(s||n.needsRedraw())&&(this.needsRedraw=!0,this.transitions[e].start(i,this.numInstances))}}const my="attributeManager.invalidate",KF="attributeManager.updateStart",qF="attributeManager.updateEnd",ZF="attribute.updateStart",QF="attribute.allocate",JF="attribute.updateEnd";class GF{constructor(e,{id:n="attribute-manager",stats:i,timeline:r}={}){this.mergeBoundsMemoized=aa(DI),this.id=n,this.device=e,this.attributes={},this.updateTriggers={},this.needsRedraw=!0,this.userData={},this.stats=i,this.attributeTransitionManager=new YF(e,{id:`${n}-transitions`,timeline:r}),Object.seal(this)}finalize(){for(const e in this.attributes)this.attributes[e].delete();this.attributeTransitionManager.finalize()}getNeedsRedraw(e={clearRedrawFlags:!1}){const n=this.needsRedraw;return this.needsRedraw=this.needsRedraw&&!e.clearRedrawFlags,n&&this.id}setNeedsRedraw(){this.needsRedraw=!0}add(e){this._add(e)}addInstanced(e){this._add(e,{instanced:1})}remove(e){for(const n of e)this.attributes[n]!==void 0&&(this.attributes[n].delete(),delete this.attributes[n])}invalidate(e,n){const i=this._invalidateTrigger(e,n);He(my,this,e,i)}invalidateAll(e){for(const n in this.attributes)this.attributes[n].setNeedsUpdate(n,e);He(my,this,"all")}update({data:e,numInstances:n,startIndices:i=null,transitions:r,props:s={},buffers:o={},context:a={}}){let l=!1;He(KF,this),this.stats&&this.stats.get("Update Attributes").timeStart();for(const c in this.attributes){const u=this.attributes[c],h=u.settings.accessor;u.startIndices=i,u.numInstances=n,s[c]&&Q.removed(`props.${c}`,`data.attributes.${c}`)(),u.setExternalBuffer(o[c])||u.setBinaryValue(typeof h=="string"?o[h]:void 0,e.startIndices)||typeof h=="string"&&!o[h]&&u.setConstantValue(s[h])||u.needsUpdate()&&(l=!0,this._updateAttribute({attribute:u,numInstances:n,data:e,props:s,context:a})),this.needsRedraw=this.needsRedraw||u.needsRedraw()}l&&He(qF,this,n),this.stats&&this.stats.get("Update Attributes").timeEnd(),this.attributeTransitionManager.update({attributes:this.attributes,numInstances:n,transitions:r})}updateTransition(){const{attributeTransitionManager:e}=this,n=e.run();return this.needsRedraw=this.needsRedraw||n,n}getAttributes(){return{...this.attributes,...this.attributeTransitionManager.getAttributes()}}getBounds(e){const n=e.map(i=>{var r;return(r=this.attributes[i])==null?void 0:r.getBounds()});return this.mergeBoundsMemoized(n)}getChangedAttributes(e={clearChangedFlags:!1}){const{attributes:n,attributeTransitionManager:i}=this,r={...i.getAttributes()};for(const s in n){const o=n[s];o.needsRedraw(e)&&!i.hasAttribute(s)&&(r[s]=o)}return r}getBufferLayouts(e,n={}){e||(e=this.getAttributes());const i=[];for(const r in e)n[r]||i.push(e[r].getBufferLayout());return i}_add(e,n={}){for(const i in e){const r=e[i];this.attributes[i]=this._createAttribute(i,r,n)}this._mapUpdateTriggersToAttributes()}_createAttribute(e,n,i){const r={...n,id:e,size:n.isIndexed&&1||n.size||1,divisor:i.instanced?1:n.divisor||0};return new RE(this.device,r)}_mapUpdateTriggersToAttributes(){const e={};for(const n in this.attributes)this.attributes[n].getUpdateTriggers().forEach(r=>{e[r]||(e[r]=[]),e[r].push(n)});this.updateTriggers=e}_invalidateTrigger(e,n){const{attributes:i,updateTriggers:r}=this,s=r[e];return s&&s.forEach(o=>{const a=i[o];a&&a.setNeedsUpdate(a.id,n)}),s}_updateAttribute(e){const{attribute:n,numInstances:i}=e;if(He(ZF,n),n.constant){n.setConstantValue(n.value);return}n.allocate(i)&&He(QF,n,i),n.updateBuffer(e)&&(this.needsRedraw=!0,He(JF,n,i))}}class eD extends Ou{get value(){return this._value}_onUpdate(){const{time:e,settings:{fromValue:n,toValue:i,duration:r,easing:s}}=this,o=s(e/r);this._value=wc(n,i,o)}}const yy=1e-5;function vy(t,e,n,i,r){const s=e-t,a=(n-e)*r,l=-s*i;return a+l+s+e}function tD(t,e,n,i,r){if(Array.isArray(n)){const s=[];for(let o=0;o<n.length;o++)s[o]=vy(t[o],e[o],n[o],i,r);return s}return vy(t,e,n,i,r)}function Ty(t,e){if(Array.isArray(t)){let n=0;for(let i=0;i<t.length;i++){const r=t[i]-e[i];n+=r*r}return Math.sqrt(n)}return Math.abs(t-e)}class nD extends Ou{get value(){return this._currValue}_onUpdate(){const{fromValue:e,toValue:n,damping:i,stiffness:r}=this.settings,{_prevValue:s=e,_currValue:o=e}=this;let a=tD(s,o,n,i,r);const l=Ty(a,n),c=Ty(a,o);l<yy&&c<yy&&(a=n,this.end()),this._prevValue=o,this._currValue=a}}const iD={interpolation:eD,spring:nD};class rD{constructor(e){this.transitions=new Map,this.timeline=e}get active(){return this.transitions.size>0}add(e,n,i,r){const{transitions:s}=this;if(s.has(e)){const l=s.get(e),{value:c=l.settings.fromValue}=l;n=c,this.remove(e)}if(r=xE(r),!r)return;const o=iD[r.type];if(!o){Q.error(`unsupported transition type '${r.type}'`)();return}const a=new o(this.timeline);a.start({...r,fromValue:n,toValue:i}),s.set(e,a)}remove(e){const{transitions:n}=this;n.has(e)&&(n.get(e).cancel(),n.delete(e))}update(){const e={};for(const[n,i]of this.transitions)i.update(),e[n]=i.value,i.inProgress||this.remove(n);return e}clear(){for(const e of this.transitions.keys())this.remove(e)}}function sD(t){const e=t[ii];for(const n in e){const i=e[n],{validate:r}=i;if(r&&!r(t[n],i))throw new Error(`Invalid prop ${n}: ${t[n]}`)}}function oD(t,e){const n=NE({newProps:t,oldProps:e,propTypes:t[ii],ignoreProps:{data:null,updateTriggers:null,extensions:null,transitions:null}}),i=lD(t,e);let r=!1;return i||(r=cD(t,e)),{dataChanged:i,propsChanged:n,updateTriggersChanged:r,extensionsChanged:uD(t,e),transitionsChanged:aD(t,e)}}function aD(t,e){if(!t.transitions)return!1;const n={},i=t[ii];let r=!1;for(const s in t.transitions){const o=i[s],a=o&&o.type;(a==="number"||a==="color"||a==="array")&&Hd(t[s],e[s],o)&&(n[s]=!0,r=!0)}return r?n:!1}function NE({newProps:t,oldProps:e,ignoreProps:n={},propTypes:i={},triggerName:r="props"}){if(e===t)return!1;if(typeof t!="object"||t===null)return`${r} changed shallowly`;if(typeof e!="object"||e===null)return`${r} changed shallowly`;for(const s of Object.keys(t))if(!(s in n)){if(!(s in e))return`${r}.${s} added`;const o=Hd(t[s],e[s],i[s]);if(o)return`${r}.${s} ${o}`}for(const s of Object.keys(e))if(!(s in n)){if(!(s in t))return`${r}.${s} dropped`;if(!Object.hasOwnProperty.call(t,s)){const o=Hd(t[s],e[s],i[s]);if(o)return`${r}.${s} ${o}`}}return!1}function Hd(t,e,n){let i=n&&n.equal;return i&&!i(t,e,n)||!i&&(i=t&&e&&t.equals,i&&!i.call(t,e))?"changed deeply":!i&&e!==t?"changed shallowly":null}function lD(t,e){if(e===null)return"oldProps is null, initial diff";let n=!1;const{dataComparator:i,_dataDiff:r}=t;return i?i(t.data,e.data)||(n="Data comparator detected a change"):t.data!==e.data&&(n="A new data container was supplied"),n&&r&&(n=r(t.data,e.data)||n),n}function cD(t,e){if(e===null)return{all:!0};if("all"in t.updateTriggers&&wy(t,e,"all"))return{all:!0};const n={};let i=!1;for(const r in t.updateTriggers)r!=="all"&&wy(t,e,r)&&(n[r]=!0,i=!0);return i?n:!1}function uD(t,e){if(e===null)return!0;const n=e.extensions,{extensions:i}=t;if(i===n)return!1;if(!n||!i||i.length!==n.length)return!0;for(let r=0;r<i.length;r++)if(!i[r].equals(n[r]))return!0;return!1}function wy(t,e,n){let i=t.updateTriggers[n];i=i??{};let r=e.updateTriggers[n];return r=r??{},NE({oldProps:r,newProps:i,triggerName:n})}const hD="count(): argument not an object",fD="count(): argument not a container";function dD(t){if(!gD(t))throw new Error(hD);if(typeof t.count=="function")return t.count();if(Number.isFinite(t.size))return t.size;if(Number.isFinite(t.length))return t.length;if(pD(t))return Object.keys(t).length;throw new Error(fD)}function pD(t){return t!==null&&typeof t=="object"&&t.constructor===Object}function gD(t){return t!==null&&typeof t=="object"}function Ey(t,e){if(!e)return t;const n={...t,...e};if("defines"in e&&(n.defines={...t.defines,...e.defines}),"modules"in e&&(n.modules=(t.modules||[]).concat(e.modules),e.modules.some(i=>i.name==="project64"))){const i=n.modules.findIndex(r=>r.name==="project32");i>=0&&n.modules.splice(i,1)}if("inject"in e)if(!t.inject)n.inject=e.inject;else{const i={...t.inject};for(const r in e.inject)i[r]=(i[r]||"")+e.inject[r];n.inject=i}return n}const _D={minFilter:"linear",mipmapFilter:"linear",magFilter:"linear",addressModeU:"clamp-to-edge",addressModeV:"clamp-to-edge"},$d={};function mD(t,e,n,i){if(n instanceof Et)return n;n.constructor&&n.constructor.name!=="Object"&&(n={data:n});let r=null;n.compressed&&(r={minFilter:"linear",mipmapFilter:n.data.length>1?"nearest":"linear"});const s=e.createTexture({...n,sampler:{..._D,...r,...i}});return $d[s.id]=t,s}function yD(t,e){!e||!(e instanceof Et)||$d[e.id]===t&&(e.delete(),delete $d[e.id])}const vD={boolean:{validate(t,e){return!0},equal(t,e,n){return!!t==!!e}},number:{validate(t,e){return Number.isFinite(t)&&(!("max"in e)||t<=e.max)&&(!("min"in e)||t>=e.min)}},color:{validate(t,e){return e.optional&&!t||Xd(t)&&(t.length===3||t.length===4)},equal(t,e,n){return Ft(t,e,1)}},accessor:{validate(t,e){const n=Pc(t);return n==="function"||n===Pc(e.value)},equal(t,e,n){return typeof e=="function"?!0:Ft(t,e,1)}},array:{validate(t,e){return e.optional&&!t||Xd(t)},equal(t,e,n){const{compare:i}=n,r=Number.isInteger(i)?i:i?1:0;return i?Ft(t,e,r):t===e}},object:{equal(t,e,n){if(n.ignore)return!0;const{compare:i}=n,r=Number.isInteger(i)?i:i?1:0;return i?Ft(t,e,r):t===e}},function:{validate(t,e){return e.optional&&!t||typeof t=="function"},equal(t,e,n){return!n.compare&&n.ignore!==!1||t===e}},data:{transform:(t,e,n)=>{if(!t)return t;const{dataTransform:i}=n.props;return i?i(t):typeof t.shape=="string"&&t.shape.endsWith("-table")&&Array.isArray(t.data)?t.data:t}},image:{transform:(t,e,n)=>{const i=n.context;return!i||!i.device?null:mD(n.id,i.device,t,{...e.parameters,...n.props.textureParameters})},release:(t,e,n)=>{yD(n.id,t)}}};function TD(t){const e={},n={},i={};for(const[r,s]of Object.entries(t)){const o=s==null?void 0:s.deprecatedFor;if(o)i[r]=Array.isArray(o)?o:[o];else{const a=wD(r,s);e[r]=a,n[r]=a.value}}return{propTypes:e,defaultProps:n,deprecatedProps:i}}function wD(t,e){switch(Pc(e)){case"object":return Ls(t,e);case"array":return Ls(t,{type:"array",value:e,compare:!1});case"boolean":return Ls(t,{type:"boolean",value:e});case"number":return Ls(t,{type:"number",value:e});case"function":return Ls(t,{type:"function",value:e,compare:!0});default:return{name:t,type:"unknown",value:e}}}function Ls(t,e){return"type"in e?{name:t,...vD[e.type],...e}:"value"in e?{name:t,type:Pc(e.value),...e}:{name:t,type:"object",value:e}}function Xd(t){return Array.isArray(t)||ArrayBuffer.isView(t)}function Pc(t){return Xd(t)?"array":t===null?"null":typeof t}function ED(t,e){let n;for(let s=e.length-1;s>=0;s--){const o=e[s];"extensions"in o&&(n=o.extensions)}const i=Yd(t.constructor,n),r=Object.create(i);r[xc]=t,r[Wi]={},r[Xn]={};for(let s=0;s<e.length;++s){const o=e[s];for(const a in o)r[a]=o[a]}return Object.freeze(r),r}const SD="_mergedDefaultProps";function Yd(t,e){let n=SD;if(e)for(const r of e){const s=r.constructor;s&&(n+=`:${s.extensionName||s.name}`)}const i=kE(t,n);return i||(t[n]=AD(t,e||[]))}function AD(t,e){if(!t.prototype)return null;const i=Object.getPrototypeOf(t),r=Yd(i),s=kE(t,"defaultProps")||{},o=TD(s),a=Object.assign(Object.create(null),r,o.defaultProps),l=Object.assign(Object.create(null),r==null?void 0:r[ii],o.propTypes),c=Object.assign(Object.create(null),r==null?void 0:r[Wh],o.deprecatedProps);for(const u of e){const h=Yd(u.constructor);h&&(Object.assign(a,h),Object.assign(l,h[ii]),Object.assign(c,h[Wh]))}return xD(a,t),bD(a,l),RD(a,c),a[ii]=l,a[Wh]=c,e.length===0&&!kg(t,"_propTypes")&&(t._propTypes=l),a}function xD(t,e){const n=PD(e);Object.defineProperties(t,{id:{writable:!0,value:n}})}function RD(t,e){for(const n in e)Object.defineProperty(t,n,{enumerable:!1,set(i){const r=`${this.id}: ${n}`;for(const s of e[n])kg(this,s)||(this[s]=i);Q.deprecated(r,e[n].join("/"))()}})}function bD(t,e){const n={},i={};for(const r in e){const s=e[r],{name:o,value:a}=s;s.async&&(n[o]=a,i[o]=CD(o))}t[Xr]=n,t[Wi]={},Object.defineProperties(t,i)}function CD(t){return{enumerable:!0,set(e){typeof e=="string"||e instanceof Promise||SE(e)?this[Wi][t]=e:this[Xn][t]=e},get(){if(this[Xn]){if(t in this[Xn])return this[Xn][t]||this[Xr][t];if(t in this[Wi]){const e=this[xc]&&this[xc].internalState;if(e&&e.hasAsyncProp(t))return e.getAsyncProp(t)||this[Xr][t]}}return this[Xr][t]}}}function kg(t,e){return Object.prototype.hasOwnProperty.call(t,e)}function kE(t,e){return kg(t,e)&&t[e]}function PD(t){const e=t.componentName;return e||Q.warn(`${t.name}.componentName not specified`)(),e||t.name}let MD=0;const eu=class eu{constructor(...e){this.props=ED(this,e),this.id=this.props.id,this.count=MD++}clone(e){const{props:n}=this,i={};for(const r in n[Xr])r in n[Xn]?i[r]=n[Xn][r]:r in n[Wi]&&(i[r]=n[Wi][r]);return new this.constructor({...n,...i,...e})}};eu.componentName="Component",eu.defaultProps={};let Kd=eu;const ID=Object.freeze({});class OD{constructor(e){this.component=e,this.asyncProps={},this.onAsyncPropUpdated=()=>{},this.oldProps=null,this.oldAsyncProps=null}finalize(){for(const e in this.asyncProps){const n=this.asyncProps[e];n&&n.type&&n.type.release&&n.type.release(n.resolvedValue,n.type,this.component)}this.asyncProps={},this.component=null,this.resetOldProps()}getOldProps(){return this.oldAsyncProps||this.oldProps||ID}resetOldProps(){this.oldAsyncProps=null,this.oldProps=this.component?this.component.props:null}hasAsyncProp(e){return e in this.asyncProps}getAsyncProp(e){const n=this.asyncProps[e];return n&&n.resolvedValue}isAsyncPropLoading(e){if(e){const n=this.asyncProps[e];return!!(n&&n.pendingLoadCount>0&&n.pendingLoadCount!==n.resolvedLoadCount)}for(const n in this.asyncProps)if(this.isAsyncPropLoading(n))return!0;return!1}reloadAsyncProp(e,n){this._watchPromise(e,Promise.resolve(n))}setAsyncProps(e){this.component=e[xc]||this.component;const n=e[Xn]||{},i=e[Wi]||e,r=e[Xr]||{};for(const s in n){const o=n[s];this._createAsyncPropData(s,r[s]),this._updateAsyncProp(s,o),n[s]=this.getAsyncProp(s)}for(const s in i){const o=i[s];this._createAsyncPropData(s,r[s]),this._updateAsyncProp(s,o)}}_fetch(e,n){return null}_onResolve(e,n){}_onError(e,n){}_updateAsyncProp(e,n){if(this._didAsyncInputValueChange(e,n)){if(typeof n=="string"&&(n=this._fetch(e,n)),n instanceof Promise){this._watchPromise(e,n);return}if(SE(n)){this._resolveAsyncIterable(e,n);return}this._setPropValue(e,n)}}_freezeAsyncOldProps(){if(!this.oldAsyncProps&&this.oldProps){this.oldAsyncProps=Object.create(this.oldProps);for(const e in this.asyncProps)Object.defineProperty(this.oldAsyncProps,e,{enumerable:!0,value:this.oldProps[e]})}}_didAsyncInputValueChange(e,n){const i=this.asyncProps[e];return n===i.resolvedValue||n===i.lastValue?!1:(i.lastValue=n,!0)}_setPropValue(e,n){this._freezeAsyncOldProps();const i=this.asyncProps[e];i&&(n=this._postProcessValue(i,n),i.resolvedValue=n,i.pendingLoadCount++,i.resolvedLoadCount=i.pendingLoadCount)}_setAsyncPropValue(e,n,i){const r=this.asyncProps[e];r&&i>=r.resolvedLoadCount&&n!==void 0&&(this._freezeAsyncOldProps(),r.resolvedValue=n,r.resolvedLoadCount=i,this.onAsyncPropUpdated(e,n))}_watchPromise(e,n){const i=this.asyncProps[e];if(i){i.pendingLoadCount++;const r=i.pendingLoadCount;n.then(s=>{this.component&&(s=this._postProcessValue(i,s),this._setAsyncPropValue(e,s,r),this._onResolve(e,s))}).catch(s=>{this._onError(e,s)})}}async _resolveAsyncIterable(e,n){if(e!=="data"){this._setPropValue(e,n);return}const i=this.asyncProps[e];if(!i)return;i.pendingLoadCount++;const r=i.pendingLoadCount;let s=[],o=0;for await(const a of n){if(!this.component)return;const{dataTransform:l}=this.component.props;l?s=l(a,s):s=s.concat(a),Object.defineProperty(s,"__diff",{enumerable:!1,value:[{startRow:o,endRow:s.length}]}),o=s.length,this._setAsyncPropValue(e,s,r)}this._onResolve(e,s)}_postProcessValue(e,n){const i=e.type;return i&&this.component&&(i.release&&i.release(e.resolvedValue,i,this.component),i.transform)?i.transform(n,i,this.component):n}_createAsyncPropData(e,n){if(!this.asyncProps[e]){const r=this.component&&this.component.props[ii];this.asyncProps[e]={type:r&&r[e],lastValue:null,resolvedValue:n,pendingLoadCount:0,resolvedLoadCount:0}}}}class ND extends OD{constructor({attributeManager:e,layer:n}){super(n),this.attributeManager=e,this.needsRedraw=!0,this.needsUpdate=!0,this.subLayers=null,this.usesPickingColorCache=!1}get layer(){return this.component}_fetch(e,n){const i=this.layer,r=i==null?void 0:i.props.fetch;return r?r(n,{propName:e,layer:i}):super._fetch(e,n)}_onResolve(e,n){const i=this.layer;if(i){const r=i.props.onDataLoad;e==="data"&&r&&r(n,{propName:e,layer:i})}}_onError(e,n){const i=this.layer;i&&i.raiseError(n,`loading ${e} of ${this.layer}`)}}const kD="layer.changeFlag",FD="layer.initialize",DD="layer.update",BD="layer.finalize",UD="layer.matched",Sy=2**24-1,LD=Object.freeze([]),zD=aa(({oldViewport:t,viewport:e})=>t.equals(e));let Zt=new Uint8ClampedArray(0);const VD={data:{type:"data",value:LD,async:!0},dataComparator:{type:"function",value:null,optional:!0},_dataDiff:{type:"function",value:t=>t&&t.__diff,optional:!0},dataTransform:{type:"function",value:null,optional:!0},onDataLoad:{type:"function",value:null,optional:!0},onError:{type:"function",value:null,optional:!0},fetch:{type:"function",value:(t,{propName:e,layer:n,loaders:i,loadOptions:r,signal:s})=>{const{resourceManager:o}=n.context;r=r||n.getLoadOptions(),i=i||n.props.loaders,s&&(r={...r,fetch:{...r==null?void 0:r.fetch,signal:s}});let a=o.contains(t);return!a&&!r&&(o.add({resourceId:t,data:fc(t,i),persistent:!1}),a=!0),a?o.subscribe({resourceId:t,onChange:l=>{var c;return(c=n.internalState)==null?void 0:c.reloadAsyncProp(e,l)},consumerId:n.id,requestId:e}):fc(t,i,r)}},updateTriggers:{},visible:!0,pickable:!1,opacity:{type:"number",min:0,max:1,value:1},operation:"draw",onHover:{type:"function",value:null,optional:!0},onClick:{type:"function",value:null,optional:!0},onDragStart:{type:"function",value:null,optional:!0},onDrag:{type:"function",value:null,optional:!0},onDragEnd:{type:"function",value:null,optional:!0},coordinateSystem:ee.DEFAULT,coordinateOrigin:{type:"array",value:[0,0,0],compare:!0},modelMatrix:{type:"array",value:null,compare:!0,optional:!0},wrapLongitude:!1,positionFormat:"XYZ",colorFormat:"RGBA",parameters:{type:"object",value:{},optional:!0,compare:2},loadOptions:{type:"object",value:null,optional:!0,ignore:!0},transitions:null,extensions:[],loaders:{type:"array",value:[],optional:!0,ignore:!0},getPolygonOffset:{type:"function",value:({layerIndex:t})=>[0,-t*100]},highlightedObjectIndex:null,autoHighlight:!1,highlightColor:{type:"accessor",value:[0,0,128,128]}},tu=class tu extends Kd{constructor(){super(...arguments),this.internalState=null,this.lifecycle=pr.NO_STATE,this.parent=null}static get componentName(){return Object.prototype.hasOwnProperty.call(this,"layerName")?this.layerName:""}get root(){let e=this;for(;e.parent;)e=e.parent;return e}toString(){return`${this.constructor.layerName||this.constructor.name}({id: '${this.props.id}'})`}project(e){Be(this.internalState);const n=this.internalState.viewport||this.context.viewport,i=eE(e,{viewport:n,modelMatrix:this.props.modelMatrix,coordinateOrigin:this.props.coordinateOrigin,coordinateSystem:this.props.coordinateSystem}),[r,s,o]=Qw(i,n.pixelProjectionMatrix);return e.length===2?[r,s]:[r,s,o]}unproject(e){return Be(this.internalState),(this.internalState.viewport||this.context.viewport).unproject(e)}projectPosition(e,n){Be(this.internalState);const i=this.internalState.viewport||this.context.viewport;return jI(e,{viewport:i,modelMatrix:this.props.modelMatrix,coordinateOrigin:this.props.coordinateOrigin,coordinateSystem:this.props.coordinateSystem,...n})}get isComposite(){return!1}setState(e){this.setChangeFlags({stateChanged:!0}),Object.assign(this.state,e),this.setNeedsRedraw()}setNeedsRedraw(){this.internalState&&(this.internalState.needsRedraw=!0)}setNeedsUpdate(){this.internalState&&(this.context.layerManager.setNeedsUpdate(String(this)),this.internalState.needsUpdate=!0)}get isLoaded(){return this.internalState?!this.internalState.isAsyncPropLoading():!1}get wrapLongitude(){return this.props.wrapLongitude}isPickable(){return this.props.pickable&&this.props.visible}getModels(){const e=this.state;return e&&(e.models||e.model&&[e.model])||[]}setModuleParameters(e){for(const n of this.getModels())n.updateModuleSettings(e)}setShaderModuleProps(...e){for(const n of this.getModels())n.shaderInputs.setProps(...e)}getAttributeManager(){return this.internalState&&this.internalState.attributeManager}getCurrentLayer(){return this.internalState&&this.internalState.layer}getLoadOptions(){return this.props.loadOptions}use64bitPositions(){const{coordinateSystem:e}=this.props;return e===ee.DEFAULT||e===ee.LNGLAT||e===ee.CARTESIAN}onHover(e,n){return this.props.onHover&&this.props.onHover(e,n)||!1}onClick(e,n){return this.props.onClick&&this.props.onClick(e,n)||!1}nullPickingColor(){return[0,0,0]}encodePickingColor(e,n=[]){return n[0]=e+1&255,n[1]=e+1>>8&255,n[2]=e+1>>8>>8&255,n}decodePickingColor(e){Be(e instanceof Uint8Array);const[n,i,r]=e;return n+i*256+r*65536-1}getNumInstances(){return Number.isFinite(this.props.numInstances)?this.props.numInstances:this.state&&this.state.numInstances!==void 0?this.state.numInstances:dD(this.props.data)}getStartIndices(){return this.props.startIndices?this.props.startIndices:this.state&&this.state.startIndices?this.state.startIndices:null}getBounds(){var e;return(e=this.getAttributeManager())==null?void 0:e.getBounds(["positions","instancePositions"])}getShaders(e){e=Ey(e,{disableWarnings:!0,modules:this.context.defaultShaderModules});for(const n of this.props.extensions)e=Ey(e,n.getShaders.call(this,n));return e}shouldUpdateState(e){return e.changeFlags.propsOrDataChanged}updateState(e){const n=this.getAttributeManager(),{dataChanged:i}=e.changeFlags;if(i&&n)if(Array.isArray(i))for(const r of i)n.invalidateAll(r);else n.invalidateAll();if(n){const{props:r}=e,s=this.internalState.hasPickingBuffer,o=Number.isInteger(r.highlightedObjectIndex)||r.pickable||r.extensions.some(a=>a.getNeedsPickingBuffer.call(this,a));if(s!==o){this.internalState.hasPickingBuffer=o;const{pickingColors:a,instancePickingColors:l}=n.attributes,c=a||l;c&&(o&&c.constant&&(c.constant=!1,n.invalidate(c.id)),!c.value&&!o&&(c.constant=!0,c.value=[0,0,0]))}}}finalizeState(e){for(const i of this.getModels())i.destroy();const n=this.getAttributeManager();n&&n.finalize(),this.context&&this.context.resourceManager.unsubscribe({consumerId:this.id}),this.internalState&&(this.internalState.uniformTransitions.clear(),this.internalState.finalize())}draw(e){for(const n of this.getModels())n.draw(e)}getPickingInfo({info:e,mode:n,sourceLayer:i}){const{index:r}=e;return r>=0&&Array.isArray(this.props.data)&&(e.object=this.props.data[r]),e}raiseError(e,n){var i,r,s,o;n&&(e=new Error(`${n}: ${e.message}`,{cause:e})),(r=(i=this.props).onError)!=null&&r.call(i,e)||(o=(s=this.context)==null?void 0:s.onError)==null||o.call(s,e,this)}getNeedsRedraw(e={clearRedrawFlags:!1}){return this._getNeedsRedraw(e)}needsUpdate(){return this.internalState?this.internalState.needsUpdate||this.hasUniformTransition()||this.shouldUpdateState(this._getUpdateParams()):!1}hasUniformTransition(){var e;return((e=this.internalState)==null?void 0:e.uniformTransitions.active)||!1}activateViewport(e){if(!this.internalState)return;const n=this.internalState.viewport;this.internalState.viewport=e,(!n||!zD({oldViewport:n,viewport:e}))&&(this.setChangeFlags({viewportChanged:!0}),this.isComposite?this.needsUpdate()&&this.setNeedsUpdate():this._update())}invalidateAttribute(e="all"){const n=this.getAttributeManager();n&&(e==="all"?n.invalidateAll():n.invalidate(e))}updateAttributes(e){let n=!1;for(const i in e)e[i].layoutChanged()&&(n=!0);for(const i of this.getModels())this._setModelAttributes(i,e,n)}_updateAttributes(){const e=this.getAttributeManager();if(!e)return;const n=this.props,i=this.getNumInstances(),r=this.getStartIndices();e.update({data:n.data,numInstances:i,startIndices:r,props:n,transitions:n.transitions,buffers:n.data.attributes,context:this});const s=e.getChangedAttributes({clearChangedFlags:!0});this.updateAttributes(s)}_updateAttributeTransition(){const e=this.getAttributeManager();e&&e.updateTransition()}_updateUniformTransition(){const{uniformTransitions:e}=this.internalState;if(e.active){const n=e.update(),i=Object.create(this.props);for(const r in n)Object.defineProperty(i,r,{value:n[r]});return i}return this.props}calculateInstancePickingColors(e,{numInstances:n}){if(e.constant)return;const i=Math.floor(Zt.length/4);if(this.internalState.usesPickingColorCache=!0,i<n){n>Sy&&Q.warn("Layer has too many data objects. Picking might not be able to distinguish all objects.")(),Zt=os.allocate(Zt,n,{size:4,copy:!0,maxCount:Math.max(n,Sy)});const r=Math.floor(Zt.length/4),s=[];for(let o=i;o<r;o++)this.encodePickingColor(o,s),Zt[o*4+0]=s[0],Zt[o*4+1]=s[1],Zt[o*4+2]=s[2]}e.value=Zt.subarray(0,n*4)}_setModelAttributes(e,n,i=!1){var a;if(!Object.keys(n).length)return;if(i){const l=this.getAttributeManager();e.setBufferLayout(l.getBufferLayouts()),n=l.getAttributes()}const r=((a=e.userData)==null?void 0:a.excludeAttributes)||{},s={},o={};for(const l in n){if(r[l])continue;const c=n[l].getValue();for(const u in c){const h=c[u];h instanceof de?n[l].settings.isIndexed?e.setIndexBuffer(h):s[u]=h:h&&(o[u]=h)}}e.setAttributes(s),e.setConstantAttributes(o)}disablePickingIndex(e){const n=this.props.data;if(!("attributes"in n)){this._disablePickingIndex(e);return}const{pickingColors:i,instancePickingColors:r}=this.getAttributeManager().attributes,s=i||r,o=s&&n.attributes&&n.attributes[s.id];if(o&&o.value){const a=o.value,l=this.encodePickingColor(e);for(let c=0;c<n.length;c++){const u=s.getVertexOffset(c);a[u]===l[0]&&a[u+1]===l[1]&&a[u+2]===l[2]&&this._disablePickingIndex(c)}}else this._disablePickingIndex(e)}_disablePickingIndex(e){const{pickingColors:n,instancePickingColors:i}=this.getAttributeManager().attributes,r=n||i;if(!r)return;const s=r.getVertexOffset(e),o=r.getVertexOffset(e+1);r.buffer.write(new Uint8Array(o-s),s)}restorePickingColors(){const{pickingColors:e,instancePickingColors:n}=this.getAttributeManager().attributes,i=e||n;i&&(this.internalState.usesPickingColorCache&&i.value.buffer!==Zt.buffer&&(i.value=Zt.subarray(0,i.value.length)),i.updateSubBuffer({startOffset:0}))}_initialize(){Be(!this.internalState),Be(Number.isFinite(this.props.coordinateSystem)),He(FD,this);const e=this._getAttributeManager();e&&e.addInstanced({instancePickingColors:{type:"uint8",size:4,noAlloc:!0,update:this.calculateInstancePickingColors}}),this.internalState=new ND({attributeManager:e,layer:this}),this._clearChangeFlags(),this.state={},Object.defineProperty(this.state,"attributeManager",{get:()=>(Q.deprecated("layer.state.attributeManager","layer.getAttributeManager()")(),e)}),this.internalState.uniformTransitions=new rD(this.context.timeline),this.internalState.onAsyncPropUpdated=this._onAsyncPropUpdated.bind(this),this.internalState.setAsyncProps(this.props),this.initializeState(this.context);for(const n of this.props.extensions)n.initializeState.call(this,this.context,n);this.setChangeFlags({dataChanged:"init",propsChanged:"init",viewportChanged:!0,extensionsChanged:!0}),this._update()}_transferState(e){He(UD,this,this===e);const{state:n,internalState:i}=e;this!==e&&(this.internalState=i,this.state=n,this.internalState.setAsyncProps(this.props),this._diffProps(this.props,this.internalState.getOldProps()))}_update(){const e=this.needsUpdate();if(He(DD,this,e),!e)return;const n=this.props,i=this.context,r=this.internalState,s=i.viewport,o=this._updateUniformTransition();r.propsInTransition=o,i.viewport=r.viewport||s,this.props=o;try{const a=this._getUpdateParams(),l=this.getModels();if(i.device)this.updateState(a);else try{this.updateState(a)}catch{}for(const u of this.props.extensions)u.updateState.call(this,a,u);const c=this.getModels()[0]!==l[0];this._postUpdate(a,c)}finally{i.viewport=s,this.props=n,this._clearChangeFlags(),r.needsUpdate=!1,r.resetOldProps()}}_finalize(){He(BD,this),this.finalizeState(this.context);for(const e of this.props.extensions)e.finalizeState.call(this,this.context,e)}_drawLayer({renderPass:e,moduleParameters:n=null,uniforms:i={},parameters:r={}}){this._updateAttributeTransition();const s=this.props,o=this.context;this.props=this.internalState.propsInTransition||s;const a=this.props.opacity;i.opacity=Math.pow(a,1/2.2);try{if(n){const{isActive:u,isAttribute:h}=n.picking;this.setModuleParameters(n),this.setShaderModuleProps({picking:{isActive:u,isAttribute:h}})}const{getPolygonOffset:l}=this.props,c=l&&l(i)||[0,0];o.device.setParametersWebGL({polygonOffset:c});for(const u of this.getModels())u.setParameters(r);o.device.withParametersWebGL(r,()=>{const u={renderPass:e,moduleParameters:n,uniforms:i,parameters:r,context:o};for(const h of this.props.extensions)h.draw.call(this,u,h);this.draw(u)})}finally{this.props=s}}getChangeFlags(){var e;return(e=this.internalState)==null?void 0:e.changeFlags}setChangeFlags(e){if(!this.internalState)return;const{changeFlags:n}=this.internalState;for(const r in e)if(e[r]){let s=!1;switch(r){case"dataChanged":const o=e[r],a=n[r];o&&Array.isArray(a)&&(n.dataChanged=Array.isArray(o)?a.concat(o):o,s=!0);default:n[r]||(n[r]=e[r],s=!0)}s&&He(kD,this,r,e)}const i=!!(n.dataChanged||n.updateTriggersChanged||n.propsChanged||n.extensionsChanged);n.propsOrDataChanged=i,n.somethingChanged=i||n.viewportChanged||n.stateChanged}_clearChangeFlags(){this.internalState.changeFlags={dataChanged:!1,propsChanged:!1,updateTriggersChanged:!1,viewportChanged:!1,stateChanged:!1,extensionsChanged:!1,propsOrDataChanged:!1,somethingChanged:!1}}_diffProps(e,n){var r;const i=oD(e,n);if(i.updateTriggersChanged)for(const s in i.updateTriggersChanged)i.updateTriggersChanged[s]&&this.invalidateAttribute(s);if(i.transitionsChanged)for(const s in i.transitionsChanged)this.internalState.uniformTransitions.add(s,n[s],e[s],(r=e.transitions)==null?void 0:r[s]);return this.setChangeFlags(i)}validateProps(){sD(this.props)}updateAutoHighlight(e){this.props.autoHighlight&&!Number.isInteger(this.props.highlightedObjectIndex)&&this._updateAutoHighlight(e)}_updateAutoHighlight(e){const n={highlightedObjectColor:e.picked?e.color:null},{highlightColor:i}=this.props;e.picked&&typeof i=="function"&&(n.highlightColor=i(e)),this.setShaderModuleProps({picking:n}),this.setNeedsRedraw()}_getAttributeManager(){const e=this.context;return new GF(e.device,{id:this.props.id,stats:e.stats,timeline:e.timeline})}_postUpdate(e,n){const{props:i,oldProps:r}=e;this.setNeedsRedraw(),this._updateAttributes();const s=this.state.model;s==null||s.setInstanceCount(this.getNumInstances());const{autoHighlight:o,highlightedObjectIndex:a,highlightColor:l}=i;if(n||r.autoHighlight!==o||r.highlightedObjectIndex!==a||r.highlightColor!==l){const c={};o||(c.highlightedObjectColor=null),Array.isArray(l)&&(c.highlightColor=l),(n||a!==r.highlightedObjectIndex)&&(c.highlightedObjectColor=Number.isFinite(a)&&a>=0?this.encodePickingColor(a):null),this.setShaderModuleProps({picking:c})}}_getUpdateParams(){return{props:this.props,oldProps:this.internalState.getOldProps(),context:this.context,changeFlags:this.internalState.changeFlags}}_getNeedsRedraw(e){if(!this.internalState)return!1;let n=!1;n=n||this.internalState.needsRedraw&&this.id;const i=this.getAttributeManager(),r=i?i.getNeedsRedraw(e):!1;if(n=n||r,n)for(const s of this.props.extensions)s.onNeedsRedraw.call(this,s);return this.internalState.needsRedraw=this.internalState.needsRedraw&&!e.clearRedrawFlags,n}_onAsyncPropUpdated(){this._diffProps(this.props,this.internalState.getOldProps()),this.setNeedsUpdate()}};tu.defaultProps=VD,tu.layerName="Layer";let bn=tu;const jD="compositeLayer.renderLayers",Xg=class Xg extends bn{get isComposite(){return!0}get isLoaded(){return super.isLoaded&&this.getSubLayers().every(e=>e.isLoaded)}getSubLayers(){return this.internalState&&this.internalState.subLayers||[]}initializeState(e){}setState(e){super.setState(e),this.setNeedsUpdate()}getPickingInfo({info:e}){const{object:n}=e;return n&&n.__source&&n.__source.parent&&n.__source.parent.id===this.id&&(e.object=n.__source.object,e.index=n.__source.index),e}filterSubLayer(e){return!0}shouldRenderSubLayer(e,n){return n&&n.length}getSubLayerClass(e,n){const{_subLayerProps:i}=this.props;return i&&i[e]&&i[e].type||n}getSubLayerRow(e,n,i){return e.__source={parent:this,object:n,index:i},e}getSubLayerAccessor(e){if(typeof e=="function"){const n={index:-1,data:this.props.data,target:[]};return(i,r)=>i&&i.__source?(n.index=i.__source.index,e(i.__source.object,n)):e(i,r)}return e}getSubLayerProps(e={}){var I;const{opacity:n,pickable:i,visible:r,parameters:s,getPolygonOffset:o,highlightedObjectIndex:a,autoHighlight:l,highlightColor:c,coordinateSystem:u,coordinateOrigin:h,wrapLongitude:f,positionFormat:d,modelMatrix:p,extensions:v,fetch:A,operation:y,_subLayerProps:g}=this.props,_={id:"",updateTriggers:{},opacity:n,pickable:i,visible:r,parameters:s,getPolygonOffset:o,highlightedObjectIndex:a,autoHighlight:l,highlightColor:c,coordinateSystem:u,coordinateOrigin:h,wrapLongitude:f,positionFormat:d,modelMatrix:p,extensions:v,fetch:A,operation:y},E=g&&e.id&&g[e.id],R=E&&E.updateTriggers,P=e.id||"sublayer";if(E){const O=this.props[ii],k=e.type?e.type._propTypes:{};for(const D in E){const H=k[D]||O[D];H&&H.type==="accessor"&&(E[D]=this.getSubLayerAccessor(E[D]))}}Object.assign(_,e,E),_.id=`${this.props.id}-${P}`,_.updateTriggers={all:(I=this.props.updateTriggers)==null?void 0:I.all,...e.updateTriggers,...R};for(const O of v){const k=O.getSubLayerProps.call(this,O);k&&Object.assign(_,k,{updateTriggers:Object.assign(_.updateTriggers,k.updateTriggers)})}return _}_updateAutoHighlight(e){for(const n of this.getSubLayers())n.updateAutoHighlight(e)}_getAttributeManager(){return null}_postUpdate(e,n){let i=this.internalState.subLayers;const r=!i||this.needsUpdate();if(r){const s=this.renderLayers();i=Iu(s,Boolean),this.internalState.subLayers=i}He(jD,this,r,i);for(const s of i)s.parent=this}};Xg.layerName="CompositeLayer";let jo=Xg;const nl=Math.PI/180,Ay=180/Math.PI,kl=6370972,Nr=256;function WD(){const t=Nr/kl,e=Math.PI/180*Nr;return{unitsPerMeter:[t,t,t],unitsPerMeter2:[0,0,0],metersPerUnit:[1/t,1/t,1/t],unitsPerDegree:[e,e,t],unitsPerDegree2:[0,0,0],degreesPerUnit:[1/e,1/e,1/t]}}class HD extends zo{constructor(e={}){const{latitude:n=0,longitude:i=0,zoom:r=0,nearZMultiplier:s=.1,farZMultiplier:o=2,resolution:a=10}=e;let{height:l,altitude:c=1.5}=e;l=l||1,c=Math.max(.75,c);const u=new Je().lookAt({eye:[0,-c,0],up:[0,0,1]}),h=Math.pow(2,r);u.rotateX(n*nl),u.rotateZ(-i*nl),u.scale(h/l);const f=Math.atan(.5/c),d=Nr*2*h/l;super({...e,height:l,viewMatrix:u,longitude:i,latitude:n,zoom:r,distanceScales:WD(),fovyRadians:f*2,focalDistance:c,near:s,far:Math.min(2,1/d+1)*c*o}),this.latitude=n,this.longitude=i,this.resolution=a}get projectionMode(){return Nt.GLOBE}getDistanceScales(){return this.distanceScales}getBounds(e={}){const n={targetZ:e.z||0},i=this.unproject([0,this.height/2],n),r=this.unproject([this.width/2,0],n),s=this.unproject([this.width,this.height/2],n),o=this.unproject([this.width/2,this.height],n);return s[0]<this.longitude&&(s[0]+=360),i[0]>this.longitude&&(i[0]-=360),[Math.min(i[0],s[0],r[0],o[0]),Math.min(i[1],s[1],r[1],o[1]),Math.max(i[0],s[0],r[0],o[0]),Math.max(i[1],s[1],r[1],o[1])]}unproject(e,{topLeft:n=!0,targetZ:i}={}){const[r,s,o]=e,a=n?s:this.height-s,{pixelUnprojectionMatrix:l}=this;let c;if(Number.isFinite(o))c=tf(l,[r,a,o,1]);else{const d=tf(l,[r,a,-1,1]),p=tf(l,[r,a,1,1]),v=((i||0)/kl+1)*Nr,A=kh(Fw([],d,p)),y=kh(d),g=kh(p),E=4*((4*y*g-(A-y-g)**2)/16)/A,R=Math.sqrt(y-E),P=Math.sqrt(Math.max(0,v*v-E)),I=(R-P)/Math.sqrt(A);c=v2([],d,p,I)}const[u,h,f]=this.unprojectPosition(c);return Number.isFinite(o)?[u,h,f]:Number.isFinite(i)?[u,h,i]:[u,h]}projectPosition(e){const[n,i,r=0]=e,s=n*nl,o=i*nl,a=Math.cos(o),l=(r/kl+1)*Nr;return[Math.sin(s)*a*l,-Math.cos(s)*a*l,Math.sin(o)*l]}unprojectPosition(e){const[n,i,r]=e,s=Dw(e),o=Math.asin(r/s),l=Math.atan2(n,-i)*Ay,c=o*Ay,u=(s/Nr-1)*kl;return[l,c,u]}projectFlat(e){return e}unprojectFlat(e){return e}panByPosition(e,n){const i=this.unproject(n);return{longitude:e[0]-i[0]+this.longitude,latitude:e[1]-i[1]+this.latitude}}}function tf(t,e){const n=ps([],e,t);return Ag(n,n,1/n[3]),n}class FE{constructor(e){this.indexStarts=[0],this.vertexStarts=[0],this.vertexCount=0,this.instanceCount=0;const{attributes:n={}}=e;this.typedArrayManager=os,this.attributes={},this._attributeDefs=n,this.opts=e,this.updateGeometry(e)}updateGeometry(e){Object.assign(this.opts,e);const{data:n,buffers:i={},getGeometry:r,geometryBuffer:s,positionFormat:o,dataChanged:a,normalize:l=!0}=this.opts;if(this.data=n,this.getGeometry=r,this.positionSize=s&&s.size||(o==="XY"?2:3),this.buffers=i,this.normalize=l,s&&(Be(n.startIndices),this.getGeometry=this.getGeometryFromBuffer(s),l||(i.vertexPositions=s)),this.geometryBuffer=i.vertexPositions,Array.isArray(a))for(const c of a)this._rebuildGeometry(c);else this._rebuildGeometry()}updatePartialGeometry({startRow:e,endRow:n}){this._rebuildGeometry({startRow:e,endRow:n})}getGeometryFromBuffer(e){const n=e.value||e;return ArrayBuffer.isView(n)?AE(n,{size:this.positionSize,offset:e.offset,stride:e.stride,startIndices:this.data.startIndices}):null}_allocate(e,n){const{attributes:i,buffers:r,_attributeDefs:s,typedArrayManager:o}=this;for(const a in s)if(a in r)o.release(i[a]),i[a]=null;else{const l=s[a];l.copy=n,i[a]=o.allocate(i[a],e,l)}}_forEachGeometry(e,n,i){const{data:r,getGeometry:s}=this,{iterable:o,objectInfo:a}=Du(r,n,i);for(const l of o){a.index++;const c=s?s(l,a):null;e(c,a.index)}}_rebuildGeometry(e){if(!this.data)return;let{indexStarts:n,vertexStarts:i,instanceCount:r}=this;const{data:s,geometryBuffer:o}=this,{startRow:a=0,endRow:l=1/0}=e||{},c={};if(e||(n=[0],i=[0]),this.normalize||!o)this._forEachGeometry((h,f)=>{const d=h&&this.normalizeGeometry(h);c[f]=d,i[f+1]=i[f]+(d?this.getGeometrySize(d):0)},a,l),r=i[i.length-1];else if(i=s.startIndices,r=i[s.length]||0,ArrayBuffer.isView(o))r=r||o.length/this.positionSize;else if(o instanceof de){const h=this.positionSize*4;r=r||o.byteLength/h}else if(o.buffer){const h=o.stride||this.positionSize*4;r=r||o.buffer.byteLength/h}else if(o.value){const h=o.value,f=o.stride/h.BYTES_PER_ELEMENT||this.positionSize;r=r||h.length/f}this._allocate(r,!!e),this.indexStarts=n,this.vertexStarts=i,this.instanceCount=r;const u={};this._forEachGeometry((h,f)=>{const d=c[f]||h;u.vertexStart=i[f],u.indexStart=n[f];const p=f<i.length-1?i[f+1]:r;u.geometrySize=p-i[f],u.geometryIndex=f,this.updateGeometryAttributes(d,u)},a,l),this.vertexCount=n[n.length-1]}}const $D=typeof window<"u"?L.useLayoutEffect:L.useEffect,XD=$D;function Mc(t,e){for(;t;){if(t===e)return!0;t=Object.getPrototypeOf(t)}return!1}const YD={position:"absolute",zIndex:-1};function DE(t,e){if(typeof t=="function")return t(e);if(Array.isArray(t))return t.map(n=>DE(n,e));if(Bu(t)){if(KD(t))return e.style=YD,L.cloneElement(t,e);if(qD(t))return L.cloneElement(t,e)}return t}function Bu(t){return t&&typeof t=="object"&&"type"in t||!1}function KD(t){var e;return(e=t.props)==null?void 0:e.mapStyle}function qD(t){const e=t.type;return e&&e.deckGLViewProps}function qd(t){if(typeof t=="function")return L.createElement(cs,{},t);if(Array.isArray(t))return t.map(qd);if(Bu(t)){if(t.type===L.Fragment)return qd(t.props.children);if(Mc(t.type,cs))return t}return t}function ZD({children:t,layers:e=[],views:n=null}){const i=[],r=[],s={};return L.Children.forEach(qd(t),o=>{if(Bu(o)){const a=o.type;if(Mc(a,bn)){const l=QD(a,o.props);r.push(l)}else i.push(o);if(Mc(a,cs)&&a!==cs&&o.props.id){const l=new a(o.props);s[l.id]=l}}else o&&i.push(o)}),Object.keys(s).length>0&&(Array.isArray(n)?n.forEach(o=>{s[o.id]=o}):n&&(s[n.id]=n),n=Object.values(s)),e=r.length>0?[...r,...e]:e,{layers:e,children:i,views:n}}function QD(t,e){const n={},i=t.defaultProps||{};for(const r in e)i[r]!==e[r]&&(n[r]=e[r]);return new t(n)}function JD({children:t,deck:e,ContextProvider:n}){const{viewManager:i}=e||{};if(!i||!i.views.length)return[];const r={},s=i.views[0].id;for(const o of t){let a=s,l=o;Bu(o)&&Mc(o.type,cs)&&(a=o.props.id||s,l=o.props.children);const c=i.getViewport(a),u=i.getViewState(a);if(c){u.padding=c.padding;const{x:h,y:f,width:d,height:p}=c;l=DE(l,{x:h,y:f,width:d,height:p,viewport:c,viewState:u}),r[a]||(r[a]={viewport:c,children:[]}),r[a].children.push(l)}}return Object.keys(r).map(o=>{const{viewport:a,children:l}=r[o],{x:c,y:u,width:h,height:f}=a,d={position:"absolute",left:c,top:u,width:h,height:f},p=`view-${o}`,v=L.createElement("div",{key:p,id:p,style:d},...l);if(n){const A={viewport:a,container:e.canvas.offsetParent,eventManager:e.eventManager,onViewStateChange:y=>{y.viewId=o,e._onViewStateChange(y)}};return L.createElement(n,{key:p,value:A},v)}return v})}const GD={mixBlendMode:null};function eB({width:t,height:e,style:n}){const i={position:"absolute",zIndex:0,left:0,top:0,width:t,height:e},r={left:0,top:0};if(n)for(const s in n)s in GD?r[s]=n[s]:i[s]=n[s];return{containerStyle:i,canvasStyle:r}}function tB(t){return{get deck(){return t.deck},pickObject:e=>t.deck.pickObject(e),pickMultipleObjects:e=>t.deck.pickMultipleObjects(e),pickObjects:e=>t.deck.pickObjects(e)}}function BE(t){t.redrawReason&&(t.deck._drawLayers(t.redrawReason),t.redrawReason=null)}function nB(t,e,n){const i=new e({...n,_customRender:r=>{t.redrawReason=r;const s=i.getViewports();t.lastRenderedViewports!==s?t.forceUpdate():BE(t)}});return i}const UE=L.forwardRef((t,e)=>{const[n,i]=L.useState(0),s=L.useRef({control:null,version:n,forceUpdate:()=>i(R=>R+1)}).current,o=L.useRef(null),a=L.useRef(null),l=L.useMemo(()=>ZD(t),[t.layers,t.views,t.children]);let c=!0;const u=R=>{var P;return c&&t.viewState?(s.viewStateUpdateRequested=R,null):(s.viewStateUpdateRequested=null,(P=t.onViewStateChange)==null?void 0:P.call(t,R))},h=R=>{var P;c?s.interactionStateUpdateRequested=R:(s.interactionStateUpdateRequested=null,(P=t.onInteractionStateChange)==null||P.call(t,R))},f=L.useMemo(()=>{const R={...t,style:null,width:"100%",height:"100%",parent:o.current,canvas:a.current,layers:l.layers,views:l.views,onViewStateChange:u,onInteractionStateChange:h};return delete R._customRender,s.deck&&s.deck.setProps(R),R},[t]);L.useEffect(()=>{const R=t.Deck||Cc;return s.deck=nB(s,R,{...f,parent:o.current,canvas:a.current}),()=>{var P;return(P=s.deck)==null?void 0:P.finalize()}},[]),XD(()=>{BE(s);const{viewStateUpdateRequested:R,interactionStateUpdateRequested:P}=s;R&&u(R),P&&h(P)}),L.useImperativeHandle(e,()=>tB(s),[]);const d=s.deck&&s.deck.isInitialized?s.deck.getViewports():void 0,{ContextProvider:p,width:v,height:A,id:y,style:g}=t,{containerStyle:_,canvasStyle:E}=L.useMemo(()=>eB({width:v,height:A,style:g}),[v,A,g]);if(!s.viewStateUpdateRequested&&s.lastRenderedViewports===d||s.version!==n){s.lastRenderedViewports=d,s.version=n;const R=JD({children:l.children,deck:s.deck,ContextProvider:p}),P=L.createElement("canvas",{key:"canvas",id:y||"deckgl-overlay",ref:a,style:E});s.control=L.createElement("div",{id:`${y||"deckgl"}-wrapper`,ref:o,style:_},[P,R])}return c=!1,s.control});UE.defaultProps=Cc.defaultProps;const iB=UE,rB="modulepreload",sB=function(t){return"/us-census-language/"+t},xy={},oB=function(e,n,i){if(!n||n.length===0)return e();const r=document.getElementsByTagName("link");return Promise.all(n.map(s=>{if(s=sB(s),s in xy)return;xy[s]=!0;const o=s.endsWith(".css"),a=o?'[rel="stylesheet"]':"";if(!!i)for(let u=r.length-1;u>=0;u--){const h=r[u];if(h.href===s&&(!o||h.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${s}"]${a}`))return;const c=document.createElement("link");if(c.rel=o?"stylesheet":rB,o||(c.as="script",c.crossOrigin=""),c.href=s,document.head.appendChild(c),o)return new Promise((u,h)=>{c.addEventListener("load",u),c.addEventListener("error",()=>h(new Error(`Unable to preload CSS for ${s}`)))})})).then(()=>e()).catch(s=>{const o=new Event("vite:preloadError",{cancelable:!0});if(o.payload=s,window.dispatchEvent(o),!o.defaultPrevented)throw s})},aB=L.createContext(null);function lB(t,e){const n=Array.isArray(t)?t[0]:t?t.x:0,i=Array.isArray(t)?t[1]:t?t.y:0,r=Array.isArray(e)?e[0]:e?e.x:0,s=Array.isArray(e)?e[1]:e?e.y:0;return n===r&&i===s}function gn(t,e){if(t===e)return!0;if(!t||!e)return!1;if(Array.isArray(t)){if(!Array.isArray(e)||t.length!==e.length)return!1;for(let n=0;n<t.length;n++)if(!gn(t[n],e[n]))return!1;return!0}else if(Array.isArray(e))return!1;if(typeof t=="object"&&typeof e=="object"){const n=Object.keys(t),i=Object.keys(e);if(n.length!==i.length)return!1;for(const r of n)if(!e.hasOwnProperty(r)||!gn(t[r],e[r]))return!1;return!0}return!1}function cB(t){const e=t.clone();return e.pixelsToGLUnits=t.pixelsToGLUnits,e}function Ry(t,e){if(!t.getProjection)return;const n=t.getProjection(),i=e.getProjection();gn(n,i)||e.setProjection(n)}function by(t){return{longitude:t.center.lng,latitude:t.center.lat,zoom:t.zoom,pitch:t.pitch,bearing:t.bearing,padding:t.padding}}function Cy(t,e){const n=e.viewState||e;let i=!1;if("longitude"in n&&"latitude"in n){const r=t.center;t.center=new r.constructor(n.longitude,n.latitude),i=i||r!==t.center}if("zoom"in n){const r=t.zoom;t.zoom=n.zoom,i=i||r!==t.zoom}if("bearing"in n){const r=t.bearing;t.bearing=n.bearing,i=i||r!==t.bearing}if("pitch"in n){const r=t.pitch;t.pitch=n.pitch,i=i||r!==t.pitch}return n.padding&&!t.isPaddingEqual(n.padding)&&(i=!0,t.padding=n.padding),i}const uB=["type","source","source-layer","minzoom","maxzoom","filter","layout"];function Py(t){if(!t)return null;if(typeof t=="string"||("toJS"in t&&(t=t.toJS()),!t.layers))return t;const e={};for(const i of t.layers)e[i.id]=i;const n=t.layers.map(i=>{let r=null;"interactive"in i&&(r=Object.assign({},i),delete r.interactive);const s=e[i.ref];if(s){r=r||Object.assign({},i),delete r.ref;for(const o of uB)o in s&&(r[o]=s[o])}return r||i});return{...t,layers:n}}const My={version:8,sources:{},layers:[]},Iy={mousedown:"onMouseDown",mouseup:"onMouseUp",mouseover:"onMouseOver",mousemove:"onMouseMove",click:"onClick",dblclick:"onDblClick",mouseenter:"onMouseEnter",mouseleave:"onMouseLeave",mouseout:"onMouseOut",contextmenu:"onContextMenu",touchstart:"onTouchStart",touchend:"onTouchEnd",touchmove:"onTouchMove",touchcancel:"onTouchCancel"},nf={movestart:"onMoveStart",move:"onMove",moveend:"onMoveEnd",dragstart:"onDragStart",drag:"onDrag",dragend:"onDragEnd",zoomstart:"onZoomStart",zoom:"onZoom",zoomend:"onZoomEnd",rotatestart:"onRotateStart",rotate:"onRotate",rotateend:"onRotateEnd",pitchstart:"onPitchStart",pitch:"onPitch",pitchend:"onPitchEnd"},Oy={wheel:"onWheel",boxzoomstart:"onBoxZoomStart",boxzoomend:"onBoxZoomEnd",boxzoomcancel:"onBoxZoomCancel",resize:"onResize",load:"onLoad",render:"onRender",idle:"onIdle",remove:"onRemove",data:"onData",styledata:"onStyleData",sourcedata:"onSourceData",error:"onError"},hB=["minZoom","maxZoom","minPitch","maxPitch","maxBounds","projection","renderWorldCopies"],fB=["scrollZoom","boxZoom","dragRotate","dragPan","keyboard","doubleClickZoom","touchZoomRotate","touchPitch"];class us{constructor(e,n,i){this._map=null,this._internalUpdate=!1,this._inRender=!1,this._hoveredFeatures=null,this._deferredEvents={move:!1,zoom:!1,pitch:!1,rotate:!1},this._onEvent=r=>{const s=this.props[Oy[r.type]];s?s(r):r.type==="error"&&console.error(r.error)},this._onPointerEvent=r=>{(r.type==="mousemove"||r.type==="mouseout")&&this._updateHover(r);const s=this.props[Iy[r.type]];s&&(this.props.interactiveLayerIds&&r.type!=="mouseover"&&r.type!=="mouseout"&&(r.features=this._hoveredFeatures||this._queryRenderedFeatures(r.point)),s(r),delete r.features)},this._onCameraEvent=r=>{if(!this._internalUpdate){const s=this.props[nf[r.type]];s&&s(r)}r.type in this._deferredEvents&&(this._deferredEvents[r.type]=!1)},this._MapClass=e,this.props=n,this._initialize(i)}get map(){return this._map}get transform(){return this._renderTransform}setProps(e){const n=this.props;this.props=e;const i=this._updateSettings(e,n);i&&this._createShadowTransform(this._map);const r=this._updateSize(e),s=this._updateViewState(e,!0);this._updateStyle(e,n),this._updateStyleComponents(e,n),this._updateHandlers(e,n),(i||r||s&&!this._map.isMoving())&&this.redraw()}static reuse(e,n){const i=us.savedMaps.pop();if(!i)return null;const r=i.map,s=r.getContainer();for(n.className=s.className;s.childNodes.length>0;)n.appendChild(s.childNodes[0]);r._container=n;const o=r._resizeObserver;o&&(o.disconnect(),o.observe(n)),i.setProps({...e,styleDiffing:!1}),r.resize();const{initialViewState:a}=e;return a&&(a.bounds?r.fitBounds(a.bounds,{...a.fitBoundsOptions,duration:0}):i._updateViewState(a,!1)),r.isStyleLoaded()?r.fire("load"):r.once("styledata",()=>r.fire("load")),r._update(),i}_initialize(e){const{props:n}=this,{mapStyle:i=My}=n,r={...n,...n.initialViewState,accessToken:n.mapboxAccessToken||dB()||null,container:e,style:Py(i)},s=r.initialViewState||r.viewState||r;if(Object.assign(r,{center:[s.longitude||0,s.latitude||0],zoom:s.zoom||0,pitch:s.pitch||0,bearing:s.bearing||0}),n.gl){const u=HTMLCanvasElement.prototype.getContext;HTMLCanvasElement.prototype.getContext=()=>(HTMLCanvasElement.prototype.getContext=u,n.gl)}const o=new this._MapClass(r);s.padding&&o.setPadding(s.padding),n.cursor&&(o.getCanvas().style.cursor=n.cursor),this._createShadowTransform(o);const a=o._render;o._render=u=>{this._inRender=!0,a.call(o,u),this._inRender=!1};const l=o._renderTaskQueue.run;o._renderTaskQueue.run=u=>{l.call(o._renderTaskQueue,u),this._onBeforeRepaint()},o.on("render",()=>this._onAfterRepaint());const c=o.fire;o.fire=this._fireEvent.bind(this,c),o.on("resize",()=>{this._renderTransform.resize(o.transform.width,o.transform.height)}),o.on("styledata",()=>{this._updateStyleComponents(this.props,{}),Ry(o.transform,this._renderTransform)}),o.on("sourcedata",()=>this._updateStyleComponents(this.props,{}));for(const u in Iy)o.on(u,this._onPointerEvent);for(const u in nf)o.on(u,this._onCameraEvent);for(const u in Oy)o.on(u,this._onEvent);this._map=o}recycle(){const n=this.map.getContainer().querySelector("[mapboxgl-children]");n==null||n.remove(),us.savedMaps.push(this)}destroy(){this._map.remove()}redraw(){const e=this._map;!this._inRender&&e.style&&(e._frame&&(e._frame.cancel(),e._frame=null),e._render())}_createShadowTransform(e){const n=cB(e.transform);e.painter.transform=n,this._renderTransform=n}_updateSize(e){const{viewState:n}=e;if(n){const i=this._map;if(n.width!==i.transform.width||n.height!==i.transform.height)return i.resize(),!0}return!1}_updateViewState(e,n){if(this._internalUpdate)return!1;const i=this._map,r=this._renderTransform,{zoom:s,pitch:o,bearing:a}=r,l=i.isMoving();l&&(r.cameraElevationReference="sea");const c=Cy(r,{...by(i.transform),...e});if(l&&(r.cameraElevationReference="ground"),c&&n){const u=this._deferredEvents;u.move=!0,u.zoom||(u.zoom=s!==r.zoom),u.rotate||(u.rotate=a!==r.bearing),u.pitch||(u.pitch=o!==r.pitch)}return l||Cy(i.transform,e),c}_updateSettings(e,n){const i=this._map;let r=!1;for(const s of hB)if(s in e&&!gn(e[s],n[s])){r=!0;const o=i[`set${s[0].toUpperCase()}${s.slice(1)}`];o==null||o.call(i,e[s])}return r}_updateStyle(e,n){if(e.cursor!==n.cursor&&(this._map.getCanvas().style.cursor=e.cursor||""),e.mapStyle!==n.mapStyle){const{mapStyle:i=My,styleDiffing:r=!0}=e,s={diff:r};return"localIdeographFontFamily"in e&&(s.localIdeographFontFamily=e.localIdeographFontFamily),this._map.setStyle(Py(i),s),!0}return!1}_updateStyleComponents(e,n){const i=this._map;let r=!1;return i.isStyleLoaded()&&("light"in e&&i.setLight&&!gn(e.light,n.light)&&(r=!0,i.setLight(e.light)),"fog"in e&&i.setFog&&!gn(e.fog,n.fog)&&(r=!0,i.setFog(e.fog)),"terrain"in e&&i.setTerrain&&!gn(e.terrain,n.terrain)&&(!e.terrain||i.getSource(e.terrain.source))&&(r=!0,i.setTerrain(e.terrain))),r}_updateHandlers(e,n){var i,r;const s=this._map;let o=!1;for(const a of fB){const l=(i=e[a])!==null&&i!==void 0?i:!0,c=(r=n[a])!==null&&r!==void 0?r:!0;gn(l,c)||(o=!0,l?s[a].enable(l):s[a].disable())}return o}_queryRenderedFeatures(e){const n=this._map,i=n.transform,{interactiveLayerIds:r=[]}=this.props;try{return n.transform=this._renderTransform,n.queryRenderedFeatures(e,{layers:r.filter(n.getLayer.bind(n))})}catch{return[]}finally{n.transform=i}}_updateHover(e){var n;const{props:i}=this;if(i.interactiveLayerIds&&(i.onMouseMove||i.onMouseEnter||i.onMouseLeave)){const s=e.type,o=((n=this._hoveredFeatures)===null||n===void 0?void 0:n.length)>0,a=this._queryRenderedFeatures(e.point),l=a.length>0;!l&&o&&(e.type="mouseleave",this._onPointerEvent(e)),this._hoveredFeatures=a,l&&!o&&(e.type="mouseenter",this._onPointerEvent(e)),e.type=s}else this._hoveredFeatures=null}_fireEvent(e,n,i){const r=this._map,s=r.transform,o=typeof n=="string"?n:n.type;return o==="move"&&this._updateViewState(this.props,!1),o in nf&&(typeof n=="object"&&(n.viewState=by(s)),this._map.isMoving())?(r.transform=this._renderTransform,e.call(r,n,i),r.transform=s,r):(e.call(r,n,i),r)}_onBeforeRepaint(){const e=this._map;this._internalUpdate=!0;for(const i in this._deferredEvents)this._deferredEvents[i]&&e.fire(i);this._internalUpdate=!1;const n=this._map.transform;e.transform=this._renderTransform,this._onAfterRepaint=()=>{Ry(this._renderTransform,n),e.transform=n}}}us.savedMaps=[];function dB(){let t=null;if(typeof location<"u"){const e=/access_token=([^&\/]*)/.exec(location.search);t=e&&e[1]}try{t=t||{}.MapboxAccessToken}catch{}try{t=t||{}.REACT_APP_MAPBOX_ACCESS_TOKEN}catch{}return t}const pB=["setMaxBounds","setMinZoom","setMaxZoom","setMinPitch","setMaxPitch","setRenderWorldCopies","setProjection","setStyle","addSource","removeSource","addLayer","removeLayer","setLayerZoomRange","setFilter","setPaintProperty","setLayoutProperty","setLight","setTerrain","setFog","remove"];function gB(t){if(!t)return null;const e=t.map,n={getMap:()=>e,getCenter:()=>t.transform.center,getZoom:()=>t.transform.zoom,getBearing:()=>t.transform.bearing,getPitch:()=>t.transform.pitch,getPadding:()=>t.transform.padding,getBounds:()=>t.transform.getBounds(),project:i=>{const r=e.transform;e.transform=t.transform;const s=e.project(i);return e.transform=r,s},unproject:i=>{const r=e.transform;e.transform=t.transform;const s=e.unproject(i);return e.transform=r,s},queryTerrainElevation:(i,r)=>{const s=e.transform;e.transform=t.transform;const o=e.queryTerrainElevation(i,r);return e.transform=s,o},queryRenderedFeatures:(i,r)=>{const s=e.transform;e.transform=t.transform;const o=e.queryRenderedFeatures(i,r);return e.transform=s,o}};for(const i of _B(e))!(i in n)&&!pB.includes(i)&&(n[i]=e[i].bind(e));return n}function _B(t){const e=new Set;let n=t;for(;n;){for(const i of Object.getOwnPropertyNames(n))i[0]!=="_"&&typeof t[i]=="function"&&i!=="fire"&&i!=="setEventedParent"&&e.add(i);n=Object.getPrototypeOf(n)}return Array.from(e)}const mB=typeof document<"u"?L.useLayoutEffect:L.useEffect,yB=["baseApiUrl","maxParallelImageRequests","workerClass","workerCount","workerUrl"];function vB(t,e){for(const i of yB)i in e&&(t[i]=e[i]);const{RTLTextPlugin:n="https://api.mapbox.com/mapbox-gl-js/plugins/mapbox-gl-rtl-text/v0.2.3/mapbox-gl-rtl-text.js"}=e;n&&t.getRTLTextPluginStatus&&t.getRTLTextPluginStatus()==="unavailable"&&t.setRTLTextPlugin(n,i=>{i&&console.error(i)},!0)}const Uu=L.createContext(null);function TB(t,e,n){const i=L.useContext(aB),[r,s]=L.useState(null),o=L.useRef(),{current:a}=L.useRef({mapLib:null,map:null});L.useEffect(()=>{const u=t.mapLib;let h=!0,f;return Promise.resolve(u||n).then(d=>{if(!h)return;if(!d)throw new Error("Invalid mapLib");const p="Map"in d?d:d.default;if(!p.Map)throw new Error("Invalid mapLib");if(vB(p,t),!p.supported||p.supported(t))t.reuseMaps&&(f=us.reuse(t,o.current)),f||(f=new us(p.Map,t,o.current)),a.map=gB(f),a.mapLib=p,s(f),i==null||i.onMapMount(a.map,t.id);else throw new Error("Map is not supported by this browser")}).catch(d=>{const{onError:p}=t;p?p({type:"error",target:null,originalEvent:null,error:d}):console.error(d)}),()=>{h=!1,f&&(i==null||i.onMapUnmount(t.id),t.reuseMaps?f.recycle():f.destroy())}},[]),mB(()=>{r&&r.setProps(t)}),L.useImperativeHandle(e,()=>a.map,[r]);const l=L.useMemo(()=>({position:"relative",width:"100%",height:"100%",...t.style}),[t.style]),c={height:"100%"};return L.createElement("div",{id:t.id,ref:o,style:l},r&&L.createElement(Uu.Provider,{value:a},L.createElement("div",{"mapboxgl-children":"",style:c},t.children)))}const wB=/box|flex|grid|column|lineHeight|fontWeight|opacity|order|tabSize|zIndex/;function er(t,e){if(!t||!e)return;const n=t.style;for(const i in e){const r=e[i];Number.isFinite(r)&&!wB.test(i)?n[i]=`${r}px`:n[i]=r}}function EB(t,e){const{map:n,mapLib:i}=L.useContext(Uu),r=L.useRef({props:t});r.current.props=t;const s=L.useMemo(()=>{let v=!1;L.Children.forEach(t.children,g=>{g&&(v=!0)});const A={...t,element:v?document.createElement("div"):null},y=new i.Marker(A);return y.setLngLat([t.longitude,t.latitude]),y.getElement().addEventListener("click",g=>{var _,E;(E=(_=r.current.props).onClick)===null||E===void 0||E.call(_,{type:"click",target:y,originalEvent:g})}),y.on("dragstart",g=>{var _,E;const R=g;R.lngLat=s.getLngLat(),(E=(_=r.current.props).onDragStart)===null||E===void 0||E.call(_,R)}),y.on("drag",g=>{var _,E;const R=g;R.lngLat=s.getLngLat(),(E=(_=r.current.props).onDrag)===null||E===void 0||E.call(_,R)}),y.on("dragend",g=>{var _,E;const R=g;R.lngLat=s.getLngLat(),(E=(_=r.current.props).onDragEnd)===null||E===void 0||E.call(_,R)}),y},[]);L.useEffect(()=>(s.addTo(n.getMap()),()=>{s.remove()}),[]);const{longitude:o,latitude:a,offset:l,style:c,draggable:u=!1,popup:h=null,rotation:f=0,rotationAlignment:d="auto",pitchAlignment:p="auto"}=t;return L.useEffect(()=>{er(s.getElement(),c)},[c]),L.useImperativeHandle(e,()=>s,[]),(s.getLngLat().lng!==o||s.getLngLat().lat!==a)&&s.setLngLat([o,a]),l&&!lB(s.getOffset(),l)&&s.setOffset(l),s.isDraggable()!==u&&s.setDraggable(u),s.getRotation()!==f&&s.setRotation(f),s.getRotationAlignment()!==d&&s.setRotationAlignment(d),s.getPitchAlignment()!==p&&s.setPitchAlignment(p),s.getPopup()!==h&&s.setPopup(h),ug.createPortal(t.children,s.getElement())}L.memo(L.forwardRef(EB));function Ny(t){return new Set(t?t.trim().split(/\s+/):[])}function SB(t,e){const{map:n,mapLib:i}=L.useContext(Uu),r=L.useMemo(()=>document.createElement("div"),[]),s=L.useRef({props:t});s.current.props=t;const o=L.useMemo(()=>{const a={...t},l=new i.Popup(a);return l.setLngLat([t.longitude,t.latitude]),l.once("open",c=>{var u,h;(h=(u=s.current.props).onOpen)===null||h===void 0||h.call(u,c)}),l},[]);if(L.useEffect(()=>{const a=l=>{var c,u;(u=(c=s.current.props).onClose)===null||u===void 0||u.call(c,l)};return o.on("close",a),o.setDOMContent(r).addTo(n.getMap()),()=>{o.off("close",a),o.isOpen()&&o.remove()}},[]),L.useEffect(()=>{er(o.getElement(),t.style)},[t.style]),L.useImperativeHandle(e,()=>o,[]),o.isOpen()&&((o.getLngLat().lng!==t.longitude||o.getLngLat().lat!==t.latitude)&&o.setLngLat([t.longitude,t.latitude]),t.offset&&!gn(o.options.offset,t.offset)&&o.setOffset(t.offset),(o.options.anchor!==t.anchor||o.options.maxWidth!==t.maxWidth)&&(o.options.anchor=t.anchor,o.setMaxWidth(t.maxWidth)),o.options.className!==t.className)){const a=Ny(o.options.className),l=Ny(t.className);for(const c of a)l.has(c)||o.removeClassName(c);for(const c of l)a.has(c)||o.addClassName(c);o.options.className=t.className}return ug.createPortal(t.children,r)}L.memo(L.forwardRef(SB));function ha(t,e,n,i){const r=L.useContext(Uu),s=L.useMemo(()=>t(r),[]);return L.useEffect(()=>{const o=i||n||e,a=typeof e=="function"&&typeof n=="function"?e:null,l=typeof n=="function"?n:typeof e=="function"?e:null,{map:c}=r;return c.hasControl(s)||(c.addControl(s,o==null?void 0:o.position),a&&a(r)),()=>{l&&l(r),c.hasControl(s)&&c.removeControl(s)}},[]),s}function AB(t){const e=ha(({mapLib:n})=>new n.AttributionControl(t),{position:t.position});return L.useEffect(()=>{er(e._container,t.style)},[t.style]),null}L.memo(AB);function xB(t){const e=ha(({mapLib:n})=>new n.FullscreenControl({container:t.containerId&&document.getElementById(t.containerId)}),{position:t.position});return L.useEffect(()=>{er(e._controlContainer,t.style)},[t.style]),null}L.memo(xB);function RB(t,e){const n=L.useRef({props:t}),i=ha(({mapLib:r})=>{const s=new r.GeolocateControl(t),o=s._setupUI;return s._setupUI=a=>{s._container.hasChildNodes()||o(a)},s.on("geolocate",a=>{var l,c;(c=(l=n.current.props).onGeolocate)===null||c===void 0||c.call(l,a)}),s.on("error",a=>{var l,c;(c=(l=n.current.props).onError)===null||c===void 0||c.call(l,a)}),s.on("outofmaxbounds",a=>{var l,c;(c=(l=n.current.props).onOutOfMaxBounds)===null||c===void 0||c.call(l,a)}),s.on("trackuserlocationstart",a=>{var l,c;(c=(l=n.current.props).onTrackUserLocationStart)===null||c===void 0||c.call(l,a)}),s.on("trackuserlocationend",a=>{var l,c;(c=(l=n.current.props).onTrackUserLocationEnd)===null||c===void 0||c.call(l,a)}),s},{position:t.position});return n.current.props=t,L.useImperativeHandle(e,()=>i,[]),L.useEffect(()=>{er(i._container,t.style)},[t.style]),null}L.memo(L.forwardRef(RB));function bB(t){const e=ha(({mapLib:n})=>new n.NavigationControl(t),{position:t.position});return L.useEffect(()=>{er(e._container,t.style)},[t.style]),null}L.memo(bB);function CB(t){const e=ha(({mapLib:s})=>new s.ScaleControl(t),{position:t.position}),n=L.useRef(t),i=n.current;n.current=t;const{style:r}=t;return t.maxWidth!==void 0&&t.maxWidth!==i.maxWidth&&(e.options.maxWidth=t.maxWidth),t.unit!==void 0&&t.unit!==i.unit&&e.setUnit(t.unit),L.useEffect(()=>{er(e._container,r)},[r]),null}L.memo(CB);const PB=oB(()=>import("./mapbox-gl-a7313d78.js").then(t=>t.m),[]),MB=(()=>L.forwardRef(function(e,n){return TB(e,n,PB)}))(),IB=`#version 300 es
#define SHADER_NAME icon-layer-vertex-shader
in vec2 positions;
in vec3 instancePositions;
in vec3 instancePositions64Low;
in float instanceSizes;
in float instanceAngles;
in vec4 instanceColors;
in vec3 instancePickingColors;
in vec4 instanceIconFrames;
in float instanceColorModes;
in vec2 instanceOffsets;
in vec2 instancePixelOffset;
uniform float sizeScale;
uniform vec2 iconsTextureDim;
uniform float sizeMinPixels;
uniform float sizeMaxPixels;
uniform bool billboard;
uniform int sizeUnits;
out float vColorMode;
out vec4 vColor;
out vec2 vTextureCoords;
out vec2 uv;
vec2 rotate_by_angle(vec2 vertex, float angle) {
float angle_radian = angle * PI / 180.0;
float cos_angle = cos(angle_radian);
float sin_angle = sin(angle_radian);
mat2 rotationMatrix = mat2(cos_angle, -sin_angle, sin_angle, cos_angle);
return rotationMatrix * vertex;
}
void main(void) {
geometry.worldPosition = instancePositions;
geometry.uv = positions;
geometry.pickingColor = instancePickingColors;
uv = positions;
vec2 iconSize = instanceIconFrames.zw;
float sizePixels = clamp(
project_size_to_pixel(instanceSizes * sizeScale, sizeUnits),
sizeMinPixels, sizeMaxPixels
);
float instanceScale = iconSize.y == 0.0 ? 0.0 : sizePixels / iconSize.y;
vec2 pixelOffset = positions / 2.0 * iconSize + instanceOffsets;
pixelOffset = rotate_by_angle(pixelOffset, instanceAngles) * instanceScale;
pixelOffset += instancePixelOffset;
pixelOffset.y *= -1.0;
if (billboard)  {
gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, vec3(0.0), geometry.position);
DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
vec3 offset = vec3(pixelOffset, 0.0);
DECKGL_FILTER_SIZE(offset, geometry);
gl_Position.xy += project_pixel_size_to_clipspace(offset.xy);
} else {
vec3 offset_common = vec3(project_pixel_size(pixelOffset), 0.0);
DECKGL_FILTER_SIZE(offset_common, geometry);
gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, offset_common, geometry.position);
DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
}
vTextureCoords = mix(
instanceIconFrames.xy,
instanceIconFrames.xy + iconSize,
(positions.xy + 1.0) / 2.0
) / iconsTextureDim;
vColor = instanceColors;
DECKGL_FILTER_COLOR(vColor, geometry);
vColorMode = instanceColorModes;
}
`,OB=`#version 300 es
#define SHADER_NAME icon-layer-fragment-shader
precision highp float;
uniform float opacity;
uniform sampler2D iconsTexture;
uniform float alphaCutoff;
in float vColorMode;
in vec4 vColor;
in vec2 vTextureCoords;
in vec2 uv;
out vec4 fragColor;
void main(void) {
geometry.uv = uv;
vec4 texColor = texture(iconsTexture, vTextureCoords);
vec3 color = mix(texColor.rgb, vColor.rgb, vColorMode);
float a = texColor.a * opacity * vColor.a;
if (a < alphaCutoff) {
discard;
}
fragColor = vec4(color, a);
DECKGL_FILTER_COLOR(fragColor, geometry);
}
`,NB=1024,kB=4,ky=()=>{},Fy={minFilter:"linear",mipmapFilter:"linear",magFilter:"linear",addressModeU:"clamp-to-edge",addressModeV:"clamp-to-edge"},FB={x:0,y:0,width:0,height:0};function DB(t){return Math.pow(2,Math.ceil(Math.log2(t)))}function BB(t,e,n,i){const r=Math.min(n/e.width,i/e.height),s=Math.floor(e.width*r),o=Math.floor(e.height*r);return r===1?{data:e,width:s,height:o}:(t.canvas.height=o,t.canvas.width=s,t.clearRect(0,0,s,o),t.drawImage(e,0,0,e.width,e.height,0,0,s,o),{data:t.canvas,width:s,height:o})}function Wo(t){return t&&(t.id||t.url)}function UB(t,e,n,i){const{width:r,height:s,device:o}=t,a=o.createTexture({format:"rgba8unorm",width:e,height:n,sampler:i}),l=o.createCommandEncoder();return l.copyTextureToTexture({source:t,destination:a,width:r,height:s}),l.finish(),t.destroy(),a}function Dy(t,e,n){for(let i=0;i<e.length;i++){const{icon:r,xOffset:s}=e[i],o=Wo(r);t[o]={...r,x:s,y:n}}}function LB({icons:t,buffer:e,mapping:n={},xOffset:i=0,yOffset:r=0,rowHeight:s=0,canvasWidth:o}){let a=[];for(let l=0;l<t.length;l++){const c=t[l],u=Wo(c);if(!n[u]){const{height:h,width:f}=c;i+f+e>o&&(Dy(n,a,r),i=0,r=s+r+e,s=0,a=[]),a.push({icon:c,xOffset:i}),i=i+f+e,s=Math.max(s,h)}}return a.length>0&&Dy(n,a,r),{mapping:n,rowHeight:s,xOffset:i,yOffset:r,canvasWidth:o,canvasHeight:DB(s+r+e)}}function zB(t,e,n){if(!t||!e)return null;n=n||{};const i={},{iterable:r,objectInfo:s}=Du(t);for(const o of r){s.index++;const a=e(o,s),l=Wo(a);if(!a)throw new Error("Icon is missing.");if(!a.url)throw new Error("Icon url is missing.");!i[l]&&(!n[l]||a.url!==n[l].url)&&(i[l]={...a,source:o,sourceIndex:s.index})}return i}class VB{constructor(e,{onUpdate:n=ky,onError:i=ky}){this._loadOptions=null,this._texture=null,this._externalTexture=null,this._mapping={},this._textureParameters=null,this._pendingCount=0,this._autoPacking=!1,this._xOffset=0,this._yOffset=0,this._rowHeight=0,this._buffer=kB,this._canvasWidth=NB,this._canvasHeight=0,this._canvas=null,this.device=e,this.onUpdate=n,this.onError=i}finalize(){var e;(e=this._texture)==null||e.delete()}getTexture(){return this._texture||this._externalTexture}getIconMapping(e){const n=this._autoPacking?Wo(e):e;return this._mapping[n]||FB}setProps({loadOptions:e,autoPacking:n,iconAtlas:i,iconMapping:r,textureParameters:s}){var o;e&&(this._loadOptions=e),n!==void 0&&(this._autoPacking=n),r&&(this._mapping=r),i&&((o=this._texture)==null||o.delete(),this._texture=null,this._externalTexture=i),s&&(this._textureParameters=s)}get isLoaded(){return this._pendingCount===0}packIcons(e,n){if(!this._autoPacking||typeof document>"u")return;const i=Object.values(zB(e,n,this._mapping)||{});if(i.length>0){const{mapping:r,xOffset:s,yOffset:o,rowHeight:a,canvasHeight:l}=LB({icons:i,buffer:this._buffer,canvasWidth:this._canvasWidth,mapping:this._mapping,rowHeight:this._rowHeight,xOffset:this._xOffset,yOffset:this._yOffset});this._rowHeight=a,this._mapping=r,this._xOffset=s,this._yOffset=o,this._canvasHeight=l,this._texture||(this._texture=this.device.createTexture({format:"rgba8unorm",width:this._canvasWidth,height:this._canvasHeight,sampler:this._textureParameters||Fy})),this._texture.height!==this._canvasHeight&&(this._texture=UB(this._texture,this._canvasWidth,this._canvasHeight,this._textureParameters||Fy)),this.onUpdate(),this._canvas=this._canvas||document.createElement("canvas"),this._loadIcons(i)}}_loadIcons(e){const n=this._canvas.getContext("2d",{willReadFrequently:!0});for(const i of e)this._pendingCount++,fc(i.url,this._loadOptions).then(r=>{const s=Wo(i),o=this._mapping[s],{x:a,y:l,width:c,height:u}=o,{data:h,width:f,height:d}=BB(n,r,c,u);this._texture.setSubImageData({data:h,x:a+(c-f)/2,y:l+(u-d)/2,width:f,height:d}),o.width=f,o.height=d,this._texture.generateMipmap(),this.onUpdate()}).catch(r=>{this.onError({url:i.url,source:i.source,sourceIndex:i.sourceIndex,loadOptions:this._loadOptions,error:r})}).finally(()=>{this._pendingCount--})}}const LE=[0,0,0,255],jB={iconAtlas:{type:"image",value:null,async:!0},iconMapping:{type:"object",value:{},async:!0},sizeScale:{type:"number",value:1,min:0},billboard:!0,sizeUnits:"pixels",sizeMinPixels:{type:"number",min:0,value:0},sizeMaxPixels:{type:"number",min:0,value:Number.MAX_SAFE_INTEGER},alphaCutoff:{type:"number",value:.05,min:0,max:1},getPosition:{type:"accessor",value:t=>t.position},getIcon:{type:"accessor",value:t=>t.icon},getColor:{type:"accessor",value:LE},getSize:{type:"accessor",value:1},getAngle:{type:"accessor",value:0},getPixelOffset:{type:"accessor",value:[0,0]},onIconError:{type:"function",value:null,optional:!0},textureParameters:{type:"object",ignore:!0,value:null}},nu=class nu extends bn{getShaders(){return super.getShaders({vs:IB,fs:OB,modules:[la,ca]})}initializeState(){this.state={iconManager:new VB(this.context.device,{onUpdate:this._onUpdate.bind(this),onError:this._onError.bind(this)})},this.getAttributeManager().addInstanced({instancePositions:{size:3,type:"float64",fp64:this.use64bitPositions(),transition:!0,accessor:"getPosition"},instanceSizes:{size:1,transition:!0,accessor:"getSize",defaultValue:1},instanceOffsets:{size:2,accessor:"getIcon",transform:this.getInstanceOffset},instanceIconFrames:{size:4,accessor:"getIcon",transform:this.getInstanceIconFrame},instanceColorModes:{size:1,type:"uint8",accessor:"getIcon",transform:this.getInstanceColorMode},instanceColors:{size:this.props.colorFormat.length,type:"unorm8",transition:!0,accessor:"getColor",defaultValue:LE},instanceAngles:{size:1,transition:!0,accessor:"getAngle"},instancePixelOffset:{size:2,transition:!0,accessor:"getPixelOffset"}})}updateState(e){var d;super.updateState(e);const{props:n,oldProps:i,changeFlags:r}=e,s=this.getAttributeManager(),{iconAtlas:o,iconMapping:a,data:l,getIcon:c,textureParameters:u}=n,{iconManager:h}=this.state;if(typeof o=="string")return;const f=o||this.internalState.isAsyncPropLoading("iconAtlas");h.setProps({loadOptions:n.loadOptions,autoPacking:!f,iconAtlas:o,iconMapping:f?a:null,textureParameters:u}),f?i.iconMapping!==n.iconMapping&&s.invalidate("getIcon"):(r.dataChanged||r.updateTriggersChanged&&(r.updateTriggersChanged.all||r.updateTriggersChanged.getIcon))&&h.packIcons(l,c),r.extensionsChanged&&((d=this.state.model)==null||d.destroy(),this.state.model=this._getModel(),s.invalidateAll())}get isLoaded(){return super.isLoaded&&this.state.iconManager.isLoaded}finalizeState(e){super.finalizeState(e),this.state.iconManager.finalize()}draw({uniforms:e}){const{sizeScale:n,sizeMinPixels:i,sizeMaxPixels:r,sizeUnits:s,billboard:o,alphaCutoff:a}=this.props,{iconManager:l}=this.state,c=l.getTexture();if(c){const u=this.state.model;u.setBindings({iconsTexture:c}),u.setUniforms(e),u.setUniforms({iconsTextureDim:[c.width,c.height],sizeUnits:ji[s],sizeScale:n,sizeMinPixels:i,sizeMaxPixels:r,billboard:o,alphaCutoff:a}),u.draw(this.context.renderPass)}}_getModel(){const e=[-1,-1,1,-1,-1,1,1,1];return new Lt(this.context.device,{...this.getShaders(),id:this.props.id,bufferLayout:this.getAttributeManager().getBufferLayouts(),geometry:new ls({topology:"triangle-strip",attributes:{positions:{size:2,value:new Float32Array(e)}}}),isInstanced:!0})}_onUpdate(){this.setNeedsRedraw()}_onError(e){var i;const n=(i=this.getCurrentLayer())==null?void 0:i.props.onIconError;n?n(e):Q.error(e.error.message)()}getInstanceOffset(e){const{width:n,height:i,anchorX:r=n/2,anchorY:s=i/2}=this.state.iconManager.getIconMapping(e);return[n/2-r,i/2-s]}getInstanceColorMode(e){return this.state.iconManager.getIconMapping(e).mask?1:0}getInstanceIconFrame(e){const{x:n,y:i,width:r,height:s}=this.state.iconManager.getIconMapping(e);return[n,i,r,s]}};nu.defaultProps=jB,nu.layerName="IconLayer";let Ic=nu;const WB=`#version 300 es
#define SHADER_NAME scatterplot-layer-vertex-shader
in vec3 positions;
in vec3 instancePositions;
in vec3 instancePositions64Low;
in float instanceRadius;
in float instanceLineWidths;
in vec4 instanceFillColors;
in vec4 instanceLineColors;
in vec3 instancePickingColors;
uniform float opacity;
uniform float radiusScale;
uniform float radiusMinPixels;
uniform float radiusMaxPixels;
uniform float lineWidthScale;
uniform float lineWidthMinPixels;
uniform float lineWidthMaxPixels;
uniform float stroked;
uniform bool filled;
uniform bool antialiasing;
uniform bool billboard;
uniform int radiusUnits;
uniform int lineWidthUnits;
out vec4 vFillColor;
out vec4 vLineColor;
out vec2 unitPosition;
out float innerUnitRadius;
out float outerRadiusPixels;
void main(void) {
geometry.worldPosition = instancePositions;
outerRadiusPixels = clamp(
project_size_to_pixel(radiusScale * instanceRadius, radiusUnits),
radiusMinPixels, radiusMaxPixels
);
float lineWidthPixels = clamp(
project_size_to_pixel(lineWidthScale * instanceLineWidths, lineWidthUnits),
lineWidthMinPixels, lineWidthMaxPixels
);
outerRadiusPixels += stroked * lineWidthPixels / 2.0;
float edgePadding = antialiasing ? (outerRadiusPixels + SMOOTH_EDGE_RADIUS) / outerRadiusPixels : 1.0;
unitPosition = edgePadding * positions.xy;
geometry.uv = unitPosition;
geometry.pickingColor = instancePickingColors;
innerUnitRadius = 1.0 - stroked * lineWidthPixels / outerRadiusPixels;
if (billboard) {
gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, vec3(0.0), geometry.position);
DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
vec3 offset = edgePadding * positions * outerRadiusPixels;
DECKGL_FILTER_SIZE(offset, geometry);
gl_Position.xy += project_pixel_size_to_clipspace(offset.xy);
} else {
vec3 offset = edgePadding * positions * project_pixel_size(outerRadiusPixels);
DECKGL_FILTER_SIZE(offset, geometry);
gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, offset, geometry.position);
DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
}
vFillColor = vec4(instanceFillColors.rgb, instanceFillColors.a * opacity);
DECKGL_FILTER_COLOR(vFillColor, geometry);
vLineColor = vec4(instanceLineColors.rgb, instanceLineColors.a * opacity);
DECKGL_FILTER_COLOR(vLineColor, geometry);
}
`,HB=`#version 300 es
#define SHADER_NAME scatterplot-layer-fragment-shader
precision highp float;
uniform bool filled;
uniform float stroked;
uniform bool antialiasing;
in vec4 vFillColor;
in vec4 vLineColor;
in vec2 unitPosition;
in float innerUnitRadius;
in float outerRadiusPixels;
out vec4 fragColor;
void main(void) {
geometry.uv = unitPosition;
float distToCenter = length(unitPosition) * outerRadiusPixels;
float inCircle = antialiasing ?
smoothedge(distToCenter, outerRadiusPixels) :
step(distToCenter, outerRadiusPixels);
if (inCircle == 0.0) {
discard;
}
if (stroked > 0.5) {
float isLine = antialiasing ?
smoothedge(innerUnitRadius * outerRadiusPixels, distToCenter) :
step(innerUnitRadius * outerRadiusPixels, distToCenter);
if (filled) {
fragColor = mix(vFillColor, vLineColor, isLine);
} else {
if (isLine == 0.0) {
discard;
}
fragColor = vec4(vLineColor.rgb, vLineColor.a * isLine);
}
} else if (!filled) {
discard;
} else {
fragColor = vFillColor;
}
fragColor.a *= inCircle;
DECKGL_FILTER_COLOR(fragColor, geometry);
}
`,By=[0,0,0,255],$B={radiusUnits:"meters",radiusScale:{type:"number",min:0,value:1},radiusMinPixels:{type:"number",min:0,value:0},radiusMaxPixels:{type:"number",min:0,value:Number.MAX_SAFE_INTEGER},lineWidthUnits:"meters",lineWidthScale:{type:"number",min:0,value:1},lineWidthMinPixels:{type:"number",min:0,value:0},lineWidthMaxPixels:{type:"number",min:0,value:Number.MAX_SAFE_INTEGER},stroked:!1,filled:!0,billboard:!1,antialiasing:!0,getPosition:{type:"accessor",value:t=>t.position},getRadius:{type:"accessor",value:1},getFillColor:{type:"accessor",value:By},getLineColor:{type:"accessor",value:By},getLineWidth:{type:"accessor",value:1},strokeWidth:{deprecatedFor:"getLineWidth"},outline:{deprecatedFor:"stroked"},getColor:{deprecatedFor:["getFillColor","getLineColor"]}},iu=class iu extends bn{getShaders(){return super.getShaders({vs:WB,fs:HB,modules:[la,ca]})}initializeState(){this.getAttributeManager().addInstanced({instancePositions:{size:3,type:"float64",fp64:this.use64bitPositions(),transition:!0,accessor:"getPosition"},instanceRadius:{size:1,transition:!0,accessor:"getRadius",defaultValue:1},instanceFillColors:{size:this.props.colorFormat.length,transition:!0,type:"unorm8",accessor:"getFillColor",defaultValue:[0,0,0,255]},instanceLineColors:{size:this.props.colorFormat.length,transition:!0,type:"unorm8",accessor:"getLineColor",defaultValue:[0,0,0,255]},instanceLineWidths:{size:1,transition:!0,accessor:"getLineWidth",defaultValue:1}})}updateState(e){var n;super.updateState(e),e.changeFlags.extensionsChanged&&((n=this.state.model)==null||n.destroy(),this.state.model=this._getModel(),this.getAttributeManager().invalidateAll())}draw({uniforms:e}){const{radiusUnits:n,radiusScale:i,radiusMinPixels:r,radiusMaxPixels:s,stroked:o,filled:a,billboard:l,antialiasing:c,lineWidthUnits:u,lineWidthScale:h,lineWidthMinPixels:f,lineWidthMaxPixels:d}=this.props,p=this.state.model;p.setUniforms(e),p.setUniforms({stroked:o?1:0,filled:a,billboard:l,antialiasing:c,radiusUnits:ji[n],radiusScale:i,radiusMinPixels:r,radiusMaxPixels:s,lineWidthUnits:ji[u],lineWidthScale:h,lineWidthMinPixels:f,lineWidthMaxPixels:d}),p.draw(this.context.renderPass)}_getModel(){const e=[-1,-1,0,1,-1,0,-1,1,0,1,1,0];return new Lt(this.context.device,{...this.getShaders(),id:this.props.id,bufferLayout:this.getAttributeManager().getBufferLayouts(),geometry:new ls({topology:"triangle-strip",attributes:{positions:{size:3,value:new Float32Array(e)}}}),isInstanced:!0})}};iu.defaultProps=$B,iu.layerName="ScatterplotLayer";let Zd=iu;const zE={CLOCKWISE:1,COUNTER_CLOCKWISE:-1};function VE(t,e,n={}){return XB(t,n)!==e?(YB(t,n),!0):!1}function XB(t,e={}){return Math.sign(Nc(t,e))}const Oc={x:0,y:1,z:2};function Nc(t,e={}){const{start:n=0,end:i=t.length,plane:r="xy"}=e,s=e.size||2;let o=0;const a=Oc[r[0]],l=Oc[r[1]];for(let c=n,u=i-s;c<i;c+=s)o+=(t[c+a]-t[u+a])*(t[c+l]+t[u+l]),u=c;return o/2}function YB(t,e){const{start:n=0,end:i=t.length,size:r=2}=e,s=(i-n)/r,o=Math.floor(s/2);for(let a=0;a<o;++a){const l=n+a*r,c=n+(s-1-a)*r;for(let u=0;u<r;++u){const h=t[l+u];t[l+u]=t[c+u],t[c+u]=h}}}function KB(t,e,n=2,i,r="xy"){const s=e&&e.length,o=s?e[0]*n:t.length;let a=jE(t,0,o,n,!0,i&&i[0],r);const l=[];if(!a||a.next===a.prev)return l;let c,u,h,f,d,p,v;if(s&&(a=GB(t,e,a,n,i,r)),t.length>80*n){f=u=t[0],d=h=t[1];for(let A=n;A<o;A+=n)p=t[A],v=t[A+1],p<f&&(f=p),v<d&&(d=v),p>u&&(u=p),v>h&&(h=v);c=Math.max(u-f,h-d),c=c!==0?32767/c:0}return Ho(a,l,n,f,d,c,0),l}function jE(t,e,n,i,r,s,o){let a,l;s===void 0&&(s=Nc(t,{start:e,end:n,size:i,plane:o}));let c=Oc[o[0]],u=Oc[o[1]];if(r===s<0)for(a=e;a<n;a+=i)l=Uy(a,t[a+c],t[a+u],l);else for(a=n-i;a>=e;a-=i)l=Uy(a,t[a+c],t[a+u],l);return l&&Lu(l,l.next)&&(Xo(l),l=l.next),l}function $i(t,e){if(!t)return t;e||(e=t);let n=t,i;do if(i=!1,!n.steiner&&(Lu(n,n.next)||_e(n.prev,n,n.next)===0)){if(Xo(n),n=e=n.prev,n===n.next)break;i=!0}else n=n.next;while(i||n!==e);return e}function Ho(t,e,n,i,r,s,o){if(!t)return;!o&&s&&rU(t,i,r,s);let a=t,l,c;for(;t.prev!==t.next;){if(l=t.prev,c=t.next,s?ZB(t,i,r,s):qB(t)){e.push(l.i/n|0),e.push(t.i/n|0),e.push(c.i/n|0),Xo(t),t=c.next,a=c.next;continue}if(t=c,t===a){o?o===1?(t=QB($i(t),e,n),Ho(t,e,n,i,r,s,2)):o===2&&JB(t,e,n,i,r,s):Ho($i(t),e,n,i,r,s,1);break}}}function qB(t){const e=t.prev,n=t,i=t.next;if(_e(e,n,i)>=0)return!1;const r=e.x,s=n.x,o=i.x,a=e.y,l=n.y,c=i.y,u=r<s?r<o?r:o:s<o?s:o,h=a<l?a<c?a:c:l<c?l:c,f=r>s?r>o?r:o:s>o?s:o,d=a>l?a>c?a:c:l>c?l:c;let p=i.next;for(;p!==e;){if(p.x>=u&&p.x<=f&&p.y>=h&&p.y<=d&&kr(r,a,s,l,o,c,p.x,p.y)&&_e(p.prev,p,p.next)>=0)return!1;p=p.next}return!0}function ZB(t,e,n,i){const r=t.prev,s=t,o=t.next;if(_e(r,s,o)>=0)return!1;const a=r.x,l=s.x,c=o.x,u=r.y,h=s.y,f=o.y,d=a<l?a<c?a:c:l<c?l:c,p=u<h?u<f?u:f:h<f?h:f,v=a>l?a>c?a:c:l>c?l:c,A=u>h?u>f?u:f:h>f?h:f,y=Qd(d,p,e,n,i),g=Qd(v,A,e,n,i);let _=t.prevZ,E=t.nextZ;for(;_&&_.z>=y&&E&&E.z<=g;){if(_.x>=d&&_.x<=v&&_.y>=p&&_.y<=A&&_!==r&&_!==o&&kr(a,u,l,h,c,f,_.x,_.y)&&_e(_.prev,_,_.next)>=0||(_=_.prevZ,E.x>=d&&E.x<=v&&E.y>=p&&E.y<=A&&E!==r&&E!==o&&kr(a,u,l,h,c,f,E.x,E.y)&&_e(E.prev,E,E.next)>=0))return!1;E=E.nextZ}for(;_&&_.z>=y;){if(_.x>=d&&_.x<=v&&_.y>=p&&_.y<=A&&_!==r&&_!==o&&kr(a,u,l,h,c,f,_.x,_.y)&&_e(_.prev,_,_.next)>=0)return!1;_=_.prevZ}for(;E&&E.z<=g;){if(E.x>=d&&E.x<=v&&E.y>=p&&E.y<=A&&E!==r&&E!==o&&kr(a,u,l,h,c,f,E.x,E.y)&&_e(E.prev,E,E.next)>=0)return!1;E=E.nextZ}return!0}function QB(t,e,n){let i=t;do{const r=i.prev,s=i.next.next;!Lu(r,s)&&WE(r,i,i.next,s)&&$o(r,s)&&$o(s,r)&&(e.push(r.i/n|0),e.push(i.i/n|0),e.push(s.i/n|0),Xo(i),Xo(i.next),i=t=s),i=i.next}while(i!==t);return $i(i)}function JB(t,e,n,i,r,s){let o=t;do{let a=o.next.next;for(;a!==o.prev;){if(o.i!==a.i&&aU(o,a)){let l=HE(o,a);o=$i(o,o.next),l=$i(l,l.next),Ho(o,e,n,i,r,s,0),Ho(l,e,n,i,r,s,0);return}a=a.next}o=o.next}while(o!==t)}function GB(t,e,n,i,r,s){const o=[];let a,l,c,u,h;for(a=0,l=e.length;a<l;a++)c=e[a]*i,u=a<l-1?e[a+1]*i:t.length,h=jE(t,c,u,i,!1,r&&r[a+1],s),h===h.next&&(h.steiner=!0),o.push(oU(h));for(o.sort(eU),a=0;a<o.length;a++)n=tU(o[a],n);return n}function eU(t,e){return t.x-e.x}function tU(t,e){const n=nU(t,e);if(!n)return e;const i=HE(n,t);return $i(i,i.next),$i(n,n.next)}function nU(t,e){let n=e;const i=t.x,r=t.y;let s=-1/0,o;do{if(r<=n.y&&r>=n.next.y&&n.next.y!==n.y){const f=n.x+(r-n.y)*(n.next.x-n.x)/(n.next.y-n.y);if(f<=i&&f>s&&(s=f,o=n.x<n.next.x?n:n.next,f===i))return o}n=n.next}while(n!==e);if(!o)return null;const a=o,l=o.x,c=o.y;let u=1/0,h;n=o;do i>=n.x&&n.x>=l&&i!==n.x&&kr(r<c?i:s,r,l,c,r<c?s:i,r,n.x,n.y)&&(h=Math.abs(r-n.y)/(i-n.x),$o(n,t)&&(h<u||h===u&&(n.x>o.x||n.x===o.x&&iU(o,n)))&&(o=n,u=h)),n=n.next;while(n!==a);return o}function iU(t,e){return _e(t.prev,t,e.prev)<0&&_e(e.next,t,t.next)<0}function rU(t,e,n,i){let r=t;do r.z===0&&(r.z=Qd(r.x,r.y,e,n,i)),r.prevZ=r.prev,r.nextZ=r.next,r=r.next;while(r!==t);r.prevZ.nextZ=null,r.prevZ=null,sU(r)}function sU(t){let e,n,i=1,r,s,o,a,l,c;do{for(s=t,t=null,c=null,r=0;s;){for(r++,a=s,o=0,n=0;n<i&&(o++,a=a.nextZ,!!a);n++);for(l=i;o>0||l>0&&a;)o!==0&&(l===0||!a||s.z<=a.z)?(e=s,s=s.nextZ,o--):(e=a,a=a.nextZ,l--),c?c.nextZ=e:t=e,e.prevZ=c,c=e;s=a}c.nextZ=null,i*=2}while(r>1);return t}function Qd(t,e,n,i,r){return t=(t-n)*r|0,e=(e-i)*r|0,t=(t|t<<8)&16711935,t=(t|t<<4)&252645135,t=(t|t<<2)&858993459,t=(t|t<<1)&1431655765,e=(e|e<<8)&16711935,e=(e|e<<4)&252645135,e=(e|e<<2)&858993459,e=(e|e<<1)&1431655765,t|e<<1}function oU(t){let e=t,n=t;do(e.x<n.x||e.x===n.x&&e.y<n.y)&&(n=e),e=e.next;while(e!==t);return n}function kr(t,e,n,i,r,s,o,a){return(r-o)*(e-a)>=(t-o)*(s-a)&&(t-o)*(i-a)>=(n-o)*(e-a)&&(n-o)*(s-a)>=(r-o)*(i-a)}function aU(t,e){return t.next.i!==e.i&&t.prev.i!==e.i&&!lU(t,e)&&($o(t,e)&&$o(e,t)&&cU(t,e)&&(_e(t.prev,t,e.prev)||_e(t,e.prev,e))||Lu(t,e)&&_e(t.prev,t,t.next)>0&&_e(e.prev,e,e.next)>0)}function _e(t,e,n){return(e.y-t.y)*(n.x-e.x)-(e.x-t.x)*(n.y-e.y)}function Lu(t,e){return t.x===e.x&&t.y===e.y}function WE(t,e,n,i){const r=rl(_e(t,e,n)),s=rl(_e(t,e,i)),o=rl(_e(n,i,t)),a=rl(_e(n,i,e));return!!(r!==s&&o!==a||r===0&&il(t,n,e)||s===0&&il(t,i,e)||o===0&&il(n,t,i)||a===0&&il(n,e,i))}function il(t,e,n){return e.x<=Math.max(t.x,n.x)&&e.x>=Math.min(t.x,n.x)&&e.y<=Math.max(t.y,n.y)&&e.y>=Math.min(t.y,n.y)}function rl(t){return t>0?1:t<0?-1:0}function lU(t,e){let n=t;do{if(n.i!==t.i&&n.next.i!==t.i&&n.i!==e.i&&n.next.i!==e.i&&WE(n,n.next,t,e))return!0;n=n.next}while(n!==t);return!1}function $o(t,e){return _e(t.prev,t,t.next)<0?_e(t,e,t.next)>=0&&_e(t,t.prev,e)>=0:_e(t,e,t.prev)<0||_e(t,t.next,e)<0}function cU(t,e){let n=t,i=!1;const r=(t.x+e.x)/2,s=(t.y+e.y)/2;do n.y>s!=n.next.y>s&&n.next.y!==n.y&&r<(n.next.x-n.x)*(s-n.y)/(n.next.y-n.y)+n.x&&(i=!i),n=n.next;while(n!==t);return i}function HE(t,e){const n=new Jd(t.i,t.x,t.y),i=new Jd(e.i,e.x,e.y),r=t.next,s=e.prev;return t.next=e,e.prev=t,n.next=r,r.prev=n,i.next=n,n.prev=i,s.next=i,i.prev=s,i}function Uy(t,e,n,i){const r=new Jd(t,e,n);return i?(r.next=i.next,r.prev=i,i.next.prev=r,i.next=r):(r.prev=r,r.next=r),r}function Xo(t){t.next.prev=t.prev,t.prev.next=t.next,t.prevZ&&(t.prevZ.nextZ=t.nextZ),t.nextZ&&(t.nextZ.prevZ=t.prevZ)}class Jd{constructor(e,n,i){this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1,this.i=e,this.x=n,this.y=i}}function Dt(t,e){const n=e.length,i=t.length;if(i>0){let r=!0;for(let s=0;s<n;s++)if(t[i-n+s]!==e[s]){r=!1;break}if(r)return!1}for(let r=0;r<n;r++)t[i+r]=e[r];return!0}function Gd(t,e){const n=e.length;for(let i=0;i<n;i++)t[i]=e[i]}function Yo(t,e,n,i,r=[]){const s=i+e*n;for(let o=0;o<n;o++)r[o]=t[s+o];return r}function ep(t,e,n,i,r=[]){let s,o;if(n&8)s=(i[3]-t[1])/(e[1]-t[1]),o=3;else if(n&4)s=(i[1]-t[1])/(e[1]-t[1]),o=1;else if(n&2)s=(i[2]-t[0])/(e[0]-t[0]),o=2;else if(n&1)s=(i[0]-t[0])/(e[0]-t[0]),o=0;else return null;for(let a=0;a<t.length;a++)r[a]=(o&1)===a?i[o]:s*(e[a]-t[a])+t[a];return r}function Fl(t,e){let n=0;return t[0]<e[0]?n|=1:t[0]>e[2]&&(n|=2),t[1]<e[1]?n|=4:t[1]>e[3]&&(n|=8),n}function $E(t,e){const{size:n=2,broken:i=!1,gridResolution:r=10,gridOffset:s=[0,0],startIndex:o=0,endIndex:a=t.length}=e||{},l=(a-o)/n;let c=[];const u=[c],h=Yo(t,0,n,o);let f,d;const p=YE(h,r,s,[]),v=[];Dt(c,h);for(let A=1;A<l;A++){for(f=Yo(t,A,n,o,f),d=Fl(f,p);d;){ep(h,f,d,p,v);const y=Fl(v,p);y&&(ep(h,v,y,p,v),d=y),Dt(c,v),Gd(h,v),hU(p,r,d),i&&c.length>n&&(c=[],u.push(c),Dt(c,h)),d=Fl(f,p)}Dt(c,f),Gd(h,f)}return i?u:u[0]}const Ly=0,uU=1;function XE(t,e=null,n){if(!t.length)return[];const{size:i=2,gridResolution:r=10,gridOffset:s=[0,0],edgeTypes:o=!1}=n||{},a=[],l=[{pos:t,types:o?new Array(t.length/i).fill(uU):null,holes:e||[]}],c=[[],[]];let u=[];for(;l.length;){const{pos:h,types:f,holes:d}=l.shift();fU(h,i,d[0]||h.length,c),u=YE(c[0],r,s,u);const p=Fl(c[1],u);if(p){let v=zy(h,f,i,0,d[0]||h.length,u,p);const A={pos:v[0].pos,types:v[0].types,holes:[]},y={pos:v[1].pos,types:v[1].types,holes:[]};l.push(A,y);for(let g=0;g<d.length;g++)v=zy(h,f,i,d[g],d[g+1]||h.length,u,p),v[0]&&(A.holes.push(A.pos.length),A.pos=sl(A.pos,v[0].pos),o&&(A.types=sl(A.types,v[0].types))),v[1]&&(y.holes.push(y.pos.length),y.pos=sl(y.pos,v[1].pos),o&&(y.types=sl(y.types,v[1].types)))}else{const v={positions:h};o&&(v.edgeTypes=f),d.length&&(v.holeIndices=d),a.push(v)}}return a}function zy(t,e,n,i,r,s,o){const a=(r-i)/n,l=[],c=[],u=[],h=[],f=[];let d,p,v;const A=Yo(t,a-1,n,i);let y=Math.sign(o&8?A[1]-s[3]:A[0]-s[2]),g=e&&e[a-1],_=0,E=0;for(let R=0;R<a;R++)d=Yo(t,R,n,i,d),p=Math.sign(o&8?d[1]-s[3]:d[0]-s[2]),v=e&&e[i/n+R],p&&y&&y!==p&&(ep(A,d,o,s,f),Dt(l,f)&&u.push(g),Dt(c,f)&&h.push(g)),p<=0?(Dt(l,d)&&u.push(v),_-=p):u.length&&(u[u.length-1]=Ly),p>=0?(Dt(c,d)&&h.push(v),E+=p):h.length&&(h[h.length-1]=Ly),Gd(A,d),y=p,g=v;return[_?{pos:l,types:e&&u}:null,E?{pos:c,types:e&&h}:null]}function YE(t,e,n,i){const r=Math.floor((t[0]-n[0])/e)*e+n[0],s=Math.floor((t[1]-n[1])/e)*e+n[1];return i[0]=r,i[1]=s,i[2]=r+e,i[3]=s+e,i}function hU(t,e,n){n&8?(t[1]+=e,t[3]+=e):n&4?(t[1]-=e,t[3]-=e):n&2?(t[0]+=e,t[2]+=e):n&1&&(t[0]-=e,t[2]-=e)}function fU(t,e,n,i){let r=1/0,s=-1/0,o=1/0,a=-1/0;for(let l=0;l<n;l+=e){const c=t[l],u=t[l+1];r=c<r?c:r,s=c>s?c:s,o=u<o?u:o,a=u>a?u:a}return i[0][0]=r,i[0][1]=o,i[1][0]=s,i[1][1]=a,i}function sl(t,e){for(let n=0;n<e.length;n++)t.push(e[n]);return t}const dU=85.051129;function pU(t,e){const{size:n=2,startIndex:i=0,endIndex:r=t.length,normalize:s=!0}=e||{},o=t.slice(i,r);KE(o,n,0,r-i);const a=$E(o,{size:n,broken:!0,gridResolution:360,gridOffset:[-180,-180]});if(s)for(const l of a)qE(l,n);return a}function gU(t,e=null,n){const{size:i=2,normalize:r=!0,edgeTypes:s=!1}=n||{};e=e||[];const o=[],a=[];let l=0,c=0;for(let h=0;h<=e.length;h++){const f=e[h]||t.length,d=c,p=_U(t,i,l,f);for(let v=p;v<f;v++)o[c++]=t[v];for(let v=l;v<p;v++)o[c++]=t[v];KE(o,i,d,c),mU(o,i,d,c,n==null?void 0:n.maxLatitude),l=f,a[h]=c}a.pop();const u=XE(o,a,{size:i,gridResolution:360,gridOffset:[-180,-180],edgeTypes:s});if(r)for(const h of u)qE(h.positions,i);return u}function _U(t,e,n,i){let r=-1,s=-1;for(let o=n+1;o<i;o+=e){const a=Math.abs(t[o]);a>r&&(r=a,s=o-1)}return s}function mU(t,e,n,i,r=dU){const s=t[n],o=t[i-e];if(Math.abs(s-o)>180){const a=Yo(t,0,e,n);a[0]+=Math.round((o-s)/360)*360,Dt(t,a),a[1]=Math.sign(a[1])*r,Dt(t,a),a[0]=s,Dt(t,a)}}function KE(t,e,n,i){let r=t[0],s;for(let o=n;o<i;o+=e){s=t[o];const a=s-r;(a>180||a<-180)&&(s-=Math.round(a/360)*360),t[o]=r=s}}function qE(t,e){let n;const i=t.length/e;for(let s=0;s<i&&(n=t[s*e],(n+180)%360===0);s++);const r=-Math.round(n/360)*360;if(r!==0)for(let s=0;s<i;s++)t[s*e]+=r}function yU(t,e,n,i){let r;if(Array.isArray(t[0])){const s=t.length*e;r=new Array(s);for(let o=0;o<t.length;o++)for(let a=0;a<e;a++)r[o*e+a]=t[o][a]||0}else r=t;return n?$E(r,{size:e,gridResolution:n}):i?pU(r,{size:e}):r}const vU=1,TU=2,rf=4;class wU extends FE{constructor(e){super({...e,attributes:{positions:{size:3,padding:18,initialize:!0,type:e.fp64?Float64Array:Float32Array},segmentTypes:{size:1,type:Uint8ClampedArray}}})}get(e){return this.attributes[e]}getGeometryFromBuffer(e){return this.normalize?super.getGeometryFromBuffer(e):null}normalizeGeometry(e){return this.normalize?yU(e,this.positionSize,this.opts.resolution,this.opts.wrapLongitude):e}getGeometrySize(e){if(Vy(e)){let i=0;for(const r of e)i+=this.getGeometrySize(r);return i}const n=this.getPathLength(e);return n<2?0:this.isClosed(e)?n<3?0:n+2:n}updateGeometryAttributes(e,n){if(n.geometrySize!==0)if(e&&Vy(e))for(const i of e){const r=this.getGeometrySize(i);n.geometrySize=r,this.updateGeometryAttributes(i,n),n.vertexStart+=r}else this._updateSegmentTypes(e,n),this._updatePositions(e,n)}_updateSegmentTypes(e,n){const i=this.attributes.segmentTypes,r=e?this.isClosed(e):!1,{vertexStart:s,geometrySize:o}=n;i.fill(0,s,s+o),r?(i[s]=rf,i[s+o-2]=rf):(i[s]+=vU,i[s+o-2]+=TU),i[s+o-1]=rf}_updatePositions(e,n){const{positions:i}=this.attributes;if(!i||!e)return;const{vertexStart:r,geometrySize:s}=n,o=new Array(3);for(let a=r,l=0;l<s;a++,l++)this.getPointOnPath(e,l,o),i[a*3]=o[0],i[a*3+1]=o[1],i[a*3+2]=o[2]}getPathLength(e){return e.length/this.positionSize}getPointOnPath(e,n,i=[]){const{positionSize:r}=this;n*r>=e.length&&(n+=1-e.length/r);const s=n*r;return i[0]=e[s],i[1]=e[s+1],i[2]=r===3&&e[s+2]||0,i}isClosed(e){if(!this.normalize)return!!this.opts.loop;const{positionSize:n}=this,i=e.length-n;return e[0]===e[i]&&e[1]===e[i+1]&&(n===2||e[2]===e[i+2])}}function Vy(t){return Array.isArray(t[0])}const EU=`#version 300 es
#define SHADER_NAME path-layer-vertex-shader
in vec2 positions;
in float instanceTypes;
in vec3 instanceStartPositions;
in vec3 instanceEndPositions;
in vec3 instanceLeftPositions;
in vec3 instanceRightPositions;
in vec3 instanceLeftPositions64Low;
in vec3 instanceStartPositions64Low;
in vec3 instanceEndPositions64Low;
in vec3 instanceRightPositions64Low;
in float instanceStrokeWidths;
in vec4 instanceColors;
in vec3 instancePickingColors;
uniform float widthScale;
uniform float widthMinPixels;
uniform float widthMaxPixels;
uniform float jointType;
uniform float capType;
uniform float miterLimit;
uniform bool billboard;
uniform int widthUnits;
uniform float opacity;
out vec4 vColor;
out vec2 vCornerOffset;
out float vMiterLength;
out vec2 vPathPosition;
out float vPathLength;
out float vJointType;
const float EPSILON = 0.001;
const vec3 ZERO_OFFSET = vec3(0.0);
float flipIfTrue(bool flag) {
return -(float(flag) * 2. - 1.);
}
vec3 getLineJoinOffset(
vec3 prevPoint, vec3 currPoint, vec3 nextPoint,
vec2 width
) {
bool isEnd = positions.x > 0.0;
float sideOfPath = positions.y;
float isJoint = float(sideOfPath == 0.0);
vec3 deltaA3 = (currPoint - prevPoint);
vec3 deltaB3 = (nextPoint - currPoint);
mat3 rotationMatrix;
bool needsRotation = !billboard && project_needs_rotation(currPoint, rotationMatrix);
if (needsRotation) {
deltaA3 = deltaA3 * rotationMatrix;
deltaB3 = deltaB3 * rotationMatrix;
}
vec2 deltaA = deltaA3.xy / width;
vec2 deltaB = deltaB3.xy / width;
float lenA = length(deltaA);
float lenB = length(deltaB);
vec2 dirA = lenA > 0. ? normalize(deltaA) : vec2(0.0, 0.0);
vec2 dirB = lenB > 0. ? normalize(deltaB) : vec2(0.0, 0.0);
vec2 perpA = vec2(-dirA.y, dirA.x);
vec2 perpB = vec2(-dirB.y, dirB.x);
vec2 tangent = dirA + dirB;
tangent = length(tangent) > 0. ? normalize(tangent) : perpA;
vec2 miterVec = vec2(-tangent.y, tangent.x);
vec2 dir = isEnd ? dirA : dirB;
vec2 perp = isEnd ? perpA : perpB;
float L = isEnd ? lenA : lenB;
float sinHalfA = abs(dot(miterVec, perp));
float cosHalfA = abs(dot(dirA, miterVec));
float turnDirection = flipIfTrue(dirA.x * dirB.y >= dirA.y * dirB.x);
float cornerPosition = sideOfPath * turnDirection;
float miterSize = 1.0 / max(sinHalfA, EPSILON);
miterSize = mix(
min(miterSize, max(lenA, lenB) / max(cosHalfA, EPSILON)),
miterSize,
step(0.0, cornerPosition)
);
vec2 offsetVec = mix(miterVec * miterSize, perp, step(0.5, cornerPosition))
* (sideOfPath + isJoint * turnDirection);
bool isStartCap = lenA == 0.0 || (!isEnd && (instanceTypes == 1.0 || instanceTypes == 3.0));
bool isEndCap = lenB == 0.0 || (isEnd && (instanceTypes == 2.0 || instanceTypes == 3.0));
bool isCap = isStartCap || isEndCap;
if (isCap) {
offsetVec = mix(perp * sideOfPath, dir * capType * 4.0 * flipIfTrue(isStartCap), isJoint);
vJointType = capType;
} else {
vJointType = jointType;
}
vPathLength = L;
vCornerOffset = offsetVec;
vMiterLength = dot(vCornerOffset, miterVec * turnDirection);
vMiterLength = isCap ? isJoint : vMiterLength;
vec2 offsetFromStartOfPath = vCornerOffset + deltaA * float(isEnd);
vPathPosition = vec2(
dot(offsetFromStartOfPath, perp),
dot(offsetFromStartOfPath, dir)
);
geometry.uv = vPathPosition;
float isValid = step(instanceTypes, 3.5);
vec3 offset = vec3(offsetVec * width * isValid, 0.0);
if (needsRotation) {
offset = rotationMatrix * offset;
}
return offset;
}
void clipLine(inout vec4 position, vec4 refPosition) {
if (position.w < EPSILON) {
float r = (EPSILON - refPosition.w) / (position.w - refPosition.w);
position = refPosition + (position - refPosition) * r;
}
}
void main() {
geometry.pickingColor = instancePickingColors;
vColor = vec4(instanceColors.rgb, instanceColors.a * opacity);
float isEnd = positions.x;
vec3 prevPosition = mix(instanceLeftPositions, instanceStartPositions, isEnd);
vec3 prevPosition64Low = mix(instanceLeftPositions64Low, instanceStartPositions64Low, isEnd);
vec3 currPosition = mix(instanceStartPositions, instanceEndPositions, isEnd);
vec3 currPosition64Low = mix(instanceStartPositions64Low, instanceEndPositions64Low, isEnd);
vec3 nextPosition = mix(instanceEndPositions, instanceRightPositions, isEnd);
vec3 nextPosition64Low = mix(instanceEndPositions64Low, instanceRightPositions64Low, isEnd);
geometry.worldPosition = currPosition;
vec2 widthPixels = vec2(clamp(
project_size_to_pixel(instanceStrokeWidths * widthScale, widthUnits),
widthMinPixels, widthMaxPixels) / 2.0);
vec3 width;
if (billboard) {
vec4 prevPositionScreen = project_position_to_clipspace(prevPosition, prevPosition64Low, ZERO_OFFSET);
vec4 currPositionScreen = project_position_to_clipspace(currPosition, currPosition64Low, ZERO_OFFSET, geometry.position);
vec4 nextPositionScreen = project_position_to_clipspace(nextPosition, nextPosition64Low, ZERO_OFFSET);
clipLine(prevPositionScreen, currPositionScreen);
clipLine(nextPositionScreen, currPositionScreen);
clipLine(currPositionScreen, mix(nextPositionScreen, prevPositionScreen, isEnd));
width = vec3(widthPixels, 0.0);
DECKGL_FILTER_SIZE(width, geometry);
vec3 offset = getLineJoinOffset(
prevPositionScreen.xyz / prevPositionScreen.w,
currPositionScreen.xyz / currPositionScreen.w,
nextPositionScreen.xyz / nextPositionScreen.w,
project_pixel_size_to_clipspace(width.xy)
);
DECKGL_FILTER_GL_POSITION(currPositionScreen, geometry);
gl_Position = vec4(currPositionScreen.xyz + offset * currPositionScreen.w, currPositionScreen.w);
} else {
prevPosition = project_position(prevPosition, prevPosition64Low);
currPosition = project_position(currPosition, currPosition64Low);
nextPosition = project_position(nextPosition, nextPosition64Low);
width = vec3(project_pixel_size(widthPixels), 0.0);
DECKGL_FILTER_SIZE(width, geometry);
vec3 offset = getLineJoinOffset(prevPosition, currPosition, nextPosition, width.xy);
geometry.position = vec4(currPosition + offset, 1.0);
gl_Position = project_common_position_to_clipspace(geometry.position);
DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
}
DECKGL_FILTER_COLOR(vColor, geometry);
}
`,SU=`#version 300 es
#define SHADER_NAME path-layer-fragment-shader
precision highp float;
uniform float miterLimit;
in vec4 vColor;
in vec2 vCornerOffset;
in float vMiterLength;
in vec2 vPathPosition;
in float vPathLength;
in float vJointType;
out vec4 fragColor;
void main(void) {
geometry.uv = vPathPosition;
if (vPathPosition.y < 0.0 || vPathPosition.y > vPathLength) {
if (vJointType > 0.5 && length(vCornerOffset) > 1.0) {
discard;
}
if (vJointType < 0.5 && vMiterLength > miterLimit + 1.0) {
discard;
}
}
fragColor = vColor;
DECKGL_FILTER_COLOR(fragColor, geometry);
}
`,ZE=[0,0,0,255],AU={widthUnits:"meters",widthScale:{type:"number",min:0,value:1},widthMinPixels:{type:"number",min:0,value:0},widthMaxPixels:{type:"number",min:0,value:Number.MAX_SAFE_INTEGER},jointRounded:!1,capRounded:!1,miterLimit:{type:"number",min:0,value:4},billboard:!1,_pathType:null,getPath:{type:"accessor",value:t=>t.path},getColor:{type:"accessor",value:ZE},getWidth:{type:"accessor",value:1},rounded:{deprecatedFor:["jointRounded","capRounded"]}},sf={enter:(t,e)=>e.length?e.subarray(e.length-t.length):t},ru=class ru extends bn{getShaders(){return super.getShaders({vs:EU,fs:SU,modules:[la,ca]})}get wrapLongitude(){return!1}getBounds(){var e;return(e=this.getAttributeManager())==null?void 0:e.getBounds(["vertexPositions"])}initializeState(){this.getAttributeManager().addInstanced({vertexPositions:{size:3,vertexOffset:1,type:"float64",fp64:this.use64bitPositions(),transition:sf,accessor:"getPath",update:this.calculatePositions,noAlloc:!0,shaderAttributes:{instanceLeftPositions:{vertexOffset:0},instanceStartPositions:{vertexOffset:1},instanceEndPositions:{vertexOffset:2},instanceRightPositions:{vertexOffset:3}}},instanceTypes:{size:1,type:"uint8",update:this.calculateSegmentTypes,noAlloc:!0},instanceStrokeWidths:{size:1,accessor:"getWidth",transition:sf,defaultValue:1},instanceColors:{size:this.props.colorFormat.length,type:"unorm8",accessor:"getColor",transition:sf,defaultValue:ZE},instancePickingColors:{size:4,type:"uint8",accessor:(i,{index:r,target:s})=>this.encodePickingColor(i&&i.__source?i.__source.index:r,s)}}),this.setState({pathTesselator:new wU({fp64:this.use64bitPositions()})})}updateState(e){var o;super.updateState(e);const{props:n,changeFlags:i}=e,r=this.getAttributeManager();if(i.dataChanged||i.updateTriggersChanged&&(i.updateTriggersChanged.all||i.updateTriggersChanged.getPath)){const{pathTesselator:a}=this.state,l=n.data.attributes||{};a.updateGeometry({data:n.data,geometryBuffer:l.getPath,buffers:l,normalize:!n._pathType,loop:n._pathType==="loop",getGeometry:n.getPath,positionFormat:n.positionFormat,wrapLongitude:n.wrapLongitude,resolution:this.context.viewport.resolution,dataChanged:i.dataChanged}),this.setState({numInstances:a.instanceCount,startIndices:a.vertexStarts}),i.dataChanged||r.invalidateAll()}i.extensionsChanged&&((o=this.state.model)==null||o.destroy(),this.state.model=this._getModel(),r.invalidateAll())}getPickingInfo(e){const n=super.getPickingInfo(e),{index:i}=n,r=this.props.data;return r[0]&&r[0].__source&&(n.object=r.find(s=>s.__source.index===i)),n}disablePickingIndex(e){const n=this.props.data;if(n[0]&&n[0].__source)for(let i=0;i<n.length;i++)n[i].__source.index===e&&this._disablePickingIndex(i);else super.disablePickingIndex(e)}draw({uniforms:e}){const{jointRounded:n,capRounded:i,billboard:r,miterLimit:s,widthUnits:o,widthScale:a,widthMinPixels:l,widthMaxPixels:c}=this.props,u=this.state.model;u.setUniforms(e),u.setUniforms({jointType:Number(n),capType:Number(i),billboard:r,widthUnits:ji[o],widthScale:a,miterLimit:s,widthMinPixels:l,widthMaxPixels:c}),u.draw(this.context.renderPass)}_getModel(){const e=[0,1,2,1,4,2,1,3,4,3,5,4],n=[0,0,0,-1,0,1,1,-1,1,1,1,0];return new Lt(this.context.device,{...this.getShaders(),id:this.props.id,bufferLayout:this.getAttributeManager().getBufferLayouts(),geometry:new ls({topology:"triangle-list",attributes:{indices:new Uint16Array(e),positions:{value:new Float32Array(n),size:2}}}),isInstanced:!0})}calculatePositions(e){const{pathTesselator:n}=this.state;e.startIndices=n.vertexStarts,e.value=n.get("positions")}calculateSegmentTypes(e){const{pathTesselator:n}=this.state;e.startIndices=n.vertexStarts,e.value=n.get("segmentTypes")}};ru.defaultProps=AU,ru.layerName="PathLayer";let tp=ru;var Fg={exports:{}};Fg.exports=zu;Fg.exports.default=zu;function zu(t,e,n){n=n||2;var i=e&&e.length,r=i?e[0]*n:t.length,s=QE(t,0,r,n,!0),o=[];if(!s||s.next===s.prev)return o;var a,l,c,u,h,f,d;if(i&&(s=PU(t,e,s,n)),t.length>80*n){a=c=t[0],l=u=t[1];for(var p=n;p<r;p+=n)h=t[p],f=t[p+1],h<a&&(a=h),f<l&&(l=f),h>c&&(c=h),f>u&&(u=f);d=Math.max(c-a,u-l),d=d!==0?32767/d:0}return Ko(s,o,n,a,l,d,0),o}function QE(t,e,n,i,r){var s,o;if(r===rp(t,e,n,i)>0)for(s=e;s<n;s+=i)o=jy(s,t[s],t[s+1],o);else for(s=n-i;s>=e;s-=i)o=jy(s,t[s],t[s+1],o);return o&&Vu(o,o.next)&&(Zo(o),o=o.next),o}function Xi(t,e){if(!t)return t;e||(e=t);var n=t,i;do if(i=!1,!n.steiner&&(Vu(n,n.next)||me(n.prev,n,n.next)===0)){if(Zo(n),n=e=n.prev,n===n.next)break;i=!0}else n=n.next;while(i||n!==e);return e}function Ko(t,e,n,i,r,s,o){if(t){!o&&s&&kU(t,i,r,s);for(var a=t,l,c;t.prev!==t.next;){if(l=t.prev,c=t.next,s?RU(t,i,r,s):xU(t)){e.push(l.i/n|0),e.push(t.i/n|0),e.push(c.i/n|0),Zo(t),t=c.next,a=c.next;continue}if(t=c,t===a){o?o===1?(t=bU(Xi(t),e,n),Ko(t,e,n,i,r,s,2)):o===2&&CU(t,e,n,i,r,s):Ko(Xi(t),e,n,i,r,s,1);break}}}}function xU(t){var e=t.prev,n=t,i=t.next;if(me(e,n,i)>=0)return!1;for(var r=e.x,s=n.x,o=i.x,a=e.y,l=n.y,c=i.y,u=r<s?r<o?r:o:s<o?s:o,h=a<l?a<c?a:c:l<c?l:c,f=r>s?r>o?r:o:s>o?s:o,d=a>l?a>c?a:c:l>c?l:c,p=i.next;p!==e;){if(p.x>=u&&p.x<=f&&p.y>=h&&p.y<=d&&Fr(r,a,s,l,o,c,p.x,p.y)&&me(p.prev,p,p.next)>=0)return!1;p=p.next}return!0}function RU(t,e,n,i){var r=t.prev,s=t,o=t.next;if(me(r,s,o)>=0)return!1;for(var a=r.x,l=s.x,c=o.x,u=r.y,h=s.y,f=o.y,d=a<l?a<c?a:c:l<c?l:c,p=u<h?u<f?u:f:h<f?h:f,v=a>l?a>c?a:c:l>c?l:c,A=u>h?u>f?u:f:h>f?h:f,y=np(d,p,e,n,i),g=np(v,A,e,n,i),_=t.prevZ,E=t.nextZ;_&&_.z>=y&&E&&E.z<=g;){if(_.x>=d&&_.x<=v&&_.y>=p&&_.y<=A&&_!==r&&_!==o&&Fr(a,u,l,h,c,f,_.x,_.y)&&me(_.prev,_,_.next)>=0||(_=_.prevZ,E.x>=d&&E.x<=v&&E.y>=p&&E.y<=A&&E!==r&&E!==o&&Fr(a,u,l,h,c,f,E.x,E.y)&&me(E.prev,E,E.next)>=0))return!1;E=E.nextZ}for(;_&&_.z>=y;){if(_.x>=d&&_.x<=v&&_.y>=p&&_.y<=A&&_!==r&&_!==o&&Fr(a,u,l,h,c,f,_.x,_.y)&&me(_.prev,_,_.next)>=0)return!1;_=_.prevZ}for(;E&&E.z<=g;){if(E.x>=d&&E.x<=v&&E.y>=p&&E.y<=A&&E!==r&&E!==o&&Fr(a,u,l,h,c,f,E.x,E.y)&&me(E.prev,E,E.next)>=0)return!1;E=E.nextZ}return!0}function bU(t,e,n){var i=t;do{var r=i.prev,s=i.next.next;!Vu(r,s)&&JE(r,i,i.next,s)&&qo(r,s)&&qo(s,r)&&(e.push(r.i/n|0),e.push(i.i/n|0),e.push(s.i/n|0),Zo(i),Zo(i.next),i=t=s),i=i.next}while(i!==t);return Xi(i)}function CU(t,e,n,i,r,s){var o=t;do{for(var a=o.next.next;a!==o.prev;){if(o.i!==a.i&&BU(o,a)){var l=GE(o,a);o=Xi(o,o.next),l=Xi(l,l.next),Ko(o,e,n,i,r,s,0),Ko(l,e,n,i,r,s,0);return}a=a.next}o=o.next}while(o!==t)}function PU(t,e,n,i){var r=[],s,o,a,l,c;for(s=0,o=e.length;s<o;s++)a=e[s]*i,l=s<o-1?e[s+1]*i:t.length,c=QE(t,a,l,i,!1),c===c.next&&(c.steiner=!0),r.push(DU(c));for(r.sort(MU),s=0;s<r.length;s++)n=IU(r[s],n);return n}function MU(t,e){return t.x-e.x}function IU(t,e){var n=OU(t,e);if(!n)return e;var i=GE(n,t);return Xi(i,i.next),Xi(n,n.next)}function OU(t,e){var n=e,i=t.x,r=t.y,s=-1/0,o;do{if(r<=n.y&&r>=n.next.y&&n.next.y!==n.y){var a=n.x+(r-n.y)*(n.next.x-n.x)/(n.next.y-n.y);if(a<=i&&a>s&&(s=a,o=n.x<n.next.x?n:n.next,a===i))return o}n=n.next}while(n!==e);if(!o)return null;var l=o,c=o.x,u=o.y,h=1/0,f;n=o;do i>=n.x&&n.x>=c&&i!==n.x&&Fr(r<u?i:s,r,c,u,r<u?s:i,r,n.x,n.y)&&(f=Math.abs(r-n.y)/(i-n.x),qo(n,t)&&(f<h||f===h&&(n.x>o.x||n.x===o.x&&NU(o,n)))&&(o=n,h=f)),n=n.next;while(n!==l);return o}function NU(t,e){return me(t.prev,t,e.prev)<0&&me(e.next,t,t.next)<0}function kU(t,e,n,i){var r=t;do r.z===0&&(r.z=np(r.x,r.y,e,n,i)),r.prevZ=r.prev,r.nextZ=r.next,r=r.next;while(r!==t);r.prevZ.nextZ=null,r.prevZ=null,FU(r)}function FU(t){var e,n,i,r,s,o,a,l,c=1;do{for(n=t,t=null,s=null,o=0;n;){for(o++,i=n,a=0,e=0;e<c&&(a++,i=i.nextZ,!!i);e++);for(l=c;a>0||l>0&&i;)a!==0&&(l===0||!i||n.z<=i.z)?(r=n,n=n.nextZ,a--):(r=i,i=i.nextZ,l--),s?s.nextZ=r:t=r,r.prevZ=s,s=r;n=i}s.nextZ=null,c*=2}while(o>1);return t}function np(t,e,n,i,r){return t=(t-n)*r|0,e=(e-i)*r|0,t=(t|t<<8)&16711935,t=(t|t<<4)&252645135,t=(t|t<<2)&858993459,t=(t|t<<1)&1431655765,e=(e|e<<8)&16711935,e=(e|e<<4)&252645135,e=(e|e<<2)&858993459,e=(e|e<<1)&1431655765,t|e<<1}function DU(t){var e=t,n=t;do(e.x<n.x||e.x===n.x&&e.y<n.y)&&(n=e),e=e.next;while(e!==t);return n}function Fr(t,e,n,i,r,s,o,a){return(r-o)*(e-a)>=(t-o)*(s-a)&&(t-o)*(i-a)>=(n-o)*(e-a)&&(n-o)*(s-a)>=(r-o)*(i-a)}function BU(t,e){return t.next.i!==e.i&&t.prev.i!==e.i&&!UU(t,e)&&(qo(t,e)&&qo(e,t)&&LU(t,e)&&(me(t.prev,t,e.prev)||me(t,e.prev,e))||Vu(t,e)&&me(t.prev,t,t.next)>0&&me(e.prev,e,e.next)>0)}function me(t,e,n){return(e.y-t.y)*(n.x-e.x)-(e.x-t.x)*(n.y-e.y)}function Vu(t,e){return t.x===e.x&&t.y===e.y}function JE(t,e,n,i){var r=al(me(t,e,n)),s=al(me(t,e,i)),o=al(me(n,i,t)),a=al(me(n,i,e));return!!(r!==s&&o!==a||r===0&&ol(t,n,e)||s===0&&ol(t,i,e)||o===0&&ol(n,t,i)||a===0&&ol(n,e,i))}function ol(t,e,n){return e.x<=Math.max(t.x,n.x)&&e.x>=Math.min(t.x,n.x)&&e.y<=Math.max(t.y,n.y)&&e.y>=Math.min(t.y,n.y)}function al(t){return t>0?1:t<0?-1:0}function UU(t,e){var n=t;do{if(n.i!==t.i&&n.next.i!==t.i&&n.i!==e.i&&n.next.i!==e.i&&JE(n,n.next,t,e))return!0;n=n.next}while(n!==t);return!1}function qo(t,e){return me(t.prev,t,t.next)<0?me(t,e,t.next)>=0&&me(t,t.prev,e)>=0:me(t,e,t.prev)<0||me(t,t.next,e)<0}function LU(t,e){var n=t,i=!1,r=(t.x+e.x)/2,s=(t.y+e.y)/2;do n.y>s!=n.next.y>s&&n.next.y!==n.y&&r<(n.next.x-n.x)*(s-n.y)/(n.next.y-n.y)+n.x&&(i=!i),n=n.next;while(n!==t);return i}function GE(t,e){var n=new ip(t.i,t.x,t.y),i=new ip(e.i,e.x,e.y),r=t.next,s=e.prev;return t.next=e,e.prev=t,n.next=r,r.prev=n,i.next=n,n.prev=i,s.next=i,i.prev=s,i}function jy(t,e,n,i){var r=new ip(t,e,n);return i?(r.next=i.next,r.prev=i,i.next.prev=r,i.next=r):(r.prev=r,r.next=r),r}function Zo(t){t.next.prev=t.prev,t.prev.next=t.next,t.prevZ&&(t.prevZ.nextZ=t.nextZ),t.nextZ&&(t.nextZ.prevZ=t.prevZ)}function ip(t,e,n){this.i=t,this.x=e,this.y=n,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}zu.deviation=function(t,e,n,i){var r=e&&e.length,s=r?e[0]*n:t.length,o=Math.abs(rp(t,0,s,n));if(r)for(var a=0,l=e.length;a<l;a++){var c=e[a]*n,u=a<l-1?e[a+1]*n:t.length;o-=Math.abs(rp(t,c,u,n))}var h=0;for(a=0;a<i.length;a+=3){var f=i[a]*n,d=i[a+1]*n,p=i[a+2]*n;h+=Math.abs((t[f]-t[p])*(t[d+1]-t[f+1])-(t[f]-t[d])*(t[p+1]-t[f+1]))}return o===0&&h===0?0:Math.abs((h-o)/o)};function rp(t,e,n,i){for(var r=0,s=e,o=n-i;s<n;s+=i)r+=(t[o]-t[s])*(t[s+1]+t[o+1]),o=s;return r}zu.flatten=function(t){for(var e=t[0][0].length,n={vertices:[],holes:[],dimensions:e},i=0,r=0;r<t.length;r++){for(var s=0;s<t[r].length;s++)for(var o=0;o<e;o++)n.vertices.push(t[r][s][o]);r>0&&(i+=t[r-1].length,n.holes.push(i))}return n};var zU=Fg.exports;const VU=hu(zU),ll=zE.CLOCKWISE,Wy=zE.COUNTER_CLOCKWISE,Kn={isClosed:!0};function jU(t){if(t=t&&t.positions||t,!Array.isArray(t)&&!ArrayBuffer.isView(t))throw new Error("invalid polygon")}function Js(t){return"positions"in t?t.positions:t}function Dl(t){return"holeIndices"in t?t.holeIndices:null}function WU(t){return Array.isArray(t[0])}function HU(t){return t.length>=1&&t[0].length>=2&&Number.isFinite(t[0][0])}function $U(t){const e=t[0],n=t[t.length-1];return e[0]===n[0]&&e[1]===n[1]&&e[2]===n[2]}function XU(t,e,n,i){for(let r=0;r<e;r++)if(t[n+r]!==t[i-e+r])return!1;return!0}function Hy(t,e,n,i,r){let s=e;const o=n.length;for(let a=0;a<o;a++)for(let l=0;l<i;l++)t[s++]=n[a][l]||0;if(!$U(n))for(let a=0;a<i;a++)t[s++]=n[0][a]||0;return Kn.start=e,Kn.end=s,Kn.size=i,VE(t,r,Kn),s}function $y(t,e,n,i,r=0,s,o){s=s||n.length;const a=s-r;if(a<=0)return e;let l=e;for(let c=0;c<a;c++)t[l++]=n[r+c];if(!XU(n,i,r,s))for(let c=0;c<i;c++)t[l++]=n[r+c];return Kn.start=e,Kn.end=l,Kn.size=i,VE(t,o,Kn),l}function YU(t,e){jU(t);const n=[],i=[];if("positions"in t){const{positions:r,holeIndices:s}=t;if(s){let o=0;for(let a=0;a<=s.length;a++)o=$y(n,o,r,e,s[a-1],s[a],a===0?ll:Wy),i.push(o);return i.pop(),{positions:n,holeIndices:i}}t=r}if(!WU(t))return $y(n,0,t,e,0,n.length,ll),n;if(!HU(t)){let r=0;for(const[s,o]of t.entries())r=Hy(n,r,o,e,s===0?ll:Wy),i.push(r);return i.pop(),{positions:n,holeIndices:i}}return Hy(n,0,t,e,ll),n}function of(t,e,n){const i=t.length/3;let r=0;for(let s=0;s<i;s++){const o=(s+1)%i;r+=t[s*3+e]*t[o*3+n],r-=t[o*3+e]*t[s*3+n]}return Math.abs(r/2)}function Xy(t,e,n,i){const r=t.length/3;for(let s=0;s<r;s++){const o=s*3,a=t[o+0],l=t[o+1],c=t[o+2];t[o+e]=a,t[o+n]=l,t[o+i]=c}}function KU(t,e,n,i){let r=Dl(t);r&&(r=r.map(a=>a/e));let s=Js(t);const o=i&&e===3;if(n){const a=s.length;s=s.slice();const l=[];for(let c=0;c<a;c+=e){l[0]=s[c],l[1]=s[c+1],o&&(l[2]=s[c+2]);const u=n(l);s[c]=u[0],s[c+1]=u[1],o&&(s[c+2]=u[2])}}if(o){const a=of(s,0,1),l=of(s,0,2),c=of(s,1,2);if(!a&&!l&&!c)return[];a>l&&a>c||(l>c?(n||(s=s.slice()),Xy(s,0,2,1)):(n||(s=s.slice()),Xy(s,2,0,1)))}return VU(s,r,e)}class qU extends FE{constructor(e){const{fp64:n,IndexType:i=Uint32Array}=e;super({...e,attributes:{positions:{size:3,type:n?Float64Array:Float32Array},vertexValid:{type:Uint16Array,size:1},indices:{type:i,size:1}}})}get(e){const{attributes:n}=this;return e==="indices"?n.indices&&n.indices.subarray(0,this.vertexCount):n[e]}updateGeometry(e){super.updateGeometry(e);const n=this.buffers.indices;if(n)this.vertexCount=(n.value||n).length;else if(this.data&&!this.getGeometry)throw new Error("missing indices buffer")}normalizeGeometry(e){if(this.normalize){const n=YU(e,this.positionSize);return this.opts.resolution?XE(Js(n),Dl(n),{size:this.positionSize,gridResolution:this.opts.resolution,edgeTypes:!0}):this.opts.wrapLongitude?gU(Js(n),Dl(n),{size:this.positionSize,maxLatitude:86,edgeTypes:!0}):n}return e}getGeometrySize(e){if(Yy(e)){let n=0;for(const i of e)n+=this.getGeometrySize(i);return n}return Js(e).length/this.positionSize}getGeometryFromBuffer(e){return this.normalize||!this.buffers.indices?super.getGeometryFromBuffer(e):null}updateGeometryAttributes(e,n){if(e&&Yy(e))for(const i of e){const r=this.getGeometrySize(i);n.geometrySize=r,this.updateGeometryAttributes(i,n),n.vertexStart+=r,n.indexStart=this.indexStarts[n.geometryIndex+1]}else{const i=e;this._updateIndices(i,n),this._updatePositions(i,n),this._updateVertexValid(i,n)}}_updateIndices(e,{geometryIndex:n,vertexStart:i,indexStart:r}){const{attributes:s,indexStarts:o,typedArrayManager:a}=this;let l=s.indices;if(!l||!e)return;let c=r;const u=KU(e,this.positionSize,this.opts.preproject,this.opts.full3d);l=a.allocate(l,r+u.length,{copy:!0});for(let h=0;h<u.length;h++)l[c++]=u[h]+i;o[n+1]=r+u.length,s.indices=l}_updatePositions(e,{vertexStart:n,geometrySize:i}){const{attributes:{positions:r},positionSize:s}=this;if(!r||!e)return;const o=Js(e);for(let a=n,l=0;l<i;a++,l++){const c=o[l*s],u=o[l*s+1],h=s>2?o[l*s+2]:0;r[a*3]=c,r[a*3+1]=u,r[a*3+2]=h}}_updateVertexValid(e,{vertexStart:n,geometrySize:i}){const{positionSize:r}=this,s=this.attributes.vertexValid,o=e&&Dl(e);if(e&&e.edgeTypes?s.set(e.edgeTypes,n):s.fill(1,n,n+i),o)for(let a=0;a<o.length;a++)s[n+o[a]/r-1]=0;s[n+i-1]=0}}function Yy(t){return Array.isArray(t)&&t.length>0&&!Number.isFinite(t[0])}const eS=`uniform bool extruded;
uniform bool isWireframe;
uniform float elevationScale;
uniform float opacity;
out vec4 vColor;
struct PolygonProps {
vec4 fillColors;
vec4 lineColors;
vec3 positions;
vec3 positions64Low;
vec3 pickingColors;
vec3 normal;
float elevations;
};
vec3 project_offset_normal(vec3 vector) {
if (project_uCoordinateSystem == COORDINATE_SYSTEM_LNGLAT ||
project_uCoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSETS) {
return normalize(vector * project_uCommonUnitsPerWorldUnit);
}
return project_normal(vector);
}
void calculatePosition(PolygonProps props) {
vec3 pos = props.positions;
vec3 pos64Low = props.positions64Low;
vec3 normal = props.normal;
vec4 colors = isWireframe ? props.lineColors : props.fillColors;
geometry.worldPosition = props.positions;
geometry.pickingColor = props.pickingColors;
if (extruded) {
pos.z += props.elevations * elevationScale;
}
gl_Position = project_position_to_clipspace(pos, pos64Low, vec3(0.), geometry.position);
DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
if (extruded) {
#ifdef IS_SIDE_VERTEX
normal = project_offset_normal(normal);
#else
normal = project_normal(normal);
#endif
geometry.normal = normal;
vec3 lightColor = lighting_getLightColor(colors.rgb, project_uCameraPosition, geometry.position.xyz, geometry.normal);
vColor = vec4(lightColor, colors.a * opacity);
} else {
vColor = vec4(colors.rgb, colors.a * opacity);
}
DECKGL_FILTER_COLOR(vColor, geometry);
}
`,ZU=`#version 300 es
#define SHADER_NAME solid-polygon-layer-vertex-shader
in vec3 vertexPositions;
in vec3 vertexPositions64Low;
in float elevations;
in vec4 fillColors;
in vec4 lineColors;
in vec3 pickingColors;
${eS}
void main(void) {
PolygonProps props;
props.positions = vertexPositions;
props.positions64Low = vertexPositions64Low;
props.elevations = elevations;
props.fillColors = fillColors;
props.lineColors = lineColors;
props.pickingColors = pickingColors;
props.normal = vec3(0.0, 0.0, 1.0);
calculatePosition(props);
}
`,QU=`#version 300 es
#define SHADER_NAME solid-polygon-layer-vertex-shader-side
#define IS_SIDE_VERTEX
in vec2 positions;
in vec3 instancePositions;
in vec3 instanceNextPositions;
in vec3 instancePositions64Low;
in vec3 instanceNextPositions64Low;
in float instanceElevations;
in vec4 instanceFillColors;
in vec4 instanceLineColors;
in vec3 instancePickingColors;
in float instanceVertexValid;
${eS}
void main(void) {
if(instanceVertexValid < 0.5){
gl_Position = vec4(0.);
return;
}
PolygonProps props;
vec3 pos;
vec3 pos64Low;
vec3 nextPos;
vec3 nextPos64Low;
#if RING_WINDING_ORDER_CW == 1
pos = instancePositions;
pos64Low = instancePositions64Low;
nextPos = instanceNextPositions;
nextPos64Low = instanceNextPositions64Low;
#else
pos = instanceNextPositions;
pos64Low = instanceNextPositions64Low;
nextPos = instancePositions;
nextPos64Low = instancePositions64Low;
#endif
props.positions = mix(pos, nextPos, positions.x);
props.positions64Low = mix(pos64Low, nextPos64Low, positions.x);
props.normal = vec3(
pos.y - nextPos.y + (pos64Low.y - nextPos64Low.y),
nextPos.x - pos.x + (nextPos64Low.x - pos64Low.x),
0.0);
props.elevations = instanceElevations * positions.y;
props.fillColors = instanceFillColors;
props.lineColors = instanceLineColors;
props.pickingColors = instancePickingColors;
calculatePosition(props);
}
`,JU=`#version 300 es
#define SHADER_NAME solid-polygon-layer-fragment-shader
precision highp float;
in vec4 vColor;
out vec4 fragColor;
void main(void) {
fragColor = vColor;
DECKGL_FILTER_COLOR(fragColor, geometry);
}
`,kc=[0,0,0,255],GU={filled:!0,extruded:!1,wireframe:!1,_normalize:!0,_windingOrder:"CW",_full3d:!1,elevationScale:{type:"number",min:0,value:1},getPolygon:{type:"accessor",value:t=>t.polygon},getElevation:{type:"accessor",value:1e3},getFillColor:{type:"accessor",value:kc},getLineColor:{type:"accessor",value:kc},material:!0},cl={enter:(t,e)=>e.length?e.subarray(e.length-t.length):t},su=class su extends bn{getShaders(e){return super.getShaders({vs:e==="top"?ZU:QU,fs:JU,defines:{RING_WINDING_ORDER_CW:!this.props._normalize&&this.props._windingOrder==="CCW"?0:1},modules:[la,IM,ca]})}get wrapLongitude(){return!1}getBounds(){var e;return(e=this.getAttributeManager())==null?void 0:e.getBounds(["vertexPositions"])}initializeState(){const{viewport:e}=this.context;let{coordinateSystem:n}=this.props;const{_full3d:i}=this.props;e.isGeospatial&&n===ee.DEFAULT&&(n=ee.LNGLAT);let r;n===ee.LNGLAT&&(i?r=e.projectPosition.bind(e):r=e.projectFlat.bind(e)),this.setState({numInstances:0,polygonTesselator:new qU({preproject:r,fp64:this.use64bitPositions(),IndexType:Uint32Array})});const s=this.getAttributeManager(),o=!0;s.remove(["instancePickingColors"]),s.add({indices:{size:1,isIndexed:!0,update:this.calculateIndices,noAlloc:o},vertexPositions:{size:3,type:"float64",fp64:this.use64bitPositions(),transition:cl,accessor:"getPolygon",update:this.calculatePositions,noAlloc:o,shaderAttributes:{instancePositions:{vertexOffset:0,divisor:1},instanceNextPositions:{vertexOffset:1,divisor:1}}},instanceVertexValid:{size:1,type:"uint16",divisor:1,update:this.calculateVertexValid,noAlloc:o},elevations:{size:1,transition:cl,accessor:"getElevation",shaderAttributes:{instanceElevations:{divisor:1}}},fillColors:{size:this.props.colorFormat.length,type:"unorm8",transition:cl,accessor:"getFillColor",defaultValue:kc,shaderAttributes:{instanceFillColors:{divisor:1}}},lineColors:{size:this.props.colorFormat.length,type:"unorm8",transition:cl,accessor:"getLineColor",defaultValue:kc,shaderAttributes:{instanceLineColors:{divisor:1}}},pickingColors:{size:4,type:"uint8",accessor:(a,{index:l,target:c})=>this.encodePickingColor(a&&a.__source?a.__source.index:l,c),shaderAttributes:{instancePickingColors:{divisor:1}}}})}getPickingInfo(e){const n=super.getPickingInfo(e),{index:i}=n,r=this.props.data;return r[0]&&r[0].__source&&(n.object=r.find(s=>s.__source.index===i)),n}disablePickingIndex(e){const n=this.props.data;if(n[0]&&n[0].__source)for(let i=0;i<n.length;i++)n[i].__source.index===e&&this._disablePickingIndex(i);else super.disablePickingIndex(e)}draw({uniforms:e}){const{extruded:n,filled:i,wireframe:r,elevationScale:s}=this.props,{topModel:o,sideModel:a,wireframeModel:l,polygonTesselator:c}=this.state,u={...e,extruded:!!n,elevationScale:s};l&&r&&(l.setInstanceCount(c.instanceCount-1),l.setUniforms(u),l.draw(this.context.renderPass)),a&&i&&(a.setInstanceCount(c.instanceCount-1),a.setUniforms(u),a.draw(this.context.renderPass)),o&&i&&(o.setVertexCount(c.vertexCount),o.setUniforms(u),o.draw(this.context.renderPass))}updateState(e){var a;super.updateState(e),this.updateGeometry(e);const{props:n,oldProps:i,changeFlags:r}=e,s=this.getAttributeManager();(r.extensionsChanged||n.filled!==i.filled||n.extruded!==i.extruded)&&((a=this.state.models)==null||a.forEach(l=>l.destroy()),this.setState(this._getModels()),s.invalidateAll())}updateGeometry({props:e,oldProps:n,changeFlags:i}){if(i.dataChanged||i.updateTriggersChanged&&(i.updateTriggersChanged.all||i.updateTriggersChanged.getPolygon)){const{polygonTesselator:s}=this.state,o=e.data.attributes||{};s.updateGeometry({data:e.data,normalize:e._normalize,geometryBuffer:o.getPolygon,buffers:o,getGeometry:e.getPolygon,positionFormat:e.positionFormat,wrapLongitude:e.wrapLongitude,resolution:this.context.viewport.resolution,fp64:this.use64bitPositions(),dataChanged:i.dataChanged,full3d:e._full3d}),this.setState({numInstances:s.instanceCount,startIndices:s.vertexStarts}),i.dataChanged||this.getAttributeManager().invalidateAll()}}_getModels(){const{id:e,filled:n,extruded:i}=this.props;let r,s,o;const a=this.getAttributeManager().getBufferLayouts();if(n){const l=this.getShaders("top");l.defines.NON_INSTANCED_MODEL=1,r=new Lt(this.context.device,{...l,id:`${e}-top`,topology:"triangle-list",uniforms:{isWireframe:!1},bufferLayout:a,isIndexed:!0,userData:{excludeAttributes:{instanceVertexValid:!0}}})}return i&&(s=new Lt(this.context.device,{...this.getShaders("side"),id:`${e}-side`,bufferLayout:a,uniforms:{isWireframe:!1},geometry:new ls({topology:"triangle-strip",attributes:{positions:{size:2,value:new Float32Array([1,0,0,0,1,1,0,1])}}}),isInstanced:1,userData:{excludeAttributes:{indices:!0}}}),o=new Lt(this.context.device,{...this.getShaders("side"),id:`${e}-wireframe`,bufferLayout:a,uniforms:{isWireframe:!0},geometry:new ls({topology:"line-strip",attributes:{positions:{size:2,value:new Float32Array([1,0,0,0,0,1,1,1])}}}),isInstanced:1,userData:{excludeAttributes:{indices:!0}}})),{models:[s,o,r].filter(Boolean),topModel:r,sideModel:s,wireframeModel:o}}calculateIndices(e){const{polygonTesselator:n}=this.state;e.startIndices=n.indexStarts,e.value=n.get("indices")}calculatePositions(e){const{polygonTesselator:n}=this.state;e.startIndices=n.vertexStarts,e.value=n.get("positions")}calculateVertexValid(e){e.value=this.state.polygonTesselator.get("vertexValid")}};su.defaultProps=GU,su.layerName="SolidPolygonLayer";let sp=su;function e4({data:t,getIndex:e,dataRange:n,replace:i}){const{startRow:r=0,endRow:s=1/0}=n,o=t.length;let a=o,l=o;for(let f=0;f<o;f++){const d=e(t[f]);if(a>f&&d>=r&&(a=f),d>=s){l=f;break}}let c=a;const h=l-a!==i.length?t.slice(l):void 0;for(let f=0;f<i.length;f++)t[c++]=i[f];if(h){for(let f=0;f<h.length;f++)t[c++]=h[f];t.length=c}return{startRow:a,endRow:a+i.length}}function t4(t,e){if(!t)return null;const n="startIndices"in t?t.startIndices[e]:e,i=t.featureIds.value[n];return n!==-1?n4(t,i,n):null}function n4(t,e,n){const i={properties:{...t.properties[e]}};for(const r in t.numericProps)i.properties[r]=t.numericProps[r].value[n];return i}function i4(t,e){const n={points:null,lines:null,polygons:null};for(const i in n){const r=t[i].globalFeatureIds.value;n[i]=new Uint8ClampedArray(r.length*3);const s=[];for(let o=0;o<r.length;o++)e(r[o],s),n[i][o*3+0]=s[0],n[i][o*3+1]=s[1],n[i][o*3+2]=s[2]}return n}const r4=`#version 300 es
#define SHADER_NAME multi-icon-layer-fragment-shader
precision highp float;
uniform float opacity;
uniform sampler2D iconsTexture;
uniform float gamma;
uniform bool sdf;
uniform float alphaCutoff;
uniform float sdfBuffer;
uniform float outlineBuffer;
uniform vec4 outlineColor;
in vec4 vColor;
in vec2 vTextureCoords;
in vec2 uv;
out vec4 fragColor;
void main(void) {
geometry.uv = uv;
if (!bool(picking.isActive)) {
float alpha = texture(iconsTexture, vTextureCoords).a;
vec4 color = vColor;
if (sdf) {
float distance = alpha;
alpha = smoothstep(sdfBuffer - gamma, sdfBuffer + gamma, distance);
if (outlineBuffer > 0.0) {
float inFill = alpha;
float inBorder = smoothstep(outlineBuffer - gamma, outlineBuffer + gamma, distance);
color = mix(outlineColor, vColor, inFill);
alpha = inBorder;
}
}
float a = alpha * color.a;
if (a < alphaCutoff) {
discard;
}
fragColor = vec4(color.rgb, a * opacity);
}
DECKGL_FILTER_COLOR(fragColor, geometry);
}
`,af=192/256,Ky=[],s4={getIconOffsets:{type:"accessor",value:t=>t.offsets},alphaCutoff:.001,smoothing:.1,outlineWidth:0,outlineColor:{type:"color",value:[0,0,0,255]}},ou=class ou extends Ic{getShaders(){return{...super.getShaders(),fs:r4}}initializeState(){super.initializeState(),this.getAttributeManager().addInstanced({instanceOffsets:{size:2,accessor:"getIconOffsets"},instancePickingColors:{type:"uint8",size:3,accessor:(n,{index:i,target:r})=>this.encodePickingColor(i,r)}})}updateState(e){super.updateState(e);const{props:n,oldProps:i}=e;let{outlineColor:r}=n;r!==i.outlineColor&&(r=r.map(s=>s/255),r[3]=Number.isFinite(r[3])?r[3]:1,this.setState({outlineColor:r})),!n.sdf&&n.outlineWidth&&Q.warn(`${this.id}: fontSettings.sdf is required to render outline`)()}draw(e){const{sdf:n,smoothing:i,outlineWidth:r}=this.props,{outlineColor:s}=this.state,o=r?Math.max(i,af*(1-r)):-1;if(e.uniforms={...e.uniforms,sdfBuffer:af,outlineBuffer:o,gamma:i,sdf:!!n,outlineColor:s},super.draw(e),n&&r){const{iconManager:a}=this.state,l=a.getTexture(),c=this.state.model;l&&(c.setUniforms({outlineBuffer:af}),c.draw(this.context.renderPass))}}getInstanceOffset(e){return e?Array.from(e).flatMap(n=>super.getInstanceOffset(n)):Ky}getInstanceColorMode(e){return 1}getInstanceIconFrame(e){return e?Array.from(e).flatMap(n=>super.getInstanceIconFrame(n)):Ky}};ou.defaultProps=s4,ou.layerName="MultiIconLayer";let op=ou;const _o=1e20;class o4{constructor({fontSize:e=24,buffer:n=3,radius:i=8,cutoff:r=.25,fontFamily:s="sans-serif",fontWeight:o="normal",fontStyle:a="normal"}={}){this.buffer=n,this.cutoff=r,this.radius=i;const l=this.size=e+n*4,c=this._createCanvas(l),u=this.ctx=c.getContext("2d",{willReadFrequently:!0});u.font=`${a} ${o} ${e}px ${s}`,u.textBaseline="alphabetic",u.textAlign="left",u.fillStyle="black",this.gridOuter=new Float64Array(l*l),this.gridInner=new Float64Array(l*l),this.f=new Float64Array(l),this.z=new Float64Array(l+1),this.v=new Uint16Array(l)}_createCanvas(e){const n=document.createElement("canvas");return n.width=n.height=e,n}draw(e){const{width:n,actualBoundingBoxAscent:i,actualBoundingBoxDescent:r,actualBoundingBoxLeft:s,actualBoundingBoxRight:o}=this.ctx.measureText(e),a=Math.ceil(i),l=0,c=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(o-s))),u=Math.min(this.size-this.buffer,a+Math.ceil(r)),h=c+2*this.buffer,f=u+2*this.buffer,d=Math.max(h*f,0),p=new Uint8ClampedArray(d),v={data:p,width:h,height:f,glyphWidth:c,glyphHeight:u,glyphTop:a,glyphLeft:l,glyphAdvance:n};if(c===0||u===0)return v;const{ctx:A,buffer:y,gridInner:g,gridOuter:_}=this;A.clearRect(y,y,c,u),A.fillText(e,y,y+a);const E=A.getImageData(y,y,c,u);_.fill(_o,0,d),g.fill(0,0,d);for(let R=0;R<u;R++)for(let P=0;P<c;P++){const I=E.data[4*(R*c+P)+3]/255;if(I===0)continue;const O=(R+y)*h+P+y;if(I===1)_[O]=0,g[O]=_o;else{const k=.5-I;_[O]=k>0?k*k:0,g[O]=k<0?k*k:0}}qy(_,0,0,h,f,h,this.f,this.v,this.z),qy(g,y,y,c,u,h,this.f,this.v,this.z);for(let R=0;R<d;R++){const P=Math.sqrt(_[R])-Math.sqrt(g[R]);p[R]=Math.round(255-255*(P/this.radius+this.cutoff))}return v}}function qy(t,e,n,i,r,s,o,a,l){for(let c=e;c<e+i;c++)Zy(t,n*s+c,s,r,o,a,l);for(let c=n;c<n+r;c++)Zy(t,c*s+e,1,i,o,a,l)}function Zy(t,e,n,i,r,s,o){s[0]=0,o[0]=-_o,o[1]=_o,r[0]=t[e];for(let a=1,l=0,c=0;a<i;a++){r[a]=t[e+a*n];const u=a*a;do{const h=s[l];c=(r[a]-r[h]+u-h*h)/(a-h)/2}while(c<=o[l]&&--l>-1);l++,s[l]=a,o[l]=c,o[l+1]=_o}for(let a=0,l=0;a<i;a++){for(;o[l+1]<a;)l++;const c=s[l],u=a-c;t[e+a*n]=r[c]+u*u}}const a4=32,l4=[];function c4(t){return Math.pow(2,Math.ceil(Math.log2(t)))}function u4({characterSet:t,getFontWidth:e,fontHeight:n,buffer:i,maxCanvasWidth:r,mapping:s={},xOffset:o=0,yOffset:a=0}){let l=0,c=o;const u=n+i*2;for(const h of t)if(!s[h]){const f=e(h);c+f+i*2>r&&(c=0,l++),s[h]={x:c+i,y:a+l*u+i,width:f,height:u,layoutWidth:f,layoutHeight:n},c+=f+i*2}return{mapping:s,xOffset:c,yOffset:a+l*u,canvasHeight:c4(a+(l+1)*u)}}function tS(t,e,n,i){var s;let r=0;for(let o=e;o<n;o++){const a=t[o];r+=((s=i[a])==null?void 0:s.layoutWidth)||0}return r}function nS(t,e,n,i,r,s){let o=e,a=0;for(let l=e;l<n;l++){const c=tS(t,l,l+1,r);a+c>i&&(o<l&&s.push(l),o=l,a=0),a+=c}return a}function h4(t,e,n,i,r,s){let o=e,a=e,l=e,c=0;for(let u=e;u<n;u++)if((t[u]===" "||t[u+1]===" "||u+1===n)&&(l=u+1),l>a){let h=tS(t,a,l,r);c+h>i&&(o<a&&(s.push(a),o=a,c=0),h>i&&(h=nS(t,a,l,i,r,s),o=s[s.length-1])),a=l,c+=h}return c}function f4(t,e,n,i,r=0,s){s===void 0&&(s=t.length);const o=[];return e==="break-all"?nS(t,r,s,n,i,o):h4(t,r,s,n,i,o),o}function d4(t,e,n,i,r,s){let o=0,a=0;for(let l=e;l<n;l++){const c=t[l],u=i[c];u?(a||(a=u.layoutHeight),r[l]=o+u.layoutWidth/2,o+=u.layoutWidth):(Q.warn(`Missing character: ${c} (${c.codePointAt(0)})`)(),r[l]=o,o+=a4)}s[0]=o,s[1]=a}function p4(t,e,n,i,r){var A;const s=Array.from(t),o=s.length,a=new Array(o),l=new Array(o),c=new Array(o),u=(n==="break-word"||n==="break-all")&&isFinite(i)&&i>0,h=[0,0],f=[0,0];let d=0,p=0,v=0;for(let y=0;y<=o;y++){const g=s[y];if((g===`
`||y===o)&&(v=y),v>p){const _=u?f4(s,n,i,r,p,v):l4;for(let E=0;E<=_.length;E++){const R=E===0?p:_[E-1],P=E<_.length?_[E]:v;d4(s,R,P,r,a,f);for(let I=R;I<P;I++){const O=s[I],k=((A=r[O])==null?void 0:A.layoutOffsetY)||0;l[I]=d+f[1]/2+k,c[I]=f[0]}d=d+f[1]*e,h[0]=Math.max(h[0],f[0])}p=v}g===`
`&&(a[p]=0,l[p]=0,c[p]=0,p++)}return h[1]=d,{x:a,y:l,rowWidth:c,size:h}}function g4({value:t,length:e,stride:n,offset:i,startIndices:r,characterSet:s}){const o=t.BYTES_PER_ELEMENT,a=n?n/o:1,l=i?i/o:0,c=r[e]||Math.ceil((t.length-l)/a),u=s&&new Set,h=new Array(e);let f=t;if(a>1||l>0){const d=t.constructor;f=new d(c);for(let p=0;p<c;p++)f[p]=t[p*a+l]}for(let d=0;d<e;d++){const p=r[d],v=r[d+1]||c,A=f.subarray(p,v);h[d]=String.fromCodePoint.apply(null,A),u&&A.forEach(u.add,u)}if(u)for(const d of u)s.add(String.fromCodePoint(d));return{texts:h,characterCount:c}}class iS{constructor(e=5){this._cache={},this._order=[],this.limit=e}get(e){const n=this._cache[e];return n&&(this._deleteOrder(e),this._appendOrder(e)),n}set(e,n){this._cache[e]?(this.delete(e),this._cache[e]=n,this._appendOrder(e)):(Object.keys(this._cache).length===this.limit&&this.delete(this._order[0]),this._cache[e]=n,this._appendOrder(e))}delete(e){this._cache[e]&&(delete this._cache[e],this._deleteOrder(e))}_deleteOrder(e){const n=this._order.indexOf(e);n>=0&&this._order.splice(n,1)}_appendOrder(e){this._order.push(e)}}function _4(){const t=[];for(let e=32;e<128;e++)t.push(String.fromCharCode(e));return t}const Yr={fontFamily:"Monaco, monospace",fontWeight:"normal",characterSet:_4(),fontSize:64,buffer:4,sdf:!1,cutoff:.25,radius:12,smoothing:.1},Qy=1024,Jy=.9,Gy=1.2,rS=3;let Fc=new iS(rS);function m4(t,e){let n;typeof e=="string"?n=new Set(Array.from(e)):n=new Set(e);const i=Fc.get(t);if(!i)return n;for(const r in i.mapping)n.has(r)&&n.delete(r);return n}function y4(t,e){for(let n=0;n<t.length;n++)e.data[4*n+3]=t[n]}function ev(t,e,n,i){t.font=`${i} ${n}px ${e}`,t.fillStyle="#000",t.textBaseline="alphabetic",t.textAlign="left"}function v4(t){Q.assert(Number.isFinite(t)&&t>=rS,"Invalid cache limit"),Fc=new iS(t)}class T4{constructor(){this.props={...Yr}}get atlas(){return this._atlas}get mapping(){return this._atlas&&this._atlas.mapping}get scale(){const{fontSize:e,buffer:n}=this.props;return(e*Gy+n*2)/e}setProps(e={}){Object.assign(this.props,e),this._key=this._getKey();const n=m4(this._key,this.props.characterSet),i=Fc.get(this._key);if(i&&n.size===0){this._atlas!==i&&(this._atlas=i);return}const r=this._generateFontAtlas(n,i);this._atlas=r,Fc.set(this._key,r)}_generateFontAtlas(e,n){const{fontFamily:i,fontWeight:r,fontSize:s,buffer:o,sdf:a,radius:l,cutoff:c}=this.props;let u=n&&n.data;u||(u=document.createElement("canvas"),u.width=Qy);const h=u.getContext("2d",{willReadFrequently:!0});ev(h,i,s,r);const{mapping:f,canvasHeight:d,xOffset:p,yOffset:v}=u4({getFontWidth:A=>h.measureText(A).width,fontHeight:s*Gy,buffer:o,characterSet:e,maxCanvasWidth:Qy,...n&&{mapping:n.mapping,xOffset:n.xOffset,yOffset:n.yOffset}});if(u.height!==d){const A=h.getImageData(0,0,u.width,u.height);u.height=d,h.putImageData(A,0,0)}if(ev(h,i,s,r),a){const A=new o4({fontSize:s,buffer:o,radius:l,cutoff:c,fontFamily:i,fontWeight:`${r}`});for(const y of e){const{data:g,width:_,height:E,glyphTop:R}=A.draw(y);f[y].width=_,f[y].layoutOffsetY=s*Jy-R;const P=h.createImageData(_,E);y4(g,P),h.putImageData(P,f[y].x,f[y].y)}}else for(const A of e)h.fillText(A,f[A].x,f[A].y+o+s*Jy);return{xOffset:p,yOffset:v,mapping:f,data:u,width:u.width,height:u.height}}_getKey(){const{fontFamily:e,fontWeight:n,fontSize:i,buffer:r,sdf:s,radius:o,cutoff:a}=this.props;return s?`${e} ${n} ${i} ${r} ${o} ${a}`:`${e} ${n} ${i} ${r}`}}const w4=`#version 300 es
#define SHADER_NAME text-background-layer-vertex-shader
in vec2 positions;
in vec3 instancePositions;
in vec3 instancePositions64Low;
in vec4 instanceRects;
in float instanceSizes;
in float instanceAngles;
in vec2 instancePixelOffsets;
in float instanceLineWidths;
in vec4 instanceFillColors;
in vec4 instanceLineColors;
in vec3 instancePickingColors;
uniform bool billboard;
uniform float opacity;
uniform float sizeScale;
uniform float sizeMinPixels;
uniform float sizeMaxPixels;
uniform vec4 padding;
uniform int sizeUnits;
out vec4 vFillColor;
out vec4 vLineColor;
out float vLineWidth;
out vec2 uv;
out vec2 dimensions;
vec2 rotate_by_angle(vec2 vertex, float angle) {
float angle_radian = radians(angle);
float cos_angle = cos(angle_radian);
float sin_angle = sin(angle_radian);
mat2 rotationMatrix = mat2(cos_angle, -sin_angle, sin_angle, cos_angle);
return rotationMatrix * vertex;
}
void main(void) {
geometry.worldPosition = instancePositions;
geometry.uv = positions;
geometry.pickingColor = instancePickingColors;
uv = positions;
vLineWidth = instanceLineWidths;
float sizePixels = clamp(
project_size_to_pixel(instanceSizes * sizeScale, sizeUnits),
sizeMinPixels, sizeMaxPixels
);
dimensions = instanceRects.zw * sizePixels + padding.xy + padding.zw;
vec2 pixelOffset = (positions * instanceRects.zw + instanceRects.xy) * sizePixels + mix(-padding.xy, padding.zw, positions);
pixelOffset = rotate_by_angle(pixelOffset, instanceAngles);
pixelOffset += instancePixelOffsets;
pixelOffset.y *= -1.0;
if (billboard)  {
gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, vec3(0.0), geometry.position);
DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
vec3 offset = vec3(pixelOffset, 0.0);
DECKGL_FILTER_SIZE(offset, geometry);
gl_Position.xy += project_pixel_size_to_clipspace(offset.xy);
} else {
vec3 offset_common = vec3(project_pixel_size(pixelOffset), 0.0);
DECKGL_FILTER_SIZE(offset_common, geometry);
gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, offset_common, geometry.position);
DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
}
vFillColor = vec4(instanceFillColors.rgb, instanceFillColors.a * opacity);
DECKGL_FILTER_COLOR(vFillColor, geometry);
vLineColor = vec4(instanceLineColors.rgb, instanceLineColors.a * opacity);
DECKGL_FILTER_COLOR(vLineColor, geometry);
}
`,E4=`#version 300 es
#define SHADER_NAME text-background-layer-fragment-shader
precision highp float;
uniform bool stroked;
in vec4 vFillColor;
in vec4 vLineColor;
in float vLineWidth;
in vec2 uv;
in vec2 dimensions;
out vec4 fragColor;
void main(void) {
geometry.uv = uv;
vec2 pixelPosition = uv * dimensions;
if (stroked) {
float distToEdge = min(
min(pixelPosition.x, dimensions.x - pixelPosition.x),
min(pixelPosition.y, dimensions.y - pixelPosition.y)
);
float isBorder = smoothedge(distToEdge, vLineWidth);
fragColor = mix(vFillColor, vLineColor, isBorder);
} else {
fragColor = vFillColor;
}
DECKGL_FILTER_COLOR(fragColor, geometry);
}
`,S4={billboard:!0,sizeScale:1,sizeUnits:"pixels",sizeMinPixels:0,sizeMaxPixels:Number.MAX_SAFE_INTEGER,padding:{type:"array",value:[0,0,0,0]},getPosition:{type:"accessor",value:t=>t.position},getSize:{type:"accessor",value:1},getAngle:{type:"accessor",value:0},getPixelOffset:{type:"accessor",value:[0,0]},getBoundingRect:{type:"accessor",value:[0,0,0,0]},getFillColor:{type:"accessor",value:[0,0,0,255]},getLineColor:{type:"accessor",value:[0,0,0,255]},getLineWidth:{type:"accessor",value:1}},au=class au extends bn{getShaders(){return super.getShaders({vs:w4,fs:E4,modules:[la,ca]})}initializeState(){this.getAttributeManager().addInstanced({instancePositions:{size:3,type:"float64",fp64:this.use64bitPositions(),transition:!0,accessor:"getPosition"},instanceSizes:{size:1,transition:!0,accessor:"getSize",defaultValue:1},instanceAngles:{size:1,transition:!0,accessor:"getAngle"},instanceRects:{size:4,accessor:"getBoundingRect"},instancePixelOffsets:{size:2,transition:!0,accessor:"getPixelOffset"},instanceFillColors:{size:4,transition:!0,type:"unorm8",accessor:"getFillColor",defaultValue:[0,0,0,255]},instanceLineColors:{size:4,transition:!0,type:"unorm8",accessor:"getLineColor",defaultValue:[0,0,0,255]},instanceLineWidths:{size:1,transition:!0,accessor:"getLineWidth",defaultValue:1}})}updateState(e){var i;super.updateState(e);const{changeFlags:n}=e;n.extensionsChanged&&((i=this.state.model)==null||i.destroy(),this.state.model=this._getModel(),this.getAttributeManager().invalidateAll())}draw({uniforms:e}){const{billboard:n,sizeScale:i,sizeUnits:r,sizeMinPixels:s,sizeMaxPixels:o,getLineWidth:a}=this.props;let{padding:l}=this.props;l.length<4&&(l=[l[0],l[1],l[0],l[1]]);const c=this.state.model;c.setUniforms(e),c.setUniforms({billboard:n,stroked:!!a,padding:l,sizeUnits:ji[r],sizeScale:i,sizeMinPixels:s,sizeMaxPixels:o}),c.draw(this.context.renderPass)}_getModel(){const e=[0,0,1,0,1,1,0,1];return new Lt(this.context.device,{...this.getShaders(),id:this.props.id,bufferLayout:this.getAttributeManager().getBufferLayouts(),geometry:new ls({topology:"triangle-fan-webgl",vertexCount:4,attributes:{positions:{size:2,value:new Float32Array(e)}}}),isInstanced:!0})}};au.defaultProps=S4,au.layerName="TextBackgroundLayer";let ap=au;const tv={start:1,middle:0,end:-1},nv={top:1,center:0,bottom:-1},lf=[0,0,0,255],A4=1,x4={billboard:!0,sizeScale:1,sizeUnits:"pixels",sizeMinPixels:0,sizeMaxPixels:Number.MAX_SAFE_INTEGER,background:!1,getBackgroundColor:{type:"accessor",value:[255,255,255,255]},getBorderColor:{type:"accessor",value:lf},getBorderWidth:{type:"accessor",value:0},backgroundPadding:{type:"array",value:[0,0,0,0]},characterSet:{type:"object",value:Yr.characterSet},fontFamily:Yr.fontFamily,fontWeight:Yr.fontWeight,lineHeight:A4,outlineWidth:{type:"number",value:0,min:0},outlineColor:{type:"color",value:lf},fontSettings:{type:"object",value:{},compare:1},wordBreak:"break-word",maxWidth:{type:"number",value:-1},getText:{type:"accessor",value:t=>t.text},getPosition:{type:"accessor",value:t=>t.position},getColor:{type:"accessor",value:lf},getSize:{type:"accessor",value:32},getAngle:{type:"accessor",value:0},getTextAnchor:{type:"accessor",value:"middle"},getAlignmentBaseline:{type:"accessor",value:"center"},getPixelOffset:{type:"accessor",value:[0,0]},backgroundColor:{deprecatedFor:["background","getBackgroundColor"]}},lu=class lu extends jo{constructor(){super(...arguments),this.getBoundingRect=(e,n)=>{let{size:[i,r]}=this.transformParagraph(e,n);const{fontSize:s}=this.state.fontAtlasManager.props;i/=s,r/=s;const{getTextAnchor:o,getAlignmentBaseline:a}=this.props,l=tv[typeof o=="function"?o(e,n):o],c=nv[typeof a=="function"?a(e,n):a];return[(l-1)*i/2,(c-1)*r/2,i,r]},this.getIconOffsets=(e,n)=>{const{getTextAnchor:i,getAlignmentBaseline:r}=this.props,{x:s,y:o,rowWidth:a,size:[l,c]}=this.transformParagraph(e,n),u=tv[typeof i=="function"?i(e,n):i],h=nv[typeof r=="function"?r(e,n):r],f=s.length,d=new Array(f*2);let p=0;for(let v=0;v<f;v++){const A=(1-u)*(l-a[v])/2;d[p++]=(u-1)*l/2+A+s[v],d[p++]=(h-1)*c/2+o[v]}return d}}initializeState(){this.state={styleVersion:0,fontAtlasManager:new T4},this.props.maxWidth>0&&Q.warn("v8.9 breaking change: TextLayer maxWidth is now relative to text size")()}updateState(e){const{props:n,oldProps:i,changeFlags:r}=e;(r.dataChanged||r.updateTriggersChanged&&(r.updateTriggersChanged.all||r.updateTriggersChanged.getText))&&this._updateText(),(this._updateFontAtlas()||n.lineHeight!==i.lineHeight||n.wordBreak!==i.wordBreak||n.maxWidth!==i.maxWidth)&&this.setState({styleVersion:this.state.styleVersion+1})}getPickingInfo({info:e}){return e.object=e.index>=0?this.props.data[e.index]:null,e}_updateFontAtlas(){const{fontSettings:e,fontFamily:n,fontWeight:i}=this.props,{fontAtlasManager:r,characterSet:s}=this.state,o={...e,characterSet:s,fontFamily:n,fontWeight:i};if(!r.mapping)return r.setProps(o),!0;for(const a in o)if(o[a]!==r.props[a])return r.setProps(o),!0;return!1}_updateText(){var l;const{data:e,characterSet:n}=this.props,i=(l=e.attributes)==null?void 0:l.getText;let{getText:r}=this.props,s=e.startIndices,o;const a=n==="auto"&&new Set;if(i&&s){const{texts:c,characterCount:u}=g4({...ArrayBuffer.isView(i)?{value:i}:i,length:e.length,startIndices:s,characterSet:a});o=u,r=(h,{index:f})=>c[f]}else{const{iterable:c,objectInfo:u}=Du(e);s=[0],o=0;for(const h of c){u.index++;const f=Array.from(r(h,u)||"");a&&f.forEach(a.add,a),o+=f.length,s.push(o)}}this.setState({getText:r,startIndices:s,numInstances:o,characterSet:a||n})}transformParagraph(e,n){const{fontAtlasManager:i}=this.state,r=i.mapping,s=this.state.getText,{wordBreak:o,lineHeight:a,maxWidth:l}=this.props,c=s(e,n)||"";return p4(c,a,o,l*i.props.fontSize,r)}renderLayers(){const{startIndices:e,numInstances:n,getText:i,fontAtlasManager:{scale:r,atlas:s,mapping:o},styleVersion:a}=this.state,{data:l,_dataDiff:c,getPosition:u,getColor:h,getSize:f,getAngle:d,getPixelOffset:p,getBackgroundColor:v,getBorderColor:A,getBorderWidth:y,backgroundPadding:g,background:_,billboard:E,fontSettings:R,outlineWidth:P,outlineColor:I,sizeScale:O,sizeUnits:k,sizeMinPixels:D,sizeMaxPixels:H,transitions:X,updateTriggers:$}=this.props,q=this.getSubLayerClass("characters",op),nt=this.getSubLayerClass("background",ap);return[_&&new nt({getFillColor:v,getLineColor:A,getLineWidth:y,padding:g,getPosition:u,getSize:f,getAngle:d,getPixelOffset:p,billboard:E,sizeScale:O,sizeUnits:k,sizeMinPixels:D,sizeMaxPixels:H,transitions:X&&{getPosition:X.getPosition,getAngle:X.getAngle,getSize:X.getSize,getFillColor:X.getBackgroundColor,getLineColor:X.getBorderColor,getLineWidth:X.getBorderWidth,getPixelOffset:X.getPixelOffset}},this.getSubLayerProps({id:"background",updateTriggers:{getPosition:$.getPosition,getAngle:$.getAngle,getSize:$.getSize,getFillColor:$.getBackgroundColor,getLineColor:$.getBorderColor,getLineWidth:$.getBorderWidth,getPixelOffset:$.getPixelOffset,getBoundingRect:{getText:$.getText,getTextAnchor:$.getTextAnchor,getAlignmentBaseline:$.getAlignmentBaseline,styleVersion:a}}}),{data:l.attributes&&l.attributes.background?{length:l.length,attributes:l.attributes.background}:l,_dataDiff:c,autoHighlight:!1,getBoundingRect:this.getBoundingRect}),new q({sdf:R.sdf,smoothing:Number.isFinite(R.smoothing)?R.smoothing:Yr.smoothing,outlineWidth:P/(R.radius||Yr.radius),outlineColor:I,iconAtlas:s,iconMapping:o,getPosition:u,getColor:h,getSize:f,getAngle:d,getPixelOffset:p,billboard:E,sizeScale:O*r,sizeUnits:k,sizeMinPixels:D*r,sizeMaxPixels:H*r,transitions:X&&{getPosition:X.getPosition,getAngle:X.getAngle,getColor:X.getColor,getSize:X.getSize,getPixelOffset:X.getPixelOffset}},this.getSubLayerProps({id:"characters",updateTriggers:{all:$.getText,getPosition:$.getPosition,getAngle:$.getAngle,getColor:$.getColor,getSize:$.getSize,getPixelOffset:$.getPixelOffset,getIconOffsets:{getTextAnchor:$.getTextAnchor,getAlignmentBaseline:$.getAlignmentBaseline,styleVersion:a}}}),{data:l,_dataDiff:c,startIndices:e,numInstances:n,getIconOffsets:this.getIconOffsets,getIcon:i})]}static set fontAtlasCacheLimit(e){v4(e)}};lu.defaultProps=x4,lu.layerName="TextLayer";let lp=lu;const Bl={circle:{type:Zd,props:{filled:"filled",stroked:"stroked",lineWidthMaxPixels:"lineWidthMaxPixels",lineWidthMinPixels:"lineWidthMinPixels",lineWidthScale:"lineWidthScale",lineWidthUnits:"lineWidthUnits",pointRadiusMaxPixels:"radiusMaxPixels",pointRadiusMinPixels:"radiusMinPixels",pointRadiusScale:"radiusScale",pointRadiusUnits:"radiusUnits",pointAntialiasing:"antialiasing",pointBillboard:"billboard",getFillColor:"getFillColor",getLineColor:"getLineColor",getLineWidth:"getLineWidth",getPointRadius:"getRadius"}},icon:{type:Ic,props:{iconAtlas:"iconAtlas",iconMapping:"iconMapping",iconSizeMaxPixels:"sizeMaxPixels",iconSizeMinPixels:"sizeMinPixels",iconSizeScale:"sizeScale",iconSizeUnits:"sizeUnits",iconAlphaCutoff:"alphaCutoff",iconBillboard:"billboard",getIcon:"getIcon",getIconAngle:"getAngle",getIconColor:"getColor",getIconPixelOffset:"getPixelOffset",getIconSize:"getSize"}},text:{type:lp,props:{textSizeMaxPixels:"sizeMaxPixels",textSizeMinPixels:"sizeMinPixels",textSizeScale:"sizeScale",textSizeUnits:"sizeUnits",textBackground:"background",textBackgroundPadding:"backgroundPadding",textFontFamily:"fontFamily",textFontWeight:"fontWeight",textLineHeight:"lineHeight",textMaxWidth:"maxWidth",textOutlineColor:"outlineColor",textOutlineWidth:"outlineWidth",textWordBreak:"wordBreak",textCharacterSet:"characterSet",textBillboard:"billboard",textFontSettings:"fontSettings",getText:"getText",getTextAngle:"getAngle",getTextColor:"getColor",getTextPixelOffset:"getPixelOffset",getTextSize:"getSize",getTextAnchor:"getTextAnchor",getTextAlignmentBaseline:"getAlignmentBaseline",getTextBackgroundColor:"getBackgroundColor",getTextBorderColor:"getBorderColor",getTextBorderWidth:"getBorderWidth"}}},Ul={type:tp,props:{lineWidthUnits:"widthUnits",lineWidthScale:"widthScale",lineWidthMinPixels:"widthMinPixels",lineWidthMaxPixels:"widthMaxPixels",lineJointRounded:"jointRounded",lineCapRounded:"capRounded",lineMiterLimit:"miterLimit",lineBillboard:"billboard",getLineColor:"getColor",getLineWidth:"getWidth"}},cp={type:sp,props:{extruded:"extruded",filled:"filled",wireframe:"wireframe",elevationScale:"elevationScale",material:"material",_full3d:"_full3d",getElevation:"getElevation",getFillColor:"getFillColor",getLineColor:"getLineColor"}};function zs({type:t,props:e}){const n={};for(const i in e)n[i]=t.defaultProps[e[i]];return n}function cf(t,e){const{transitions:n,updateTriggers:i}=t.props,r={updateTriggers:{},transitions:n&&{getPosition:n.geometry}};for(const s in e){const o=e[s];let a=t.props[s];s.startsWith("get")&&(a=t.getSubLayerAccessor(a),r.updateTriggers[o]=i[s],n&&(r.transitions[o]=n[s])),r[o]=a}return r}function R4(t){if(Array.isArray(t))return t;switch(Q.assert(t.type,"GeoJSON does not have type"),t.type){case"Feature":return[t];case"FeatureCollection":return Q.assert(Array.isArray(t.features),"GeoJSON does not have features array"),t.features;default:return[{geometry:t}]}}function iv(t,e,n={}){const i={pointFeatures:[],lineFeatures:[],polygonFeatures:[],polygonOutlineFeatures:[]},{startRow:r=0,endRow:s=t.length}=n;for(let o=r;o<s;o++){const a=t[o],{geometry:l}=a;if(l)if(l.type==="GeometryCollection"){Q.assert(Array.isArray(l.geometries),"GeoJSON does not have geometries array");const{geometries:c}=l;for(let u=0;u<c.length;u++){const h=c[u];rv(h,i,e,a,o)}}else rv(l,i,e,a,o)}return i}function rv(t,e,n,i,r){const{type:s,coordinates:o}=t,{pointFeatures:a,lineFeatures:l,polygonFeatures:c,polygonOutlineFeatures:u}=e;if(!C4(s,o)){Q.warn(`${s} coordinates are malformed`)();return}switch(s){case"Point":a.push(n({geometry:t},i,r));break;case"MultiPoint":o.forEach(h=>{a.push(n({geometry:{type:"Point",coordinates:h}},i,r))});break;case"LineString":l.push(n({geometry:t},i,r));break;case"MultiLineString":o.forEach(h=>{l.push(n({geometry:{type:"LineString",coordinates:h}},i,r))});break;case"Polygon":c.push(n({geometry:t},i,r)),o.forEach(h=>{u.push(n({geometry:{type:"LineString",coordinates:h}},i,r))});break;case"MultiPolygon":o.forEach(h=>{c.push(n({geometry:{type:"Polygon",coordinates:h}},i,r)),h.forEach(f=>{u.push(n({geometry:{type:"LineString",coordinates:f}},i,r))})});break}}const b4={Point:1,MultiPoint:2,LineString:2,MultiLineString:3,Polygon:3,MultiPolygon:4};function C4(t,e){let n=b4[t];for(Q.assert(n,`Unknown GeoJSON type ${t}`);e&&--n>0;)e=e[0];return e&&Number.isFinite(e[0])}function sS(){return{points:{},lines:{},polygons:{},polygonsOutline:{}}}function ul(t){return t.geometry.coordinates}function P4(t,e){const n=sS(),{pointFeatures:i,lineFeatures:r,polygonFeatures:s,polygonOutlineFeatures:o}=t;return n.points.data=i,n.points._dataDiff=e.pointFeatures&&(()=>e.pointFeatures),n.points.getPosition=ul,n.lines.data=r,n.lines._dataDiff=e.lineFeatures&&(()=>e.lineFeatures),n.lines.getPath=ul,n.polygons.data=s,n.polygons._dataDiff=e.polygonFeatures&&(()=>e.polygonFeatures),n.polygons.getPolygon=ul,n.polygonsOutline.data=o,n.polygonsOutline._dataDiff=e.polygonOutlineFeatures&&(()=>e.polygonOutlineFeatures),n.polygonsOutline.getPath=ul,n}function M4(t,e){const n=sS(),{points:i,lines:r,polygons:s}=t,o=i4(t,e);return n.points.data={length:i.positions.value.length/i.positions.size,attributes:{...i.attributes,getPosition:i.positions,instancePickingColors:{size:3,value:o.points}},properties:i.properties,numericProps:i.numericProps,featureIds:i.featureIds},n.lines.data={length:r.pathIndices.value.length-1,startIndices:r.pathIndices.value,attributes:{...r.attributes,getPath:r.positions,instancePickingColors:{size:3,value:o.lines}},properties:r.properties,numericProps:r.numericProps,featureIds:r.featureIds},n.lines._pathType="open",n.polygons.data={length:s.polygonIndices.value.length-1,startIndices:s.polygonIndices.value,attributes:{...s.attributes,getPolygon:s.positions,pickingColors:{size:3,value:o.polygons}},properties:s.properties,numericProps:s.numericProps,featureIds:s.featureIds},n.polygons._normalize=!1,s.triangles&&(n.polygons.data.attributes.indices=s.triangles.value),n.polygonsOutline.data={length:s.primitivePolygonIndices.value.length-1,startIndices:s.primitivePolygonIndices.value,attributes:{...s.attributes,getPath:s.positions,instancePickingColors:{size:3,value:o.polygons}},properties:s.properties,numericProps:s.numericProps,featureIds:s.featureIds},n.polygonsOutline._pathType="open",n}const I4=["points","linestrings","polygons"],O4={...zs(Bl.circle),...zs(Bl.icon),...zs(Bl.text),...zs(Ul),...zs(cp),stroked:!0,filled:!0,extruded:!1,wireframe:!1,_full3d:!1,iconAtlas:{type:"object",value:null},iconMapping:{type:"object",value:{}},getIcon:{type:"accessor",value:t=>t.properties.icon},getText:{type:"accessor",value:t=>t.properties.text},pointType:"circle",getRadius:{deprecatedFor:"getPointRadius"}},cu=class cu extends jo{initializeState(){this.state={layerProps:{},features:{},featuresDiff:{}}}updateState({props:e,changeFlags:n}){if(!n.dataChanged)return;const{data:i}=this.props,r=i&&"points"in i&&"polygons"in i&&"lines"in i;this.setState({binary:r}),r?this._updateStateBinary({props:e,changeFlags:n}):this._updateStateJSON({props:e,changeFlags:n})}_updateStateBinary({props:e,changeFlags:n}){const i=M4(e.data,this.encodePickingColor);this.setState({layerProps:i})}_updateStateJSON({props:e,changeFlags:n}){const i=R4(e.data),r=this.getSubLayerRow.bind(this);let s={};const o={};if(Array.isArray(n.dataChanged)){const l=this.state.features;for(const c in l)s[c]=l[c].slice(),o[c]=[];for(const c of n.dataChanged){const u=iv(i,r,c);for(const h in l)o[h].push(e4({data:s[h],getIndex:f=>f.__source.index,dataRange:c,replace:u[h]}))}}else s=iv(i,r);const a=P4(s,o);this.setState({features:s,featuresDiff:o,layerProps:a})}getPickingInfo(e){const n=super.getPickingInfo(e),{index:i,sourceLayer:r}=n;return n.featureType=I4.find(s=>r.id.startsWith(`${this.id}-${s}-`)),i>=0&&r.id.startsWith(`${this.id}-points-text`)&&this.state.binary&&(n.index=this.props.data.points.globalFeatureIds.value[i]),n}_updateAutoHighlight(e){const n=`${this.id}-points-`,i=e.featureType==="points";for(const r of this.getSubLayers())r.id.startsWith(n)===i&&r.updateAutoHighlight(e)}_renderPolygonLayer(){var o;const{extruded:e,wireframe:n}=this.props,{layerProps:i}=this.state,r="polygons-fill",s=this.shouldRenderSubLayer(r,(o=i.polygons)==null?void 0:o.data)&&this.getSubLayerClass(r,cp.type);if(s){const a=cf(this,cp.props),l=e&&n;return l||delete a.getLineColor,a.updateTriggers.lineColors=l,new s(a,this.getSubLayerProps({id:r,updateTriggers:a.updateTriggers}),i.polygons)}return null}_renderLineLayers(){var l,c;const{extruded:e,stroked:n}=this.props,{layerProps:i}=this.state,r="polygons-stroke",s="linestrings",o=!e&&n&&this.shouldRenderSubLayer(r,(l=i.polygonsOutline)==null?void 0:l.data)&&this.getSubLayerClass(r,Ul.type),a=this.shouldRenderSubLayer(s,(c=i.lines)==null?void 0:c.data)&&this.getSubLayerClass(s,Ul.type);if(o||a){const u=cf(this,Ul.props);return[o&&new o(u,this.getSubLayerProps({id:r,updateTriggers:u.updateTriggers}),i.polygonsOutline),a&&new a(u,this.getSubLayerProps({id:s,updateTriggers:u.updateTriggers}),i.lines)]}return null}_renderPointLayers(){var a;const{pointType:e}=this.props,{layerProps:n,binary:i}=this.state;let{highlightedObjectIndex:r}=this.props;!i&&Number.isFinite(r)&&(r=n.points.data.findIndex(l=>l.__source.index===r));const s=new Set(e.split("+")),o=[];for(const l of s){const c=`points-${l}`,u=Bl[l],h=u&&this.shouldRenderSubLayer(c,(a=n.points)==null?void 0:a.data)&&this.getSubLayerClass(c,u.type);if(h){const f=cf(this,u.props);let d=n.points;if(l==="text"&&i){const{instancePickingColors:p,...v}=d.data.attributes;d={...d,data:{...d.data,attributes:v}}}o.push(new h(f,this.getSubLayerProps({id:c,updateTriggers:f.updateTriggers,highlightedObjectIndex:r}),d))}}return o}renderLayers(){const{extruded:e}=this.props,n=this._renderPolygonLayer(),i=this._renderLineLayers(),r=this._renderPointLayers();return[!e&&n,i,r,e&&n]}getSubLayerAccessor(e){const{binary:n}=this.state;return!n||typeof e!="function"?super.getSubLayerAccessor(e):(i,r)=>{const{data:s,index:o}=r,a=t4(s,o);return e(a,r)}}};cu.layerName="GeoJsonLayer",cu.defaultProps=O4;let Dc=cu;class N4{constructor(e){this.index=e,this.isVisible=!1,this.isSelected=!1,this.parent=null,this.children=[],this.content=null,this._loader=void 0,this._abortController=null,this._loaderId=0,this._isLoaded=!1,this._isCancelled=!1,this._needsReload=!1}get bbox(){return this._bbox}set bbox(e){this._bbox||(this._bbox=e,"west"in e?this.boundingBox=[[e.west,e.south],[e.east,e.north]]:this.boundingBox=[[e.left,e.top],[e.right,e.bottom]])}get data(){return this.isLoading&&this._loader?this._loader.then(()=>this.data):this.content}get isLoaded(){return this._isLoaded&&!this._needsReload}get isLoading(){return!!this._loader&&!this._isCancelled}get needsReload(){return this._needsReload||this._isCancelled}get byteLength(){const e=this.content?this.content.byteLength:0;return Number.isFinite(e)||console.error("byteLength not defined in tile data"),e}async _loadData({getData:e,requestScheduler:n,onLoad:i,onError:r}){const{index:s,id:o,bbox:a,userData:l,zoom:c}=this,u=this._loaderId;this._abortController=new AbortController;const{signal:h}=this._abortController,f=await n.scheduleRequest(this,v=>v.isSelected?1:-1);if(!f){this._isCancelled=!0;return}if(this._isCancelled){f.done();return}let d=null,p;try{d=await e({index:s,id:o,bbox:a,userData:l,zoom:c,signal:h})}catch(v){p=v||!0}finally{f.done()}if(u===this._loaderId){if(this._loader=void 0,this.content=d,this._isCancelled&&!d){this._isLoaded=!1;return}this._isLoaded=!0,this._isCancelled=!1,p?r(p,this):i(this)}}loadData(e){return this._isLoaded=!1,this._isCancelled=!1,this._needsReload=!1,this._loaderId++,this._loader=this._loadData(e),this._loader}setNeedsReload(){this.isLoading&&(this.abort(),this._loader=void 0),this._needsReload=!0}abort(){var e;this.isLoaded||(this._isCancelled=!0,(e=this._abortController)==null||e.abort())}}const $e={OUTSIDE:-1,INTERSECTING:0,INSIDE:1},sv=new V,k4=new V;class Dg{constructor(e=[0,0,0],n=[0,0,0],i){i=i||sv.copy(e).add(n).scale(.5),this.center=new V(i),this.halfDiagonal=new V(n).subtract(this.center),this.minimum=new V(e),this.maximum=new V(n)}clone(){return new Dg(this.minimum,this.maximum,this.center)}equals(e){return this===e||!!e&&this.minimum.equals(e.minimum)&&this.maximum.equals(e.maximum)}transform(e){return this.center.transformAsPoint(e),this.halfDiagonal.transform(e),this.minimum.transform(e),this.maximum.transform(e),this}intersectPlane(e){const{halfDiagonal:n}=this,i=k4.from(e.normal),r=n.x*Math.abs(i.x)+n.y*Math.abs(i.y)+n.z*Math.abs(i.z),s=this.center.dot(i)+e.distance;return s-r>0?$e.INSIDE:s+r<0?$e.OUTSIDE:$e.INTERSECTING}distanceTo(e){return Math.sqrt(this.distanceSquaredTo(e))}distanceSquaredTo(e){const n=sv.from(e).subtract(this.center),{halfDiagonal:i}=this;let r=0,s;return s=Math.abs(n.x)-i.x,s>0&&(r+=s*s),s=Math.abs(n.y)-i.y,s>0&&(r+=s*s),s=Math.abs(n.z)-i.z,s>0&&(r+=s*s),r}}const Vs=new V,ov=new V;class Bg{constructor(e=[0,0,0],n=0){this.radius=-0,this.center=new V,this.fromCenterRadius(e,n)}fromCenterRadius(e,n){return this.center.from(e),this.radius=n,this}fromCornerPoints(e,n){return n=Vs.from(n),this.center=new V().from(e).add(n).scale(.5),this.radius=this.center.distance(n),this}equals(e){return this===e||!!e&&this.center.equals(e.center)&&this.radius===e.radius}clone(){return new Bg(this.center,this.radius)}union(e){const n=this.center,i=this.radius,r=e.center,s=e.radius,o=Vs.copy(r).subtract(n),a=o.magnitude();if(i>=a+s)return this.clone();if(s>=a+i)return e.clone();const l=(i+a+s)*.5;return ov.copy(o).scale((-i+l)/a).add(n),this.center.copy(ov),this.radius=l,this}expand(e){const i=Vs.from(e).subtract(this.center).magnitude();return i>this.radius&&(this.radius=i),this}transform(e){this.center.transform(e);const n=L2(Vs,e);return this.radius=Math.max(n[0],Math.max(n[1],n[2]))*this.radius,this}distanceSquaredTo(e){const n=this.distanceTo(e);return n*n}distanceTo(e){const i=Vs.from(e).subtract(this.center);return Math.max(0,i.len()-this.radius)}intersectPlane(e){const n=this.center,i=this.radius,s=e.normal.dot(n)+e.distance;return s<-i?$e.OUTSIDE:s<i?$e.INTERSECTING:$e.INSIDE}}const F4=new V,D4=new V,hl=new V,fl=new V,dl=new V,B4=new V,U4=new V,un={COLUMN0ROW0:0,COLUMN0ROW1:1,COLUMN0ROW2:2,COLUMN1ROW0:3,COLUMN1ROW1:4,COLUMN1ROW2:5,COLUMN2ROW0:6,COLUMN2ROW1:7,COLUMN2ROW2:8};class Ug{constructor(e=[0,0,0],n=[0,0,0,0,0,0,0,0,0]){this.center=new V().from(e),this.halfAxes=new Ue(n)}get halfSize(){const e=this.halfAxes.getColumn(0),n=this.halfAxes.getColumn(1),i=this.halfAxes.getColumn(2);return[new V(e).len(),new V(n).len(),new V(i).len()]}get quaternion(){const e=this.halfAxes.getColumn(0),n=this.halfAxes.getColumn(1),i=this.halfAxes.getColumn(2),r=new V(e).normalize(),s=new V(n).normalize(),o=new V(i).normalize();return new E0().fromMatrix3(new Ue([...r,...s,...o]))}fromCenterHalfSizeQuaternion(e,n,i){const r=new E0(i),s=new Ue().fromQuaternion(r);return s[0]=s[0]*n[0],s[1]=s[1]*n[0],s[2]=s[2]*n[0],s[3]=s[3]*n[1],s[4]=s[4]*n[1],s[5]=s[5]*n[1],s[6]=s[6]*n[2],s[7]=s[7]*n[2],s[8]=s[8]*n[2],this.center=new V().from(e),this.halfAxes=s,this}clone(){return new Ug(this.center,this.halfAxes)}equals(e){return this===e||!!e&&this.center.equals(e.center)&&this.halfAxes.equals(e.halfAxes)}getBoundingSphere(e=new Bg){const n=this.halfAxes,i=n.getColumn(0,hl),r=n.getColumn(1,fl),s=n.getColumn(2,dl),o=F4.copy(i).add(r).add(s);return e.center.copy(this.center),e.radius=o.magnitude(),e}intersectPlane(e){const n=this.center,i=e.normal,r=this.halfAxes,s=i.x,o=i.y,a=i.z,l=Math.abs(s*r[un.COLUMN0ROW0]+o*r[un.COLUMN0ROW1]+a*r[un.COLUMN0ROW2])+Math.abs(s*r[un.COLUMN1ROW0]+o*r[un.COLUMN1ROW1]+a*r[un.COLUMN1ROW2])+Math.abs(s*r[un.COLUMN2ROW0]+o*r[un.COLUMN2ROW1]+a*r[un.COLUMN2ROW2]),c=i.dot(n)+e.distance;return c<=-l?$e.OUTSIDE:c>=l?$e.INSIDE:$e.INTERSECTING}distanceTo(e){return Math.sqrt(this.distanceSquaredTo(e))}distanceSquaredTo(e){const n=D4.from(e).subtract(this.center),i=this.halfAxes,r=i.getColumn(0,hl),s=i.getColumn(1,fl),o=i.getColumn(2,dl),a=r.magnitude(),l=s.magnitude(),c=o.magnitude();r.normalize(),s.normalize(),o.normalize();let u=0,h;return h=Math.abs(n.dot(r))-a,h>0&&(u+=h*h),h=Math.abs(n.dot(s))-l,h>0&&(u+=h*h),h=Math.abs(n.dot(o))-c,h>0&&(u+=h*h),u}computePlaneDistances(e,n,i=[-0,-0]){let r=Number.POSITIVE_INFINITY,s=Number.NEGATIVE_INFINITY;const o=this.center,a=this.halfAxes,l=a.getColumn(0,hl),c=a.getColumn(1,fl),u=a.getColumn(2,dl),h=B4.copy(l).add(c).add(u).add(o),f=U4.copy(h).subtract(e);let d=n.dot(f);return r=Math.min(d,r),s=Math.max(d,s),h.copy(o).add(l).add(c).subtract(u),f.copy(h).subtract(e),d=n.dot(f),r=Math.min(d,r),s=Math.max(d,s),h.copy(o).add(l).subtract(c).add(u),f.copy(h).subtract(e),d=n.dot(f),r=Math.min(d,r),s=Math.max(d,s),h.copy(o).add(l).subtract(c).subtract(u),f.copy(h).subtract(e),d=n.dot(f),r=Math.min(d,r),s=Math.max(d,s),o.copy(h).subtract(l).add(c).add(u),f.copy(h).subtract(e),d=n.dot(f),r=Math.min(d,r),s=Math.max(d,s),o.copy(h).subtract(l).add(c).subtract(u),f.copy(h).subtract(e),d=n.dot(f),r=Math.min(d,r),s=Math.max(d,s),o.copy(h).subtract(l).subtract(c).add(u),f.copy(h).subtract(e),d=n.dot(f),r=Math.min(d,r),s=Math.max(d,s),o.copy(h).subtract(l).subtract(c).subtract(u),f.copy(h).subtract(e),d=n.dot(f),r=Math.min(d,r),s=Math.max(d,s),i[0]=r,i[1]=s,i}transform(e){this.center.transformAsPoint(e);const n=this.halfAxes.getColumn(0,hl);n.transformAsPoint(e);const i=this.halfAxes.getColumn(1,fl);i.transformAsPoint(e);const r=this.halfAxes.getColumn(2,dl);return r.transformAsPoint(e),this.halfAxes=new Ue([...n,...i,...r]),this}getTransform(){throw new Error("not implemented")}}const av=new V,lv=new V;class Qo{constructor(e=[0,0,1],n=0){this.normal=new V,this.distance=-0,this.fromNormalDistance(e,n)}fromNormalDistance(e,n){return Lo(Number.isFinite(n)),this.normal.from(e).normalize(),this.distance=n,this}fromPointNormal(e,n){e=av.from(e),this.normal.from(n).normalize();const i=-this.normal.dot(e);return this.distance=i,this}fromCoefficients(e,n,i,r){return this.normal.set(e,n,i),Lo(wn(this.normal.len(),1)),this.distance=r,this}clone(){return new Qo(this.normal,this.distance)}equals(e){return wn(this.distance,e.distance)&&wn(this.normal,e.normal)}getPointDistance(e){return this.normal.dot(e)+this.distance}transform(e){const n=lv.copy(this.normal).transformAsVector(e).normalize(),i=this.normal.scale(-this.distance).transform(e);return this.fromPointNormal(i,n)}projectPointOntoPlane(e,n=[0,0,0]){const i=av.from(e),r=this.getPointDistance(i),s=lv.copy(this.normal).scale(r);return i.subtract(s).to(n)}}const cv=[new V([1,0,0]),new V([0,1,0]),new V([0,0,1])],uv=new V,L4=new V;class vn{constructor(e=[]){this.planes=e}fromBoundingSphere(e){this.planes.length=2*cv.length;const n=e.center,i=e.radius;let r=0;for(const s of cv){let o=this.planes[r],a=this.planes[r+1];o||(o=this.planes[r]=new Qo),a||(a=this.planes[r+1]=new Qo);const l=uv.copy(s).scale(-i).add(n);o.fromPointNormal(l,s);const c=uv.copy(s).scale(i).add(n),u=L4.copy(s).negate();a.fromPointNormal(c,u),r+=2}return this}computeVisibility(e){let n=$e.INSIDE;for(const i of this.planes)switch(e.intersectPlane(i)){case $e.OUTSIDE:return $e.OUTSIDE;case $e.INTERSECTING:n=$e.INTERSECTING;break}return n}computeVisibilityWithPlaneMask(e,n){if(Lo(Number.isFinite(n),"parentPlaneMask is required."),n===vn.MASK_OUTSIDE||n===vn.MASK_INSIDE)return n;let i=vn.MASK_INSIDE;const r=this.planes;for(let s=0;s<this.planes.length;++s){const o=s<31?1<<s:0;if(s<31&&!(n&o))continue;const a=r[s],l=e.intersectPlane(a);if(l===$e.OUTSIDE)return vn.MASK_OUTSIDE;l===$e.INTERSECTING&&(i|=o)}return i}}vn.MASK_OUTSIDE=4294967295;vn.MASK_INSIDE=0;vn.MASK_INDETERMINATE=2147483647;new V;new V;new V;new V;new V;new V;new V;new V;new V;new V;new V;new V;new V;new V;new V;new V;new V;const Qt=new Ue,z4=new Ue,V4=new Ue,pl=new Ue,hv=new Ue;function j4(t,e={}){const n=SM,i=10;let r=0,s=0;const o=z4,a=V4;o.identity(),a.copy(t);const l=n*W4(a);for(;s<i&&H4(a)>l;)$4(a,pl),hv.copy(pl).transpose(),a.multiplyRight(pl),a.multiplyLeft(hv),o.multiplyRight(pl),++r>2&&(++s,r=0);return e.unitary=o.toTarget(e.unitary),e.diagonal=a.toTarget(e.diagonal),e}function W4(t){let e=0;for(let n=0;n<9;++n){const i=t[n];e+=i*i}return Math.sqrt(e)}const up=[1,0,0],hp=[2,2,1];function H4(t){let e=0;for(let n=0;n<3;++n){const i=t[Qt.getElementIndex(hp[n],up[n])];e+=2*i*i}return Math.sqrt(e)}function $4(t,e){const n=EM;let i=0,r=1;for(let c=0;c<3;++c){const u=Math.abs(t[Qt.getElementIndex(hp[c],up[c])]);u>i&&(r=c,i=u)}const s=up[r],o=hp[r];let a=1,l=0;if(Math.abs(t[Qt.getElementIndex(o,s)])>n){const c=t[Qt.getElementIndex(o,o)],u=t[Qt.getElementIndex(s,s)],h=t[Qt.getElementIndex(o,s)],f=(c-u)/2/h;let d;f<0?d=-1/(-f+Math.sqrt(1+f*f)):d=1/(f+Math.sqrt(1+f*f)),a=1/Math.sqrt(1+d*d),l=d*a}return Ue.IDENTITY.to(e),e[Qt.getElementIndex(s,s)]=e[Qt.getElementIndex(o,o)]=a,e[Qt.getElementIndex(o,s)]=l,e[Qt.getElementIndex(s,o)]=-l,e}const Dn=new V,X4=new V,Y4=new V,K4=new V,q4=new V,Z4=new Ue,Q4={diagonal:new Ue,unitary:new Ue};function J4(t,e=new Ug){if(!t||t.length===0)return e.halfAxes=new Ue([0,0,0,0,0,0,0,0,0]),e.center=new V,e;const n=t.length,i=new V(0,0,0);for(const k of t)i.add(k);const r=1/n;i.multiplyByScalar(r);let s=0,o=0,a=0,l=0,c=0,u=0;for(const k of t){const D=Dn.copy(k).subtract(i);s+=D.x*D.x,o+=D.x*D.y,a+=D.x*D.z,l+=D.y*D.y,c+=D.y*D.z,u+=D.z*D.z}s*=r,o*=r,a*=r,l*=r,c*=r,u*=r;const h=Z4;h[0]=s,h[1]=o,h[2]=a,h[3]=o,h[4]=l,h[5]=c,h[6]=a,h[7]=c,h[8]=u;const{unitary:f}=j4(h,Q4),d=e.halfAxes.copy(f);let p=d.getColumn(0,Y4),v=d.getColumn(1,K4),A=d.getColumn(2,q4),y=-Number.MAX_VALUE,g=-Number.MAX_VALUE,_=-Number.MAX_VALUE,E=Number.MAX_VALUE,R=Number.MAX_VALUE,P=Number.MAX_VALUE;for(const k of t)Dn.copy(k),y=Math.max(Dn.dot(p),y),g=Math.max(Dn.dot(v),g),_=Math.max(Dn.dot(A),_),E=Math.min(Dn.dot(p),E),R=Math.min(Dn.dot(v),R),P=Math.min(Dn.dot(A),P);p=p.multiplyByScalar(.5*(E+y)),v=v.multiplyByScalar(.5*(R+g)),A=A.multiplyByScalar(.5*(P+_)),e.center.copy(p).add(v).add(A);const I=X4.set(y-E,g-R,_-P).multiplyByScalar(.5),O=new Ue([I[0],0,0,0,I[1],0,0,0,I[2]]);return e.halfAxes.multiplyRight(O),e}const Dr=512,fv=3,oS=[[.5,.5],[0,0],[0,1],[1,0],[1,1]],aS=oS.concat([[0,.5],[.5,0],[1,.5],[.5,1]]),G4=aS.concat([[.25,.5],[.75,.5]]);class Br{constructor(e,n,i){this.x=e,this.y=n,this.z=i}get children(){if(!this._children){const e=this.x*2,n=this.y*2,i=this.z+1;this._children=[new Br(e,n,i),new Br(e,n+1,i),new Br(e+1,n,i),new Br(e+1,n+1,i)]}return this._children}update(e){const{viewport:n,cullingVolume:i,elevationBounds:r,minZ:s,maxZ:o,bounds:a,offset:l,project:c}=e,u=this.getBoundingVolume(r,l,c);if(a&&!this.insideBounds(a)||i.computeVisibility(u)<0)return!1;if(!this.childVisible){let{z:f}=this;if(f<o&&f>=s){const d=u.distanceTo(n.cameraPosition)*n.scale/n.height;f+=Math.floor(Math.log2(d))}if(f>=o)return this.selected=!0,!0}this.selected=!1,this.childVisible=!0;for(const f of this.children)f.update(e);return!0}getSelected(e=[]){if(this.selected&&e.push(this),this._children)for(const n of this._children)n.getSelected(e);return e}insideBounds([e,n,i,r]){const s=Math.pow(2,this.z),o=Dr/s;return this.x*o<i&&this.y*o<r&&(this.x+1)*o>e&&(this.y+1)*o>n}getBoundingVolume(e,n,i){if(i){const l=this.z<1?G4:this.z<2?aS:oS,c=[];for(const u of l){const h=dp(this.x+u[0],this.y+u[1],this.z);h[2]=e[0],c.push(i(h)),e[0]!==e[1]&&(h[2]=e[1],c.push(i(h)))}return J4(c)}const r=Math.pow(2,this.z),s=Dr/r,o=this.x*s+n*Dr,a=Dr-(this.y+1)*s;return new Dg([o,a,e[0]],[o+s,a+s,e[1]])}}function eL(t,e,n,i){const r=t instanceof HD&&t.resolution?t.projectPosition:null,s=Object.values(t.getFrustumPlanes()).map(({normal:d,distance:p})=>new Qo(d.clone().negate(),p)),o=new vn(s),a=t.distanceScales.unitsPerMeter[2],l=n&&n[0]*a||0,c=n&&n[1]*a||0,u=t instanceof as&&t.pitch<=60?e:0;if(i){const[d,p,v,A]=i,y=rs([d,A]),g=rs([v,p]);i=[y[0],Dr-y[1],g[0],Dr-g[1]]}const h=new Br(0,0,0),f={viewport:t,project:r,cullingVolume:o,elevationBounds:[l,c],minZ:u,maxZ:e,bounds:i,offset:0};if(h.update(f),t instanceof as&&t.subViewports&&t.subViewports.length>1){for(f.offset=-1;h.update(f)&&!(--f.offset<-fv););for(f.offset=1;h.update(f)&&!(++f.offset>fv););}return h.getSelected()}const Cn=512,tL=[-1/0,-1/0,1/0,1/0],nL={type:"object",value:null,validate:(t,e)=>e.optional&&t===null||typeof t=="string"||Array.isArray(t)&&t.every(n=>typeof n=="string"),equal:(t,e)=>{if(t===e)return!0;if(!Array.isArray(t)||!Array.isArray(e))return!1;const n=t.length;if(n!==e.length)return!1;for(let i=0;i<n;i++)if(t[i]!==e[i])return!1;return!0}};function lS(t,e){const n=[e.transformAsPoint([t[0],t[1]]),e.transformAsPoint([t[2],t[1]]),e.transformAsPoint([t[0],t[3]]),e.transformAsPoint([t[2],t[3]])];return[Math.min(...n.map(r=>r[0])),Math.min(...n.map(r=>r[1])),Math.max(...n.map(r=>r[0])),Math.max(...n.map(r=>r[1]))]}function iL(t){return Math.abs(t.split("").reduce((e,n)=>(e<<5)-e+n.charCodeAt(0)|0,0))}function rL(t,e){if(!t||!t.length)return null;const{index:n,id:i}=e;if(Array.isArray(t)){const s=iL(i)%t.length;t=t[s]}let r=t;for(const s of Object.keys(n)){const o=new RegExp(`{${s}}`,"g");r=r.replace(o,String(n[s]))}return Number.isInteger(n.y)&&Number.isInteger(n.z)&&(r=r.replace(/\{-y\}/g,String(Math.pow(2,n.z)-n.y-1))),r}function sL(t,e,n){let i;if(e&&e.length===2){const[r,s]=e,o=t.getBounds({z:r}),a=t.getBounds({z:s});i=[Math.min(o[0],a[0]),Math.min(o[1],a[1]),Math.max(o[2],a[2]),Math.max(o[3],a[3])]}else i=t.getBounds();return t.isGeospatial?[Math.max(i[0],n[0]),Math.max(i[1],n[1]),Math.min(i[2],n[2]),Math.min(i[3],n[3])]:[Math.max(Math.min(i[0],n[2]),n[0]),Math.max(Math.min(i[1],n[3]),n[1]),Math.min(Math.max(i[2],n[0]),n[2]),Math.min(Math.max(i[3],n[1]),n[3])]}function oL({viewport:t,z:e,cullRect:n}){return(t.subViewports||[t]).map(r=>fp(r,e||0,n))}function fp(t,e,n){if(!Array.isArray(e)){const s=n.x-t.x,o=n.y-t.y,{width:a,height:l}=n,c={targetZ:e},u=t.unproject([s,o],c),h=t.unproject([s+a,o],c),f=t.unproject([s,o+l],c),d=t.unproject([s+a,o+l],c);return[Math.min(u[0],h[0],f[0],d[0]),Math.min(u[1],h[1],f[1],d[1]),Math.max(u[0],h[0],f[0],d[0]),Math.max(u[1],h[1],f[1],d[1])]}const i=fp(t,e[0],n),r=fp(t,e[1],n);return[Math.min(i[0],r[0]),Math.min(i[1],r[1]),Math.max(i[2],r[2]),Math.max(i[3],r[3])]}function aL(t,e,n){return n?lS(t,n).map(r=>r*e/Cn):t.map(i=>i*e/Cn)}function Lg(t,e){return Math.pow(2,t)*Cn/e}function dp(t,e,n){const i=Lg(n,Cn),r=t/i*360-180,s=Math.PI-2*Math.PI*e/i,o=180/Math.PI*Math.atan(.5*(Math.exp(s)-Math.exp(-s)));return[r,o]}function dv(t,e,n,i){const r=Lg(n,i);return[t/r*Cn,e/r*Cn]}function lL(t,e,n,i,r=Cn){if(t.isGeospatial){const[c,u]=dp(e,n,i),[h,f]=dp(e+1,n+1,i);return{west:c,north:u,east:h,south:f}}const[s,o]=dv(e,n,i,r),[a,l]=dv(e+1,n+1,i,r);return{left:s,top:o,right:a,bottom:l}}function cL(t,e,n,i,r){const s=sL(t,null,i),o=Lg(e,n),[a,l,c,u]=aL(s,o,r),h=[];for(let f=Math.floor(a);f<c;f++)for(let d=Math.floor(l);d<u;d++)h.push({x:f,y:d,z:e});return h}function uL({viewport:t,maxZoom:e,minZoom:n,zRange:i,extent:r,tileSize:s=Cn,modelMatrix:o,modelMatrixInverse:a,zoomOffset:l=0}){let c=t.isGeospatial?Math.round(t.zoom+Math.log2(Cn/s))+l:Math.ceil(t.zoom)+l;if(typeof n=="number"&&Number.isFinite(n)&&c<n){if(!r)return[];c=n}typeof e=="number"&&Number.isFinite(e)&&c>e&&(c=e);let u=r;return o&&a&&r&&!t.isGeospatial&&(u=lS(r,o)),t.isGeospatial?eL(t,c,i,r):cL(t,c,s,u||tL,a)}function hL(t){let e={},n;return i=>{for(const r in i)if(!fL(i[r],e[r])){n=t(i),e=i;break}return n}}function fL(t,e){if(t===e)return!0;if(Array.isArray(t)){const n=t.length;if(!e||e.length!==n)return!1;for(let i=0;i<n;i++)if(t[i]!==e[i])return!1;return!0}return!1}const pv=1,ju=2,dL="never",pL="no-overlap",zg="best-available",gL=5,_L={[zg]:vL,[pL]:TL,[dL]:()=>{}},mL={extent:null,tileSize:512,maxZoom:null,minZoom:null,maxCacheSize:null,maxCacheByteSize:null,refinementStrategy:"best-available",zRange:null,maxRequests:6,debounceTime:0,zoomOffset:0,onTileLoad:()=>{},onTileUnload:()=>{},onTileError:()=>{}};class yL{constructor(e){this._getCullBounds=hL(oL),this.opts={...mL,...e},this.setOptions(this.opts),this.onTileLoad=n=>{var i,r;(r=(i=this.opts).onTileLoad)==null||r.call(i,n),this.opts.maxCacheByteSize&&(this._cacheByteSize+=n.byteLength,this._resizeCache())},this._requestScheduler=new Z3({throttleRequests:this.opts.maxRequests>0||this.opts.debounceTime>0,maxRequests:this.opts.maxRequests,debounceTime:this.opts.debounceTime}),this._cache=new Map,this._tiles=[],this._dirty=!1,this._cacheByteSize=0,this._viewport=null,this._zRange=null,this._selectedTiles=null,this._frameNumber=0,this._modelMatrix=new Je,this._modelMatrixInverse=new Je}get tiles(){return this._tiles}get selectedTiles(){return this._selectedTiles}get isLoaded(){return this._selectedTiles!==null&&this._selectedTiles.every(e=>e.isLoaded)}get needsReload(){return this._selectedTiles!==null&&this._selectedTiles.some(e=>e.needsReload)}setOptions(e){Object.assign(this.opts,e),Number.isFinite(e.maxZoom)&&(this._maxZoom=Math.floor(e.maxZoom)),Number.isFinite(e.minZoom)&&(this._minZoom=Math.ceil(e.minZoom))}finalize(){for(const e of this._cache.values())e.isLoading&&e.abort();this._cache.clear(),this._tiles=[],this._selectedTiles=null}reloadAll(){for(const e of this._cache.keys()){const n=this._cache.get(e);!this._selectedTiles||!this._selectedTiles.includes(n)?this._cache.delete(e):n.setNeedsReload()}}update(e,{zRange:n,modelMatrix:i}={zRange:null,modelMatrix:null}){const r=i?new Je(i):new Je,s=!r.equals(this._modelMatrix);if(!this._viewport||!e.equals(this._viewport)||!wn(this._zRange,n)||s){s&&(this._modelMatrixInverse=r.clone().invert(),this._modelMatrix=r),this._viewport=e,this._zRange=n;const a=this.getTileIndices({viewport:e,maxZoom:this._maxZoom,minZoom:this._minZoom,zRange:n,modelMatrix:this._modelMatrix,modelMatrixInverse:this._modelMatrixInverse});this._selectedTiles=a.map(l=>this._getTile(l,!0)),this._dirty&&this._rebuildTree()}else this.needsReload&&(this._selectedTiles=this._selectedTiles.map(a=>this._getTile(a.index,!0)));const o=this.updateTileStates();return this._pruneRequests(),this._dirty&&this._resizeCache(),o&&this._frameNumber++,this._frameNumber}isTileVisible(e,n){if(!e.isVisible)return!1;if(n&&this._viewport){const i=this._getCullBounds({viewport:this._viewport,z:this._zRange,cullRect:n}),{bbox:r}=e;for(const[s,o,a,l]of i){let c;if("west"in r)c=r.west<a&&r.east>s&&r.south<l&&r.north>o;else{const u=Math.min(r.top,r.bottom),h=Math.max(r.top,r.bottom);c=r.left<a&&r.right>s&&u<l&&h>o}if(c)return!0}return!1}return!0}getTileIndices({viewport:e,maxZoom:n,minZoom:i,zRange:r,modelMatrix:s,modelMatrixInverse:o}){const{tileSize:a,extent:l,zoomOffset:c}=this.opts;return uL({viewport:e,maxZoom:n,minZoom:i,zRange:r,tileSize:a,extent:l,modelMatrix:s,modelMatrixInverse:o,zoomOffset:c})}getTileId(e){return`${e.x}-${e.y}-${e.z}`}getTileZoom(e){return e.z}getTileMetadata(e){const{tileSize:n}=this.opts;return{bbox:lL(this._viewport,e.x,e.y,e.z,n)}}getParentIndex(e){const n=Math.floor(e.x/2),i=Math.floor(e.y/2),r=e.z-1;return{x:n,y:i,z:r}}updateTileStates(){const e=this.opts.refinementStrategy||zg,n=new Array(this._cache.size);let i=0;for(const r of this._cache.values())n[i++]=r.isVisible,r.isSelected=!1,r.isVisible=!1;for(const r of this._selectedTiles)r.isSelected=!0,r.isVisible=!0;(typeof e=="function"?e:_L[e])(Array.from(this._cache.values())),i=0;for(const r of this._cache.values())if(n[i++]!==r.isVisible)return!0;return!1}_pruneRequests(){const{maxRequests:e=0}=this.opts,n=[];let i=0;for(const r of this._cache.values())r.isLoading&&(i++,!r.isSelected&&!r.isVisible&&n.push(r));for(;e>0&&i>e&&n.length>0;)n.shift().abort(),i--}_rebuildTree(){const{_cache:e}=this;for(const n of e.values())n.parent=null,n.children&&(n.children.length=0);for(const n of e.values()){const i=this._getNearestAncestor(n);n.parent=i,i!=null&&i.children&&i.children.push(n)}}_resizeCache(){var o,a;const{_cache:e,opts:n}=this,i=n.maxCacheSize||(n.maxCacheByteSize?1/0:gL*this.selectedTiles.length),r=n.maxCacheByteSize||1/0;if(e.size>i||this._cacheByteSize>r){for(const[l,c]of e)if(!c.isVisible&&!c.isSelected&&(this._cacheByteSize-=n.maxCacheByteSize?c.byteLength:0,e.delete(l),(a=(o=this.opts).onTileUnload)==null||a.call(o,c)),e.size<=i&&this._cacheByteSize<=r)break;this._rebuildTree(),this._dirty=!0}this._dirty&&(this._tiles=Array.from(this._cache.values()).sort((l,c)=>l.zoom-c.zoom),this._dirty=!1)}_getTile(e,n){const i=this.getTileId(e);let r=this._cache.get(i),s=!1;return!r&&n?(r=new N4(e),Object.assign(r,this.getTileMetadata(r.index)),Object.assign(r,{id:i,zoom:this.getTileZoom(r.index)}),s=!0,this._cache.set(i,r),this._dirty=!0):r&&r.needsReload&&(s=!0),r&&s&&r.loadData({getData:this.opts.getTileData,requestScheduler:this._requestScheduler,onLoad:this.onTileLoad,onError:this.opts.onTileError}),r}_getNearestAncestor(e){const{_minZoom:n=0}=this;let i=e.index;for(;this.getTileZoom(i)>n;){i=this.getParentIndex(i);const r=this._getTile(i);if(r)return r}return null}}function vL(t){for(const e of t)e.state=0;for(const e of t)e.isSelected&&!cS(e)&&Vg(e);for(const e of t)e.isVisible=!!(e.state&ju)}function TL(t){for(const n of t)n.state=0;for(const n of t)n.isSelected&&cS(n);const e=Array.from(t).sort((n,i)=>n.zoom-i.zoom);for(const n of e)if(n.isVisible=!!(n.state&ju),n.children&&(n.isVisible||n.state&pv))for(const i of n.children)i.state=pv;else n.isSelected&&Vg(n)}function cS(t){let e=t;for(;e;){if(e.isLoaded||e.content)return e.state|=ju,!0;e=e.parent}return!1}function Vg(t){for(const e of t.children)e.isLoaded||e.content?e.state|=ju:Vg(e)}const wL={TilesetClass:yL,data:{type:"data",value:[]},dataComparator:nL.equal,renderSubLayers:{type:"function",value:t=>new Dc(t)},getTileData:{type:"function",optional:!0,value:null},onViewportLoad:{type:"function",optional:!0,value:null},onTileLoad:{type:"function",value:t=>{}},onTileUnload:{type:"function",value:t=>{}},onTileError:{type:"function",value:t=>console.error(t)},extent:{type:"array",optional:!0,value:null,compare:!0},tileSize:512,maxZoom:null,minZoom:0,maxCacheSize:null,maxCacheByteSize:null,refinementStrategy:zg,zRange:null,maxRequests:6,debounceTime:0,zoomOffset:0},uu=class uu extends jo{initializeState(){this.state={tileset:null,isLoaded:!1}}finalizeState(){var e,n;(n=(e=this.state)==null?void 0:e.tileset)==null||n.finalize()}get isLoaded(){var e,n,i;return!!((i=(n=(e=this.state)==null?void 0:e.tileset)==null?void 0:n.selectedTiles)!=null&&i.every(r=>r.isLoaded&&r.layers&&r.layers.every(s=>s.isLoaded)))}shouldUpdateState({changeFlags:e}){return e.somethingChanged}updateState({changeFlags:e}){let{tileset:n}=this.state;const i=e.propsOrDataChanged||e.updateTriggersChanged,r=e.dataChanged||e.updateTriggersChanged&&(e.updateTriggersChanged.all||e.updateTriggersChanged.getTileData);n?i&&(n.setOptions(this._getTilesetOptions()),r?n.reloadAll():n.tiles.forEach(s=>{s.layers=null})):(n=new this.props.TilesetClass(this._getTilesetOptions()),this.setState({tileset:n})),this._updateTileset()}_getTilesetOptions(){const{tileSize:e,maxCacheSize:n,maxCacheByteSize:i,refinementStrategy:r,extent:s,maxZoom:o,minZoom:a,maxRequests:l,debounceTime:c,zoomOffset:u}=this.props;return{maxCacheSize:n,maxCacheByteSize:i,maxZoom:o,minZoom:a,tileSize:e,refinementStrategy:r,extent:s,maxRequests:l,debounceTime:c,zoomOffset:u,getTileData:this.getTileData.bind(this),onTileLoad:this._onTileLoad.bind(this),onTileError:this._onTileError.bind(this),onTileUnload:this._onTileUnload.bind(this)}}_updateTileset(){const e=this.state.tileset,{zRange:n,modelMatrix:i}=this.props,r=e.update(this.context.viewport,{zRange:n,modelMatrix:i}),{isLoaded:s}=e,o=this.state.isLoaded!==s,a=this.state.frameNumber!==r;s&&(o||a)&&this._onViewportLoad(),a&&this.setState({frameNumber:r}),this.state.isLoaded=s}_onViewportLoad(){const{tileset:e}=this.state,{onViewportLoad:n}=this.props;n&&n(e.selectedTiles)}_onTileLoad(e){this.props.onTileLoad(e),e.layers=null,this.setNeedsUpdate()}_onTileError(e,n){this.props.onTileError(e),n.layers=null,this.setNeedsUpdate()}_onTileUnload(e){this.props.onTileUnload(e)}getTileData(e){const{data:n,getTileData:i,fetch:r}=this.props,{signal:s}=e;return e.url=typeof n=="string"||Array.isArray(n)?rL(n,e):null,i?i(e):r&&e.url?r(e.url,{propName:"data",layer:this,signal:s}):null}renderSubLayers(e){return this.props.renderSubLayers(e)}getSubLayerPropsByTile(e){return null}getPickingInfo(e){const n=e.sourceLayer.props.tile,i=e.info;return i.picked&&(i.tile=n),i.sourceTile=n,i}_updateAutoHighlight(e){const n=e.sourceTile;if(n&&n.layers)for(const i of n.layers)i.updateAutoHighlight(e)}renderLayers(){return this.state.tileset.tiles.map(e=>{const n=this.getSubLayerPropsByTile(e);if(!(!e.isLoaded&&!e.content))if(e.layers)n&&e.layers[0]&&Object.keys(n).some(i=>e.layers[0].props[i]!==n[i])&&(e.layers=e.layers.map(i=>i.clone(n)));else{const i=this.renderSubLayers({...this.props,...this.getSubLayerProps({id:e.id,updateTriggers:this.props.updateTriggers}),data:e.content,_offset:0,tile:e});e.layers=Iu(i,Boolean).map(r=>r.clone({tile:e,...n}))}return e.layers})}filterSubLayer({layer:e,cullRect:n}){const{tile:i}=e.props;return this.state.tileset.isTileVisible(i,n)}};uu.defaultProps=wL,uu.layerName="TileLayer";let pp=uu;function EL(t,e,n){const i=SL(t),r=Object.keys(i).filter(s=>i[s]!==Array);return AL(t,{propArrayTypes:i,...e},{numericPropKeys:n&&n.numericPropKeys||r,PositionDataType:n?n.PositionDataType:Float32Array,triangulate:n?n.triangulate:!0})}function SL(t){const e={};for(const n of t)if(n.properties)for(const i in n.properties){const r=n.properties[i];e[i]=ML(r,e[i])}return e}function AL(t,e,n){const{pointPositionsCount:i,pointFeaturesCount:r,linePositionsCount:s,linePathsCount:o,lineFeaturesCount:a,polygonPositionsCount:l,polygonObjectsCount:c,polygonRingsCount:u,polygonFeaturesCount:h,propArrayTypes:f,coordLength:d}=e,{numericPropKeys:p=[],PositionDataType:v=Float32Array,triangulate:A=!0}=n,y=t[0]&&"id"in t[0],g=t.length>65535?Uint32Array:Uint16Array,_={type:"Point",positions:new v(i*d),globalFeatureIds:new g(i),featureIds:r>65535?new Uint32Array(i):new Uint16Array(i),numericProps:{},properties:[],fields:[]},E={type:"LineString",pathIndices:s>65535?new Uint32Array(o+1):new Uint16Array(o+1),positions:new v(s*d),globalFeatureIds:new g(s),featureIds:a>65535?new Uint32Array(s):new Uint16Array(s),numericProps:{},properties:[],fields:[]},R={type:"Polygon",polygonIndices:l>65535?new Uint32Array(c+1):new Uint16Array(c+1),primitivePolygonIndices:l>65535?new Uint32Array(u+1):new Uint16Array(u+1),positions:new v(l*d),globalFeatureIds:new g(l),featureIds:h>65535?new Uint32Array(l):new Uint16Array(l),numericProps:{},properties:[],fields:[]};A&&(R.triangles=[]);for(const I of[_,E,R])for(const O of p){const k=f[O];I.numericProps[O]=new k(I.positions.length/d)}E.pathIndices[o]=s,R.polygonIndices[c]=l,R.primitivePolygonIndices[u]=l;const P={pointPosition:0,pointFeature:0,linePosition:0,linePath:0,lineFeature:0,polygonPosition:0,polygonObject:0,polygonRing:0,polygonFeature:0,feature:0};for(const I of t){const O=I.geometry,k=I.properties||{};switch(O.type){case"Point":xL(O,_,P,d,k),_.properties.push(hf(k,p)),y&&_.fields.push({id:I.id}),P.pointFeature++;break;case"LineString":RL(O,E,P,d,k),E.properties.push(hf(k,p)),y&&E.fields.push({id:I.id}),P.lineFeature++;break;case"Polygon":bL(O,R,P,d,k),R.properties.push(hf(k,p)),y&&R.fields.push({id:I.id}),P.polygonFeature++;break;default:throw new Error("Invalid geometry type")}P.feature++}return PL(_,E,R,d)}function xL(t,e,n,i,r){e.positions.set(t.data,n.pointPosition*i);const s=t.data.length/i;jg(e,r,n.pointPosition,s),e.globalFeatureIds.fill(n.feature,n.pointPosition,n.pointPosition+s),e.featureIds.fill(n.pointFeature,n.pointPosition,n.pointPosition+s),n.pointPosition+=s}function RL(t,e,n,i,r){e.positions.set(t.data,n.linePosition*i);const s=t.data.length/i;jg(e,r,n.linePosition,s),e.globalFeatureIds.fill(n.feature,n.linePosition,n.linePosition+s),e.featureIds.fill(n.lineFeature,n.linePosition,n.linePosition+s);for(let o=0,a=t.indices.length;o<a;++o){const l=t.indices[o],c=o===a-1?t.data.length:t.indices[o+1];e.pathIndices[n.linePath++]=n.linePosition,n.linePosition+=(c-l)/i}}function bL(t,e,n,i,r){e.positions.set(t.data,n.polygonPosition*i);const s=t.data.length/i;jg(e,r,n.polygonPosition,s),e.globalFeatureIds.fill(n.feature,n.polygonPosition,n.polygonPosition+s),e.featureIds.fill(n.polygonFeature,n.polygonPosition,n.polygonPosition+s);for(let o=0,a=t.indices.length;o<a;++o){const l=n.polygonPosition;e.polygonIndices[n.polygonObject++]=l;const c=t.areas[o],u=t.indices[o],h=t.indices[o+1];for(let d=0,p=u.length;d<p;++d){const v=u[d],A=d===p-1?h===void 0?t.data.length:h[0]:u[d+1];e.primitivePolygonIndices[n.polygonRing++]=n.polygonPosition,n.polygonPosition+=(A-v)/i}const f=n.polygonPosition;CL(e,c,u,{startPosition:l,endPosition:f,coordLength:i})}}function CL(t,e,n,{startPosition:i,endPosition:r,coordLength:s}){if(!t.triangles)return;const o=i*s,a=r*s,l=t.positions.subarray(o,a),c=n[0],u=n.slice(1).map(f=>(f-c)/s),h=KB(l,u,s,e);for(let f=0,d=h.length;f<d;++f)t.triangles.push(i+h[f])}function uf(t,e){const n={};for(const i in t)n[i]={value:t[i],size:e};return n}function PL(t,e,n,i){const r={shape:"binary-feature-collection",points:{...t,positions:{value:t.positions,size:i},globalFeatureIds:{value:t.globalFeatureIds,size:1},featureIds:{value:t.featureIds,size:1},numericProps:uf(t.numericProps,1)},lines:{...e,positions:{value:e.positions,size:i},pathIndices:{value:e.pathIndices,size:1},globalFeatureIds:{value:e.globalFeatureIds,size:1},featureIds:{value:e.featureIds,size:1},numericProps:uf(e.numericProps,1)},polygons:{...n,positions:{value:n.positions,size:i},polygonIndices:{value:n.polygonIndices,size:1},primitivePolygonIndices:{value:n.primitivePolygonIndices,size:1},globalFeatureIds:{value:n.globalFeatureIds,size:1},featureIds:{value:n.featureIds,size:1},numericProps:uf(n.numericProps,1)}};return r.polygons&&n.triangles&&(r.polygons.triangles={value:new Uint32Array(n.triangles),size:1}),r}function jg(t,e,n,i){for(const r in t.numericProps)if(r in e){const s=e[r];t.numericProps[r].fill(s,n,n+i)}}function hf(t,e){const n={};for(const i in t)e.includes(i)||(n[i]=t[i]);return n}function ML(t,e){return e===Array||!Number.isFinite(t)?Array:e===Float64Array||Math.fround(t)!==t?Float64Array:Float32Array}var Wg={};/*! ieee754. BSD-3-Clause License. Feross Aboukhadijeh <https://feross.org/opensource> */Wg.read=function(t,e,n,i,r){var s,o,a=r*8-i-1,l=(1<<a)-1,c=l>>1,u=-7,h=n?r-1:0,f=n?-1:1,d=t[e+h];for(h+=f,s=d&(1<<-u)-1,d>>=-u,u+=a;u>0;s=s*256+t[e+h],h+=f,u-=8);for(o=s&(1<<-u)-1,s>>=-u,u+=i;u>0;o=o*256+t[e+h],h+=f,u-=8);if(s===0)s=1-c;else{if(s===l)return o?NaN:(d?-1:1)*(1/0);o=o+Math.pow(2,i),s=s-c}return(d?-1:1)*o*Math.pow(2,s-i)};Wg.write=function(t,e,n,i,r,s){var o,a,l,c=s*8-r-1,u=(1<<c)-1,h=u>>1,f=r===23?Math.pow(2,-24)-Math.pow(2,-77):0,d=i?0:s-1,p=i?1:-1,v=e<0||e===0&&1/e<0?1:0;for(e=Math.abs(e),isNaN(e)||e===1/0?(a=isNaN(e)?1:0,o=u):(o=Math.floor(Math.log(e)/Math.LN2),e*(l=Math.pow(2,-o))<1&&(o--,l*=2),o+h>=1?e+=f/l:e+=f*Math.pow(2,1-h),e*l>=2&&(o++,l/=2),o+h>=u?(a=0,o=u):o+h>=1?(a=(e*l-1)*Math.pow(2,r),o=o+h):(a=e*Math.pow(2,h-1)*Math.pow(2,r),o=0));r>=8;t[n+d]=a&255,d+=p,a/=256,r-=8);for(o=o<<r|a,c+=r;c>0;t[n+d]=o&255,d+=p,o/=256,c-=8);t[n+d-p]|=v*128};var IL=te,gl=Wg;function te(t){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(t)?t:new Uint8Array(t||0),this.pos=0,this.type=0,this.length=this.buf.length}te.Varint=0;te.Fixed64=1;te.Bytes=2;te.Fixed32=5;var gp=65536*65536,gv=1/gp,OL=12,uS=typeof TextDecoder>"u"?null:new TextDecoder("utf8");te.prototype={destroy:function(){this.buf=null},readFields:function(t,e,n){for(n=n||this.length;this.pos<n;){var i=this.readVarint(),r=i>>3,s=this.pos;this.type=i&7,t(r,e,this),this.pos===s&&this.skip(i)}return e},readMessage:function(t,e){return this.readFields(t,e,this.readVarint()+this.pos)},readFixed32:function(){var t=_l(this.buf,this.pos);return this.pos+=4,t},readSFixed32:function(){var t=mv(this.buf,this.pos);return this.pos+=4,t},readFixed64:function(){var t=_l(this.buf,this.pos)+_l(this.buf,this.pos+4)*gp;return this.pos+=8,t},readSFixed64:function(){var t=_l(this.buf,this.pos)+mv(this.buf,this.pos+4)*gp;return this.pos+=8,t},readFloat:function(){var t=gl.read(this.buf,this.pos,!0,23,4);return this.pos+=4,t},readDouble:function(){var t=gl.read(this.buf,this.pos,!0,52,8);return this.pos+=8,t},readVarint:function(t){var e=this.buf,n,i;return i=e[this.pos++],n=i&127,i<128||(i=e[this.pos++],n|=(i&127)<<7,i<128)||(i=e[this.pos++],n|=(i&127)<<14,i<128)||(i=e[this.pos++],n|=(i&127)<<21,i<128)?n:(i=e[this.pos],n|=(i&15)<<28,NL(n,t,this))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var t=this.readVarint();return t%2===1?(t+1)/-2:t/2},readBoolean:function(){return!!this.readVarint()},readString:function(){var t=this.readVarint()+this.pos,e=this.pos;return this.pos=t,t-e>=OL&&uS?YL(this.buf,e,t):XL(this.buf,e,t)},readBytes:function(){var t=this.readVarint()+this.pos,e=this.buf.subarray(this.pos,t);return this.pos=t,e},readPackedVarint:function(t,e){if(this.type!==te.Bytes)return t.push(this.readVarint(e));var n=hn(this);for(t=t||[];this.pos<n;)t.push(this.readVarint(e));return t},readPackedSVarint:function(t){if(this.type!==te.Bytes)return t.push(this.readSVarint());var e=hn(this);for(t=t||[];this.pos<e;)t.push(this.readSVarint());return t},readPackedBoolean:function(t){if(this.type!==te.Bytes)return t.push(this.readBoolean());var e=hn(this);for(t=t||[];this.pos<e;)t.push(this.readBoolean());return t},readPackedFloat:function(t){if(this.type!==te.Bytes)return t.push(this.readFloat());var e=hn(this);for(t=t||[];this.pos<e;)t.push(this.readFloat());return t},readPackedDouble:function(t){if(this.type!==te.Bytes)return t.push(this.readDouble());var e=hn(this);for(t=t||[];this.pos<e;)t.push(this.readDouble());return t},readPackedFixed32:function(t){if(this.type!==te.Bytes)return t.push(this.readFixed32());var e=hn(this);for(t=t||[];this.pos<e;)t.push(this.readFixed32());return t},readPackedSFixed32:function(t){if(this.type!==te.Bytes)return t.push(this.readSFixed32());var e=hn(this);for(t=t||[];this.pos<e;)t.push(this.readSFixed32());return t},readPackedFixed64:function(t){if(this.type!==te.Bytes)return t.push(this.readFixed64());var e=hn(this);for(t=t||[];this.pos<e;)t.push(this.readFixed64());return t},readPackedSFixed64:function(t){if(this.type!==te.Bytes)return t.push(this.readSFixed64());var e=hn(this);for(t=t||[];this.pos<e;)t.push(this.readSFixed64());return t},skip:function(t){var e=t&7;if(e===te.Varint)for(;this.buf[this.pos++]>127;);else if(e===te.Bytes)this.pos=this.readVarint()+this.pos;else if(e===te.Fixed32)this.pos+=4;else if(e===te.Fixed64)this.pos+=8;else throw new Error("Unimplemented type: "+e)},writeTag:function(t,e){this.writeVarint(t<<3|e)},realloc:function(t){for(var e=this.length||16;e<this.pos+t;)e*=2;if(e!==this.length){var n=new Uint8Array(e);n.set(this.buf),this.buf=n,this.length=e}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(t){this.realloc(4),dr(this.buf,t,this.pos),this.pos+=4},writeSFixed32:function(t){this.realloc(4),dr(this.buf,t,this.pos),this.pos+=4},writeFixed64:function(t){this.realloc(8),dr(this.buf,t&-1,this.pos),dr(this.buf,Math.floor(t*gv),this.pos+4),this.pos+=8},writeSFixed64:function(t){this.realloc(8),dr(this.buf,t&-1,this.pos),dr(this.buf,Math.floor(t*gv),this.pos+4),this.pos+=8},writeVarint:function(t){if(t=+t||0,t>268435455||t<0){kL(t,this);return}this.realloc(4),this.buf[this.pos++]=t&127|(t>127?128:0),!(t<=127)&&(this.buf[this.pos++]=(t>>>=7)&127|(t>127?128:0),!(t<=127)&&(this.buf[this.pos++]=(t>>>=7)&127|(t>127?128:0),!(t<=127)&&(this.buf[this.pos++]=t>>>7&127)))},writeSVarint:function(t){this.writeVarint(t<0?-t*2-1:t*2)},writeBoolean:function(t){this.writeVarint(!!t)},writeString:function(t){t=String(t),this.realloc(t.length*4),this.pos++;var e=this.pos;this.pos=KL(this.buf,t,this.pos);var n=this.pos-e;n>=128&&_v(e,n,this),this.pos=e-1,this.writeVarint(n),this.pos+=n},writeFloat:function(t){this.realloc(4),gl.write(this.buf,t,this.pos,!0,23,4),this.pos+=4},writeDouble:function(t){this.realloc(8),gl.write(this.buf,t,this.pos,!0,52,8),this.pos+=8},writeBytes:function(t){var e=t.length;this.writeVarint(e),this.realloc(e);for(var n=0;n<e;n++)this.buf[this.pos++]=t[n]},writeRawMessage:function(t,e){this.pos++;var n=this.pos;t(e,this);var i=this.pos-n;i>=128&&_v(n,i,this),this.pos=n-1,this.writeVarint(i),this.pos+=i},writeMessage:function(t,e,n){this.writeTag(t,te.Bytes),this.writeRawMessage(e,n)},writePackedVarint:function(t,e){e.length&&this.writeMessage(t,BL,e)},writePackedSVarint:function(t,e){e.length&&this.writeMessage(t,UL,e)},writePackedBoolean:function(t,e){e.length&&this.writeMessage(t,VL,e)},writePackedFloat:function(t,e){e.length&&this.writeMessage(t,LL,e)},writePackedDouble:function(t,e){e.length&&this.writeMessage(t,zL,e)},writePackedFixed32:function(t,e){e.length&&this.writeMessage(t,jL,e)},writePackedSFixed32:function(t,e){e.length&&this.writeMessage(t,WL,e)},writePackedFixed64:function(t,e){e.length&&this.writeMessage(t,HL,e)},writePackedSFixed64:function(t,e){e.length&&this.writeMessage(t,$L,e)},writeBytesField:function(t,e){this.writeTag(t,te.Bytes),this.writeBytes(e)},writeFixed32Field:function(t,e){this.writeTag(t,te.Fixed32),this.writeFixed32(e)},writeSFixed32Field:function(t,e){this.writeTag(t,te.Fixed32),this.writeSFixed32(e)},writeFixed64Field:function(t,e){this.writeTag(t,te.Fixed64),this.writeFixed64(e)},writeSFixed64Field:function(t,e){this.writeTag(t,te.Fixed64),this.writeSFixed64(e)},writeVarintField:function(t,e){this.writeTag(t,te.Varint),this.writeVarint(e)},writeSVarintField:function(t,e){this.writeTag(t,te.Varint),this.writeSVarint(e)},writeStringField:function(t,e){this.writeTag(t,te.Bytes),this.writeString(e)},writeFloatField:function(t,e){this.writeTag(t,te.Fixed32),this.writeFloat(e)},writeDoubleField:function(t,e){this.writeTag(t,te.Fixed64),this.writeDouble(e)},writeBooleanField:function(t,e){this.writeVarintField(t,!!e)}};function NL(t,e,n){var i=n.buf,r,s;if(s=i[n.pos++],r=(s&112)>>4,s<128||(s=i[n.pos++],r|=(s&127)<<3,s<128)||(s=i[n.pos++],r|=(s&127)<<10,s<128)||(s=i[n.pos++],r|=(s&127)<<17,s<128)||(s=i[n.pos++],r|=(s&127)<<24,s<128)||(s=i[n.pos++],r|=(s&1)<<31,s<128))return fr(t,r,e);throw new Error("Expected varint not more than 10 bytes")}function hn(t){return t.type===te.Bytes?t.readVarint()+t.pos:t.pos+1}function fr(t,e,n){return n?e*4294967296+(t>>>0):(e>>>0)*4294967296+(t>>>0)}function kL(t,e){var n,i;if(t>=0?(n=t%4294967296|0,i=t/4294967296|0):(n=~(-t%4294967296),i=~(-t/4294967296),n^4294967295?n=n+1|0:(n=0,i=i+1|0)),t>=18446744073709552e3||t<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");e.realloc(10),FL(n,i,e),DL(i,e)}function FL(t,e,n){n.buf[n.pos++]=t&127|128,t>>>=7,n.buf[n.pos++]=t&127|128,t>>>=7,n.buf[n.pos++]=t&127|128,t>>>=7,n.buf[n.pos++]=t&127|128,t>>>=7,n.buf[n.pos]=t&127}function DL(t,e){var n=(t&7)<<4;e.buf[e.pos++]|=n|((t>>>=3)?128:0),t&&(e.buf[e.pos++]=t&127|((t>>>=7)?128:0),t&&(e.buf[e.pos++]=t&127|((t>>>=7)?128:0),t&&(e.buf[e.pos++]=t&127|((t>>>=7)?128:0),t&&(e.buf[e.pos++]=t&127|((t>>>=7)?128:0),t&&(e.buf[e.pos++]=t&127)))))}function _v(t,e,n){var i=e<=16383?1:e<=2097151?2:e<=268435455?3:Math.floor(Math.log(e)/(Math.LN2*7));n.realloc(i);for(var r=n.pos-1;r>=t;r--)n.buf[r+i]=n.buf[r]}function BL(t,e){for(var n=0;n<t.length;n++)e.writeVarint(t[n])}function UL(t,e){for(var n=0;n<t.length;n++)e.writeSVarint(t[n])}function LL(t,e){for(var n=0;n<t.length;n++)e.writeFloat(t[n])}function zL(t,e){for(var n=0;n<t.length;n++)e.writeDouble(t[n])}function VL(t,e){for(var n=0;n<t.length;n++)e.writeBoolean(t[n])}function jL(t,e){for(var n=0;n<t.length;n++)e.writeFixed32(t[n])}function WL(t,e){for(var n=0;n<t.length;n++)e.writeSFixed32(t[n])}function HL(t,e){for(var n=0;n<t.length;n++)e.writeFixed64(t[n])}function $L(t,e){for(var n=0;n<t.length;n++)e.writeSFixed64(t[n])}function _l(t,e){return(t[e]|t[e+1]<<8|t[e+2]<<16)+t[e+3]*16777216}function dr(t,e,n){t[n]=e,t[n+1]=e>>>8,t[n+2]=e>>>16,t[n+3]=e>>>24}function mv(t,e){return(t[e]|t[e+1]<<8|t[e+2]<<16)+(t[e+3]<<24)}function XL(t,e,n){for(var i="",r=e;r<n;){var s=t[r],o=null,a=s>239?4:s>223?3:s>191?2:1;if(r+a>n)break;var l,c,u;a===1?s<128&&(o=s):a===2?(l=t[r+1],(l&192)===128&&(o=(s&31)<<6|l&63,o<=127&&(o=null))):a===3?(l=t[r+1],c=t[r+2],(l&192)===128&&(c&192)===128&&(o=(s&15)<<12|(l&63)<<6|c&63,(o<=2047||o>=55296&&o<=57343)&&(o=null))):a===4&&(l=t[r+1],c=t[r+2],u=t[r+3],(l&192)===128&&(c&192)===128&&(u&192)===128&&(o=(s&15)<<18|(l&63)<<12|(c&63)<<6|u&63,(o<=65535||o>=1114112)&&(o=null))),o===null?(o=65533,a=1):o>65535&&(o-=65536,i+=String.fromCharCode(o>>>10&1023|55296),o=56320|o&1023),i+=String.fromCharCode(o),r+=a}return i}function YL(t,e,n){return uS.decode(t.subarray(e,n))}function KL(t,e,n){for(var i=0,r,s;i<e.length;i++){if(r=e.charCodeAt(i),r>55295&&r<57344)if(s)if(r<56320){t[n++]=239,t[n++]=191,t[n++]=189,s=r;continue}else r=s-55296<<10|r-56320|65536,s=null;else{r>56319||i+1===e.length?(t[n++]=239,t[n++]=191,t[n++]=189):s=r;continue}else s&&(t[n++]=239,t[n++]=191,t[n++]=189,s=null);r<128?t[n++]=r:(r<2048?t[n++]=r>>6|192:(r<65536?t[n++]=r>>12|224:(t[n++]=r>>18|240,t[n++]=r>>12&63|128),t[n++]=r>>6&63|128),t[n++]=r&63|128)}return n}const hS=hu(IL);function qL(t){const e=t.length;if(e<=1)return[t];const n=[];let i,r;for(let s=0;s<e;s++){const o=ZL(t[s]);o!==0&&(r===void 0&&(r=o<0),r===o<0?(i&&n.push(i),i=[t[s]]):i&&i.push(t[s]))}return i&&n.push(i),n}function ZL(t){let e=0;for(let n=0,i=t.length-1,r,s;n<t.length;i=n++)r=t[n],s=t[i],e+=(s[0]-r[0])*(r[1]+s[1]);return e}function QL(t,e,n){e&&n&&(t===1?e.id=n.readVarint():t===2?JL(n,e):t===3?e.type=n.readVarint():t===4&&(e._geometry=n.pos))}function JL(t,e){const n=t.readVarint()+t.pos;for(;t.pos<n;){const i=e._keys[t.readVarint()],r=e._values[t.readVarint()];e.properties[i]=r}}class Hg{constructor(e,n,i,r,s){m(this,"properties");m(this,"extent");m(this,"type");m(this,"id");m(this,"_pbf");m(this,"_geometry");m(this,"_keys");m(this,"_values");this.properties={},this.extent=i,this.type=0,this.id=null,this._pbf=e,this._geometry=-1,this._keys=r,this._values=s,e.readFields(QL,this,n)}static get types(){return["Unknown","Point","LineString","Polygon"]}loadGeometry(){const e=this._pbf;e.pos=this._geometry;const n=e.readVarint()+e.pos;let i=1,r=0,s=0,o=0;const a=[];let l;for(;e.pos<n;){if(r<=0){const c=e.readVarint();i=c&7,r=c>>3}if(r--,i===1||i===2)s+=e.readSVarint(),o+=e.readSVarint(),i===1&&(l&&a.push(l),l=[]),l&&l.push([s,o]);else if(i===7)l&&l.push(l[0].slice());else throw new Error(`unknown command ${i}`)}return l&&a.push(l),a}bbox(){const e=this._pbf;e.pos=this._geometry;const n=e.readVarint()+e.pos;let i=1,r=0,s=0,o=0,a=1/0,l=-1/0,c=1/0,u=-1/0;for(;e.pos<n;){if(r<=0){const h=e.readVarint();i=h&7,r=h>>3}if(r--,i===1||i===2)s+=e.readSVarint(),o+=e.readSVarint(),s<a&&(a=s),s>l&&(l=s),o<c&&(c=o),o>u&&(u=o);else if(i!==7)throw new Error(`unknown command ${i}`)}return[a,c,l,u]}_toGeoJSON(e){let n=this.loadGeometry(),i=Hg.types[this.type],r,s;switch(this.type){case 1:const a=[];for(r=0;r<n.length;r++)a[r]=n[r][0];n=a,e(n,this);break;case 2:for(r=0;r<n.length;r++)e(n[r],this);break;case 3:for(n=qL(n),r=0;r<n.length;r++)for(s=0;s<n[r].length;s++)e(n[r][s],this);break}n.length===1?n=n[0]:i=`Multi${i}`;const o={type:"Feature",geometry:{type:i,coordinates:n},properties:this.properties};return this.id!==null&&(o.id=this.id),o}toGeoJSON(e){if(typeof e=="function")return this._toGeoJSON(e);const{x:n,y:i,z:r}=e,s=this.extent*Math.pow(2,r),o=this.extent*n,a=this.extent*i;function l(c){for(let u=0;u<c.length;u++){const h=c[u];h[0]=(h[0]+o)*360/s-180;const f=180-(h[1]+a)*360/s;h[1]=360/Math.PI*Math.atan(Math.exp(f*Math.PI/180))-90}}return this._toGeoJSON(l)}}class GL{constructor(e,n){m(this,"version");m(this,"name");m(this,"extent");m(this,"length");m(this,"_pbf");m(this,"_keys");m(this,"_values");m(this,"_features");this.version=1,this.name="",this.extent=4096,this.length=0,this._pbf=e,this._keys=[],this._values=[],this._features=[],e.readFields(e6,this,n),this.length=this._features.length}feature(e){if(e<0||e>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[e];const n=this._pbf.readVarint()+this._pbf.pos;return new Hg(this._pbf,n,this.extent,this._keys,this._values)}}function e6(t,e,n){e&&n&&(t===15?e.version=n.readVarint():t===1?e.name=n.readString():t===5?e.extent=n.readVarint():t===2?e._features.push(n.pos):t===3?e._keys.push(n.readString()):t===4&&e._values.push(t6(n)))}function t6(t){let e=null;const n=t.readVarint()+t.pos;for(;t.pos<n;){const i=t.readVarint()>>3;e=i===1?t.readString():i===2?t.readFloat():i===3?t.readDouble():i===4?t.readVarint64():i===5?t.readVarint():i===6?t.readSVarint():i===7?t.readBoolean():null}return e}class n6{constructor(e,n){m(this,"layers");this.layers=e.readFields(i6,{},n)}}function i6(t,e,n){if(t===3&&n){const i=new GL(n,n.readVarint()+n.pos);i.length&&e&&(e[i.name]=i)}}function r6(t){const e=t.indices.length,n="Polygon";if(e<=1)return{type:n,data:t.data,areas:[[Nc(t.data)]],indices:[t.indices]};const i=[],r=[];let s=[],o=[],a,l=0;for(let c,u=0,h;u<e;u++){h=t.indices[u]-l,c=t.indices[u+1]-l||t.data.length;const f=t.data.slice(h,c),d=Nc(f);if(d===0){const p=t.data.slice(0,h),v=t.data.slice(c);t.data=p.concat(v),l+=c-h;continue}a===void 0&&(a=d<0),a===d<0?(o.length&&(i.push(s),r.push(o)),o=[h],s=[d]):(s.push(d),o.push(h))}return s&&i.push(s),o.length&&r.push(o),{type:n,areas:i,indices:r,data:t.data}}function s6(t,e,n,i){for(let r=0,s=t.length;r<s;r+=2){t[r]=(t[r]+e)*360/i-180;const o=180-(t[r+1]+n)*360/i;t[r+1]=360/Math.PI*Math.atan(Math.exp(o*Math.PI/180))-90}}function o6(t,e,n){e&&n&&(t===1?e.id=n.readVarint():t===2?a6(n,e):t===3?e.type=n.readVarint():t===4&&(e._geometry=n.pos))}function a6(t,e){const n=t.readVarint()+t.pos;for(;t.pos<n;){const i=e._keys[t.readVarint()],r=e._values[t.readVarint()];e.properties[i]=r}}let yv,mi,ff,ml,df,pf,js;class l6{constructor(e,n,i,r,s,o){m(this,"properties");m(this,"extent");m(this,"type");m(this,"id");m(this,"_pbf");m(this,"_geometry");m(this,"_keys");m(this,"_values");m(this,"_geometryInfo");this.properties={},this.extent=i,this.type=0,this.id=null,this._pbf=e,this._geometry=-1,this._keys=r,this._values=s,this._geometryInfo=o,e.readFields(o6,this,n)}loadGeometry(){const e=this._pbf;e.pos=this._geometry,yv=e.readVarint()+e.pos,mi=1,ml=0,df=0,pf=0,js=0;const n=[],i=[];for(;e.pos<yv;)if(ml<=0&&(ff=e.readVarint(),mi=ff&7,ml=ff>>3),ml--,mi===1||mi===2)df+=e.readSVarint(),pf+=e.readSVarint(),mi===1&&n.push(js),i.push(df,pf),js+=2;else if(mi===7){if(js>0){const r=n[n.length-1];i.push(i[r],i[r+1]),js+=2}}else throw new Error(`unknown command ${mi}`);return{data:i,indices:n}}_toBinaryCoordinates(e){const n=this.loadGeometry();let i;e(n.data,this);const r=2;switch(this.type){case 1:this._geometryInfo.pointFeaturesCount++,this._geometryInfo.pointPositionsCount+=n.indices.length,i={type:"Point",...n};break;case 2:this._geometryInfo.lineFeaturesCount++,this._geometryInfo.linePathsCount+=n.indices.length,this._geometryInfo.linePositionsCount+=n.data.length/r,i={type:"LineString",...n};break;case 3:i=r6(n),this._geometryInfo.polygonFeaturesCount++,this._geometryInfo.polygonObjectsCount+=i.indices.length;for(const o of i.indices)this._geometryInfo.polygonRingsCount+=o.length;this._geometryInfo.polygonPositionsCount+=i.data.length/r;break;default:throw new Error(`Invalid geometry type: ${this.type}`)}const s={type:"Feature",geometry:i,properties:this.properties};return this.id!==null&&(s.id=this.id),s}toBinaryCoordinates(e){if(typeof e=="function")return this._toBinaryCoordinates(e);const{x:n,y:i,z:r}=e,s=this.extent*Math.pow(2,r),o=this.extent*n,a=this.extent*i;return this._toBinaryCoordinates(l=>s6(l,o,a,s))}}class c6{constructor(e,n){m(this,"version");m(this,"name");m(this,"extent");m(this,"length");m(this,"_pbf");m(this,"_keys");m(this,"_values");m(this,"_features");this.version=1,this.name="",this.extent=4096,this.length=0,this._pbf=e,this._keys=[],this._values=[],this._features=[],e.readFields(u6,this,n),this.length=this._features.length}feature(e,n){if(e<0||e>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[e];const i=this._pbf.readVarint()+this._pbf.pos;return new l6(this._pbf,i,this.extent,this._keys,this._values,n)}}function u6(t,e,n){e&&n&&(t===15?e.version=n.readVarint():t===1?e.name=n.readString():t===5?e.extent=n.readVarint():t===2?e._features.push(n.pos):t===3?e._keys.push(n.readString()):t===4&&e._values.push(h6(n)))}function h6(t){let e=null;const n=t.readVarint()+t.pos;for(;t.pos<n;){const i=t.readVarint()>>3;e=i===1?t.readString():i===2?t.readFloat():i===3?t.readDouble():i===4?t.readVarint64():i===5?t.readVarint():i===6?t.readSVarint():i===7?t.readBoolean():null}return e}class f6{constructor(e,n){m(this,"layers");this.layers=e.readFields(d6,{},n)}}function d6(t,e,n){if(t===3&&n){const i=new c6(n,n.readVarint()+n.pos);i.length&&e&&(e[i.name]=i)}}function vv(t,e){var r,s;const n=g6(e),i=((r=e==null?void 0:e.gis)==null?void 0:r.format)||((s=e==null?void 0:e.mvt)==null?void 0:s.shape)||(e==null?void 0:e.shape);switch(i){case"columnar-table":return{shape:"columnar-table",data:gf(t,n)};case"geojson-table":return{shape:"geojson-table",type:"FeatureCollection",features:Tv(t,n)};case"geojson":return Tv(t,n);case"binary-geometry":return gf(t,n);case"binary":return gf(t,n);default:throw new Error(i||"undefined shape")}}function gf(t,e){const[n,i]=p6(t,e),r=EL(n,i);return r.byteLength=t.byteLength,r}function p6(t,e){const n=[],i={coordLength:2,pointPositionsCount:0,pointFeaturesCount:0,linePositionsCount:0,linePathsCount:0,lineFeaturesCount:0,polygonPositionsCount:0,polygonObjectsCount:0,polygonRingsCount:0,polygonFeaturesCount:0};if(t.byteLength<=0)return[n,i];const r=new f6(new hS(t));return(e&&Array.isArray(e.layers)?e.layers:Object.keys(r.layers)).forEach(o=>{const a=r.layers[o];if(a)for(let l=0;l<a.length;l++){const c=a.feature(l,i),u=m6(c,e,o);n.push(u)}}),[n,i]}function Tv(t,e){if(t.byteLength<=0)return[];const n=[],i=new n6(new hS(t));return(Array.isArray(e.layers)?e.layers:Object.keys(i.layers)).forEach(s=>{const o=i.layers[s];if(o)for(let a=0;a<o.length;a++){const l=o.feature(a),c=_6(l,e,s);n.push(c)}}),n}function g6(t){var r;if(!(t!=null&&t.mvt))throw new Error("mvt options required");const e=((r=t.mvt)==null?void 0:r.coordinates)==="wgs84",{tileIndex:n}=t.mvt,i=n&&Number.isFinite(n.x)&&Number.isFinite(n.y)&&Number.isFinite(n.z);if(e&&!i)throw new Error("MVT Loader: WGS84 coordinates need tileIndex property");return t.mvt}function _6(t,e,n){const i=t.toGeoJSON(e.coordinates==="wgs84"?e.tileIndex:y6);return e.layerProperty&&(i.properties[e.layerProperty]=n),i}function m6(t,e,n){const i=t.toBinaryCoordinates(e.coordinates==="wgs84"?e.tileIndex:v6);return e.layerProperty&&i.properties&&(i.properties[e.layerProperty]=n),i}function y6(t,e){const{extent:n}=e;for(let i=0;i<t.length;i++){const r=t[i];r[0]/=n,r[1]/=n}}function v6(t,e){const{extent:n}=e;for(let i=0,r=t.length;i<r;++i)t[i]/=n}const T6="4.2.0-beta.2",w6={dataType:null,batchType:null,name:"Mapbox Vector Tile",id:"mvt",module:"mvt",version:T6,extensions:["mvt","pbf"],mimeTypes:["application/vnd.mapbox-vector-tile","application/x-protobuf"],worker:!0,category:"geometry",options:{mvt:{shape:"geojson",coordinates:"local",layerProperty:"layerName",layers:void 0,tileIndex:null}}},fS={...w6,parse:async(t,e)=>vv(t,e),parseSync:vv,binary:!0};function E6({info:t}){if(!t.object)return null;const e={position:"absolute",margin:"8px",padding:"4px",background:"rgba(0, 0, 0, 0.8)",color:"#fff",zIndex:9,pointerEvents:"none",fontSize:"14px",borderRadius:"4px",left:t.x,top:t.y};return qe.createElement("div",{style:e},t.object.properties.language_name," ")}K1([fS]);const yt="/us-census-language/";var S6=`${yt}data/tiles/{z}/{x}/{y}.pbf`;const _f=[{id:"C16001_E006",label:"French",url:`${yt}/./data/C16001_E006_250.geojson`,color:[255,255,179,200]},{id:"C16001_E009",label:"German",url:`${yt}/../data/C16001_E009_250.geojson`,color:[190,186,218,200]},{id:"C16001_E012",label:"Russian",url:`${yt}/data/C16001_E012_250.geojson`,color:[251,128,114,200]},{id:"C16001_E015",label:"Other Indo-European",url:`${yt}/data/C16001_E015_250.geojson`,color:[253,180,98,200]},{id:"C16001_E018",label:"Korean",url:`${yt}/data/C16001_E018_250.geojson`,color:[179,222,105,200]},{id:"C16001_E021",label:"Chinese",url:`${yt}/data/C16001_E021_250.geojson`,color:[252,205,229,200]},{id:"C16001_E024",label:"Vietnamese",url:`${yt}/data/C16001_E024_250.geojson`,color:[217,217,217,200]},{id:"C16001_E027",label:"Tagalog",url:`${yt}/data/C16001_E027_250.geojson`,color:[188,128,189,200]},{id:"C16001_E030",label:"Other Asian",url:`${yt}/data/C16001_E030_250.geojson`,color:[204,235,197,200]},{id:"C16001_E033",label:"Arabic",url:`${yt}/data/C16001_E033_250.geojson`,color:[255,237,111,200]},{id:"C16001_E036",label:"Other",url:`${yt}/data/C16001_E036_250.geojson`,color:[255,255,255,200]}];function A6(){const[t,e]=L.useState(_f.reduce((f,d)=>({...f,[d.id]:!0}),{})),[n,i]=L.useState(null),r=f=>{e(d=>({...d,[f]:!d[f]})),i(null)},s=f=>{i(f)},o=()=>{i(null)},[a,l]=L.useState({}),c=_f.filter(f=>t[f.id]&&(!n||f.id===n)).map(f=>new Dc({id:f.id,data:f.url,getFillColor:f.color,filled:!0,pointRadiusMinPixels:1,pointRadiusScale:50,pickable:!0,autoHighlight:!0,onHover:d=>l(d)})),u=new pp({id:"TileLayer",data:S6,loaders:[fS],renderSubLayers:f=>{f.tile},pickable:!0}),h=({layerConfigs:f,visibleLayers:d,toggleLayerVisibility:p})=>qe.createElement("div",{style:{position:"absolute",top:0,right:0,margin:"1rem",padding:"1rem",borderRadius:".5rem",background:"rgba(100,100,100,.8)"}},qe.createElement("h1",{style:{display:"flex",color:"white",justifyContent:"center",fontFamily:"sans-serif",fontSize:"1.2rem"}},"Languages Spoken at Home"),qe.createElement("a",{href:"https://github.com/wrynearson/us-census-language/blob/main/README.md",target:"_blank",rel:"noreferrer noopener",style:{display:"flex",color:"white",justifyContent:"center",fontFamily:"sans-serif",fontSize:"1rem",paddingBottom:".5rem"}},"About"),f.map(v=>qe.createElement("div",{key:v.id,style:{display:"flex",alignItems:"center",paddingBottom:".5rem",wrap:"no-wrap"},onMouseEnter:()=>s(v.id),onMouseLeave:o},qe.createElement("span",{style:{display:"inline-block",width:"1rem",height:"1rem",backgroundColor:`rgb(${v.color.join(",")})`,marginRight:"10px",border:"1px solid rgba(0,0,0,0)"}}),qe.createElement("label",{style:{display:"flex"}},qe.createElement("input",{type:"checkbox",checked:!!d[v.id],onChange:()=>p(v.id)}),qe.createElement("div",{style:{color:"white",fontFamily:"sans-serif",fontSize:"1rem"}},v.label)))));return qe.createElement("div",{style:{position:"auto",height:"100vh"}},qe.createElement(iB,{initialViewState:{longitude:-100,latitude:40,zoom:3,pitch:0},controller:!0,layers:[u,c]},qe.createElement(MB,{mapboxAccessToken:"pk.eyJ1Ijoid3J5bmVhcnNvbiIsImEiOiJjbHR4MG81bmwwMTU3MmxxZmI5cXU0aWo2In0.xdai0JcabfRYAtUDsKteEg",mapStyle:"mapbox://styles/mapbox/dark-v10"}),qe.createElement(E6,{info:a})),qe.createElement(h,{layerConfigs:_f,visibleLayers:t,toggleLayerVisibility:r}))}ug.render(qe.createElement(A6,null),document.getElementById("root"));export{R6 as c,hu as g};
